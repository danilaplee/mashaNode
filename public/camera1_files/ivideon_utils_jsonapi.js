(function(d,e,a){"use strict";var b=e.$,g=i,f=g.prototype,c="ivideon.utils.JsonAPI",h=c;e.provide(c,g);g.NetworkError=e.utils.declareErrorClass(c+".NetworkError",["request","jqXHR"]);g.TimeoutError=e.utils.declareErrorClass(g.NetworkError,c+".TimeoutError",["request","jqXHR"]);
g.AbortError=e.utils.declareErrorClass(g.NetworkError,c+".AbortError",["request","jqXHR"]);g.HTTPError=e.utils.declareErrorClass(c+".HTTPError",["request","jqXHR"]);g.ResponseParseError=e.utils.declareErrorClass(c+".ResponseParseError",["request","jqXHR"]);
g.ResponseError=e.utils.declareErrorClass(c+".ResponseError",["request","jqXHR","response"]);g.ResponseRedirectError=e.utils.declareErrorClass(c+".ResponseRedirectError",["request","jqXHR","response"]);
function i(j){var k=this;k._options=e.optMerge(g.defaults,j);k._options.rootUrl=(k._options.rootUrl||"").replace(/\/+$/,"")+"/";k.errorFilters=[g.emptyResponseFilter,g.redirectFilter]}g.defaults={rootUrl:"/"};
g.emptyResponseFilter=function(n,j,m,p,o){var l,k;if(typeof j!=="object"||j===null){k=g._addErrorDebugInfo(e.tr(h,"error.parse"),n,j,m,p,o,true);l=new g.ResponseParseError(k,n,m)}return l};g.redirectFilter=function(m,j,l,o,n){var k;
if(j&&j.success===false&&j.redirect){d.location.href=j.redirect;k=new g.ResponseRedirectError(j.error?j.error.message||"":"",m,l,j);b.extend(k,j.error);k.errors=(j.errors||(j.error?[j.error]:[]))}return k
};g.successFalseFilter=function(m,j,l){var k;if(j&&j.success===false){k=new g.ResponseError(j.error?j.error.message||"":"",m,l,j);b.extend(k,j.error);k.errors=(j.errors||(j.error?[j.error]:[]))}return k
};g._addErrorDebugInfo=function(k,m,j,l,p,n,o){if(d._DEBUG){k+="\n"+(n&&n.message?((n.name?n.name+": ":"")+n.message):(n||p||"error"));if(o){if(typeof j==="object"&&j!==null){k+="\n"+JSON.stringify(j)}k+="\n"+(l.responseText?" "+l.responseText:" (empty response)")
}}return k};f.request=function(j,n,m,k){var p=this,s=b.Deferred(),l=b.extend({url:p._options.rootUrl+j,type:"get",dataType:"json",data:n,cache:false},p._options.ajaxOptions,m),o={method:j,params:n,ajaxOptions:l},q=(l.dataType==="jsonp"),r;
r=b.ajax(l).done(function(t,w,v){var u;u=p._runErrorFilters(o,t,v,w,null,k);if(u){s.rejectWith(p,[u,t])}else{s.resolveWith(p,[t])}}).fail(function(E,v,y){var A=y,w=null,B,z,C={func:c+"#request fail"},x=E.status,u=(x>=100&&x<600);
if(q){var D;for(D in this){if(D.indexOf("jQuery")===0){d[D]=e.noop;break}}}if(typeof A!=="object"){A=null}E.responseHeaders=E.getAllResponseHeaders();if(!q&&u&&E.responseText){try{w=JSON.parse(E.responseText)
}catch(t){if(!A){A=t}}}B=p._runErrorFilters(o,w,E,v,y,k);if(!B||(B instanceof g.ResponseParseError)){if(y==="timeout"){z=g._addErrorDebugInfo(e.tr(h,"error.timeout"),o,w,E,v,y);B=new g.TimeoutError(z,o,E)
}else{if(y==="abort"||y==="canceled"){z=g._addErrorDebugInfo(e.tr(h,"error.abort"),o,w,E,v,y);B=new g.AbortError(z,o,E)}else{if(y==="parsererror"){z=g._addErrorDebugInfo(e.tr(h,"error.parse"),o,w,E,v,y,true);
B=new g.ResponseParseError(z,o,E)}else{if(!B&&u&&x!==200){z=g._addErrorDebugInfo(e.tr(h,"error.http"),o,w,E,v,y,true);B=new g.HTTPError(z,o,E);B.code=x}else{if(!B||!u){z=g._addErrorDebugInfo(e.tr(h,"error.network"),o,w,E,v,y);
B=new g.NetworkError(z,o,E);B.code=x}}}}}}if(B&&!B.inner&&A){B.inner=A}if((B instanceof g.ResponseParseError)||(B instanceof g.HTTPError)){e.reportError(B,C)}s.rejectWith(p,[B])});return s.promise()};f._runErrorFilters=function(o,n,u,m,r,t){var q=this,l=[].concat(q.errorFilters).concat(t||[]),p,k,j,s;
if(l.length){for(p=0,k=l.length;p<k;++p){j=l[p];s=j(o,n,u,m,r);if(s){return s}}}}}(window,window._ivideon));