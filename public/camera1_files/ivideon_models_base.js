(function(f,g,a){"use strict";var b=g.$,i=c,h=i.prototype,d="ivideon.utils.OrderedHashMap",e=[].slice;g.provide(d,i);i.KeyGeneratorError=g.utils.declareErrorClass(g.utils.CriticalError,d+".KeyGeneratorError");
function c(j){var k=this;k._options=g.optMerge(i.defaults,j);k.events=new (g.require("ivideon.utils.Observable"))(k);if(k._options.withColors){k._allColors=(typeof k._options.withColors==="function"?null:k._options.withColors);
k._colorsGenerator=(typeof k._options.withColors==="function"?k._options.withColors:i._createColor)}if(k._options.withLabels){k._allLabels=(typeof k._options.withLabels==="function"?null:k._options.withLabels);
k._labelsGenerator=(typeof k._options.withLabels==="function"?k._options.withLabels:i._createLabel)}k._clear(true)}i.defaults={withColors:null,withLabels:null,comparer:null,keyGenerator:null,batchEvents:false,allowDuplicates:false};
i._createColor=function(w,u,m){if(m&&m.length){return m[u%m.length]}else{var y=2.4,x=2.4,v=2.4,s=0,p=2,o=3,k=128,l=127,j,n,q,t=0.5;j=~~(Math.sin(y*u+s)*l+k);n=~~(Math.sin(x*u+p)*l+k);q=~~(Math.sin(v*u+o)*l+k);
return{r:j,g:n,b:q,a:t}}};i._createLabel=function(j,l,k){if(k&&k.length){return k[l%k.length]}};h.toJSON=function(){return g.toJSON.apply(this.getItems())};h.get=function(j){var k=this;return(j!==a?k._items[j]:a)
};h.getByIndex=function(j){var k=this;return(j!==a?k._itemsArray[j]:a)};h.getKey=function(j){var k=this;return k._keys[j]};h.getIndex=function(k){var l=this,j=l._keys.indexOf(k);return(j>=0?j:a)};h.findKey=function(k){var l=this,j=l._itemsArray.indexOf(k);
return(j>-1?l._keys[j]:a)};h.add=function(r,k){if(typeof r!=="object"||!r){return}var n=this,p=n._items,s=n._keys,j=n._options,l=j.comparer,o=j.keyGenerator,t,q,m;t=n.findKey(r);if(t!==a&&!j.allowDuplicates){return t
}if(typeof o==="function"){q=o(r);if(p[q]){throw new i.KeyGeneratorError(d+'#add: Item with key "'+q+'" already exists and different from the one being added.')}}else{q=n._nextKey++}p[q]=r;if(typeof l==="function"){m=g.utils.pushSorted(n._itemsArray,r,l);
s.splice(m,0,q)}else{m=s.length;s.push(q);n._itemsArray.push(r)}n.length=s.length;if(n._colors){n._colors[q]=n._colorsGenerator(r,n._nextColorIndex++,n._allColors)}if(n._labels){n._labels[q]=String(n._labelsGenerator(r,n._nextLabelIndex++,n._allLabels))
}if(!k){if(j.batchEvents){n.events.fire("added-batch",[{item:r,key:q,index:m}])}else{n.events.fire("added",{item:r,key:q,index:m})}}return q};h.addBatch=function(p,l){var m=this,t=m._keys,r=m._options.allowDuplicates,n=(m._options.batchEvents?[]:a),o=[],k,j,s,q,u;
for(j=p.length,k=0;k<j;++k){s=p[k];u=m.findKey(s);if(u!==a&&!r){o.push(u)}else{q=m.add(s,l||!!n);if(n&&!l){n.push({item:s,key:q,index:t.indexOf(q)})}o.push(q)}}if(n&&!l){m.events.fire("added-batch",n)}return o
};h.remove=function(m,k){var p=this,j=p._items,o=p._keys,l,n;n=j[m];if(!n){return false}l=o.indexOf(m);p._itemsArray.splice(l,1);o.splice(l,1);p.length=o.length;delete j[m];if(p._colors){if(l===p.length){p._nextColorIndex--
}delete p._colors[m]}if(p._labels){if(l===p.length){p._nextLabelIndex--}delete p._labels[m]}if(!k){if(p._options.batchEvents){p.events.fire("removed-batch",[{item:n,key:m,index:l}])}else{p.events.fire("removed",{item:n,key:m,index:l})
}}return true};h.removeBatch=function(o,l){var m=this,q=m._items,t=m._keys,n=(m._options.batchEvents?[]:a),p=[],k,j,r,s;for(j=o.length,k=0;k<j;++k){r=o[k];s=q[r];if(!s){p.push(false)}else{if(n&&!l){n.push({item:s,key:r,index:t.indexOf(r)})
}m.remove(r,l||!!n)}}if(!l&&n&&n.length){m.events.fire("removed-batch",n)}return p};h.clear=function(j){return this._clear.apply(this,arguments)};h._clear=function(k){var n=this,m=n._keys,j=n._options.batchEvents,l=[];
if(m&&m.length){if(!k){n.events.fire("clearing")}n.forEach(function(q,p){var o=m.indexOf(p);delete n._items[p];n._itemsArray[o]=a;--n.length;if(!k){l.push({item:q,key:p,index:o,clearing:true});if(!j){n.events.fire("removed",{item:q,key:p,index:o,clearing:true})
}}});if(!k&&j&&l.length){l.clearing=true;n.events.fire("removed-batch",l)}}n._items={};n._itemsArray=[];n._keys=m=[];n._nextKey=1;n.length=0;if(n._options.withColors){n._colors={};n._nextColorIndex=0}if(n._options.withLabels){n._labels={};
n._nextLabelIndex=0}if(!k){n.events.fire("cleared",l)}};h.shuffle=function(){var j=this;j._keys.sort(function(){return 0.5-Math.random()});j.events.fire("shuffled")};h.getKeys=function(){return this._keys
};h.getItems=function(){return this._itemsArray};h.forEach=function(m,j){var q=this,r=q._items,s=e.call(q._keys),n,p,l,o;if(typeof m!=="function"){throw new TypeError("processor")}for(p=0,l=s.length;p<l;
++p){n=s[p];o=r[n];if(o){m.call(j||q,o,n,q)}}};h.getColor=function(j,k){var m=this,l;if(m._colors){l=m._colors[j];if(l){return"rgba("+l.r+","+l.g+","+l.b+","+(!k&&k!==0?l.a:k)+")"}}};h.getLabel=function(j){var k=this;
if(k._labels){return k._labels[j]}};h.filter=function(n){if(!n){throw new Error("options")}if(typeof n.valueGetter!=="function"){throw new Error("options.valueGetter")}if(n.valueHighlighter&&typeof n.valueHighlighter!=="function"){throw new Error("options.valueHighlighter")
}if(n.highlighterBoundaries&&typeof n.highlighterBoundaries!=="object"){throw new Error("options.highlighterBoundaries")}if(n.misprintFixer&&typeof n.misprintFixer!=="function"){throw new Error("options.misprintFixer")
}var H=this,y=n.filter||"",A,o=!!n.caseSensitive,B=H._items,z=H._keys,u=[],x=[],I,L,E,t,F,j,M,D,r,N,q,P,O,G,C=0,K=0,J=0,l=0,w,s,m,v;y=y.replace(/^\s+|\s+$/g,"");A=y.split(/\s+/g);for(L=0,E=z.length;L<E;
++L){I=z[L];t=B[I];if(!t){continue}F=n.valueGetter(t);if(typeof F!=="string"){continue}j=F;w=true;s=false;J=-1;l=-1;if(A.length){K=0;C=0;for(M=0,D=A.length;M<D;++M){m=false;r=A[M];C=(o?j:j.toLowerCase()).indexOf((o?r:r.toLowerCase()),K);
if(C<0&&n.misprintFixer){N=n.misprintFixer(r);if(typeof N==="string"){C=(o?j:j.toLowerCase()).indexOf((o?N:N.toLowerCase()),K);m=true}}if(C<0){j=F;w=false;break}else{q=j.substring(0,C);P=j.substr(C,r.length);
G=(n.valueHighlighter?n.valueHighlighter(t,P,m,n.highlighterBoundaries):P);K=q.length+G.length;O=j.substring(C+P.length);j=q+G+O;if(J<0){J=q.length}l=O.length}}if(w&&J===0&&l===0){s=true}}v={item:t,matched:w,matchedFull:s,value:F,highlighted:j};
if(w){x[x.length]=v}u[u.length]=v}u.matched=x;return u};h.findBy=function(j,o,q,n){var m=this,r=m._keys,s,l,k,p;for(l=0,k=r.length;l<k;++l){p=r[l];s=m._items[p];if(s&&(n===false?s[j]==o:s[j]===o)){return(q?s:p)
}}}}(window,window._ivideon));(function(b,h,e){"use strict";var c=h.$,d=f,a=d.prototype,g="ivideon.utils.Crud";h.provide(g,d);function f(j,i,k){var l=this;j._crud=l;l._target=j;l._state=d.STATE_EMPTY;
l._enabled=true;l._options=h.optMerge(d.defaults,i);l._deferred=null;l._queue=[];l._loaded=false;if(k===true){l.mixInto(j)}}d.defaults={};d.STATE_EMPTY=0;d.STATE_ERROR=1;d.STATE_LOADED=2;d.STATE_LOADING=3;
d.STATE_ADDING=4;d.STATE_REMOVING=5;d.STATE_UPDATING=6;a.enable=function(){var i=this._crud||this;i._enabled=true};a.disable=function(){var i=this._crud||this;i._enabled=false};a.mixInto=function(i){i._crud=this;
i.crudLoad=this.load;i.crudAutoload=this.autoload;i.crudAdd=this.add;i.crudUpdate=this.update;i.crudRemove=this.remove;i.crudIsLoading=this.isLoading;i.crudIsLoaded=this.isLoaded};a.load=function(){var i=this._crud||this;
return i._call("load",c.makeArray(arguments),d.STATE_LOADING,d.STATE_LOADED)};a.add=function(){var i=this._crud||this;return i._call("add",c.makeArray(arguments),d.STATE_ADDING,i._state)};a.update=function(){var i=this._crud||this;
return i._call("update",c.makeArray(arguments),d.STATE_UPDATING,i._state)};a.remove=function(){var i=this._crud||this;return i._call("remove",c.makeArray(arguments),d.STATE_REMOVING,i._state)};a.autoload=function(i){var j=this._crud||this;
j._autoloadStart(i)};a.isLoading=function(){var i=this._crud||this;return(i._state===d.STATE_LOADING)};a.isLoaded=function(){var i=this._crud||this;return i._loaded};a._enqueue=function(k,j){var l=this,i=c.Deferred();
l._queue.push([k,j,i]);return i.promise()};a._dequeue=function(){var j=this,i=j._queue.shift();if(i){j[i[0]].apply(j,i[1]).done(function(k,l){i[2].resolve(k,l)}).fail(function(l,k){i[2].reject(l,k)})}};
a._call=function(l,j,k,o){var p=this,i=c.Deferred(),n="crud-"+l+"-",m=function(q){p.error=q;p._state=d.STATE_ERROR;p._deferred=null;if(c.isFunction(p._options[l+"Error"])){p._options[l+"Error"].apply(p._target,[q].concat(j))
}p._target.events.fire(n+"error",{error:q,args:j});i.reject(q,j)};if(!c.isFunction(p._options[l])){throw new h.utils.ArgumentError(g+'#_call: Argument "fn" is incorrect.')}if(p._state!==d.STATE_EMPTY&&p._state!==d.STATE_LOADED){return p._enqueue(l,j)
}p._deferred=i;p.error=null;p._state=k;p._target.events.fire(n+"started");p._deferred.done(function(){p._dequeue()}).fail(function(){p._queue.length=0});p._options[l].apply(p._target,j).done(function(q){var r;
if(!q.success){r=new Error(q.error?q.error.message:"");c.extend(r,q.error);m(r);return}p._state=o;p._deferred=null;if(p._state===d.STATE_LOADED){p._loaded=true}if(c.isFunction(p._options[l+"Success"])){p._options[l+"Success"].apply(p._target,[q].concat(j))
}p._target.events.fire(n+"success",{response:q,args:j});i.resolve(q,j)}).fail(m);return i.promise()};a._autoloadStart=function(i){var j=this;j._autoloadStop();j._autoloadInterval=i;j._autoloadRepeat()};
a._autoloadStop=function(){var i=this;if(i._autoloadTimer){b.clearTimeout(i._autoloadTimer);i._autoloadTimer=null}};a._autoloadRepeat=function(){var j=this,i=function(){if(h.app){if(h.app.isEnded()){j._autoloadStop();
return}if(!h.app.isRunning()){if(j._autoloadInterval>0){j._autoloadTimer=b.setTimeout(i,j._autoloadInterval)}else{j._autoloadStop()}return}}j.load().always(function(){j._autoloadRepeat()})};j._autoloadStop();
if(j._autoloadInterval>0){j._autoloadTimer=b.setTimeout(i,j._autoloadInterval)}}}(window,window._ivideon));