(function(a,c,b){"use strict";c.provide("ivideon.constants.api",{ERR_UNKNOWN:0,ERR_NOT_SUPPORTED:10000,ERR_AUTH:10001,ERR_SESSION:10002,ERR_ACCESS:10003,ERR_NOT_FOUND:10004,ERR_ALREADY_EXISTS:10005,ERR_BAD_USER:10006,ERR_MISSING_ARG:10007,ERR_BAD_PARTNER:10009,ERR_BAD_GATE:10010,ERR_BAD_TARIFF:10011,ERR_BAD_SERVER:10012,ERR_MALFORMED_ARG:10013,ERR_BAD_ROLE:10014,ERR_BAD_PARTNER_DATA:10015,ERR_TOO_FREQUENT:10016,ERR_RELOGIN:10017,ERR_CODE_REQUIRED:10018,ERR_BAD_AUTH_CODE:10019,ERR_NOT_PAID:10020,ERR_BAD_PROMO:10021,ERR_TIMED_OUT:10022,ERR_BAD_REQUEST:10008,ERR_QUOTA_EXHAUSTED:20003,ERR_NOT_ENOUGH_MINERALS:20002,ERR_OPERATION_RESTRICTED:20001,ERR_DEPRECATED:20004,ERR_BAD_DATA:20008,ERR_BAD_AMOUNT:20009})
}(window,window._ivideon));(function(a,d,c){"use strict";var b=d.provide("ivideon.constants.billing",{TARIFFS_ACCOUNT:"tariffs_account",TARIFFS_CAMERA:"tariffs_camera",REASON_SERVICE_UNAVAILABLE:"service_unavailable",REASON_SERVICE_DISABLED_BY_OWNER:"service_disabled_by_owner",REASON_NOT_ENOUGH_MONEY:"not_enough_money",REASON_CAMERA_DISABLED:"camera_disabled",REASON_NO_CAMERA_TARIFF:"no_camera_tariff",REASON_NEED_ACTIVATION:"need_activation",REASON_ERROR:"error",SUGGESTION__CONTACT_OWNER:"contact_owner",SUGGESTION__ACTIVATE_SERVER:"activate_server",SUGGESTION__TARIFFS_ACCOUNT__ENABLE_SERVICE:"tariffs_account__enable_service",SUGGESTION__TARIFFS_ACCOUNT__UPGRADE_TARIFF:"tariffs_account__upgrade_tariff",SUGGESTION__TARIFFS_ACCOUNT__ENABLE_CAMERA:"tariffs_account__enable_camera",SUGGESTION__TARIFFS_ACCOUNT__TOPUP_BALANCE:"tariffs_account__topup_balance",SUGGESTION__TARIFFS_CAMERA__SELECT_CAMERA_TARIFF:"tariffs_camera__select_camera_tariff",SUGGESTION__TARIFFS_CAMERA__SELECT_ANOTHER_CAMERA_TARIFF:"tariffs_camera__select_another_camera_tariff",PAYMENT_BALANCE:"balance",PAYMENT_SUBSCRIPTION:"subscription"});
d.provide("ivideon.constants.billing.TARIFFS_ACCOUNT__REASON_MAP",{camera:b.REASON_CAMERA_DISABLED,billing:b.REASON_NOT_ENOUGH_MONEY})}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,h=a,g=h.prototype,d="ivideon.models.StreamerAPI",i=d;
f.provide(d,h);function a(j){var l=this,k=f.require("ivideon.utils.JsonAPI");l._options=f.optMerge(h.defaults,j);l._options.rootUrl=(l._options.rootUrl||"").replace(/\/+$/,"")+"/";l._options.ajaxOptions={dataType:"jsonp",jsonp:"jsonp",timeout:5000};
l._jsonAPI=new k(l._options);l._jsonAPI.errorFilters.push(k.successFalseFilter)}h.defaults={rootUrl:"/",audioEnabled:true,qualityValues:[0,1,2]};g.getQualitySet=function(){var o=this,n=o._options.qualityValues,m=[],l,k,j;
for(k=0,j=n.length;k<j;++k){l=n[k];m[m.length]={value:l,fullText:f.tr(i,"quality."+l),shortText:f.tr(i,"quality."+l+".short")}}return m};g.createLiveStream=function(k,j){return this._createStream(k,j,"ivideon.models.CameraLiveStream")
};g.createArchiveStream=function(k,j){return this._createStream(k,j,"ivideon.models.CameraArchiveStream")};g.getSources=function(r){var o=this,l=c.Deferred(),k,n,p,q={},m,j;f.utils.assertArg(d+"#getSources",{"stream.camera":r,"stream.options":r});
k=r.options.startTime;n=r.options.endTime;p=!!k;j={};if(f.app.hasService("session")&&f.app.service("session").ssid){q.sessionId=f.app.service("session").ssid}q.server=r.camera.serverId;q.camera=r.camera.cameraId;
if(o._options.qualityValues.indexOf(r.options.videoOptions.quality)>=0){q.q=r.options.videoOptions.quality}if(p){if(r.options.videoOptions.speed>0){q.speed=r.options.videoOptions.speed}}if(o._options.audioEnabled!==true||r.options.audioEnabled!==true){q.acodec="none"
}if(k){q.startTime=Math.floor(k+1);if(n>k){q.endTime=Math.ceil(n)}}j.hls={url:o._hlsUrl(q,p,m),mimeType:"application/vnd.apple.mpegurl"};j.flv={url:o._flvUrl(c.extend({},q,{vcodec:["h264","flv"],type:"site"}),p,m),mimeType:"video/x-flv"};
j.jpeg={url:o._jpegUrl(q,p,m),mimeType:"image/jpeg"};l.resolveWith(r,[j]);return l.promise()};g.getArchiveRecords=function(m,l,k){var o=this,j;var n={};if(f.app.hasService("session")&&f.app.service("session").ssid){n.sessionId=f.app.service("session").ssid
}n.server=m.serverId;n.camera=m.cameraId;n.startTime=Math.floor(l/1000);n.endTime=Math.floor(k/1000);j=c.Deferred();o._jsonAPI.request("archive/list",n,{timeout:15000}).done(function(p){var q;if(!c.isArray(p)){q=new f.utils.CriticalError(d+"#getArchiveRecords done: archive/list response not Array.");
f.reportError(q);j.reject(q);return}j.resolve(p)}).fail(function(p){j.reject(p)});return j.promise()};g.getArchiveRecordsCounts=function(m,l,k){var o=this,j;var n={};if(f.app.hasService("session")&&f.app.service("session").ssid){n.sessionId=f.app.service("session").ssid
}n.server=m.serverId;n.camera=m.cameraId;n.startTime=Math.floor(l/1000);n.endTime=Math.floor(k/1000);j=c.Deferred();o._jsonAPI.request("archive/days",n,{timeout:15000}).done(function(q){var s;if(!c.isArray(q)){s=new f.utils.CriticalError(d+"#getArchiveRecordsCounts done: archive/days response not Array.");
f.reportError(s);j.reject(s);return}var t,p,u;for(p=q.length,t=0;t<p;++t){u=q[t];u.startTime=(u.date*1000);delete u.date}j.resolve(q)}).fail(function(p){j.reject(p)});return j.promise()};g._createStream=function(l,j,k){var m=new (f.require(k))(l,j);
this.getSources(m).then(function(n){m.setSources(n)});return m};g._url=function(k,j){var m=this,l=c.param(j,true);return m._options.rootUrl+(k||"")+"?"+l};g._flvUrl=function(k,m,j){var n=this,l;if(m){l="flv/archive"
}else{l="flv/live"}return n._url(l,k)};g._hlsUrl=function(k,m,j){var n=this,l;if(m){l="ios/archive"}else{l="hls/live.m3u8"}return n._url(l,k)};g._jpegUrl=function(k,m,j){var n=this,l;if(m){l="preview/archive"
}else{l="preview/live"}return n._url(l,k)}}(window,window._ivideon));(function(b,h,f){"use strict";var c=h.$,e=d,a=e.prototype,g="ivideon.models.BackendAPI";h.provide(g,e);function d(i){var k=this,j=h.require("ivideon.utils.JsonAPI");
k._jsonAPI=new j(i);k._jsonAPI.errorFilters.push(j.successFalseFilter);k.events=new (h.require("ivideon.utils.Observable"))(k)}a.requestOverJson=function(i){var j=this;return j._jsonAPI.request(i.url,(i.dataRaw?i.dataRaw:{data:JSON.stringify(i.dataJson)}),i.ajaxOptions||{type:"post"})
}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,h=j,g=h.prototype,d="ivideon.models.Camera",i=d,a=f.require("ivideon.constants.billing");f.provide(d,h);f.require("ivideon.utils.declareErrorClass");
h.ServicesError=f.utils.declareErrorClass(d+".ServicesError",["services"]);h.ArchiveRecordNegativeDurationError=f.utils.declareErrorClass(d+".ArchiveRecordNegativeDurationError",["recordInfo"]);h.ArchiveCountsShiftedTimeError=f.utils.declareErrorClass(d+".ArchiveCountsShiftedTimeError",["countInfo"]);
function j(k){var m=this,l=f.require({throwError:false},"ivideon.models.Timeline");f.require("ivideon.utils.Observable");f.require("ivideon.tr");c.extend(m,k);if(typeof m.id!=="undefined"){m.id=String(m.id)
}if(typeof m.cameraId!=="undefined"){m.cameraId=String(m.cameraId)}if(typeof m.removed==="undefined"){m.removed=false}if(typeof m.name==="undefined"){m.name=m.alias||""}if(typeof m.alias==="undefined"){m.alias=m.name||""
}if(typeof m.width!=="number"||m.width<=0||typeof m.height!=="number"||m.height<=0){m.width=640;m.height=480}if(typeof m.enabled==="undefined"){m.enabled=true}if(typeof m.online==="undefined"){m.online=false
}if(typeof m.banned==="undefined"){m.banned=false}if(typeof m.hidden==="undefined"){m.hidden=false}m._handleFeatures();m._handleServices();m._handleAccessRights();if(typeof m.liveEnabled==="undefined"){m.liveEnabled=false
}if(typeof m.ptzEnabled==="undefined"){m.ptzEnabled=false}if((typeof m.archiveEnabled==="undefined"||m.archiveEnabled)&&l){m.archiveEnabled=true;m.timeline=new l({recordsLoader:function(o,n){return m.updateArchive(o,n)
},countsLoader:function(o,n){return m.updateArchiveCounts(o,n)}})}else{m.archiveEnabled=false;delete m.timeline;delete m._archiveRecordsSaver;delete m._archiveTimelapseSaver}if(m.timeline){f.require("ivideon.models.TimelineRecord")
}m._archiveLoaded=false;m.previewUpdateIntervalInSec=Math.max(m.previewUpdateIntervalInSec||0,0);m.events=new (f.require("ivideon.utils.Observable"))(m)}g.toJSON=f.toJSON;g._handleFeatures=function(){var k=this;
if(!c.isPlainObject(k.features)){k.features={}}if(!k.features.ptz){k.ptzEnabled=false}};g._handleServices=function(){var k=this;if(typeof k.services==="undefined"){k.liveEnabled=true;k.streamingDisabledReason=null;
return}if(!c.isPlainObject(k.services)){k.services={}}k.streamingDisabledReason=k.ensureServiceCanBeUsed({serviceId:"live",displayMessage:false}).reasonId;if(this.streamingDisabledReason!==null){k.liveEnabled=false;
k.archiveEnabled=false;k.ptzEnabled=false}};g._handleAccessRights=function(){var k=this;if(!c.isArray(k.rights)){k.rights=[]}if(!k.hasRight("live")){k.liveEnabled=false}if(!k.hasRight("archive")){k.archiveEnabled=false
}if(!k.hasRight("ptz")){k.ptzEnabled=false}};g.hasRight=function(k){return(c.inArray(k,this.rights)>=0)};g.updateStatus=function(l,k,m){this._acceptChanges({enabled:l,online:k,hidden:m})};g.update=function(k){this._acceptChanges(k)
};g._acceptChanges=function(l){var n=this,m={},s=c.extend(true,{},l),r,p,q,k,o;delete s.id;delete s.server_id;delete s.cameraId;delete s.serverId;if(typeof s.name!=="undefined"){s.alias=s.name}c.each(s,function(t){if(typeof n[t]==="object"&&n[t]!==null){m[t]=c.extend(true,{},n[t])
}else{if(typeof n[t]!=="function"){m[t]=n[t]}}});if(typeof s.enabled!=="undefined"&&n.enabled!==Boolean(s.enabled)){r=true}if(typeof s.online!=="undefined"&&n.online!==Boolean(s.online)){p=true}if(typeof s.hidden!=="undefined"&&n.hidden!==Boolean(s.hidden)){q=true
}if(typeof s.name!=="undefined"&&n.name!==s.name){k=true}if(typeof s.removed!=="undefined"&&n.removed!==Boolean(s.removed)){if(s.removed){o=true}else{delete s.removed}}c.extend(true,n,s);if(s.tariff){n.tariff=s.tariff
}if(!f.utils.isEqual(m,s)){n.events.fire("changed",{prev:m,curr:s})}if(r){n.events.fire("enabled-changed")}if(p){n.events.fire("online-changed")}if(q){n.events.fire("hidden-changed")}if(k){n.events.fire("name-changed")
}if(o&&n.removed){n.events.fire("removed")}};g.isOwnCamera=function(){var k=this;return(k.server&&k.server.isOwnServer()===true)};g.isEnabled=function(){return f.app.service("serviceAccessManager").isCameraEnabled(this)
};g.canServiceBeUsed=function(k){k=k||{};k.camera=this;return f.app.service("serviceAccessManager").canServiceBeUsed(k)};g.ensureServiceCanBeUsed=function(k){k=k||{};k.camera=this;return f.app.service("serviceAccessManager").ensureServiceCanBeUsed(k)
};g.getServiceData=function(k){var l=this;return l.services[k]};g.getTariffModel=function(){var k=this;if(typeof k.billver!=="undefined"){if(k.billver>=5){return a.TARIFFS_CAMERA}return a.TARIFFS_ACCOUNT
}if(f.app.hasService("userAccount")){return f.app.service("userAccount").getTariffModel()}return a.TARIFFS_ACCOUNT};g.compareTariffModel=function(k){var l=this;return(l.getTariffModel()===k)};g.getStreamingLimit=function(){var l=this,k=10*f.MINUTE_IN_MS;
if(l.services){if(l.services.live&&typeof l.services.live.secs==="number"){k=(l.services.live.secs*f.SECOND_IN_MS)}if(l.services.streaming_limit&&typeof l.services.streaming_limit.secs==="number"){k=Math.max(k,(l.services.streaming_limit.secs*f.SECOND_IN_MS))
}}return k};g.getStatusText=function(){var l=this,k="status";if(l.enabled){k+=".enabled"}else{k+=".disabled"}if(l.online){k+=".online"}else{k+=".offline"}if(l.hidden){k+=".hidden"}else{k+=".visible"}return f.tr(i,k)
};g.getTimezone=function(){var k;if(f.app.hasService("userAccount")){k=f.app.service("userAccount").timezone}else{k=f.getDetectedTimezone()}return(k||b)};g.isArchiveLoaded=function(){var k=this;return(k.timeline&&(k.timeline.count()>0||k._archiveLoaded))
};g.updateArchive=function(l,o){var p=this,t=c.Deferred(),u=f.now(),s=String(u),k,r,n,q;if(!p.timeline){return t.reject().promise()}if(!p._archiveUpdating){p._archiveUpdating={}}r=p._archiveUpdating;for(q in r){if(r.hasOwnProperty(q)){n=r[q];
if(n.startTime<=l&&n.endTime>=o){k=n;break}}}if(k){return k.deferred.promise()}k={updateStartTime:u,startTime:l,endTime:o,ajaxRequest:null};p._archiveUpdating[s]=c.extend({deferred:t},k);function m(v){delete k.ajaxRequest;
delete p._archiveUpdating[s];t.reject(v);p.events.fire("archiveUpdateStopped",c.extend({result:"error",error:v},k))}p.events.fire("archiveUpdateStarted",c.extend({},k));k.ajaxRequest=f.app.service("streamerAPI").getArchiveRecords(p,l,o).done(function(z){delete k.ajaxRequest;
if(!p.timeline){m(new Error(d+'#updateArchive: Missing "timeline" (1).'));return}var x=[],y=z.length,w,v;while(y--){w=z[y];v=null;try{if(w.duration===0){continue}if(w.duration<0){continue}if((w.startTime+w.duration)<l||w.startTime>o){continue
}v=new (f.require("ivideon.models.TimelineRecord"))(w.startTime,w.startTime+w.duration,w);x[x.length]=v}catch(A){f.reportError(A)}}e.setTimeout(function(){if(!p.timeline){m(new Error(d+'#updateArchive: Missing "timeline" (2).'));
return}p.timeline.addRecords(x);p._archiveLoaded=true;delete p._archiveUpdating[s];t.resolve();p.events.fire("archiveUpdateStopped",c.extend({result:"success"},k))},0)}).fail(m);return t.promise()};g.updateArchiveCounts=function(l,o){var p=this,t=c.Deferred(),u=f.now(),s=String(u),k,q,n,r;
if(!p.timeline){return t.reject().promise()}if(!p._archiveCountsUpdating){p._archiveCountsUpdating={}}q=p._archiveCountsUpdating;for(r in q){if(q.hasOwnProperty(r)){n=q[r];if(n.startTime<=l&&n.endTime>=o){k=n;
break}}}if(k){return k.deferred.promise()}k={updateStartTime:u,startTime:l,endTime:o,ajaxRequest:null};p._archiveCountsUpdating[s]=c.extend({deferred:t},k);function m(v){delete k.ajaxRequest;delete p._archiveCountsUpdating[s];
t.reject(v);p.events.fire("archiveCountsUpdateStopped",c.extend({result:"error"},k))}p.events.fire("archiveCountsUpdateStarted",c.extend({},k));k.ajaxRequest=f.app.service("streamerAPI").getArchiveRecordsCounts(p,l,o).done(function(w){delete k.ajaxRequest;
if(!p.timeline){m(new Error(d+'#updateArchiveCounts: Missing "timeline" (1).'));return}var A=[],z,y,C,B,v=0,E,x;for(y=w.length,z=0;z<y;++z){C=w[z];if(z===0){for(E=l;E<=o;E+=f.DAY_IN_MS){x=(C.startTime-E);
if(Math.abs(x)>0&&Math.abs(x)<f.DAY_IN_MS){if(Math.abs(x)<=(12*f.HOUR_IN_MS)){v=x}else{v=(x/Math.abs(x))*(Math.abs(x)-f.DAY_IN_MS)}break}}}try{B=new (f.require("ivideon.models.TimelineRecordsCount"))(C.startTime-v,C.startTime-v+f.DAY_IN_MS,C.recordsCount,C);
A[A.length]=B}catch(D){f.console.error(d+".updateArchiveCounts: "+String(D))}}e.setTimeout(function(){if(!p.timeline){m(new Error(d+'#updateArchiveCounts: Missing "timeline" (2).'));return}p.timeline.addCounts(A);
delete p._archiveCountsUpdating[s];t.resolve();p.events.fire("archiveCountsUpdateStopped",c.extend({result:"success"},k))},0)}).fail(m);return t.promise()};g.ptz=function(l){var m=this,k=c.Deferred();if(!m.ptzEnabled||!f.app.hasService("backendAPI")){return k.reject().promise()
}m.events.fire("ptzStarted",{});f.app.service("backendAPI").ptz(m,l).done(function(n){k.resolve();m.events.fire("ptzStopped",{result:"success",response:n})}).fail(function(n){k.reject(n);m.events.fire("ptzStopped",{result:"error",error:n})
});return k.promise()}}(window,window._ivideon));(function(e,f,a){"use strict";var c=f.$,h=b,i=f.require("ivideon.utils.OrderedHashMap"),g=(f.require("ivideon.utils.subclass"))(h,i),d="ivideon.models.CamerasList";
f.provide(d,h);function b(j){var k=this;i.call(k,f.optMerge(h.defaults,j));k._byId={};k._byIdKeys={};k.events.on((k._options.batchEvents?"added-batch":"added"),(k._options.batchEvents?k._onAddedBatch:k._onAdded),k);
k.events.on((k._options.batchEvents?"removed-batch":"removed"),(k._options.batchEvents?k._onRemovedBatch:k._onRemoved),k)}h.defaults={withColors:true,withLabels:function(k,j){return j+1},comparer:function(k,j){return f.utils.strcmp(k.name,j.name)
}};g.getById=function(j,k){var l=this;return(l._byId[j]?l._byId[j][k]:a)};g.getKeyById=function(j,k){var l=this;return(l._byIdKeys[j]?l._byIdKeys[j][k]:a)};g._onAdded=function(m,j){var n=this,l=j.item,k=j.key;
if(!n._byId[l.serverId]){n._byId[l.serverId]={};n._byIdKeys[l.serverId]={}}n._byId[l.serverId][l.cameraId]=l;n._byIdKeys[l.serverId][l.cameraId]=k};g._onRemoved=function(l,j){var m=this,k=j.item;delete m._byId[k.serverId][k.cameraId];
delete m._byIdKeys[k.serverId][k.cameraId]};g._onAddedBatch=function(m,k){var l,j;for(j=k.length,l=0;l<j;++l){this._onAdded(m,k[l])}};g._onRemovedBatch=function(m,k){var l,j;for(j=k.length,l=0;l<j;++l){this._onRemoved(m,k[l])
}}}(window,window._ivideon));(function(b,h,f){"use strict";var c=h.$,d=e,a=d.prototype,g="ivideon.models.Server";h.provide(g,d);function e(j,i){var m=this,l,k;c.extend(m,j);if(typeof m.removed==="undefined"){m.removed=false
}m.events=new (h.require("ivideon.utils.Observable"))(m);k=m.cameras;delete m.cameras;m.cameras=new (h.require("ivideon.models.CamerasList"))(i?i.camerasListOptions:f);m.cameras.events.on("added",m._onCamerasListAdded,m);
m.cameras.events.on("removed",m._onCamerasListRemoved,m);for(l in k){if(k.hasOwnProperty(l)){m.cameras.add(m._createCamera(k[l]))}}}a.toString=function(){var i=this;return(i.name||i.id||"")};a.toJSON=h.toJSON;
a.hasMarker=function(){var i=this;return(typeof i.latitude==="number"&&!isNaN(i.latitude)&&typeof i.longitude==="number"&&!isNaN(i.longitude))};a.isOwnServer=function(){var i=this;return(i.owner===true)
};a.updateStatus=function(i){this._acceptChanges({online:i,status:(i===true?"online":(i===false?"offline":f))})};a.update=function(i){this._acceptChanges(i)};a._acceptChanges=function(l){var n=this,j={},q=c.extend(true,{},l),k=q.cameras,p,i,m,o;
delete q.id;delete q.cameras;if(typeof q.name!=="undefined"){q.alias=q.name}c.each(q,function(r){if(typeof n[r]==="object"&&n[r]!==null){j[r]=c.extend(true,{},n[r])}else{if(typeof n[r]!=="function"){j[r]=n[r]
}}});if(typeof q.online!=="undefined"&&n.online!==Boolean(q.online)){p=true}if(typeof q.name!=="undefined"&&n.name!==q.name){i=true}if(typeof q.removed!=="undefined"&&n.removed!==Boolean(q.removed)){if(q.removed){o=true
}else{delete q.removed}}c.extend(true,n,q);if(!h.utils.isEqual(j,q)){n.events.fire("changed",{prev:j,curr:q})}if(!h.utils.isEqual(j.info,q.info)){n.events.fire("info-changed",{prev:j.info,curr:q.info})
}if(p){n.events.fire("online-changed")}if(i){n.events.fire("name-changed")}if(k){n.cameras.forEach(function(r){if(!k[r.id]){if(!r.removed){r.update({removed:true});m=true}}});c.each(k,function(s,t){var r=n.cameras.getById(n.id,t.id);
if(r){r.update(t)}else{n.cameras.add(n._createCamera(t))}m=true});if(m){n.events.fire("cameras-changed")}}if(o&&n.removed){n.events.fire("removed")}};a._createCamera=function(k){var l=this,j=h.require("ivideon.models.Camera"),i;
k=c.extend(true,{},k);k.serverId=k.serverId||l.id;k.cameraId=k.cameraId||k.id;k.server=l;k.liveEnabled=l.live;k.archiveEnabled=l.archive;k.ptzEnabled=l.ptz;i=new j(k);return i};a._onCamerasListAdded=function(k,i){var l=this,j=i.item;
j.events.on("removed",l._onCameraRemoved,l)};a._onCamerasListRemoved=function(k,i){var l=this,j=i.item;j.events.un("removed",l._onCameraRemoved,l)};a._onCameraRemoved=function(j){var k=this,i=j.target;
k.cameras.remove(k.cameras.findKey(i))};a.setMarker=function(k){var m=this,l=(k&&typeof k.longitude==="number"&&typeof k.latitude==="number"),j=(l?"marker-update-":"marker-remove-"),i;if(!l){k=null}m.events.fire(j+"started",(k?{coordinates:k}:{}));
i=c.Deferred();h.app.service("backendAPI").setServerMapLocation({server_id:m.id,coordinates:k}).done(function(){m.longitude=(k?k.longitude:null);m.latitude=(k?k.latitude:null);i.resolve();m.events.fire(j+"success",(k?{coordinates:k}:{}));
m.events.fire(l?"marker-updated":"marker-removed")}).fail(function(n){i.reject(n);m.events.fire(j+"error",(k?{coordinates:k,error:n}:{error:n}))});return i};a.removeMarker=function(){var i=this;return i.setMarker(null)
}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,h=a,i=f.require("ivideon.utils.OrderedHashMap"),g=(f.require("ivideon.utils.subclass"))(h,i),d="ivideon.models.ServersList";f.provide(d,h);
function a(j){var k=this;i.call(k,f.optMerge(h.defaults,j));k._byId={};k._markerLabels={};k._markerLabelNext=1;k.events.on((k._options.batchEvents?"added-batch":"added"),(k._options.batchEvents?k._onAddedBatch:k._onAdded),k);
k.events.on((k._options.batchEvents?"removed-batch":"removed"),(k._options.batchEvents?k._onRemovedBatch:k._onRemoved),k)}h.defaults={removeOnRemovedEvent:true,withColors:true,comparer:function(k,j){return f.utils.strcmp(k.name,j.name)
}};g.getById=function(j){var k=this;return k._byId[j]};g.getMappedById=function(){var j=this;return c.extend({},j._byId)};g.getMarkerLabel=function(j){var l=this,k=l.get(j);return l._markerLabels[k.id]
};g._updateMarkerLabel=function(j){var k=this;if(j){if(j.latitude&&j.longitude){if(!k._markerLabels[j.id]){k._markerLabels[j.id]=String(k._markerLabelNext);k._markerLabelNext++}}else{delete k._markerLabels[j.id]
}}};g._onServerMarkerUpdateSuccess=function(j){var l=this,k=j.target;l._updateMarkerLabel(k)};g._onServerMarkerRemoveSuccess=function(j){var l=this,k=j.target;l._updateMarkerLabel(k)};g._onServerRemoved=function(j){var l=this,k=j.target;
if(l._options.removeOnRemovedEvent){l.remove(l.findKey(k))}};g._onAdded=function(k,j){var m=this,l=j.item;m._byId[l.id]=l;m._updateMarkerLabel(l);l.events.on("marker-update-success",m._onServerMarkerUpdateSuccess,m);
l.events.on("marker-remove-success",m._onServerMarkerRemoveSuccess,m);l.events.on("removed",m._onServerRemoved,m)};g._onRemoved=function(k,j){var m=this,l=j.item;delete m._byId[l.id];l.events.un("marker-update-success",m._onServerMarkerUpdateSuccess,m);
l.events.un("marker-remove-success",m._onServerMarkerRemoveSuccess,m);l.events.un("removed",m._onServerRemoved,m)};g._onAddedBatch=function(m,k){var l,j;for(j=k.length,l=0;l<j;++l){this._onAdded(m,k[l])
}};g._onRemovedBatch=function(m,k){var l,j;for(j=k.length,l=0;l<j;++l){this._onRemoved(m,k[l])}}}(window,window._ivideon));(function(b,h,f){"use strict";var c=h.$,d=e,a=d.prototype,g="ivideon.models.Roster";
h.provide(g,d);function e(n){var m=this,l=h.require("ivideon.utils.strcmp"),j;m.events=new (h.require("ivideon.utils.Observable"))(m);m._initialData=n;var k=function(q,p){if(q===p){return 0}var s=l(q.name,p.name);
var r=(q.online===p.online?0:(q.online?-1:1));return(r===0?s:r)};var i=function(r,p){if(r===p){return 0}var q=(r.server&&p.server?k(r.server,p.server):(r.server?-1:1));var u=l(r.name,p.name);var t=0;return(q===0?(t===0?u:t):q)
};m.servers=new (h.require("ivideon.models.ServersList"))({comparer:k});m.cameras=new (h.require("ivideon.models.CamerasList"))({comparer:i});m._serverOptions={camerasListOptions:{comparer:i}};m.servers.events.on("added",m._onServersListAdded,m);
m.servers.events.on("removed",m._onServersListRemoved,m);for(j in n){if(n.hasOwnProperty(j)){m.servers.add(m._createServer(n[j]))}}}a.toJSON=h.toJSON;a.getInitialData=function(){var i=this;return i._initialData
};a.getServers=function(){var i=this;return i.servers};a.getCameras=function(){var i=this;return i.cameras};a.update=function(i){this._acceptChanges(i)};a.reload=function(){var j=this,i=c.Deferred();h.app.service("backendAPI").getRoster().done(function(k){j.update(k.response);
i.resolve()}).fail(function(){i.reject()});return i.promise()};a._acceptChanges=function(l){var k=this,j=l,i;if(j){k.servers.forEach(function(m){if(!j[m.id]){if(!m.removed){m.update({removed:true});i=true
}}});c.each(j,function(n,m){var o=k.servers.getById(m.id);if(o){o.update(m)}else{k.servers.add(k._createServer(m))}i=true});if(i){k.events.fire("servers-changed")}}};a._createServer=function(j){var l=this,i=h.require("ivideon.models.Server"),k;
k=new i(j,l._serverOptions);return k};a._onServersListAdded=function(j,i){var l=this,k=i.item;k.events.on("removed",l._onServerRemoved,l);k.cameras.forEach(function(m){l.cameras.add(m)});k.cameras.events.on("added",l._onServerCamerasListAdded,l);
k.cameras.events.on("removed",l._onServerCamerasListRemoved,l)};a._onServersListRemoved=function(j,i){var l=this,k=i.item;k.events.un("removed",l._onServerRemoved,l);k.cameras.events.un("added",l._onServerCamerasListAdded,l);
k.cameras.events.un("removed",l._onServerCamerasListRemoved,l);k.cameras.forEach(function(m){l.cameras.remove(l.cameras.findKey(m))})};a._onServerRemoved=function(i){var k=this,j=i.target;k.servers.remove(k.servers.findKey(j))
};a._onServerCamerasListAdded=function(k,i){var l=this,j=i.item;l.cameras.add(j)};a._onServerCamerasListRemoved=function(l,i){var m=this,k=i.item,j=m.cameras.findKey(k);m.cameras.remove(j)}}(window,window._ivideon));
(function(c,h,f){"use strict";var d=h.$,e=b,a=e.prototype,g="ivideon.models.CameraStream";h.provide(g,e);function b(j,i){var k=this;h.utils.assertArg(g,{camera:j});k.camera=j;k.options=h.optMerge(e.defaults,{videoOptions:{width:j.width,height:j.height,quality:(j.width>480?2:1)}},i);
k.sources=null}e.defaults={videoOptions:{width:640,height:480,quality:2,speed:1},audioEnabled:true,connectTimeout:20000,stalledTimeout:4000};a.setSources=function(i){this.sources=i};a.isLive=function(){throw new h.utils.NotImplementedError(g+"#isLive")
};a.getSpeed=function(){return this.options.videoOptions.speed||1};a.getDuration=function(){throw new h.utils.NotImplementedError(g+"#getDuration")}}(window,window._ivideon));(function(c,h,e){"use strict";
var d=f,b=h.require("ivideon.models.CameraStream"),a=(h.require("ivideon.utils.subclass"))(d,b),g="ivideon.models.CameraLiveStream";h.provide(g,d);function f(j,i){var k=this;b.call(k,j,i);k.options.videoOptions.speed=1
}a.isLive=function(){return true};a.getDuration=function(){return 0}}(window,window._ivideon));(function(d,h,f){"use strict";var e=c,b=h.require("ivideon.models.CameraStream"),a=(h.require("ivideon.utils.subclass"))(e,b),g="ivideon.models.CameraArchiveStream";
h.provide(g,e);function c(j,i){var k=this;h.utils.assertArg(g,{"options.startTime":i,"options.endTime":i});b.call(k,j,i);k._duration=(k.options.endTime-k.options.startTime);k._duration=(k._duration/k.options.videoOptions.speed)
}a.isLive=function(){return false};a.getDuration=function(){return this._duration}}(window,window._ivideon));(function(b,h,f){"use strict";var d=h.$,e=c,a=e.prototype,g="ivideon.models.CameraArchiveRecordsSaver";
h.provide(g,e);function c(i){var l=this,j=h.require("ivideon.models.CameraArchiveRecordsSaver.Record"),k=h.require("ivideon.models.CameraArchiveRecordsSaver.RecordsList");l._options=h.optClass(e.defaults,i,g,l,{_server:"server ?",_camera:"camera ?"});
l._saveRequests=[];l._updateRequestDeferred=null;l._savedRecords=new k({comparer:j.requestTimeDescComparer});l._isOnceUpdated=false;l.events=new (h.require("ivideon.utils.Observable"))(l);l._savedRecords.events.on("added",l._onRecordAdded=function(p,n){var m=n.item,o=n.key;
l.events.fire("record-added",{record:m,key:o})});l._savedRecords.events.on("removed",l._onRecordRemoved=function(p,n){var m=n.item,o=n.key;l.events.fire("record-removed",{record:m,key:o})});l._autoRefreshEnabled=l._options.autoRefreshEnabled;
l._autoRefreshTimer=null;l.events.on("update-list-started",function(){if(l._autoRefreshTimer){b.clearTimeout(l._autoRefreshTimer);l._autoRefreshTimer=null}});l.events.on("update-list-success",l._repeatAutoRefresh,l);
l.events.on("update-list-error",l._repeatAutoRefresh,l);l.events.on("delete-success",function(){l.updateList();l._repeatAutoRefresh()});l.events.on("queue-save-success",function(){l.updateList();l._repeatAutoRefresh()
});h.app.events.on("ending",function(){l._autoRefreshEnabled=false;if(l._autoRefreshTimer){b.clearTimeout(l._autoRefreshTimer);l._autoRefreshTimer=null}})}e.defaults={autoRefreshEnabled:false,autoRefreshInterval:5000};
e._recordsComparer=function(j,i){return(j.startTime-i.startTime)};a.isOnceUpdated=function(){var i=this;return i._isOnceUpdated};a.isUpdating=function(){var i=this;return !!i._updateRequestDeferred};a.startAutoRefresh=function(){var i=this;
if(!i._autoRefreshEnabled){i._autoRefreshEnabled=true;i._repeatAutoRefresh()}};a.stopAutoRefresh=function(){var i=this;if(i._autoRefreshTimer){b.clearTimeout(i._autoRefreshTimer);i._autoRefreshTimer=null
}i._autoRefreshEnabled=false};a.getList=function(){var i=this;return i._savedRecords};a.updateList=function(){var l=this,k="update-list-",j=d.Deferred(),i;if(l._updateRequestDeferred){return l._updateRequestDeferred.promise()
}if(l._autoRefreshTimer){b.clearTimeout(l._autoRefreshTimer);l._autoRefreshTimer=null}l._updateRequestDeferred=j;l.events.fire(k+"started");if(l._camera){i=h.app.service("backendAPI").getSavedArchiveRecordsForCamera(l._camera)
}else{if(l._server){i=h.app.service("backendAPI").getSavedArchiveRecordsForServer(l._server)}else{i=h.app.service("backendAPI").getSavedArchiveRecordsAll()}}i.always(function(){l._updateRequestDeferred=null;
l._isOnceUpdated=true}).done(function(m){var n={},o=h.require("ivideon.models.CameraArchiveRecordsSaver.Record");if(!h.app||h.app.isEnded()){return}d.each(m.records||[],function(t,q){var s=q.id,r=l._savedRecords.findById(s),p=l._savedRecords.get(r);
if(p){p.update(q);l.events.fire("record-updated",{record:p,key:r})}else{r=l._savedRecords.add(new o(q))}n[s]=r});l._savedRecords.forEach(function(p,q){if(!n[p.id]){l._savedRecords.remove(q)}});j.resolve();
l.events.fire(k+"success")}).fail(function(m){if(!h.app||h.app.isEnded()){return}j.reject(m);l.events.fire(k+"error",m)});return j.promise()};a.queueSaveRecord=function(l,j,o,k){var p=this,n="queue-save-",i=d.Deferred(),m=function(q){p.events.fire(n+"error",{error:q});
i.reject(q)};k=k||p._camera;if(!k){throw new Error("camera")}p.events.fire(n+"started");h.app.service("backendAPI").queueSaveArchiveRecord(k,l,j,o).done(function(q){var r;if(!q.success){r=new Error(q.error?q.error.message:"");
d.extend(r,q.error);m(r);return}p.events.fire(n+"success");i.resolve()}).fail(m);return i.promise()};a.deleteRecord=function(j){var l=this,k="delete-",i=d.Deferred();l.events.fire(k+"started");h.app.service("backendAPI").deleteSavedArchiveRecord(j).done(function(){i.resolve();
l.events.fire(k+"success")}).fail(function(m){i.reject(m);l.events.fire(k+"error",m)});return i.promise()};a._repeatAutoRefresh=function(){var j=this,i=function(){if(h.app.isEnded()){if(j._autoRefreshTimer){b.clearTimeout(j._autoRefreshTimer);
j._autoRefreshTimer=null}return}if(!h.app.isRunning()){if(j._autoRefreshEnabled){j._autoRefreshTimer=b.setTimeout(i,j._options.autoRefreshInterval)}else{if(j._autoRefreshTimer){b.clearTimeout(j._autoRefreshTimer);
j._autoRefreshTimer=null}}return}j.updateList()};if(j._autoRefreshTimer){b.clearTimeout(j._autoRefreshTimer);j._autoRefreshTimer=null}if(j._autoRefreshEnabled){j._autoRefreshTimer=b.setTimeout(i,j._options.autoRefreshInterval)
}}}(window,window._ivideon));(function(d,h,g){"use strict";var e=h.$,c="ivideon.models.CameraArchiveRecordsSaver",f=a,b=f.prototype;h.require(c);h.provide(c+".Record",f);function a(i){var j=this;j.update(i)
}f.STATUS_QUEUED=0;f.STATUS_SAVING=1;f.STATUS_SAVING_DONE=2;f.STATUS_SERVER_NOT_AVAILABLE=10000;f.STATUS_RECORD_NOT_FOUND=10001;f.STATUS_SAVING_INTERRUPTED=10002;f.STATUS_QUOTA_EXHAUSTED=10003;f.STATUS_RECORD_DELETED=10004;
f.STATUS_RECORD_DELETING=10005;f.STATUS_NOT_PAID=10006;f.requestTimeDescComparer=function(j,i){return(i.requestTime-j.requestTime)};f.prepareData=function(i){i=e.extend({},i);i.startTime*=1000;i.endTime*=1000;
i.requestTime*=1000;i.cameraId=i.camera;delete i.camera;i.serverId=i.server;delete i.server;return i};b.update=function(i){e.extend(this,f.prepareData(i))}}(window,window._ivideon));(function(e,h,g){"use strict";
var d="ivideon.models.CameraArchiveRecordsSaver",f=b,c=h.require("ivideon.utils.OrderedHashMap"),a=(h.require("ivideon.utils.subclass"))(f,c);h.require(d);h.provide(d+".RecordsList",f);function b(){var i=this;
c.apply(i,arguments)}a.findById=function(p){var o=this,n=o._keys,k,m,j,l;for(m=0,j=n.length;m<j;++m){l=n[m];k=o._items[l];if(k&&k.id===p){return l}}}}(window,window._ivideon));(function(i,j,c){"use strict";
var f=j.$,l=n,k=l.prototype,g="ivideon.views.CameraStreamPlayer",m=g,h=a,b="ivideon.views.CameraStreamPlayer.IEngine",d=h.prototype;j.ns("ivideon.views");j.views.CameraStreamPlayer=l;j.views.CameraStreamPlayer.IEngine=h;
l.StreamError=j.utils.declareErrorClass(g+".StreamError");l.EngineError=j.utils.declareErrorClass(g+".EngineError");l.EngineNotAvailableError=j.utils.declareErrorClass(l.EngineError,g+".EngineNotAvailableError",["engine"]);
l.EngineTimeoutError=j.utils.declareErrorClass(l.EngineError,g+".EngineTimeoutError",["timeout"]);l.FlashRequiredError=j.utils.declareErrorClass(l.EngineError,g+".FlashRequiredError",["flashRequiredVersionString"]);
l.StreamNotAvailableError=j.utils.declareErrorClass(g+".StreamNotAvailableError");l.StreamTimeoutError=j.utils.declareErrorClass(g+".StreamTimeoutError",["timeout"]);function a(){}d.canEmbed=j.utils.declareNotImplementedMethod(b,"canEmbed");
d.isEmbedded=j.utils.declareNotImplementedMethod(b,"isEmbedded");d.embed=j.utils.declareNotImplementedMethod(b,"embed");d.load=j.utils.declareNotImplementedMethod(b,"load");d.unload=j.utils.declareNotImplementedMethod(b,"unload");
d.unembed=j.utils.declareNotImplementedMethod(b,"unembed");d.pause=j.utils.declareNotImplementedMethod(b,"pause");d.play=j.utils.declareNotImplementedMethod(b,"play");d.isPaused=j.utils.declareNotImplementedMethod(b,"isPaused");
d.isPlaying=j.utils.declareNotImplementedMethod(b,"isPlaying");d.getTime=j.utils.declareNotImplementedMethod(b,"getTime");d.updateSize=j.utils.declareNotImplementedMethod(b,"updateSize");d.setVolume=j.utils.declareNotImplementedMethod(b,"setVolume");
d.setMuted=j.utils.declareNotImplementedMethod(b,"setMuted");function n(p,q){var r=this;r.options=j.optMerge(l.defaults,q);r.$container=f(p);r.$wrapper=f("<div/>").addClass("ivideon-camera-stream-player iv-ratio-a").appendTo(r.$container);
r.$playerContainer=f("<div/>").addClass("ivideon-camera-stream-player-video-frame iv-ratio-b").appendTo(r.$wrapper);r.$overlayContainer=f("<div/>").addClass("ivideon-camera-stream-player-overlay-frame iv-ratio-b").appendTo(r.$wrapper);
r._playDeferred=null;r._videoFinishedDeferred=null;r._engine=null;r._forcedRatio=null;r._tickHandler=null;r._tickTimer=null;r._tickNextTime=0;r._stream=null;r._speed=0;r._startTime=0;r._lastTime=0;r._firstMetadata=false;
r._speedStats=[];r._speedStats.length=20;r._resetMetadata();r.events=new (j.require("ivideon.utils.Observable"))(r);r._setState(l.STATE_NEW)}l.STATE_NEW=1;l.STATE_DESTROYED=2;l.STATE_ENGINE_CREATING=3;
l.STATE_ENGINE_CREATED=4;l.STATE_ENGINE_EMBEDDING=5;l.STATE_ENGINE_EMBEDDED=6;l.STATE_STREAM_LOADING=7;l.STATE_STREAM_LOADED=8;l.STATE_ENGINE_EMBED_SUSPENDED=9;l.STATE_STREAM_LOAD_SUSPENDED=10;l.STATE_STREAM_PLAYBACK_SUSPENDED=11;
l.defaults={debug:false,engineDebug:false,embedTimeout:20*1000,volume:1,muted:false,engine:null,archiveStreamHasDuration:false,tickInterval:1000};l.engines={};l._allStatesCssClasses="m-empty m-embedding m-embedded m-loading m-loaded m-suspended m-error";
l._compareMetadataByOffset=function(q,p){return((q.metadataOffset||0)-(p.metadataOffset||0))};k.getCurrentStream=function(){return this._stream};k.getSpeed=function(){return this._speed};k.getOverlayElement=function(){var p=this;
return p.$overlayContainer};k.isEngineEmbedded=function(){var p=this;return(p._state===l.STATE_ENGINE_EMBEDDED||p._state===l.STATE_STREAM_LOADING||p._state===l.STATE_STREAM_LOADED)};k.isStreamLoaded=function(){var p=this;
return(p._state===l.STATE_STREAM_LOADED)};k.isDestroyed=function(){var p=this;return(p._state===l.STATE_DESTROYED)};k.hide=function(){var p=this;if(p._state===l.STATE_DESTROYED){return}p.$wrapper.addClass("m-hidden");
p._hidden=true};k.show=function(){var p=this;if(p._state===l.STATE_DESTROYED){return}p._hidden=false;p.$wrapper.removeClass("m-hidden")};k.load=function(t){var u=this,s,p,r;if(u._state===l.STATE_DESTROYED){return f.Deferred().rejectWith(u,[null,t]).promise()
}if(u.options.debug){j.console.log(g+".load: stream == ",t)}if(!t||!t.sources){p=new l.StreamError(j.tr(m,"stream.error.source_not_available"));p.inner=new j.utils.ArgumentError(g+'#load: Argument "stream" '+(!t?"not set":"sources not ready")+".");
return f.Deferred().rejectWith(u,[p,t]).promise()}try{u._unload();s=u._getSuitableEngine(t);u._stream=t;u._speed=t.getSpeed();u._startTime=(t.isLive()?j.now():t.options.startTime||0);u._playDeferred=f.Deferred();
r=u._playDeferred.promise();if(u._engine instanceof s.constructor){if(u._state===l.STATE_ENGINE_CREATED){u._embed()}else{if(u._state!==l.STATE_ENGINE_EMBEDDING){u._load()}}}else{u._createEngine(s)}return r
}catch(q){u._stream=null;u._speed=0;u._startTime=0;u._lastTime=0;u._firstMetadata=false;u._playDeferred=null;p=q;j.reportError(q);return f.Deferred().rejectWith(u,[p,t]).promise()}};k.reload=function(){var p=this;
return p.load(p._stream)};k.unload=function(p){var q=this;if(q._state===l.STATE_DESTROYED){return}q._unload(p)};k.pause=function(){var p=this;if(p._stream){if(p._engine){p._engine.pause()}}};k.play=function(){var p=this;
if(p._stream){if(p._engine){p._engine.play()}}};k.isSuspended=function(){var p=this;return(p._state===l.STATE_ENGINE_EMBED_SUSPENDED||p._state===l.STATE_STREAM_LOAD_SUSPENDED||p._state===l.STATE_STREAM_PLAYBACK_SUSPENDED)
};k.isPaused=function(){var p=this;if(p._stream){if(p._engine){return p._engine.isPaused()}}return false};k.isPlaying=function(){var p=this;if(p._stream){if(p._engine){return p._engine.isPlaying()}}return false
};k.getStatus=function(q){var t=this,s=j.now(),p=(q===c?t.getTime():q),r={when:s,time:p,timestamp:t._calcAbsoluteTime(p),playedDuration:t._calcPlayedDuration(p),skippedDuration:t._skippedDuration,bufferedDuration:t._bufferedDuration,speed:t._speed,currentSpeed:t._currentSpeed,averageSpeed:t._averageSpeed};
return r};k.getStallingStatus=function(){return(this._stalling?f.extend({},this._stallingStatus):null)};k.getTime=function(){var q=this,p=0;if(q._stream){if(q._engine){p=q._engine.getTime();if(p>0){q._lastTime=p
}}}return p};k.getBufferedDuration=function(){return this._bufferedDuration};k.getPlayedDuration=function(){return this._calcPlayedDuration(this.getTime())};k.getSkippedDuration=function(){return this._skippedDuration
};k.getAbsoluteTime=function(){return this._calcAbsoluteTime(this.getTime())};k.getCurrentSpeed=function(){return this._currentSpeed};k.getAverageSpeed=function(){return this._averageSpeed};k.updateSize=function(p){var q=this;
q._forcedRatio=p;q._updateEngineSize()};k.setVolume=function(p){var q=this;return q._setVolume(p)};k.setMuted=function(p){var q=this;return q._setMuted(p)};k.destroy=function(){var q=this,p;if(q._state===l.STATE_DESTROYED){return
}q._unload(true);q._setState(l.STATE_DESTROYED);q.events.fire("destroying");q.events.un();q.$wrapper.remove();for(p in q){if(q.hasOwnProperty(p)&&p.charAt(0)==="$"){delete q[p]}}};k._setState=function(p){var q=this;
if(!p){throw new j.utils.ArgumentError(g+'#_setState: Argument "state" not set.')}if(q._state===l.STATE_DESTROYED){return}q._state=p;q._updateCssAccordingToState()};k._updateCssAccordingToState=function(){var q=this,p="";
if(q._state===l.STATE_DESTROYED){return}switch(q._state){case l.STATE_NEW:p="m-empty";break;case l.STATE_ENGINE_CREATING:p="m-embedding";break;case l.STATE_ENGINE_CREATED:p="m-embedding";break;case l.STATE_ENGINE_EMBEDDING:p="m-embedding";
break;case l.STATE_ENGINE_EMBEDDED:p="m-embedded";break;case l.STATE_STREAM_LOADING:p="m-loading";break;case l.STATE_STREAM_LOADED:p="m-loaded";break;case l.STATE_ENGINE_EMBED_SUSPENDED:p="m-embedding m-suspended";
break;case l.STATE_STREAM_LOAD_SUSPENDED:p="m-loading m-suspended";break;case l.STATE_STREAM_PLAYBACK_SUSPENDED:p="m-loaded m-suspended";break}q.$wrapper.removeClass(l._allStatesCssClasses).addClass(p)
};k._getSuitableEngine=function(u){var v=this,r,s,q,t,p;j.utils.assertArg(g+"#_getSuitableEngine",{stream:u,"stream.sources":u});t=(i.flashembed&&i.flashembed.isSupported([10,0]));p=(f.browser.ios||f.browser.android);
if(p&&!t){r="ios"}else{if(u.sources.swf){r="swf"}else{if(u.sources.flv){r=v.options.engine}}}if(!r){throw new l.EngineError(j.tr(m,"player.error.engine_not_available"))}q=l.engines[r];if(!q){throw new l.EngineError(j.tr(m,"player.error.engine_not_found",{engine:r}))
}s=(v.options[r+"Engine"]||{});if(v.options.engineDebug){s.debug=true}return{name:r,options:s,constructor:q}};k._createEngine=function e(p){var s=this,u,v;if(!p){throw new j.utils.ArgumentError(g+'#_createEngine: Argument "engineInfo" not set.')
}s._setState(l.STATE_ENGINE_CREATING);try{try{s._destroyEngine()}catch(r){v={func:g+"#_destroyEngine"};throw r}try{s._engine=new p.constructor(s,p.options)}catch(q){v={engineName:p.name,context:(p.constructor?p.constructor.toString():""),options:p.options};
throw q}s._engine.events.on("engine-suspended",s._onEngineSuspended,s);s._engine.events.on("engine-resumed",s._onEngineResumed,s);s._engine.events.on("embed-success",s._onEmbedSuccess,s);s._engine.events.on("embed-error",s._onEmbedError,s);
s._engine.events.on("load-success",s._onStreamLoadSuccess,s);s._engine.events.on("load-error",s._onStreamLoadError,s);s._engine.events.on("stream-paused",s._onStreamPaused,s);s._engine.events.on("stream-resumed",s._onStreamResumed,s);
s._engine.events.on("stream-finished",s._onStreamFinished,s);s._engine.events.on("stream-metadata",s._onStreamMetadata,s);try{s._onEngineCreateSuccess()}catch(x){v={func:g+"#_onEngineCreateSuccess"};throw x
}}catch(t){if(s.options.debug){j.console.error(g+"#_createEngine: "+t,t)}j.reportError(t,v);try{s._destroyEngine()}catch(w){if(s.options.debug){j.console.error(g+"#_createEngine: in _destroyEngine "+w,w)
}j.reportError(w,{func:g+"#_destroyEngine"})}u=new l.EngineError(j.tr(m,"player.error.engine_not_available"));u.inner=t;s._onEngineCreateError(u)}};k._destroyEngine=function o(){var q=this,p;q._clearEmbedTimeout();
q._clearLoadTimeout();q._clearTickTimer();q._resetMetadata();if(q._engine){p=q._engine;q._engine=null;p.destroy()}};k._onEngineCreateSuccess=function(){var p=this;if(p._state!==l.STATE_ENGINE_CREATING){return
}p._setState(l.STATE_ENGINE_CREATED);if(/\s+Firefox\/3\.[0-9]+/.test(i.navigator.userAgent)){p._showOverlayAfterEmbed=true;p.$overlayContainer.css("display","none")}p._embed()};k._onEngineCreateError=function(p){var q=this;
if(q._state!==l.STATE_ENGINE_CREATING){return}q._setState(l.STATE_NEW)};k._onEmbedSuccess=function(){var p=this;if(p._state!==l.STATE_ENGINE_EMBEDDING){return}p._clearEmbedTimeout();if(p._showOverlayAfterEmbed){p.$overlayContainer.css("display","")
}p._setVolume(p.options.volume);p._setMuted(p.options.muted);p._setState(l.STATE_ENGINE_EMBEDDED);if(p._stream){p._load()}};k._onEmbedError=function(r,p){var s=this,q;if(s._state===l.STATE_NEW||s._state===l.STATE_ENGINE_CREATING||s._state===l.STATE_ENGINE_CREATED||s._state===l.STATE_DESTROYED){return
}j.console.error(g+"._onEmbedError: "+p,p);s._destroyEngine();s._setState(l.STATE_NEW);if(s._playDeferred){q=s._playDeferred;s._playDeferred=null;q.rejectWith(s,[p])}};k._onEngineSuspended=function(){var p=this;
if(p._state===l.STATE_ENGINE_EMBEDDING){p._clearEmbedTimeout();p._setState(l.STATE_ENGINE_EMBED_SUSPENDED)}else{if(p._state===l.STATE_STREAM_LOADING){p._clearLoadTimeout();p._setState(l.STATE_STREAM_LOAD_SUSPENDED)
}else{if(p._state===l.STATE_STREAM_LOADED){p._clearTickTimer();p._setState(l.STATE_STREAM_PLAYBACK_SUSPENDED)}}}p.events.fire("engine-suspended")};k._onEngineResumed=function(){var p=this;if(p._state===l.STATE_ENGINE_EMBED_SUSPENDED){p._setEmbedTimeout();
p._setState(l.STATE_ENGINE_EMBEDDING)}else{if(p._state===l.STATE_STREAM_LOAD_SUSPENDED){p._setLoadTimeout();p._setState(l.STATE_STREAM_LOADING)}else{if(p._state===l.STATE_STREAM_PLAYBACK_SUSPENDED){p._startTickTimer();
p._setState(l.STATE_STREAM_LOADED)}}}p.events.fire("engine-resumed")};k._onStreamLoadSuccess=function(){var q=this,p;if(q._state!==l.STATE_STREAM_LOADING){return}q._clearLoadTimeout();q._startTickTimer();
q._setState(l.STATE_STREAM_LOADED);if(q._playDeferred){q._videoFinishedDeferred=f.Deferred();p=q._playDeferred;q._playDeferred=null;p.resolveWith(q,[q._videoFinishedDeferred])}};k._onStreamLoadError=function(r,p){var s=this,q;
if(s._state!==l.STATE_STREAM_LOADING){return}j.console.error(g+"._onStreamLoadError: "+p,p);s._clearLoadTimeout();if(s._engine){if(s._engine.isEmbedded()){s._setState(l.STATE_ENGINE_EMBEDDED)}else{s._setState(l.STATE_ENGINE_CREATED)
}}else{s._setState(l.STATE_NEW)}if(s._playDeferred){q=s._playDeferred;s._playDeferred=null;q.rejectWith(s,[p])}};k._onStreamPaused=function(q,p){var r=this;if(r._state!==l.STATE_STREAM_LOADED){return}r._clearTickTimer();
r.events.fire("pause",p)};k._onStreamResumed=function(q,p){var r=this;if(r._state!==l.STATE_STREAM_LOADED){return}r._startTickTimer();r.events.fire("play",p)};k._onStreamFinished=function(s,q){var t=this,p,r;
if(t._state!==l.STATE_STREAM_LOADED){return}t._clearTickTimer();p=t.getStatus(t._lastTime);t._resetMetadata();if(t._engine){if(t._engine.isEmbedded()){t._setState(l.STATE_ENGINE_EMBEDDED)}else{t._setState(l.STATE_ENGINE_CREATED)
}}else{t._setState(l.STATE_NEW)}if(t._videoFinishedDeferred){r=t._videoFinishedDeferred;t._videoFinishedDeferred=null;if(q.error){r.rejectWith(t,[{status:p,error:q.error}])}else{r.resolveWith(t,[{status:p,error:null}])
}}};k._onStreamMetadata=function(s,r){var t=this;if(!t._pendingMetadata){t._pendingMetadata=[]}j.utils.pushSorted(t._pendingMetadata,r,l._compareMetadataByOffset);if(t._state===l.STATE_STREAM_LOADED&&!t.isPaused()){var p=t.getStatus(),q=p.time;
if(r.metadataOffset>=0){t._bufferedDuration=(r.metadataOffset-q)}t._flushPendingMetadata(p)}};k._setEmbedTimeout=function(){var p=this;p._clearEmbedTimeout();if(typeof p.options.embedTimeout!=="undefined"&&p.options.embedTimeout>0){p._embedTimeoutTimer=i.setTimeout(function(){if(p._state===l.STATE_DESTROYED){return
}var q;q=new l.EngineTimeoutError(j.tr(m,"player.error.engine_load_timeout"),p.options.embedTimeout);p._onEmbedError({},q)},p.options.embedTimeout)}};k._clearEmbedTimeout=function(){var p=this;if(p._embedTimeoutTimer){i.clearTimeout(p._embedTimeoutTimer);
p._embedTimeoutTimer=null}};k._setLoadTimeout=function(){var q=this,p=(q._stream?q._stream.options.connectTimeout:null);q._clearLoadTimeout();if(typeof p!=="undefined"&&p>0){q._loadTimeoutTimer=i.setTimeout(function(){if(q._state===l.STATE_DESTROYED){return
}var r;q._clearLoadTimeout();r=new l.StreamTimeoutError(j.tr(m,"stream.error.timeout"),p);q._onStreamLoadError({},r)},p)}};k._clearLoadTimeout=function(){var p=this;if(p._loadTimeoutTimer){i.clearTimeout(p._loadTimeoutTimer);
p._loadTimeoutTimer=null}};k._processMetadata=function(s,q){var t=this,r=q.time,p;if(!t._firstMetadata&&s.metadataOffset===0){if(s.metadataPosition>0){}t._firstMetadata=s}if(s.fragmentPosition>=0&&s.fragmentDuration>=0){if(t._currentFragment){p=(s.fragmentPosition-t._calcAbsoluteTime(r));
t._skippedDuration+=p}t._currentFragment=s}q=t.getStatus(r);t.events.fire("stream-metadata",{status:q,metadata:s});return q};k._flushPendingMetadata=function(p){var w=this,q=p.time,v=w._pendingMetadata,r,t,s,u;
if(v){while((r=v[0])){t=(r.metadataOffset||0);s=(t<=q);u=(w._tickNextTime>0&&((t-q)<10));if(s||u){v.shift();p=w._processMetadata(r,p);q=p.time}else{break}}if((r=v[0])){w._tickInterval=Math.min(w._tickDefaultInterval,Math.max(r.metadataOffset-q,0));
w._nextTick()}else{w._tickInterval=w._tickDefaultInterval}}return p};k._resetStalling=function(p){var r=this,q;p=p||r.getStatus();if(r._stalling){r._stalling=false;q={status:p};r.events.fire("stream-not-stalling",q)
}r._stallingStatus=p;r._stalling=false};k._startTickTimer=function(){var t=this,s=t._stream,r=((s&&s.options&&s.options.stalledTimeout)||0),p=(t._speed>0?t.options.tickInterval/t._speed:0);t._clearTickTimer();
if(p>0){t._previousStatus=null;t._resetStalling();t._tickDefaultInterval=p;t._tickInterval=0;var q=0;t._tickHandler=function(){if(t._state===l.STATE_DESTROYED||t.isPaused()||!t._tickHandler){t._clearTickTimer();
return}var w=t.getStatus(),D=t._previousStatus,A=t._stallingStatus,u=w.when,E,x,y=t._speedStats,C=y.length,v=0,z,B;if(q<=0||(u-q)>=t._tickInterval){if(D){t._currentSpeed=x=(((w.time-D.time)*t._speed)/(u-D.when));
y[t._speedStatsIndex]=x;t._speedStatsIndex++;if(t._speedStatsIndex>=C){t._speedStatsIndex=0}for(z=0;z<C;++z){v+=y[z]}t._averageSpeed=(v/C)}t._previousStatus=w;B={status:w};t.events.fire("stream-tick",B);
w=t._flushPendingMetadata(w);if(A&&w.time===A.time){E=(u-A.when);if(E>=r){t._stallingStatus=null;t._stalling=false;B={status:w,stallingStatus:A,stallingDuration:E,stalledTimeout:r};t.events.fire("stream-stalled",B)
}else{if(E>(r/3)){if(!t._stalling){t._stalling=true;B={status:w,stallingStatus:A,stallingDuration:E,stalledTimeout:r};t.events.fire("stream-stalling",B)}}}}else{t._resetStalling(w)}q=u}if(t._tickInterval===0){t._tickInterval=t._tickDefaultInterval
}t._nextTick()};t._nextTick()}};k._nextTick=function(){var p=this;if(p._tickHandler&&p._tickInterval>=0){p._tickNextTime=(j.now()+p._tickInterval);i.clearTimeout(p._tickTimer);p._tickTimer=i.setTimeout(p._tickHandler,p._tickInterval)
}};k._clearTickTimer=function(){var p=this;p._tickHandler=null;p._tickNextTime=0;if(p._tickTimer){i.clearTimeout(p._tickTimer);p._tickTimer=null}};k._cleanupBrowserPlugins=function(){var p=this;if(p.$playerContainer){p.$playerContainer.find("object").each(j.utils.cleanupBrowserPlugins).end().find("embed").remove()
}};k._embed=function(){var p=this;if(p._state===l.STATE_DESTROYED){return}p._clearEmbedTimeout();p._setState(l.STATE_ENGINE_EMBEDDING);p._updateEngineSize();p._setEmbedTimeout();p._engine.embed()};k._calcPlayedDuration=function(q){var r=this,p=(q*r._speed);
return p};k._calcAbsoluteTime=function(q){var r=this,p=(r._startTime+r._skippedDuration+r._calcPlayedDuration(q));return p};k._resetMetadata=function(){var s=this;s._pendingMetadata=null;s._currentFragment=null;
s._previousStatus=null;s._skippedDuration=0;s._bufferedDuration=0;s._currentSpeed=0;s._averageSpeed=0;s._speedStatsIndex=0;for(var p=s._speedStats,q=0,r=p.length;q<r;++q){p[q]=0}s._resetStalling()};k._load=function(){var r=this,q,p;
if(r._state===l.STATE_DESTROYED){return}r._clearLoadTimeout();r._clearTickTimer();r._resetMetadata();q=r._stream;r._setState(l.STATE_STREAM_LOADING);if(!q||!q.sources){p=new l.StreamError(j.tr(m,"stream.error.source_not_available"));
p.inner=new j.utils.ArgumentError(g+'#load: Argument "stream" '+(!q?"not set":"sources not ready")+".");r._onStreamLoadError({},p);return}r._setLoadTimeout();r._engine.load(q)};k._unload=function(s){var t=this,q,p,r;
t._clearLoadTimeout();t._clearTickTimer();p=t.getStatus();t._resetMetadata();if(t._stream){if(t._videoFinishedDeferred){q=t._videoFinishedDeferred;t._videoFinishedDeferred=null;q.rejectWith(t,[{status:p,error:null}])
}if(t._playDeferred){r=t._playDeferred;t._playDeferred=null;r.rejectWith(t,[null])}}t._stream=null;t._speed=0;t._startTime=0;t._lastTime=0;t._firstMetadata=false;if(t._state===l.STATE_STREAM_LOADING||t._state===l.STATE_STREAM_LOAD_SUSPENDED||t._state===l.STATE_STREAM_LOADED||t._state===l.STATE_STREAM_PLAYBACK_SUSPENDED){if(t._engine&&!s){t._engine.unload()
}}if(s){t._destroyEngine();t._setState(l.STATE_NEW)}else{if(t._engine){if(t._engine.isEmbedded()){t._setState(l.STATE_ENGINE_EMBEDDED)}else{t._setState(l.STATE_ENGINE_CREATED)}}else{t._setState(l.STATE_NEW)
}}};k._updateEngineSize=function(){var s=this,p,r,q;if(s._stream){p=s._stream.options.videoOptions.width;r=s._stream.options.videoOptions.height;if(p&&r){q=(p/r)}}if(s._forcedRatio){q=s._forcedRatio}if(q){s.$wrapper.css("paddingBottom",(100/q).toFixed(8)+"%")
}else{s.$wrapper.css("paddingBottom",0)}if(s._engine){s._engine.updateSize()}};k._setVolume=function(p){var q=this;if(typeof p==="number"){if(p<0){p=0}if(p>1){p=1}q.options.volume=p}if(q._engine){q._engine.setVolume(q.options.volume)
}};k._setMuted=function(p){var q=this;q.options.muted=!!p;if(q._engine){q._engine.setMuted(q.options.muted)}}}(window,window._ivideon));(function(c,h,f){"use strict";var d=h.$,e=a,b=e.prototype,g="ivideon.models.TimelineRecord";
h.provide(g,e);function a(k,i,j){var l=this;h.require("ivideon.tr");if(k>i){throw new Error(h.tr("ivideon.models.TimelineRecord","error.end_before_start",{startTime:k,endTime:i}))}if(j){d.extend(true,l,j)
}l.startTime=k;l.endTime=i}e.compareByStartTime=function(j,i){return j.startTime-i.startTime};e.sortRecordsByStartTime=function(i){i.sort(e.compareByStartTime)};b.intersects=function(j,i,l){var k=this;
return((i===f||(l?k.startTime<=i:k.startTime<i))&&(j===f||(l?k.endTime>=j:k.endTime>j)))};b.contained=function(j,i,l){var k=this;return((j===f||(l?k.startTime>=j:k.startTime>j))&&(i===f||(l?k.endTime<=i:k.endTime<i)))
}}(window,window._ivideon));(function(c,h,f){"use strict";var e=d,b=h.require("ivideon.models.TimelineRecord"),a=(h.require("ivideon.utils.subclass"))(e,b),g="ivideon.models.TimelineRecordsGroup";h.provide(g,e);
function d(k,i,l,j){var m=this;h.require("ivideon.models.TimelineHashTable");b.call(m,k,i,j);m.records=[]}}(window,window._ivideon));(function(d,h,f){"use strict";var e=c,b=h.require("ivideon.models.TimelineRecord"),a=(h.require("ivideon.utils.subclass"))(e,b),g="ivideon.models.TimelineRecordsCount";
h.provide(g,e);function c(l,i,j,k){var m=this;b.call(m,l,i,k);m.recordsCount=j}}(window,window._ivideon));(function(c,h,f){"use strict";var d=h.$,e=b,a=e.prototype,g="ivideon.models.TimelineHashTable";
h.provide(g,e);function b(j){var i=this;if(!j||j<=0){throw new Error("Slot size must be a positive number.")}i._hashTableSlotSize=j||(2*h.MINUTE_IN_MS);i._hashTable={};i._firstHash=0;i._lastHash=0;i._firstTime=0;
i._lastTime=0;i._count=0}a.add=function(k,n){if(!k){return}var l=this,m,j;if(d.isArray(k)){for(m=0,j=k.length;m<j;++m){l._addOne(k[m],n)}}else{l._addOne(k,n)}};a.first=function(){var i=this,j=(i._firstHash?i._hashTable[i._firstHash]:f);
return(j?j[0]:f)};a.last=function(){var i=this,j=(i._lastHash?i._hashTable[i._lastHash]:f);return(j&&j.length?j[j.length-1]:f)};a.count=function(){var i=this;return i._count};a.toArray=function(){var l=this,k=[],n,o,m,j;
for(n in l._hashTable){if(l._hashTable.hasOwnProperty(n)){o=l._hashTable[n];if(o&&o.length){for(m=0,j=o.length;m<j;++m){k[k.length]=o[m]}}}}return k};a.select=function(k,r,p){var u=this,l=[],q,o,s,m,j,n,v;
if(typeof k==="function"){q=k;p=!!r;for(o in u._hashTable){if(u._hashTable.hasOwnProperty(o)){s=u._hashTable[o];if(s&&s.length){for(m=0,j=s.length;m<j;++m){n=s[m];if(q(n)){if(p){return n}l[l.length]=n}}}}}if(p){return f
}}else{if(isNaN(k)){throw new h.utils.ArgumentError(g+'#select: Argument "startTime" must be number.')}v=k-2*u._hashTableSlotSize;if(u._lastHash){while(r===f||v<=(r+u._hashTableSlotSize)){o=u._hashFunction(v);
s=u._hashTable[o];if(s&&s.length){for(m=0,j=s.length;m<j;++m){n=s[m];if(n.intersects(k,r,true)){if(p){return n}l[l.length]=n}}}if(r===f&&(o>=u._lastHash||v>=u._lastTime)){break}v+=u._hashTableSlotSize}}if(p){return null
}}return l};a._addOne=function(i,m){if(m&&m(i)===false){return}var j=this,l=j._hashFunction(i.startTime),n=j._hashTable[l],k=i.startTime,o=i.endTime;if(!j._firstHash||l<j._firstHash){j._firstHash=l}if(!j._lastHash||l>j._lastHash){j._lastHash=l
}if(!j._firstTime||k<j._firstTime){j._firstTime=k}if(!j._lastTime||o>j._lastTime){j._lastTime=o}if(!n){n=j._hashTable[l]=[]}j._insertIntoSorted(n,i);++j._count};a._insertIntoSorted=function(j,i){h.utils.pushSorted(j,i,h.models.TimelineRecord.compareByStartTime)
};a._hashFunction=function(j){var i=this;return(Math.floor(j/i._hashTableSlotSize)*i._hashTableSlotSize)}}(window,window._ivideon));(function(c,h,f){"use strict";var d=h.$,e=a,b=e.prototype,g="ivideon.models.Timeline";
h.provide(g,e);function a(i){var k=this,j=h.require("ivideon.models.TimelineHashTable");k._options=h.optMerge(e.defaults,i);k.events=new (h.require("ivideon.utils.Observable"))(k);k._recordsHashTable=new j(k._options.hashTableSlotSize);
k._countsHashTable=new j(31*h.DAY_IN_MS);k._groupings={};k._groupingThresholds=[];k._ranges=[]}e.LOAD_MODE_RECORDS=1;e.LOAD_MODE_COUNTS=2;e.defaults={hashTableSlotSize:(48*h.HOUR_IN_MS),recordsLoader:function(j,i){return d.Deferred().resolve().promise()
},countsLoader:function(j,i){return d.Deferred().resolve().promise()}};b.getRanges=function(k,o){var p=this,m=p._ranges,q=h.require("ivideon.models.TimelineRecord").prototype.intersects,n,l,j,s;if(typeof k==="undefined"&&typeof o==="undefined"){return[].concat(m)
}s=[];for(n=0,l=m.length;n<l;++n){j=m[n];if(q.call(j,k,o,true)){s[s.length]=j}}return s};b.getRangesToLoad=function(n,p){var q=this,s=[],l,k=h.now(),j,o,m;if(p>k){p=k}l=q.getRanges(n,p);j={startTime:n,endTime:p};
for(o=0,m=l.length;o<m;++o){j.endTime=l[o].startTime;if(j.endTime>j.startTime){s[s.length]=j}j={startTime:l[o].endTime,endTime:p}}if(j.endTime>j.startTime){s[s.length]=j}return s};b.performLoad=function(n,s,q){var t=this,x=[],u="",w="loading-started",o="loading-success",m="loading-error",k,p,l,j,v;
if(q===e.LOAD_MODE_COUNTS){u="counts-";t.events.fire(u+w);if(d.isFunction(t._options.countsLoader)){x[x.length]=t._options.countsLoader.call(t,n,s)}}else{u="records-";t.events.fire(u+w);if(d.isFunction(t._options.recordsLoader)){k=t.getRangesToLoad(n,s);
for(p=0,l=k.length;p<l;++p){j=k[p];x[x.length]=t._options.recordsLoader.call(t,j.startTime,j.endTime)}}}v=d.when.apply(d,x);v.done(function(){t.events.fire(u+o)}).fail(function(){t.events.fire(u+m)});return v.promise()
};b.select=function(k,i,j){var l=this;return l._recordsHashTable.select(k,i,j)};b.count=function(){var i=this;return i._recordsHashTable.count()};b.selectFromGrouping=function(k,i,m,j){var n=this,l;if(typeof k==="function"){j=!!m;
m=i;i=j}l=n._groupings[m];if(!l){throw new Error("No grouping with threshold "+m)}return l.select(k,i,j)};b.selectLastRecord=function(){return this._recordsHashTable.last()};b.addRecords=function(i){if(!i||!i.length){return
}var j=this;h.models.TimelineRecord.sortRecordsByStartTime(i);j._recordsHashTable.add(i,function(k){return j._filterByRanges(k)});j._addToGroupings(i);j._addToRanges(i);j.events.fire("records-added",{records:i})
};b.addCounts=function(l){var n=this,k=l.length,m,j;while(k--){m=l[k];j=n._countsHashTable.select(m.startTime,f,true);if(j&&j.startTime===m.startTime){j.recordsCount=m.recordsCount}else{n._countsHashTable.add(m)
}}n.events.fire("counts-added",{counts:l})};b.selectCounts=function(k,i,j){var l=this;return l._countsHashTable.select(k,i,j)};b.addGrouping=function(j){var k=this,i=h.require("ivideon.models.TimelineHashTable");
if(k._groupings[j]){return}k._groupings[j]=new i(k._options.hashTableSlotSize);k._groupingThresholds[k._groupingThresholds.length]=j;k._addToGrouping(j,k._recordsHashTable.toArray())};b.getClosestGrouping=function(n){var q=this,m=q._groupingThresholds,k=m[0],p=Math.abs(n-k),l,j,o;
for(l=0,j=m.length;l<j;++l){o=Math.abs(n-m[l]);if(o<p){k=m[l];p=o}}return k};b._addToGroupings=function(i){var k=this,j;for(j in k._groupings){if(k._groupings.hasOwnProperty(j)){k._addToGrouping(j,i)}}};
b._addToGrouping=function(p,l){var o=this,s=h.require("ivideon.models.TimelineRecordsGroup"),k=o._groupings[p],r,n,q,m,j=l.length;if(!k){throw new Error("No grouping with threshold "+p)}p=parseFloat(p);
for(m=0;m<j;++m){q=(m>0?l[m-1]:null);n=l[m];if(!q||n.startTime>(q.endTime+p)){r=new s(n.startTime,n.endTime,p);k.add(r)}else{r.endTime=n.endTime}h.utils.pushSorted(r.records,n,h.models.TimelineRecord.compareByStartTime)
}};b._addToRanges=function(l){var q=this,w=l[0].startTime,u=l[l.length-1].endTime,o=q._ranges,n=[],j={startTime:w,endTime:u},p,k,v,t,m;h.utils.pushSorted(o,j,h.models.TimelineRecord.compareByStartTime);
v=null;for(p=0,k=o.length;p<k;++p){j=o[p];if(v===null){v={startTime:j.startTime,endTime:j.endTime};continue}t=v.startTime;m=v.endTime;if(j.startTime<=m){v.endTime=Math.max(j.endTime,m)}else{n[n.length]=v;
v={startTime:j.startTime,endTime:j.endTime}}}if(v){n[n.length]=v}q._ranges=n};b._filterByRanges=function(k){var o=this,l=o._ranges,m,j,n;for(m=0,j=l.length;m<j;++m){n=l[m];if(k.contained(n.startTime,n.endTime,true)){return false
}}}}(window,window._ivideon));(function(d,e,a){"use strict";var b=e.$,h=g,i=e.require("ivideon.utils.OrderedHashMap"),f=(e.require("ivideon.utils.subclass"))(h,i),c="ivideon.models.TimelinesList";e.provide(c,h);
function g(){var j=this;i.call(j,{withColors:true,withLabels:function(l,k){return k+1}})}f.performLoad=function(j,o,n){var p=this,u=[],t=p._keys,q=p._items,l,m,r,s;for(l=0,m=t.length;l<m;++l){r=q[t[l]];
u[u.length]=r.performLoad(j,o,n)}s=b.when.apply(b,u);return s.promise()}}(window,window._ivideon));(function(h,p,f){"use strict";var e=p.$,t=p.require({prefix:""},"moment"),g=r,d=g.prototype,q="ivideon.views.TimelineView",j=q,u=p.require("ivideon.utils.PointersTracker"),s=((e.browser.msie&&e.browser.version<9)||e.browser.android),a=t().zone(),n,m=["height","borderLeftWidth","borderLeftColor","borderTopWidth","borderTopColor","paddingTop","paddingRight","paddingBottom","paddingLeft","marginTop","marginRight","marginLeft","marginBottom","color","backgroundColor","fontSize","fontWeight","fontStyle","fontFamily"],b=["height","minHeight","marginBottom","color","backgroundColor"],i=["color","fontSize","fontWeight","fontStyle","fontFamily"],k=["paddingTop","paddingBottom","borderTopWidth","borderBottomWidth"],o={center:0,left:1,right:2},c=u.POINTER_TYPE_MOUSE,l=u.POINTER_TYPE_FINGER;
n=m;p.provide(q,g);function r(y,v,w){if(!y){throw new p.utils.ArgumentError(q+': Argument "timelines" not set.')}if(!v){throw new p.utils.ArgumentError(q+': Argument "container" not set.')}var A=this;A._options=g._takeOptions(w);
A.events=new (p.require("ivideon.utils.Observable"))(A);A._timelines=y;A._timelinesColors={};A._timelineLabels={};A._timelineLabelsColors={};A.$container=e(v);A._timezone=(A._options.timezone||p.getDetectedTimezone());
A._range=(A._options.rangeInitial?g._cloneRange(A._options.rangeInitial):A._createInitialRange());A._limitRange(A._range,f);A._rangeInitial=g._cloneRange(A._range);A._rangeChangedExternally=!!A._options.rangeInitial;
A._rangePrev={startTime:A._range.startTime,endTime:A._range.startTime};A._rangeNext=g._cloneRange(A._range);A._rangeRecords={};A._allItems={};A._tooltippedItems={};A._rangeItems={};A._nowItems={};A._allItemsId=0;
A._statusCssClassName=null;h.document.createElement("CANVAS");A.$wrapper=e('<div class="ivideon-timeline"><a class="ivideon-timeline-button ivideon-timeline-button-scroll-left iv-btn" title="'+p.utils.htmlencode(p.tr(j,"button.scroll_left.title"))+'">'+p.tr(j,"button.scroll_left.text")+'</a><a class="ivideon-timeline-button ivideon-timeline-button-scroll-right iv-btn" title="'+p.utils.htmlencode(p.tr(j,"button.scroll_right.title"))+'">'+p.tr(j,"button.scroll_right.text")+'</a><div class="ivideon-timeline-items-wrapper" /><div class="ivideon-timeline-tooltip-wrapper" /><div class="ivideon-timeline-status-wrapper" /><div class="ivideon-timeline-future-overlay-wrapper"><div class="ivideon-timeline-future-overlay"><span/></div></div><div class="ivideon-timeline-wrapper"><canvas class="ivideon-timeline-canvas" /></div></div>').disableSelection().appendTo(A.$container);
A.$scrollLeft=A.$wrapper.find(".ivideon-timeline-button-scroll-left").button({icons:{primary:"ui-icon-seek-prev"},text:false}).bind("click",function(){if(e(this).button("widget").hasClass("ui-state-disabled")){return false
}A.events.fire("scroll-left-click");A.scrollLeft()});A.$scrollRight=A.$wrapper.find(".ivideon-timeline-button-scroll-right").button({icons:{primary:"ui-icon-seek-next"},text:false}).bind("click",function(){if(e(this).button("widget").hasClass("ui-state-disabled")){return false
}A.events.fire("scroll-right-click");A.scrollRight()});A.$itemsWrapper=A.$wrapper.find(".ivideon-timeline-items-wrapper");A.$tooltipWrapper=A.$wrapper.find(".ivideon-timeline-tooltip-wrapper");A.$statusWrapper=A.$wrapper.find(".ivideon-timeline-status-wrapper");
A.$futureOverlayWrapper=A.$wrapper.find(".ivideon-timeline-future-overlay-wrapper");A.$futureOverlay=A.$wrapper.find(".ivideon-timeline-future-overlay");A.$timelineWrapper=A.$wrapper.find(".ivideon-timeline-wrapper");
A.$canvas=A.$wrapper.find(".ivideon-timeline-canvas");A._initCursors();A._timelineWrapperWidth=1;A._timelineWrapperHeight=0;A._timelineWrapperOffset=A.$timelineWrapper.offset();if(e.browser.msie&&e.browser.version<9){A.$timelineWrapper.css("left","auto");
A._timelineWrapperRight=parseInt(A.$timelineWrapper.css("right"),10);A.$timelineWrapper.css("left","")}A._timelineWrapperBorderTopWidth=parseInt(A.$timelineWrapper.css("borderTopWidth"),10);if(isNaN(A._timelineWrapperBorderTopWidth)){A._timelineWrapperBorderTopWidth=0;
p.reportError(new p.utils.NonCriticalError(q+" wrapper border-top-width is NaN"))}A._timelineWrapperBorderBottomWidth=parseInt(A.$timelineWrapper.css("borderBottomWidth"),10);if(isNaN(A._timelineWrapperBorderBottomWidth)){A._timelineWrapperBorderBottomWidth=0;
p.reportError(new p.utils.NonCriticalError(q+" wrapper border-bottom-width is NaN"))}A._timelineTicksStyle=p.utils.convertIntegerCSS(p.utils.extractCSS("ivideon-timeline-ticks-style",m,A.$wrapper));A._timelineDatesStyle=p.utils.convertIntegerCSS(p.utils.extractCSS("ivideon-timeline-dates-style",n,A.$wrapper));
A._timelineTicksFont=p.utils.getCanvasFont(A._timelineTicksStyle);A._timelineDatesFont=p.utils.getCanvasFont(A._timelineDatesStyle);A._timelineTicksHeight=(A._timelineTicksStyle.height+A._timelineTicksStyle.paddingTop+A._timelineTicksStyle.paddingBottom);
A._timelineTicksOuterHeight=(A._timelineTicksHeight+A._timelineTicksStyle.marginTop+A._timelineTicksStyle.marginBottom);A._timelineDatesHeight=(A._timelineDatesStyle.height+A._timelineDatesStyle.paddingTop+A._timelineDatesStyle.paddingBottom);
A._timelineDatesOuterHeight=(A._timelineDatesHeight+A._timelineDatesStyle.marginTop+A._timelineDatesStyle.marginBottom);A._timelineTicksFutureStyle=p.utils.convertIntegerCSS(p.utils.extractCSS("ivideon-timeline-ticks-future-style",m,A.$wrapper));
A._timelineDatesFutureStyle=p.utils.convertIntegerCSS(p.utils.extractCSS("ivideon-timeline-dates-future-style",n,A.$wrapper));A._timelineRecordsStyle=p.utils.convertIntegerCSS(p.utils.extractCSS("ivideon-timeline-records-style",b,A.$wrapper));
A._railSpacing=A._timelineRecordsStyle.marginBottom;A._extractRecordsByTypeStyles();A._timelineLabelsStyle=p.utils.convertIntegerCSS(p.utils.extractCSS("ivideon-timeline-labels-style",i,A.$wrapper));A._timelineLabelsFont=p.utils.getCanvasFont(A._timelineLabelsStyle);
A._canvas=A.$canvas.get(0);A._canvasShimUsed=false;A._pointer1=null;A._pointer2=null;A._pointerOverTimeline=false;A._pointerOverRecords=false;A._pointerClickDisabled=false;A._dragging=false;A._draggingZoom=false;
A._draggingItem=false;A._draggingItemRangeBase={startTime:null,endTime:null};A._draggingBase=null;A._draggingRangeBase={startTime:null,endTime:null};A._draggingRange={startTime:null,endTime:null};A._draggingDelta=null;
A._draggingStartTimer=null;A._slingAnimation=null;A._onRangeChanged(true,true);A._timelines.forEach(function(C,B){A._addTimeline(C,B)});A._timelines.events.on("added",A._onTimelineAdded=function(E,B){var D=B.item,C=B.key;
A._addTimeline(D,C)});A._timelines.events.on("removed",A._onTimelineRemoved=function(E,B){var D=B.item,C=B.key;A._removeTimeline(D,C)});A._updateTimelineWrapperMetrics(true);A._tooltipItem=A._addItem("ivideon-timeline-tooltip",A._range.startTime,{stayInView:true});
A._tooltipMetrics={left:0,width:0,height:0};A._pointerItem=A._addItem("ivideon-timeline-pointer m-cursor",A._range.startTime,{snap:true,onUpdate:function(){A.events.fire("pointer-updated",A._pointerItemArgs)
}});A._pointerItemArgs={item:A._pointerItem};A._tooltipStyle=p.utils.convertIntegerCSS(p.utils.extractCSS(A._tooltipItem._el,k,A.$wrapper));A.$wrapper.bind("contextmenu",false);A._createPointersTracker();
e(h).one("load",A._onWindowLoad=function(){A._redraw()}).bind("resize orientationchange",A._onWindowResize=function(){h.clearTimeout(A._onWindowResizeTimer);A._onWindowResizeTimer=null;A._onWindowResizeTimer=h.setTimeout(function(){if(A._state===g.STATE_DESTROYED){return
}A._updateTimelineWrapperMetrics()},1000)});function z(){if(A._state===g.STATE_DESTROYED){return}var B=(A._rangeInitial.endTime-A._rangeInitial.startTime),C=p.now();A._updateFutureOverlay();if(C>A._closestFutureTickTime){A._redraw()
}else{A._updateNowItems()}if(!A._rangeChangedExternally&&C>A._rangeInitial.endTime){A._rangeInitial.startTime+=B;A._rangeInitial.endTime+=B;A._slingTo(A._rangeInitial.startTime,A._rangeInitial.endTime)
}A._timeUpdateTimer=h.setTimeout(z,(s?2000:1000))}A._tendFPS=(s?10:60);A._tendSling=true;A._setState(g.STATE_CREATED);h.setTimeout(function x(){if(A._state===g.STATE_DESTROYED){return}A._redraw(true);A._timeUpdateTimer=h.setTimeout(z,500);
A._startTend()},0)}g.SCROLL_TO_FUTURE_MODE_NONE=0;g.SCROLL_TO_FUTURE_MODE_NOW=1;g.SCROLL_TO_FUTURE_MODE_DAY=2;g.STATE_CREATED=1;g.STATE_DESTROYED=2;g.defaults={levels:[{rangeSize:15*p.MINUTE_IN_MS,ticksCount:5,groupingThreshold:p.SECOND_IN_MS},{rangeSize:p.HOUR_IN_MS,ticksCount:5,groupingThreshold:p.SECOND_IN_MS},{rangeSize:4*p.HOUR_IN_MS,ticksCount:4,groupingThreshold:5*p.MINUTE_IN_MS},{rangeSize:24*p.HOUR_IN_MS,ticksCount:8,groupingThreshold:5*p.MINUTE_IN_MS}],doubleBuffering:true,slingEnabled:(s?false:true),redrawTimeout:(s?50:0),zoomWheelStep:(s?0.5:0.3),itemsSnapDistance:3,itemsDraggableSnapDistance:20,centerAtDelay:100,centerAtSoftenLimits:0.05,draggingSoftenLimits:0.1,draggingMouseMoveThreshold:1,draggingMouseTimeThreshold:500,draggingFingerMoveThreshold:1,draggingFingerTimeThreshold:50,draggingZoomEnabled:false,timelineColorsEnabled:true,timelineLabelsEnabled:true,recordColorsByTypeEnabled:false,groupingEnabled:false,scrollByTicks:true,flipLastTick:false,scrollButtonsFullHeight:false,scrollToFutureMode:g.SCROLL_TO_FUTURE_MODE_DAY};
g._takeOptions=function(w){var z=g.defaults,A=p.optMerge(z,w),y=A.levels,x,v,B;if(!e.isArray(y)||y.length<=0){A.levels=y=z.levels}for(x=0,v=y.length;x<v;++x){B=y[x];if(typeof B.rangeSize!=="number"){B.rangeSize=z.levels[0].rangeSize
}}y.sort(g._levelsComparer);if(!A.rangeInitial||typeof A.rangeInitial.startTime!=="number"||typeof A.rangeInitial.endTime!=="number"){A.rangeInitial=f}A.redrawTimeout=Math.max(0,A.redrawTimeout);return A
};g._levelsComparer=function(w,v){var x=(w.rangeSize-v.rangeSize);return(x===0?0:(x>0?1:-1))};g._itemsSnapCandidatesComparer=function(w,v){if(w.draggable!==v.draggable){return(w.draggable?-1:1)}if(!w.range!==!v.range){return(w.range?1:-1)
}return(w._snapCandidateDistance-v._snapCandidateDistance)};g._cloneRange=function(v){return{startTime:v.startTime||0,endTime:v.endTime||0}};d.getRange=function(){var v=this;if(v._state===g.STATE_DESTROYED){return
}return g._cloneRange(v._range)};d.getNextRange=function(){var v=this;if(v._state===g.STATE_DESTROYED){return}return g._cloneRange(v._rangeNext)};d.isEmpty=function(){var v=this;return !v._someRecordsVisible
};d.addItem=function(v,x,w){var z=this,y;if(z._state===g.STATE_DESTROYED){return}y=z._addItem(v,x,w);return z._allItemsId};d.updateItem=function(z,w,v){var y=this,x;if(y._state===g.STATE_DESTROYED){return
}x=y._allItems[z];if(!x){return}y._updateItem(x,w,v)};d.removeItem=function(x){var w=this,v;if(w._state===g.STATE_DESTROYED){return}v=w._allItems[x];if(v){delete w._tooltippedItems[x];delete w._rangeItems[x];
delete w._allItems[x];v._el.remove()}};d.getItemTime=function(y,v){var x=this,w;if(x._state===g.STATE_DESTROYED){return}w=x._allItems[y];if(w){return(v&&w.range?w._range.endTime:w._range.startTime)}};d.scrollTo=function(x,w,y,v){var z=this;
if(z._state===g.STATE_DESTROYED){return}if(typeof x!=="number"||isNaN(x)){throw new p.utils.ArgumentError(q+'#scrollTo: Argument "startTime" is incorrect.')}if(typeof w!=="number"||isNaN(w)){throw new p.utils.ArgumentError(q+'#scrollTo: Argument "endTime" is incorrect.')
}if(typeof y==="undefined"){y=z._options.slingEnabled}z._rangeChangedExternally=true;if(y){z._slingTo(x,w,v)}else{z._jumpTo(x,w,v)}};d.scrollLeft=function(x){var z=this,v,y,w;if(z._state===g.STATE_DESTROYED){return
}y=(z._rangeNext.endTime-z._rangeNext.startTime);w=(z._level.rangeSize/z._level.ticksCount);if(z._options.scrollByTicks){v=z._createAlignedRange(z._rangeNext.startTime,w);if(v.startTime!==z._rangeNext.startTime){v.startTime+=w
}v.endTime=v.startTime+y}else{v=g._cloneRange(z._rangeNext)}v.startTime-=w;v.endTime-=w;z.scrollTo(v.startTime,v.endTime,x)};d.scrollRight=function(x){var z=this,v,y,w;if(z._state===g.STATE_DESTROYED){return
}y=(z._rangeNext.endTime-z._rangeNext.startTime);w=(z._level.rangeSize/z._level.ticksCount);if(z._options.scrollByTicks){v=z._createAlignedRange(z._rangeNext.startTime,w);v.endTime=v.startTime+y}else{v=g._cloneRange(z._rangeNext)
}v.startTime+=w;v.endTime+=w;z.scrollTo(v.startTime,v.endTime,x)};d.zoomBy=function(w,v,y){var z=this,x;if(z._state===g.STATE_DESTROYED){return}x=z._getZoomedRange(z._rangeNext,w,v);z.scrollTo(x.startTime,x.endTime,y,v)
};d.centerAt=function(D,v,B,y){var z=this,x,A,C,w;if(z._state===g.STATE_DESTROYED){return}x=z._rangeNext;A=(x.endTime-x.startTime);v=z._limitCenter(v);C={startTime:D-(v)*A,endTime:D+(1-v)*A};if(typeof B==="undefined"){B=z._options.slingEnabled
}if(B){if(s){y=0}else{if(typeof y!=="number"){y=z._options.centerAtSoftenLimits}}w=g._cloneRange(C);if(z._limitRange(w,z._range,v)){z._slingTo(C.startTime,C.endTime,B,v,y);h.setTimeout(function(){z.scrollTo(C.startTime,C.endTime,B,v)
},z._options.centerAtDelay);return}}z.scrollTo(C.startTime,C.endTime,B,v)};d.setStatus=function(w,v){var x=this;if(x._state===g.STATE_DESTROYED){return}if(x._statusCssClassName){x.$wrapper.removeClass(x._statusCssClassName);
x._statusCssClassName=null}x._statusCssClassName=v;if(x._statusCssClassName){x.$wrapper.addClass(x._statusCssClassName)}x.$statusWrapper.html(w||"")};d.setTimezone=function(w){var x=this,v;if(typeof w!=="string"||!w){throw new p.utils.ArgumentError(q+'#setTimezone: Argument "timezone" is incorrect.')
}if(x._state===g.STATE_DESTROYED){return}x._timezone=w;if(!x._rangeChangedExternally&&!x._options.rangeInitial){v=x._createInitialRange();x._rangeInitial.startTime=v.startTime;x._rangeInitial.endTime=v.endTime;
x._jumpTo(x._rangeInitial.startTime,x._rangeInitial.endTime)}else{x._redraw()}};d.getTimezone=function(){return this._timezone};d.redraw=function(){var v=this;if(v._state===g.STATE_DESTROYED){return}v._updateTimelineWrapperMetrics(true);
return v._redraw()};d.destroy=function(){var w=this,v;if(w._state===g.STATE_DESTROYED){return}if(w._timeUpdateTimer){h.clearTimeout(w._timeUpdateTimer);w._timeUpdateTimer=null}w._stopTend();if(w._onWindowLoad){e(h).unbind("load",w._onWindowLoad);
w._onWindowLoad=null}if(w._onWindowResize){h.clearTimeout(w._onWindowResizeTimer);w._onWindowResizeTimer=null;e(h).unbind("resize orientationchange",w._onWindowResize);w._onWindowResize=null}if(w._onTimelineAdded){w._timelines.events.un("added",w._onTimelineAdded);
w._onTimelineAdded=null}if(w._onTimelineRemoved){w._timelines.events.un("removed",w._onTimelineRemoved);w._onTimelineRemoved=null}w._timelines.forEach(function(y,x){w._removeTimeline(y,x,true)});w._setState(g.STATE_DESTROYED);
w.events.fire("destroying");w.events.un();if(w._draggingStartTimer){h.clearTimeout(w._draggingStartTimer);w._draggingStartTimer=null}if(w._redrawTimer){h.clearTimeout(w._redrawTimer);w._redrawTimer=null
}w._pointersTracker.destroy();w._pointersTracker=null;if(w._canvasShimUsed&&typeof h.FlashCanvas!=="undefined"&&typeof w._canvas._destroy==="function"){w._canvas._destroy()}w._canvasBufferContext=null;
w._canvasBuffer=null;w._canvasContext=null;w._canvas=null;w._replaceCursor(null);w._cleanupBrowserPlugins();w.$wrapper.remove();for(v in w){if(w.hasOwnProperty(v)&&v.charAt(0)==="$"){delete w[v]}}w._timelines=null
};d._setState=function(v){var w=this;if(!v){throw new p.utils.ArgumentError(q+'#_setState: Argument "state" not set.')}if(w._state===g.STATE_DESTROYED){return}w._state=v};d._cleanupBrowserPlugins=function(){var v=this;
if(v.$wrapper){v.$wrapper.find("object").each(p.utils.cleanupBrowserPlugins).end().find("embed").remove()}};d._extractRecordsByTypeStyles=function(){var A=this,y=[null,1,2,3],x,v,z,w;if(!A._options.recordColorsByTypeEnabled){return
}A._timelineRecordsByTypeColors=[];for(v=y.length,x=0;x<v;++x){if(y[x]!==f&&y[x]!==null){z=p.utils.convertIntegerCSS(p.utils.extractCSS("ivideon-timeline-records-style m-type-"+y[x],["color"],A.$wrapper))
}if(z){w=z.color}else{w=null}A._timelineRecordsByTypeColors[x]=w}};d._updateTimelineWrapperOffset=function(y){var x=this,w=x.$timelineWrapper.offset(),v=false;if(w.left!==x._timelineWrapperOffset.left||w.top!==x._timelineWrapperOffset.top){x._timelineWrapperOffset=w;
v=true;x._onTimelineWrapperOffsetChanged(y)}if(v&&!y){x._redraw()}return v};d._updateTimelineWrapperMetrics=function(D){var C=this,z=C._getRailHeight(),y=(C._timelines.length===0?z:C._getRailOffsetTop(z,C._timelines.length)-C._railSpacing),A=(C._timelineWrapperBorderTopWidth+C._timelineTicksOuterHeight+y+C._timelineDatesOuterHeight+C._timelineWrapperBorderBottomWidth),B=false,x,v;
C._updateTimelineWrapperOffset(true);if(e.browser.msie&&e.browser.version<9){x=(C.$scrollRight.offset().left+C.$scrollRight.outerWidth()-C._timelineWrapperRight-C._timelineWrapperOffset.left)}else{x=C.$timelineWrapper.width()
}x=(x<=0||typeof x!=="number"?1:x);A=(A<=0||typeof A!=="number"?1:A);if(x!==C._timelineWrapperWidth||x!==parseInt(C._canvas.style.width,10)){C._timelineWrapperWidth=x;B=true;if(e.browser.msie&&e.browser.version<9){v=~~x+"px";
C.$timelineWrapper[0].style.width=v;C.$tooltipWrapper[0].style.width=v;C.$futureOverlayWrapper[0].style.width=v;C.$itemsWrapper[0].style.width=v;C.$statusWrapper[0].style.width=v}C._onTimelineWrapperWidthChanged(D)
}if(y!==C._timelineRecordsOuterHeight||A!==C._timelineWrapperHeight){C._timelineRecordsOuterHeight=y;C._timelineWrapperHeight=A;B=true;C.$timelineWrapper[0].style.height=~~C._timelineWrapperHeight+"px";
C._onTimelineWrapperHeightChanged(D)}if(B&&!D){C._redraw()}return B};d._rememberPointers=function(v){var y=this,x=y._pointer1,w;w=y._pointersTracker.getPointers(v);if(w.length===0){y._pointer1=null;y._pointer2=null
}else{if(w.length===1){y._pointer1=w[0];y._pointer2=null;if(!x){y._updateTooltipUnderItem()}}else{if(w.length===2){y._pointer1=w[0];y._pointer2=w[1];if(!x){y._updateTooltipUnderItem()}}else{return}}}};
d._getPointerTimelineOffset=function(y){var z=this,w=y.currX,v=(typeof w==="number"?z._coordToOffset(w):f);return v};d._isPointerNearAwayTooltip=function(){var w=this,v=false;if(w._tooltipItem&&w._tooltipItem.visible){if(w._tooltipUnderItem&&w._tooltipUnderItem!==w._pointerItem){if(!w._pointerOverRecords&&w._pointerOverTimeline){v=(w._pointer1.currX>=w._tooltipMetrics.left&&w._pointer1.currX<=w._tooltipMetrics.right)
}}}return v};d._pixelTime=function(v){return((v.endTime-v.startTime)/this._timelineWrapperWidth)};d._timeToOffset=function(w,v){return(this._timelineWrapperWidth*(w-v.startTime)/(v.endTime-v.startTime))
};d._offsetToTime=function(v,w){return((v/this._timelineWrapperWidth)*(w.endTime-w.startTime)+w.startTime)};d._coordToTime=function(v){return this._offsetToTime(this._coordToOffset(v),this._range)};d._coordToOffset=function(v){return(v-this._timelineWrapperOffset.left)
};d._coordToTimelineIndex=function(v){var w=(v-(this._timelineWrapperOffset.top+this._timelineWrapperBorderTopWidth+this._timelineTicksOuterHeight));if(w<0){return -1}return(~~(w/(this._getRailHeight()+this._railSpacing)))
};d._coordDeltaToTimeDelta=function(v){return((this._range.endTime-this._range.startTime)*(-v/this._timelineWrapperWidth))};d._momentWithTimezone=function(v){return t(v).tz(this._timezone)};d._getTimezoneOffsetText=function(v){return("UTC"+(v<=0?"+":"-")+p.utils.padWithZeros(~~(Math.abs(v)*100/60),4))
};d._getTooltipHtml=function(w){if(!w){return""}var y=this._momentWithTimezone(w),x=y.zone(),v="";v+='<span class="ivideon-timeline-tooltip-content">';v+='<span class="ivideon-timeline-tooltip-icon"></span>';
v+='<span class="ivideon-timeline-tooltip-text">';v+='<span class="ivideon-timeline-tooltip-time">';v+=y.format("HH:mm:ss");v+="</span>";v+='<span class="ivideon-timeline-tooltip-date">';v+=y.format("D.MM.YYYY");
v+="</span>";v+='<span class="ivideon-timeline-tooltip-timezone">';if(x!==a){v+=" "+this._getTimezoneOffsetText(x)}v+="</span>";v+="</span>";v+="</span>";return v};d._getTickTimeText=function(w,v){var x=w.format("HH:mm");
if(v){x+=" "+this._getTimezoneOffsetText(w.zone())}return x};d._getTickDateText=function(w,v){var x=w.format("D.MM.YYYY");if(v){x+=" "+this._getTimezoneOffsetText(w.zone())}return x};d._getLevelByRange=function(z){var w=this._options,D=w.levels,A=(z.endTime-z.startTime),B=D[0],y,x,v,C;
for(y=0,x=D.length;y<x;++y){v=D[y];C=(y>0?D[y-1]:null);if(A>=(C?(C.rangeSize+v.rangeSize)/2:v.rangeSize)){B=v}}return B};d._limitRange=function(C,J,v,D){var B=this._options,y=p.now(),I=C.startTime,E=C.endTime,F=(E-I),A=(J?(J.endTime-J.startTime):f),x=B.rangeLimit,w=(x?x.startTime:f),H=(x?x.endTime:f),G=B.levels[0].rangeSize,z=B.levels[B.levels.length-1].rangeSize;
v=this._limitCenter(v);switch(B.scrollToFutureMode){case g.SCROLL_TO_FUTURE_MODE_NOW:H=y;break;case g.SCROLL_TO_FUTURE_MODE_DAY:H=this._momentWithTimezone(y).startOf("day").add(1,"day").valueOf();break;
default:}if(typeof D==="number"){if(typeof w==="number"){w-=D*F}if(typeof H==="number"){H+=D*F}}if(typeof w==="number"&&typeof H==="number"){if((H-w)<G){G=(H-w)}if((H-w)>z){z=(H-w)}}if(typeof A!=="number"||F<A){if(F<G){C.startTime-=(v)*(G-F);
C.endTime+=(1-v)*(G-F);F=(C.endTime-C.startTime)}}else{if(typeof A!=="number"||F>A){if(F>z){C.startTime+=(v)*(F-z);C.endTime-=(1-v)*(F-z);F=(C.endTime-C.startTime)}}}if(typeof H==="number"){if(C.endTime>H){C.endTime=H;
C.startTime=C.endTime-F}}else{if(typeof w==="number"){if(C.startTime<w){C.startTime=w;C.endTime=C.startTime+F}}}return(I!==C.startTime||E!==C.endTime)};d._limitCenter=function(v){if(typeof v!=="number"){v=0.5
}else{v=Math.max(0,Math.min(1,v))}return v};d._getZoomedRange=function(x,y,w){var z,v;if(y!==0){z=(x.endTime-x.startTime);w=this._limitCenter(w);v={startTime:x.startTime-(w)*(z*-y),endTime:x.endTime+(1-w)*(z*-y)}
}else{v=g._cloneRange(x)}return v};d._createAlignedRange=function(w,z,v){var y=this._momentWithTimezone(w),x=y.startOf("day").valueOf();while((x+z)<=w){x+=z}return(v?x:{startTime:x,endTime:x+z})};d._createInitialRange=function(){var x=this,w=x._options.levels[x._options.levels.length-1].rangeSize,v=p.now();
return x._createAlignedRange(v,w)};d._changeRangeTo=function(x,w,v,y){this._rangeNext.startTime=x;this._rangeNext.endTime=w;this._limitRange(this._rangeNext,this._rangePrev,v,y)};d._freeze=function(){var v=(this._rangeNext.startTime!==this._range.startTime||this._rangeNext.endTime!==this._range.endTime);
this._rangeNext.startTime=this._range.startTime;this._rangeNext.endTime=this._range.endTime;this._stopTend();if(v){this._onRangeChanged(false)}};d._jumpTo=function(x,w,v,y){this._tendSling=false;this._changeRangeTo(x,w,v,y);
this._tend(false)};d._slingTo=function(x,w,v,y){this._tendSling=true;this._changeRangeTo(x,w,v,y);this._startTend()};d._startTend=function(){var v=this;if(!v._tendTimer){v._tendTimer=h.setTimeout(function(){v._tendTimer=null;
v._tend(true)},1000/v._tendFPS)}};d._stopTend=function(){if(this._tendTimer){h.clearTimeout(this._tendTimer);this._tendTimer=null}};d._tend=function(v){var B=this,y,E,D,x,C=5,w=5000,A=true,z=false;if(B._state===g.STATE_DESTROYED){return
}y=(B._rangeNext.startTime-B._range.startTime);E=(B._rangeNext.endTime-B._range.endTime);D=B._pixelTime(B._range);x=D/2;if(!B._tendSling||(((y&&E)||!B._rangeChangeFired)&&(Math.abs(y)+Math.abs(E))<x)){B._range.startTime=B._rangeNext.startTime;
B._range.endTime=B._rangeNext.endTime;z=true;A=false}else{if(y||E){B._rangeChangeFired=0;B._range.startTime=B._range.startTime+y/C;B._range.endTime=B._range.endTime+E/C;z=true}}if(!A){A=(B._dragging&&B._pointer1&&(p.now()-B._rangeChangeFired)<w)
}if(!B._dragging&&B._draggingMoved){B._draggingMoved=false;B._onRangeChanged(false)}else{if(z){B._onRangeChanged(A)}}if(A&&v){B._startTend()}};d._addTimeline=function(w,v,y){if(!w){return}var x=this;if(x._state===g.STATE_DESTROYED){return
}x._timelinesColors[v]=x._timelines.getColor(v,0.5);x._timelineLabels[v]=x._timelines.getLabel(v);x._timelineLabelsColors[v]=x._timelines.getColor(v,0.7);w.events.on("records-added",x._onTimelineRecordsAdded,x);
h.setTimeout(function(){if(x._state===g.STATE_DESTROYED){return}x._updateTimelineWrapperMetrics(y);h.setTimeout(function(){if(x._state===g.STATE_DESTROYED){return}if(x._collectRecordsInRange()){x._redraw()
}},10)},0)};d._removeTimeline=function(w,v,y){if(!w){return}var x=this;w.events.un("records-added",x._onTimelineRecordsAdded);delete x._timelinesColors[v];delete x._timelineLabels[v];delete x._timelineLabelsColors[v];
h.setTimeout(function(){if(x._state===g.STATE_DESTROYED){return}x._updateTimelineWrapperMetrics(y);h.setTimeout(function(){if(x._state===g.STATE_DESTROYED){return}if(x._collectRecordsInRange()){x._redraw()
}},10)},0)};d._collectRecordsInRange=function(w){var C=this,x=C._options,A=C._range,v=C._level,J=A.startTime-v.rangeSize/v.ticksCount,E=A.endTime+v.rangeSize/v.ticksCount,z=false,I=C._timelines.getKeys(),D=C._timelines.length,y=C._rangeRecords,F,B,G,H;
for(B=0;B<D;++B){G=I[B];H=C._timelines.get(G);if(w||!y[G]){if(x.groupingEnabled){F=H.getClosestGrouping(v.groupingThreshold);y[G]=H.selectFromGrouping(J,E,F)}else{y[G]=H.select(J,E)}z=true}}return z};d._findSnapCandidates=function(F,w){var B=this,x=B._options,D=B._rangeItems,z=B._range,A=[],G,v,y,C,E;
if(F.range){return A}G=F.time;if(typeof G==="number"){G=B._wrapTimeToNow(G)}else{return A}for(v in D){if(D.hasOwnProperty(v)){y=D[v];if(y&&y!==F&&y!==B._tooltipItem&&(!B._draggingItem||F!==B._pointerItem)&&y.visible){if(y.range&&(!w||y.draggable)){if(y._range.startTime<=G&&G<=y._range.endTime){y._snapCandidateDistance=0;
A[A.length]=y}}else{E=y.snapDistance;if(E===null){E=(y.draggable?x.itemsDraggableSnapDistance:x.itemsSnapDistance)}if(E>0){C=(Math.abs(B._timeToOffset(G,z)-B._timeToOffset(y._range.startTime,z)));if(C<=E){y._snapCandidateDistance=C;
A[A.length]=y}}}}}}A.sort(g._itemsSnapCandidatesComparer);return A};d._addItem=function(z,B,D){var x=this,v=/^\s+|\s+$/g,C=/\s+/g,y=e(h.document.createElement("DIV")),A,w=y[0].style;z=(z||"").replace(C," ").replace(v,"");
p.utils.addClassesFast(y[0],"ivideon-timeline-item"+(z?" "+z:""));++x._allItemsId;x._allItems[x._allItemsId]=A={_el:y,_range:{startTime:null,endTime:null},_snappedTo:null,_snappedEndTo:null,_tooltipClassName:(z?"under-"+z.split(C).join(" under-"):""),_isVerticalCenter:p.utils.hasClassFast(y[0],"m-vertical-center"),_isTooltip:p.utils.hasClassFast(y[0],"ivideon-timeline-tooltip"),_hookCalled:{},_stayInViewApplied:false,id:x._allItemsId,time:(B||0),range:null,state:"",visible:null,draggable:false,tooltip:false,snap:false,snapDistance:null,stayInView:false,align:0,rangeLimit:null,html:null,text:null,onUpdate:null,onClick:null,onDragStart:null,onDragMove:null,onDragStop:null};
w.visibility="hidden";if(A._isTooltip){y.appendTo(x.$tooltipWrapper)}else{y.appendTo(x.$itemsWrapper)}x._updateItemVerticalOffset(A);x._updateItem(A,f,D);x._updateTooltipUnderItem();return A};d._getItemSnapTime=function(v){return v._range.startTime
};d._wrapTimeToNow=function(w){var v=p.now();return(w<=0?w+v:w)};d._updateItem=function(U,E,y){var O=this,J=O._allItems,H=O._range,D=(H.endTime-H.startTime),W,A,w=p.now(),M=false,F=false,v,V,L,S,P,R,x,N,z,I,B,G,Q,T,K,C;
if(!U){return}v=U._el;V=U._range.startTime;L=U._range.endTime;P=U.html;R=U.text;x=U.visible;N=U.state;z=U.align;I=U.draggable;B=U.tooltip;S=U.stayInView;if(y){for(K in y){if(y.hasOwnProperty(K)){U[K]=y[K]
}}if(U.snap&&typeof U.snap==="object"){if(U.snap.startItem){U.align=1}else{if(U.snap.endItem){U.align=2}}}if(typeof U.align==="string"){U.align=o[U.align]||0}}if(typeof E==="number"||E===null){U.time=E
}if(U.range){U._range.startTime=U.range.startTime;U._range.endTime=U.range.endTime;U._range.startTime=O._wrapTimeToNow(U._range.startTime);U._range.endTime=O._wrapTimeToNow(U._range.endTime)}else{if(typeof U.time==="number"){if(U.time<=0){O._nowItems[U.id]=U
}else{delete O._nowItems[U.id]}U._range.startTime=U._range.endTime=U.time;U._range.startTime=O._wrapTimeToNow(U._range.startTime);U._range.endTime=O._wrapTimeToNow(U._range.endTime)}}if(U.rangeLimit){if(typeof U.rangeLimit.startTime==="number"){W=U.rangeLimit.startTime;
W=O._wrapTimeToNow(W)}if(typeof U.rangeLimit.startItem==="number"){C=J[U.rangeLimit.startItem];if(C){W=(typeof W==="number"?Math.max(W,C._range.endTime):C._range.endTime)}}if(typeof U.rangeLimit.endTime==="number"){A=U.rangeLimit.endTime;
A=O._wrapTimeToNow(A)}if(typeof U.rangeLimit.endItem==="number"){C=J[U.rangeLimit.endItem];if(C){A=(typeof W==="number"?Math.min(A,C._range.startTime):C._range.startTime)}}T=(U._range.endTime-U._range.startTime);
if(typeof W==="number"){if(U._range.startTime<W){U._range.startTime=W;U._range.endTime=W+T}}if(typeof A==="number"){if(U._range.endTime>A){U._range.startTime=A-T;U._range.endTime=A}}}U._snappedTo=null;
U._snappedEndTo=null;if(U.snap){if(typeof U.snap==="object"){C=J[U.snap.startItem];if(C&&C!==U&&C!==O._tooltipItem){U._snappedTo=C;if(U.range){U._range.startTime=C._range.startTime}else{U._range.startTime=U._range.endTime=C._range.startTime
}}C=J[U.snap.endItem];if(C&&C!==U&&C!==O._tooltipItem){U._snappedEndTo=C;U._range.endTime=C._range.endTime}}else{G=O._findSnapCandidates(U,true);if(G.length){C=G[0];Q=O._getItemSnapTime(C);U._snappedTo=C;
U._range.startTime=Q}}}if(U.tooltip!==B){if(B){delete O._tooltippedItems[U.id]}else{O._tooltippedItems[U.id]=U}}if(U._range.startTime!==V||U._range.endTime!==L||U.stayInView!==S){if(!U.stayInView&&(U._range.startTime>(O._range.endTime+D/4)||U._range.endTime<(O._range.startTime-D/4))){if(O._rangeItems[U.id]){delete O._rangeItems[U.id];
v[0].style.display="none"}}else{if(!O._rangeItems[U.id]){O._rangeItems[U.id]=U;v[0].style.display=""}}}if(U.text||U.text===""){if(U.text!==R){v[0].innerText=(U.text);M=true}}else{if(U.html||U.html===""){if(U.html!==P){v[0].innerHTML=(U.html);
M=true}}}if(U.state!==N){if(N){p.utils.removeClassesFast(v[0],N);M=true}if(U.state){p.utils.addClassesFast(v[0],U.state);M=true}}if(U.draggable!==I){if(U.draggable){p.utils.addClassFast(v[0],"m-draggable");
M=true}else{p.utils.removeClassFast(v[0],"m-draggable");M=true}}if(Math.floor(U._range.endTime)>Math.floor(w+2000)){if(!p.utils.hasClassFast(v[0],"m-future")){p.utils.addClassFast(v[0],"m-future");M=true
}}else{if(Math.floor(U._range.startTime)<=Math.floor(w+2000)){if(p.utils.hasClassFast(v[0],"m-future")){p.utils.removeClassFast(v[0],"m-future");M=true}}}if(U.visible!==x){M=true;F=true}if(U.visible&&O._rangeItems[U.id]){if((M&&U.align!==1)||U._stayInViewApplied){U.outerWidth=parseFloat(e.css(v[0],"width","border"))
}if(M&&!U._isTooltip&&U._isVerticalCenter){U.outerHeight=parseFloat(e.css(v[0],"height","border"));v[0].style.top=(O._timelineWrapperBorderTopWidth+O._timelineTicksOuterHeight+O._timelineRecordsOuterHeight/2-U.outerHeight/2)+"px"
}O._updateItemSizeOffset(U,1)}if(F){O._updateItemVisibility(U)}for(K in J){if(J.hasOwnProperty(K)){C=J[K];if(C!==U&&(C._snappedTo===U||C._snappedEndTo===U)){O._updateItem(C)}}}if(U.tooltip!==B||((U===O._pointerItem||O._tooltippedItems[U.id])&&U.visible!==x)){O._updateTooltipUnderItem()
}if(U===O._tooltipUnderItem){O._updateTooltipItem()}else{if(!O._dragging&&U===O._pointerItem){if(U.visible){if(U._snappedTo&&U._snappedTo.draggable){O._replaceCursor(U._snappedTo)}else{if(U._snappedEndTo&&U._snappedEndTo.draggable){O._replaceCursor(U._snappedEndTo)
}else{O._replaceCursor(null)}}}else{O._replaceCursor(null)}}}O._callItemHook(U,"onUpdate")};d._callItemHook=function(y,z){if(!y){return}var A=this,v=y[z],w;try{if(v&&v.call){if(!y._hookCalled[z]){y._hookCalled[z]=true;
w=v.call(A,y);y._hookCalled[z]=false}}}catch(x){y._hookCalled[z]=false;p.reportError(x,(v?{context:(v.toString?v.toString():""+v)}:f))}return w};d._updateItemVisibility=function(v){v._el[0].style.visibility=(v.visible?"inherit":"hidden")
};d._updateItemSizeOffset=function(K,F){var C=this,A=C._range,I=C._timelineWrapperWidth,G=C._timeToOffset(K._range.startTime,A),H=K._el,B=H[0].style,z=K.outerWidth,y=false,D=K._stayInViewApplied,v,J,E=0;
switch(K.range?1:K.align){case 1:v=G;break;case 2:v=G-z;break;default:v=(G-z/2);break}if(K.range){J=C._timeToOffset(K._range.endTime,A);if(v>J){G=v;v=J;J=G}B.width=Math.max(1,~~((J-v)-E))+"px"}else{if(K.stayInView){if((v+z)>I){y=(G>I?"away-right":"right");
v=I-z}else{if(v<0){y=(G<0?"away-left":"left");v=0}}}}B.left=~~v+"px";if(y!==D){if(D){p.utils.removeClassFast(H[0],"m-"+D)}K._stayInViewApplied=y;if(y){p.utils.addClassFast(H[0],"m-"+y)}K.outerWidth=parseFloat(e.css(H[0],"width","border"));
if(F>0){C._updateItemSizeOffset(K,F-1)}}};d._updateItemVerticalOffset=function(z){var A=this,w=z._el,x=w[0].style,v=A._timelineRecordsOuterHeight,y=0;if(p.utils.hasClassFast(w[0],"m-cursor")){z.outerHeight=v;
x.height=(z.outerHeight-y)+"px"}if(p.utils.hasClassFast(w[0],"m-top")){z.outerHeight=(v+A._timelineTicksOuterHeight);x.height=(z.outerHeight-y)+"px";x.top=(A._timelineWrapperBorderTopWidth)+"px"}else{x.top=(A._timelineWrapperBorderTopWidth+A._timelineTicksOuterHeight)+"px"
}};d._updateTooltipItem=function(){var B=this,y=B._tooltipUnderItem,w=(y&&y.visible),x=(w?B._getItemSnapTime(y):null),A,z="";if(!B._tooltipItem){return}if(w&&y._snappedTo){z=y._snappedTo._tooltipClassName+" "+y._snappedTo.state
}else{if(w){z=y._tooltipClassName+" "+y.state}}B._updateItem(B._tooltipItem,(w?x:f),{visible:w,html:(w?B._getTooltipHtml(x):f),state:z});if(w){A=B._tooltipItem._el.offset();B._tooltipMetrics.left=A.left;
B._tooltipMetrics.right=A.left+B._tooltipItem.outerWidth}};d._updatePointerItem=function(){var v=this;if(v._pointer1){v._updateItem(v._pointerItem,(v._dragging?(v._draggingItem?v._getItemSnapTime(v._draggingItem):v._draggingPointerTime):v._coordToTime(v._pointer1.currX)),{rangeLimit:(v._dragging?null:v._range),visible:true&&!v._isPointerNearAwayTooltip()&&(!v._pointer2||!v._pointer2.pressed)&&(v._pointer1.type===c)&&((v._pointer1.type===c&&v._pointerOverTimeline)||v._pointer1.pressed)})
}};d._updatePointerOverFlags=function(A){var E=this,C,v,D,z,B=E._pointerOverTimeline,w=E._pointerOverRecords;if(E._pointer1){v=E._pointer1.currX;D=E._pointer1.currY;C=E._timelineWrapperOffset;E._pointerOverTimeline=(v>=C.left&&v<=C.left+E._timelineWrapperWidth&&D>=C.top&&D<=C.top+E._timelineWrapperHeight);
if(E._pointerOverTimeline){z=E._coordToTimelineIndex(D);E._pointerOverRecords=(z>=0&&z<E._timelines.length)}else{E._pointerOverRecords=false}}else{E._pointerOverTimeline=E._pointerOverRecords=false}if(!A&&(E._pointerOverTimeline!==B||E._pointerOverRecords!==w)){E._updatePointerItem()
}};d._updateTooltipUnderItem=function(){var z=this,w=z._tooltippedItems,x,v,y;for(y in w){if(w.hasOwnProperty(y)){x=w[y];if(x.tooltip&&x.visible){v=x;break}}}if(z._pointer1&&z._pointerItem.visible){if(!z._isPointerNearAwayTooltip()){v=z._pointerItem
}}if(v!==z._tooltipUnderItem){z._tooltipUnderItem=v;z._updateTooltipItem()}};d._updateItems=function(){var y=this,v=y._rangeItems,w,x;for(x in v){if(v.hasOwnProperty(x)){w=v[x];y._updateItem(w)}}y._updateTooltipUnderItem()
};d._updateNowItems=function(){var y=this,v=y._nowItems,w,x;for(x in v){if(v.hasOwnProperty(x)){w=v[x];y._updateItem(w)}}y._updateTooltipUnderItem()};d._collectItemsInRange=function(){var A=this,w=A._range,y=(w.endTime-w.startTime),v=A._allItems,x,z;
for(z in v){if(v.hasOwnProperty(z)){x=v[z];if(!x.stayInView&&(x._range.startTime>(w.endTime+y/4)||x._range.endTime<(w.startTime-y/4))){if(A._rangeItems[x.id]){delete A._rangeItems[x.id];x._el[0].style.display="none"
}}else{if(!A._rangeItems[x.id]){A._rangeItems[x.id]=x;x._el[0].style.display=""}}}}};d._onRangeChanged=function(w,z){var y=this,v=y._range,x=y._rangePrev;y._level=y._getLevelByRange(v);y._rangePrev=g._cloneRange(v);
if(!w){y.events.fire("range-changed",{prev:g._cloneRange(x),curr:g._cloneRange(v)});y._rangeChangeFired=p.now()}y._collectRecordsInRange(true);y._collectItemsInRange();if(!z){y._redraw()}};d._redraw=function(x,z){var C=this,B,y,v,A;
if(C._state===g.STATE_DESTROYED){return}B=C._options;y=p.now();h.clearTimeout(C._redrawTimer);if(x||!C._lastRedrawTime||(y-C._lastRedrawTime)>B.redrawTimeout){C._clear();C._updateFutureOverlay(true);if(!z){C._drawRecords()
}C._drawTicks();if(h._DEBUG&&C._drawRangesToLoad){C._drawRangesToLoad()}C._updateItems();if(C._canvasBuffer!==C._canvas){v=C._canvasBuffer.width;A=C._canvasBuffer.height;if(v>0&&A>0){C._canvas.width=v;
C._canvas.height=A;C._canvasContext.drawImage(C._canvasBuffer,0,0)}}C._lastRedrawTime=y;h.setTimeout(function(){C.events.fire("range-displayed",{prev:g._cloneRange(C._rangePrev),curr:g._cloneRange(C._range)})
},0)}else{C._redrawTimer=h.setTimeout(function(){C._redraw(x,z)},B.redrawTimeout-(y-C._lastRedrawTime)+1)}};d._initCanvas=function(){var A=this,v,y;if(A._canvasBufferContext){return}v=A._timelineWrapperWidth;
y=A._timelineWrapperHeight;if(e.browser.msie&&e.browser.version<9){A._canvas.width=~~v;A._canvas.height=~~y;if(typeof h.FlashCanvas!=="undefined"){A._canvas=h.FlashCanvas.initElement(A._canvas);A._canvasShimUsed=true
}else{if(typeof h.G_vmlCanvasManager!=="undefined"){A._canvas=h.G_vmlCanvasManager.initElement(A._canvas);A._canvasShimUsed=true}}if(A._canvas.lastChild&&A._canvas.lastChild.tagName==="DIV"){A._canvas.removeChild(A._canvas.lastChild)
}}if(!A._canvas){throw new p.utils.IncompatibleBrowserError(q+"#_initCanvas: "+(A._canvasShimUsed?"Shim.":"No shim.")+" No canvas. FlashCanvas "+(typeof h.FlashCanvas)+", VML "+(typeof h.G_vmlCanvasManager))
}if(!A._canvas.getContext){throw new p.utils.IncompatibleBrowserError(q+"#_initCanvas: "+(A._canvasShimUsed?"Shim.":"No shim.")+" No getContext. FlashCanvas "+(typeof h.FlashCanvas)+", VML "+(typeof h.G_vmlCanvasManager))
}try{A._canvasContext=A._canvas.getContext("2d")}catch(z){throw new p.utils.IncompatibleBrowserError(q+"#_initCanvas: "+(A._canvasShimUsed?"Shim.":"No shim.")+" Exception calling getContext: "+z+". FlashCanvas "+(typeof h.FlashCanvas)+", VML "+(typeof h.G_vmlCanvasManager))
}try{if(!A._canvasShimUsed&&A._options.doubleBuffering){A._canvasBuffer=h.document.createElement("CANVAS");A._canvasBufferContext=A._canvasBuffer.getContext("2d");if(e.browser.mozilla){A._canvasBufferContext.mozImageSmoothingEnabled=false
}}else{A._canvasBuffer=A._canvas;A._canvasBufferContext=A._canvasContext;if(A._canvasShimUsed&&typeof h.FlashCanvas!=="undefined"){A._canvas.style.width=~~v+"px";A._canvas.style.height=~~y+"px";A._canvasBufferContext._resize(~~v,~~y)
}}}catch(x){throw new p.utils.IncompatibleBrowserError(q+"#_initCanvas: "+(A._canvasShimUsed?"Shim.":"No shim.")+" Exception initializing canvas: "+x+". FlashCanvas "+(typeof h.FlashCanvas)+", VML "+(typeof h.G_vmlCanvasManager))
}};d._clear=function(){var C=this,y,B,x,A,v,z;if(!C._canvasBufferContext){C._initCanvas()}y=C._canvasBuffer.width;B=C._canvasBuffer.height;x=C._timelineWrapperWidth;A=C._timelineWrapperHeight;v=(x!==y||x!==parseInt(C._canvas.style.width,10));
z=(A!==B||A!==parseInt(C._canvas.style.height,10));if(!v&&!z){C._canvasBufferContext.clearRect(0,0,y,B)}if(h.devicePixelRatio&&(v||z)){C._canvasBuffer.width=~~x*h.devicePixelRatio;C._canvasBuffer.height=~~A*h.devicePixelRatio;
C._canvas.style.width=~~x+"px";C._canvas.style.height=~~A+"px";C._canvasBufferContext.scale(h.devicePixelRatio,h.devicePixelRatio)}else{if(v){C._canvasBuffer.width=~~x}if(z){C._canvasBuffer.height=~~A}}if(C._canvasShimUsed&&typeof h.FlashCanvas!=="undefined"){C._canvas.style.width=~~x+"px";
C._canvas.style.height=~~A+"px";C._canvasBufferContext._resize(~~x,~~A)}};d._getRailHeight=function(){return(this._timelines.length>1?this._timelineRecordsStyle.minHeight:this._timelineRecordsStyle.height)
};d._getRailOffsetTop=function(w,v){return(v*(w+this._railSpacing))};d._drawRecords=function(){var U=this,P=U._options,L=U._range,J=U._canvasBuffer.width,R=U._timelineTicksOuterHeight,H=U._timelinesColors,aa=U._timelineLabels,Q=U._timelineRecordsStyle.color,ac=U._timelineRecordsByTypeColors,M=U._timelineRecordsOuterHeight,T=U._rangeRecords,Z=U._timelines.length,K=U._timelines.getKeys(),Y=U._getRailHeight(),B=U._railSpacing,X=B+Y/2,N=U._timelineLabelsStyle.color,S=U._canvasBufferContext,E=(P.timelineLabelsEnabled&&Z>1),v=U._canvasShimUsed,W,G=false,ad,C,V,O,D,z,I,ab,A,F,x,y;
S.save();S.fillStyle=U._timelineRecordsStyle.backgroundColor;S.fillRect(0.5,0.5+R,J-1,M);if(E){S.font=U._timelineLabelsFont}for(C=0;C<Z;++C){ad=K[C];if(P.timelineColorsEnabled&&Z>1){S.fillStyle=H[ad]}else{if(!ac){S.fillStyle=Q
}}A=R+U._getRailOffsetTop(Y,C);W=T[ad];if(W){O=W.length;for(V=0;V<O;++V){D=W[V];z=U._timeToOffset(D.startTime,L);if(z>J){continue}I=U._timeToOffset(D.endTime,L);if(I<0){continue}if(ac){S.fillStyle=ac[D.type]||Q
}ab=(I-z);S.fillRect(z,A,(ab<1?1:ab),Y);G=true}}if(E){F=aa[ad];S.textAlign="center";S.textBaseline="middle";x=(!S.measureText||v?14*F.length:S.measureText(F));y=(x?Math.max(x.width||0,x.height||Y):Y)/2;
S.fillStyle=N;S.fillText(F,X,(A+Y/2)+y-Y/2)}}S.restore();U._someRecordsVisible=G};d._drawTicks=function(){var C=this,ag=p.now(),G=C._range,Z=C._level.ticksCount,X=(C._level.rangeSize/Z),af=G.startTime,al=G.endTime,ac=C._canvasBuffer.width,am=C._timelineTicksStyle,aa=C._timelineDatesStyle,S=C._canvasBufferContext,ai=C._timelineTicksOuterHeight+C._timelineRecordsOuterHeight+C._timelineDatesStyle.marginTop,Q=(aa.paddingLeft+aa.paddingRight),E=am.paddingTop,D=C._timelineTicksHeight,an=C._timelineDatesHeight,z=null,V,B,W,K=0,O=0,aj,Y=(C._timelineTicksFont===C._timelineDatesFont),ad=C._canvasShimUsed,R=this._momentWithTimezone(af).subtract(1,"day").startOf("day"),J=R.valueOf(),I=this._momentWithTimezone(R.valueOf()).add(1,"day"),M=I.valueOf(),P,H,N=(ad?am.paddingTop-1:(e.browser.chrome?-1:(e.browser.mozilla?2.5:0))),y=C._options.flipLastTick,v,L,F,ae,U,ab,ah,T,A,ak;
S.save();S.textBaseline="top";if(y){S.textAlign="left"}if(Y){S.font=C._timelineTicksFont}ab=C._timeToOffset(J,G);aj=C._timeToOffset(J+X,G)-ab;for(ae=J,v=C._momentWithTimezone(ae),L=v.zone(),F=L,P=true,H=(L!==a);
ae<=(al+X);F=L,ae+=X,v=C._momentWithTimezone(ae),L=v.zone(),ab+=aj,P=false,H=(L!==F)){if(ae>ag&&z===null){C._closestFutureTickTime=z=ae;am=C._timelineTicksFutureStyle;aa=C._timelineDatesFutureStyle}if(ae>=M){J=M;
I=I.add(1,"day");M=I.valueOf();ab=C._timeToOffset(J,G);aj=C._timeToOffset(J+X,G)-ab;ae=J;v=C._momentWithTimezone(ae);L=v.zone();P=true;H=(L!==a)}T=ab+aj;if(!P&&T<0){continue}ah=ab;if(ah>=ac-1){ah-=1}U=C._getTickTimeText(v,H);
V=(S.measureText&&ad?S.measureText(U):null);B=(V&&V.width?V.width:14*U.length);K=(am.paddingLeft+B+am.paddingRight);O=(T-ah);if(P){while(K>O){X*=2;aj*=2;T+=aj;O+=aj}}ah=~~ah;T=~~T;S.fillStyle=am.borderLeftColor;
S.fillRect(ah,0,am.borderLeftWidth,D);if(!Y){S.font=C._timelineTicksFont}ak=y&&((ah+am.paddingLeft+K)>ac&&(ah-am.paddingRight-K)>(ah+am.paddingLeft-(T-ah)+K));ak=ak||((M-ae)<=p.HOUR_IN_MS);if(!ad){S.save();
S.beginPath();S.rect((ak?ah-(T-ah):ah),0,O,D);S.closePath();S.clip()}S.fillStyle=am.color;if(ak){S.textAlign="right";S.fillText(U,(ah-am.paddingRight),(E+N))}else{if(y){S.textAlign="left"}S.fillText(U,(ah+am.paddingLeft),(E+N))
}if(!ad){S.restore()}if(P){U=C._getTickDateText(v,false);if(!Y){S.font=C._timelineDatesFont}V=(S.measureText&&ad?S.measureText(U):null);W=(V&&V.width?V.width:14*U.length);A=C._timeToOffset(M,G);if(ah<=-aa.marginLeft){ah=Math.min(Math.max(ah,0),A-(W+Q+aa.marginRight))
}else{ah+=aa.marginLeft}ah=~~ah;S.fillStyle=aa.backgroundColor;S.fillRect(ah,ai,W+Q,ai+an);if(aa.borderTopColor!==aa.backgroundColor){S.fillStyle=aa.borderTopColor}S.fillRect(ah-aa.marginLeft,ai,-(ah-aa.marginLeft)+A-aa.marginRight,aa.borderTopWidth);
S.fillStyle=aa.color;S.fillText(U,(ah+aa.paddingLeft),(ai+aa.paddingTop+N))}}S.restore()};d._drawRangesToLoad=function(){var K=this,G=K._options,E=K._range,C=K._canvasBuffer.width,A=K._timelinesColors,I="rgba(220,220,220,0.7)",O=K._timelines.length,D=K._timelines.getKeys(),J=K._canvasBufferContext,z=K._timelineTicksOuterHeight+K._timelineRecordsOuterHeight+K._timelineDatesStyle.marginTop,L=K._timelineDatesStyle,N=L.borderTopWidth,v,P,y,M,H,F,x,B;
J.save();for(y=0;y<O;++y){P=D[y];if(G.timelineColorsEnabled&&O>1){J.fillStyle=A[P]}else{J.fillStyle=I}v=K._timelines.getByIndex(y).getRangesToLoad(E.startTime,E.endTime);if(v){for(M=0,H=v.length;M<H;++M){F=v[M];
x=K._timeToOffset(F.startTime,E);if(x>C){continue}B=K._timeToOffset(F.endTime,E);if(B<0){continue}J.fillRect(x,z,(B-x),N)}}}J.restore()};d._updateFutureOverlay=function(D){var C=this,z=C._range,A=p.now(),v=C._timeToOffset(A,z),B=C.$futureOverlay[0].style,y;
B.left=v+"px";if(e.browser.msie&&e.browser.version<9){y=~~(C._timelineWrapperWidth-v+1);B.width=(y<0?0:y)+"px"}if(!D&&A>=C._closestFutureTickTime){C._redraw()}};d._initCursors=function(){var v=this;if(h.Modernizr.touch){return
}v._cursorInitialOfHtmlTag=e("html").css("cursor");v._cursorInitialOfBodyTag=e("body").css("cursor");v._cursorsClassNamesOfWrapper=["cursor-idle","cursor-dragging"];v._cursorReplaced=false;v._replaceCursor(null)
};d._clearCursor=function(){var v=this;if(h.Modernizr.touch||!v._cursorReplaced){return}if(v._cursorsClassNamesOfWrapper){p.utils.removeClassesFast(v.$wrapper[0],v._cursorsClassNamesOfWrapper)}if(v._cursorReplaced){e("html").css("cursor",v._cursorInitialOfHtmlTag);
e("body").css("cursor",v._cursorInitialOfBodyTag);v._cursorReplaced=false}};d._replaceCursor=function(v){var x=this,w;if(h.Modernizr.touch||x._cursorReplaced===v){return}x._clearCursor();if(v){if(typeof v==="object"){w=v._el.css("cursor")
}else{p.utils.addClassesFast(x.$wrapper[0],v);w=x.$itemsWrapper.css("cursor")}e("html, body").css("cursor",w);x._cursorReplaced=v}else{p.utils.addClassFast(x.$wrapper[0],"cursor-idle")}};d._renderDragging=function(){var v=this;
v._limitRange(v._draggingRange,v._range,f,v._draggingSoftenLimits);v._jumpTo(v._draggingRange.startTime,v._draggingRange.endTime,f,v._draggingSoftenLimits)};d._onDragging=function(){var v=this;if(!v._dragging){return
}v._draggingSoftenLimits=0;if(!s){v._draggingSoftenLimits=v._options.draggingSoftenLimits}v._draggingDelta=(v._pointer1.currX-v._pointer1.pressedX);if(v._draggingItem){if(v._draggingItem.range){v._updateItem(v._draggingItem,null,{range:{startTime:(v._draggingItemRangeBase.startTime-v._coordDeltaToTimeDelta(v._draggingDelta)),endTime:(v._draggingItemRangeBase.endTime-v._coordDeltaToTimeDelta(v._draggingDelta))}})
}else{v._updateItem(v._draggingItem,(v._draggingPointerTime-v._coordDeltaToTimeDelta(v._draggingDelta)))}v._callItemHook(v._draggingItem,"onDragMove")}else{v._draggingRange.startTime=v._draggingRangeBase.startTime+v._coordDeltaToTimeDelta(v._draggingDelta);
v._draggingRange.endTime=v._draggingRangeBase.endTime+v._coordDeltaToTimeDelta(v._draggingDelta);v._draggingMoved=true;v._renderDragging()}};d._onDraggingZoom=function(){var v=this;if(!v._dragging||!v._draggingZoom){return
}v._draggingSoftenLimits=0;v._draggingDelta=(v._pointer1.currX-v._pointer1.pressedX);v._draggingDelta2=(v._pointer2.currX-v._pointer2.pressedX);v._draggingRange.startTime=v._draggingRangeBase.startTime+v._coordDeltaToTimeDelta(v._draggingDelta);
v._draggingRange.endTime=v._draggingRangeBase.endTime+v._coordDeltaToTimeDelta(v._draggingDelta2);v._renderDragging()};d._onDraggingStarted=function(){var v=this;v._draggingPointerTime=v._coordToTime(v._pointer1.pressedX);
v._draggingRangeBase.startTime=v._range.startTime;v._draggingRangeBase.endTime=v._range.endTime;v._draggingRange.startTime=v._range.startTime;v._draggingRange.endTime=v._range.endTime;v._dragging=true;
if(v._pointerItem._snappedTo&&v._pointerItem._snappedTo.draggable){v._draggingItem=v._pointerItem._snappedTo;v._draggingItemRangeBase.startTime=v._draggingItem._range.startTime;v._draggingItemRangeBase.endTime=v._draggingItem._range.endTime;
v._draggingItem._el.addClass("m-dragging");v._replaceCursor(v._draggingItem);v._callItemHook(v._draggingItem,"onDragStart")}else{v._replaceCursor("cursor-dragging")}v.$scrollLeft.button("disable");v.$scrollRight.button("disable");
v._updatePointerItem();if(v._draggingItem){v.events.fire("item-drag-started",{item:v._draggingItem.id})}else{v.events.fire("drag-started")}v._onDragging()};d._onDraggingZoomStarted=function(){var v=this;
if(!v._options.draggingZoomEnabled){return}if(v._draggingItem){return}v._draggingRangeBase.startTime=v._draggingRange.startTime;v._draggingRangeBase.endTime=v._draggingRange.endTime;v._draggingZoom=true;
v._onDraggingZoom()};d._onDraggingFinished=function(){var w=this,v;if(!w._dragging){return}v=w._draggingItem;if(v){v._el.removeClass("m-dragging")}w._draggingItem=false;w._draggingZoom=false;w._dragging=false;
w._replaceCursor(null);w.$scrollLeft.button("enable");w.$scrollRight.button("enable");w._updatePointerItem();if(v){if(v._range.startTime<w._range.startTime||v._range.endTime>w._range.endTime){w.centerAt((v._range.startTime+v._range.endTime)/2)
}w._callItemHook(v,"onDragStop");w.events.fire("item-drag-finished",{item:v.id})}else{if(s||h.Modernizr.touch){w._jumpTo(w._draggingRange.startTime,w._draggingRange.endTime)}else{w._slingTo(w._draggingRange.startTime,w._draggingRange.endTime)
}w.events.fire("drag-finished")}};d._onTimelineWrapperWidthChanged=function(){var v=this;v._updatePointerOverFlags();return true};d._onTimelineWrapperHeightChanged=function(z){var y=this,v=y._timelineRecordsOuterHeight,x=y._timelineWrapperBorderTopWidth+y._timelineTicksOuterHeight,w;
y.$itemsWrapper.children(".m-cursor").css("height",v);y.$statusWrapper.css("paddingTop",x).css("lineHeight",v+"px");y.$futureOverlayWrapper.css("height",v).css("top",x);y.$futureOverlay.css("height",v);
w=y._timelineWrapperHeight;y.$itemsWrapper.css({height:w,marginBottom:-w});y.$statusWrapper.css({height:(w-x),marginBottom:-(w-x)});y.$tooltipWrapper.css({height:w,marginBottom:-w});y.$wrapper.css("height",w);
if(y._options.scrollButtonsFullHeight){y.$scrollLeft.add(y.$scrollRight).css("height",y._timelineWrapperHeight-2)}else{y.$scrollLeft.add(y.$scrollRight).css({top:x,height:v-2})}y._updatePointerOverFlags(!z);
if(!z){y._redraw(true,true)}return true};d._onTimelineWrapperOffsetChanged=function(){var v=this;v._updatePointerOverFlags();return false};d._createPointersTracker=function(){var w=this,v=w.$canvas.add(w.$itemsWrapper).add(w.$tooltipWrapper).add(w.$statusWrapper);
w._pointersTracker=new u(v,e(h.document).add(v).add(w.$scrollLeft).add(w.$scrollRight),e(h.document).add(v).add(w.$scrollLeft).add(w.$scrollRight),w._options.pointersTrackerOptions);w._pointersTracker.events.on("pressed",w._onPointerPressed,w);
w._pointersTracker.events.on("moved",w._onPointerMoved,w);w._pointersTracker.events.on("released",w._onPointerReleased,w);w._pointersTracker.events.on("wheel",w._onPointerWheel,w)};d._onPointerPressed=function(w,v){var y=this,x=y._options;
y._rememberPointers(u.pressedPointersSelector);if(!y._pointer1){return}if(v.pointer!==y._pointer1&&v.pointer!==y._pointer2){return}y._pointerClickDisabled=y._dragging;if(y._pointer1.pressed&&y._pointer2&&y._pointer2.pressed){y._onDraggingZoomStarted()
}else{if(y._pointer1.pressed){y._freeze();y._onPointerMoved(w,v);if(y._draggingStartTimer){h.clearTimeout(y._draggingStartTimer);y._draggingStartTimer=null}if(y._pointer1.type===c&&!y._dragging){y._draggingStartTimer=h.setTimeout(function(){y._onDraggingStarted()
},x.draggingMouseTimeThreshold)}}}};d._onPointerMoved=function(w,v){var z=this,x=z._options,y=false;z._updateTimelineWrapperOffset(true);z._rememberPointers();if(!z._pointer1){return}if(v.pointer!==z._pointer1&&v.pointer!==z._pointer2){return
}if(z._draggingStartTimer){h.clearTimeout(z._draggingStartTimer);z._draggingStartTimer=null}if(z._pointer1&&z._pointer1.pressed&&z._pointer2&&z._pointer2.pressed){y=true}else{z._updatePointerOverFlags(true);
if(z._pointer1.type===l){y=z._pointer1.pressed&&(x.draggingFingerMoveThreshold<=0||Math.abs(z._pointer1.currX-z._pointer1.pressedX)>=x.draggingFingerMoveThreshold)&&(x.draggingFingerTimeThreshold<=0||(p.now()-z._pointer1.pressedTime)>=x.draggingFingerTimeThreshold)
}else{if(z._pointer1.type===c){y=z._pointer1.pressed&&(z._pointer1.pressedWhich===1)&&((x.draggingMouseMoveThreshold<=0||Math.abs(z._pointer1.currX-z._pointer1.pressedX)>=x.draggingMouseMoveThreshold)||(x.draggingMouseTimeThreshold<=0||(p.now()-z._pointer1.pressedTime)>=x.draggingMouseTimeThreshold))
}}}z._updatePointerItem();if(z._dragging||y){z._pointerClickDisabled=true}if(!z._dragging&&y){z._onDraggingStarted()}else{if(z._dragging){if(z._draggingZoom){z._onDraggingZoom()}else{z._onDragging()}}}};
d._onPointerReleased=function(v,F){var E=this,z=E._options,C,H,L,w,A,I,K,B,y=false,G,J,D;if(!E._pointer1){return}if(F.pointer!==E._pointer1&&F.pointer!==E._pointer2){return}E._onPointerMoved(v,F);if(E._pointer1&&E._pointer2){if(F.pointer===E._pointer1){E._pointer1=E._pointer2;
E._pointer2=null}E._draggingZoom=false;if(E._dragging){E._onDraggingStarted()}E._pointer2=null}else{if(E._draggingStartTimer){h.clearTimeout(E._draggingStartTimer);E._draggingStartTimer=null}E._draggingZoom=false;
if(E._dragging){E._onDraggingFinished()}else{if(E._pointer1.type===l){y=(E._pointer1.pressedWhich===1&&E._pointerOverTimeline)&&(z.draggingFingerMoveThreshold<=0||Math.abs(E._pointer1.currX-E._pointer1.pressedX)<z.draggingFingerMoveThreshold)
}else{if(E._pointer1.type===c){y=(E._pointer1.pressedWhich===1&&E._pointerOverTimeline)&&(z.draggingMouseMoveThreshold<=0||Math.abs(E._pointer1.currX-E._pointer1.pressedX)<z.draggingMouseMoveThreshold);
if((E._pointer1.releasedTime-E._pointer1.pressedTime)>1500){y=false}}}if(y&&!E._pointerClickDisabled){C=E._range;if(E._isPointerNearAwayTooltip()){G=(C.endTime-C.startTime);J=(E._getItemSnapTime(E._tooltipUnderItem)-G/2);
E.scrollTo(J,J+G);y=false}if(y){if(E._pointerItem._snappedTo){if(false===E._callItemHook(E._pointerItem._snappedTo,"onClick")){return}}else{D=E._findSnapCandidates(E._pointerItem,false);if(D.length){if(false===E._callItemHook(D[0],"onClick")){return
}}}H=E._getPointerTimelineOffset(E._pointer1);if(typeof H!=="number"){return}A=E._coordToTimelineIndex(E._pointer1.currY);L=E._offsetToTime(H,C);I=E._timelines.getKey(A);K=E._timelines.get(I);B=(K?K.select(L,f,true):null);
w={time:L,timeline:K,record:B};if(E.events.fire("click",w)!==false&&K){E.events.fire("select",w)}}}}E._pointer1=null}};d._onPointerWheel=function(A,y){var B=this,w,v,z;if(B._dragging){return}w=B._getPointerTimelineOffset(y.pointer);
if(typeof w!=="number"){return}v=(w/B._timelineWrapperWidth);B._onPointerMoved(A,y);z=(y.deltaY!==0?y.deltaY:(y.delta!==0?y.delta:0));z=(z>0?1:-1)*B._options.zoomWheelStep;B.events.fire("zoom-wheel");B.zoomBy(z,v,!s)
};d._onTimelineRecordsAdded=function(w,v){var x=this;if(v.records.length>0){x._collectRecordsInRange(true)}x._redraw()}}(window,window._ivideon));(function(f,g,a){"use strict";var d=g.$,b="ivideon.views.TimelineView",c=g.require(b),j=i,h=j.prototype,e=b+".Playback";
g.provide(e,j);function i(k){var l=this;l._options=g.optClass(j.defaults,k,e,l,{_timelineView:"timelineView",_playbackTime:"time"});l._playbackCursorItem=l._timelineView.addItem("ivideon-timeline-item-playback m-cursor",l._playbackTime,{visible:false,tooltip:true});
l._playbackKnobItem=l._timelineView.addItem("ivideon-timeline-item-playback-knob",l._playbackTime,{visible:false})}j.STATE_IDLE=1;j.STATE_LOADING=2;j.STATE_PLAYING=3;j.STATE_PAUSED=4;j.STATE_ERROR=5;j.defaults={time:0};
h.getTime=function(){var k=this;return k._playbackTime};h.setTime=function(l,k){var m=this;m._playbackTime=l;if(typeof k!=="undefined"){m._setState(k);if(k===m._state){m._updatePlaybackCursor()}}else{m._updatePlaybackCursor()
}};h.getState=function(){var k=this;return k._state};h.setState=function(k){var l=this;l._setState(k)};h._setState=function(k){var l=this;if(!k){throw new Error("state")}if(k!==l._state){l._state=k;l._updatePlaybackCursor()
}};h._getStateCssClassName=function(l){var k="";switch(l){case j.STATE_IDLE:k="m-idle";break;case j.STATE_LOADING:k="m-loading";break;case j.STATE_PLAYING:k="m-playing";break;case j.STATE_PAUSED:k="m-paused";
break;case j.STATE_ERROR:k="m-error";break}return k};h._updatePlaybackCursor=function(){var l=this,k=l._getStateCssClassName(l._state);l._timelineView.updateItem(l._playbackCursorItem,l._playbackTime,(l._state===j.STATE_IDLE?{visible:false}:{visible:true,state:k}));
l._timelineView.updateItem(l._playbackKnobItem,l._playbackTime,(l._state===j.STATE_IDLE?{visible:false}:{visible:true,state:k}))}}(window,window._ivideon));(function(g,h,b){"use strict";var e=h.$,c="ivideon.views.TimelineView",d=h.require(c),j=a,i=j.prototype,f=c+".SelectionRange";
h.provide(f,j);function a(l){var m=this,k=h.now();m.options=h.optClass(j.defaults,l,f,m,{_timelineView:"timelineView"});if(m.options.maxSize<m.options.minSize){throw new h.utils.ArgumentError(f+': Argument "options.maxSize" should be greater than "options.minSize".')
}if(typeof m.options.endTime!=="number"){m.options.endTime=k}if(typeof m.options.startTime!=="number"){m.options.startTime=m.options.endTime-(m.options.minSize+(m.options.maxSize-m.options.minSize)/2)}m._selectionRange={startTime:(m.options.startTime<=0?m.options.startTime+k:m.options.startTime),endTime:(m.options.endTime<=0?m.options.endTime+k:m.options.endTime)};
m._limitRange();m._createSelectionItems();m._updateSelection()}j.defaults={maxSize:15*h.MINUTE_IN_MS,minSize:2*h.MINUTE_IN_MS};i.getRange=function(){var k=this;return{startTime:k._selectionRange.startTime,endTime:k._selectionRange.endTime}
};i.setRange=function(l,k){var n=this,m=false;if(typeof l==="number"&&l!==n._selectionRange.startTime){n._selectionRange.startTime=l;m=true}if(typeof k==="number"&&k!==n._selectionRange.endTime){n._selectionRange.endTime=k;
m=true}if(m){m=m||n._limitRange()}if(m){n._updateSelection()}return n};i.setRangeLimits=function(k,n){var m=this,l=false;if(typeof k==="number"){m.options.minSize=k;l=true}if(typeof n==="number"){m.options.maxSize=n;
l=true}if(m.options.maxSize<m.options.minSize){throw new Error("options.maxSize")}if(l){l=m._limitRange()}if(l){m._updateSelection()}return m};i.centerAt=function(l,k){var n=this,m=(n._selectionRange.endTime-n._selectionRange.startTime);
if(typeof k!=="number"){k=0.5}else{if(k>1){k=1}else{if(k<0){k=0}}}n.setRange(l-(k)*m,l+(1-k)*m);return n};i.hide=function(){var k=this;k._timelineView.updateItem(k._selectionStartItem,null,{visible:false});
k._timelineView.updateItem(k._selectionEndItem,null,{visible:false});k._timelineView.updateItem(k._selectionSpanItem,null,{visible:false});return k};i.show=function(){var k=this;k._timelineView.updateItem(k._selectionStartItem,null,{visible:true});
k._timelineView.updateItem(k._selectionEndItem,null,{visible:true});k._timelineView.updateItem(k._selectionSpanItem,null,{visible:true});return k};i.disableDragging=function(){var k=this;k._timelineView.updateItem(k._selectionStartItem,null,{draggable:false});
k._timelineView.updateItem(k._selectionEndItem,null,{draggable:false});k._timelineView.updateItem(k._selectionSpanItem,null,{draggable:false});return k};i.enableDragging=function(){var k=this;k._timelineView.updateItem(k._selectionStartItem,null,{draggable:true});
k._timelineView.updateItem(k._selectionEndItem,null,{draggable:true});k._timelineView.updateItem(k._selectionSpanItem,null,{draggable:true});return k};i._limitRange=function(){var n=this,k=h.now(),m=(n._selectionRange.endTime-n._selectionRange.startTime),l=false;
if(m<n.options.minSize){m=n.options.minSize;n._selectionRange.endTime=n._selectionRange.startTime+m;l=true}else{if(m>n.options.maxSize){m=n.options.maxSize;n._selectionRange.endTime=n._selectionRange.startTime+m;
l=true}}if(n._selectionRange.endTime>k){n._selectionRange.endTime=k;n._selectionRange.startTime=n._selectionRange.endTime-m;l=true}return l};i._updateSelection=function(){var k=this;k._updateSelectionStartHandleLimit();
k._updateSelectionEndHandleLimit();k._timelineView.updateItem(k._selectionStartItem,k._selectionRange.startTime);k._timelineView.updateItem(k._selectionEndItem,k._selectionRange.endTime);k._selectionRange.startTime=k._timelineView.getItemTime(k._selectionStartItem);
k._selectionRange.endTime=k._timelineView.getItemTime(k._selectionEndItem);k._updateSelectionSpan()};i._updateSelectionStartHandleLimit=function(){var k=this;k._timelineView.updateItem(k._selectionStartItem,null,{rangeLimit:{endTime:0-k.options.minSize}})
};i._updateSelectionEndHandleLimit=function(){var k=this;k._timelineView.updateItem(k._selectionEndItem,null,{rangeLimit:{endTime:0}})};i._updateSelectionSpan=function(){var k=this;k._timelineView.updateItem(k._selectionSpanItem,null,{range:{startTime:k._selectionRange.startTime,endTime:k._selectionRange.endTime}})
};i._createSelectionItems=function(){var k=this;k._selectionStartItem=k._timelineView.addItem("ivideon-timeline-item-selection-start m-cursor m-top",k._selectionRange.startTime,{visible:true,draggable:true,onDragStart:function(){k._updateSelectionStartHandleLimit()
},onDragMove:function(){var n=k._timelineView.getItemTime(k._selectionStartItem),m=false,l=h.now();k._selectionRange.startTime=n;if((k._selectionRange.endTime-k._selectionRange.startTime)>k.options.maxSize){k._selectionRange.endTime=k._selectionRange.startTime+k.options.maxSize;
m=true}else{if((k._selectionRange.endTime-k._selectionRange.startTime)<k.options.minSize){k._selectionRange.endTime=k._selectionRange.startTime+k.options.minSize;m=true}}if(m){if(k._selectionRange.endTime>l){k._selectionRange.endTime=l;
k._selectionRange.startTime=k._selectionRange.endTime-k.options.minSize;k._timelineView.updateItem(k._selectionStartItem,k._selectionRange.startTime);k._timelineView.updateItem(k._selectionEndItem,k._selectionRange.endTime)
}else{k._timelineView.updateItem(k._selectionEndItem,k._selectionRange.endTime)}}k._updateSelectionSpan()},onDragStop:function(){k._updateSelectionStartHandleLimit()}});k._selectionEndItem=k._timelineView.addItem("ivideon-timeline-item-selection-end m-cursor m-top",k._selectionRange.endTime,{visible:true,draggable:true,onDragStart:function(){k._updateSelectionEndHandleLimit()
},onDragMove:function(){var l=k._timelineView.getItemTime(k._selectionEndItem),n=false,m=h.now();k._selectionRange.endTime=l;if((k._selectionRange.endTime-k._selectionRange.startTime)>k.options.maxSize){k._selectionRange.startTime=k._selectionRange.endTime-k.options.maxSize;
n=true}else{if((k._selectionRange.endTime-k._selectionRange.startTime)<k.options.minSize){k._selectionRange.startTime=k._selectionRange.endTime-k.options.minSize;n=true}}if(n){if(k._selectionRange.startTime>(m-k.options.minSize)){k._selectionRange.startTime=m-k.options.minSize;
k._selectionRange.endTime=k._selectionRange.endTime-k.options.minSize;k._timelineView.updateItem(k._selectionStartItem,k._selectionRange.startTime);k._timelineView.updateItem(k._selectionEndItem,k._selectionRange.endTime)
}else{k._timelineView.updateItem(k._selectionStartItem,k._selectionRange.startTime)}}k._updateSelectionSpan()},onDragStop:function(){k._updateSelectionEndHandleLimit()}});k._selectionSpanItem=k._timelineView.addItem("ivideon-timeline-item-selection-span m-cursor",null,{visible:true,draggable:true,range:k._selectionRange,rangeLimit:{endTime:0},onDragStart:function(){k._updateSelectionStartHandleLimit();
k._updateSelectionEndHandleLimit()},onDragMove:function(){k._selectionRange.startTime=k._timelineView.getItemTime(k._selectionSpanItem);k._selectionRange.endTime=k._timelineView.getItemTime(k._selectionSpanItem,true);
k._timelineView.updateItem(k._selectionStartItem,k._selectionRange.startTime);k._timelineView.updateItem(k._selectionEndItem,k._selectionRange.endTime)},onDragStop:function(){k._selectionRange.startTime=k._timelineView.getItemTime(k._selectionSpanItem);
k._selectionRange.endTime=k._timelineView.getItemTime(k._selectionSpanItem,true);k._timelineView.updateItem(k._selectionStartItem,k._selectionRange.startTime);k._timelineView.updateItem(k._selectionEndItem,k._selectionRange.endTime)
}})}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,j=f.require({prefix:""},"moment"),i=a,g=i.prototype,d="ivideon.views.TimelineCalendar",h=d;f.provide(d,i);function a(t){var p=this,m=0,o,l,q,n,r=function(){var k=c.datepicker._getInst(p.$calendar[0]),w,y,v,u,z,x;
if(!k){return 0}w=k.drawYear;y=k.drawMonth;v=parseInt(c.datepicker._get(k,"firstDay"),10);v=(isNaN(v)?0:v);u=c.datepicker._getDaysInMonth(w,y);z=(c.datepicker._getFirstDayOfMonth(w,y)-v+7)%7;x=Math.ceil((z+u)/7);
return(7*x)},s=function(){m=0};p._options=f.optClass(i.defaults,t,d,p,{$container:"container",_timelines:"timelines"});p._timezone=(p._options.timezone||f.getDetectedTimezone());p.events=new (f.require("ivideon.utils.Observable"))(p);
p.$wrapper=c('<div class="ivideon-timeline-calendar-wrapper" />').appendTo(p.$container);p.$wrapper.on("contextmenu",false).on("click touchstart",p._clickHandler=function(k){k.stopPropagation()}).on("clickoutside touchstartoutside",p._clickOutsideHandler=function(){if(p._showOptions&&p._showOptions.clickOutsideHide){p.hide()
}});p.$calendar=c('<div class="ivideon-timeline-calendar" />').appendTo(p.$wrapper);c('<div class="ivideon-timeline-calendar-spinner" />').appendTo(p.$calendar);p._showOptions=null;p._range={startTime:0,endTime:0};
p._redrawTimer=null;p._rangeDisplayedTimer=null;n=c.datepicker.regional[f.lang.getMessage("ivideon.libs","jquery.ui.datepicker.lang")||""];p.$calendar.datepicker(c.extend({maxDate:(p._options.scrollToFuture?b:0),showButtonPanel:false,showOtherMonths:true,selectOtherMonths:true,changeMonth:true,changeYear:true,showOn:"",showAnim:"",onChangeMonthYear:function(){s()
},onClose:function(){s()},beforeShow:function(){s()},beforeShowDay:function(x){if(p._state===i.STATE_DESTROYED){return}var v=x.getTime(),u=true,k,w;m++;if(m===1){q=r();o=v;l=null}else{if(m===q){l=v+p._getLengthOfDay(v);
if(o!==p._range.startTime||l!==p._range.endTime){p._range.startTime=o;p._range.endTime=l;p._onMonthSelected();e.clearTimeout(p._rangeDisplayedTimer);p._rangeDisplayedTimer=e.setTimeout(function(){if(p._state===i.STATE_DESTROYED){return
}p.events.fire("range-displayed",{startTime:p._range.startTime,endTime:p._range.endTime})},1)}s();p._redraw(0)}}k=p._getCssClassForDay(v,0);return[u,k,w]},onSelect:function(){var k=p.getSelectedRange();
if(k){e.setTimeout(function(){if(p._state===i.STATE_DESTROYED){return}p._redraw();p._onDaySelected(k)},0)}}},{monthNamesShort:(n&&n.monthNames?n.monthNames:b),prevText:f.tr(h,"button.prev.tooltip"),nextText:f.tr(h,"button.next.tooltip")}));
c(e).bind("resize orientationchange",p._onWindowResize=function(){p.updatePosition()});p._timelines.forEach(function(v,u){var k=p._timelines.getIndex(u);p._addTimeline(v,k)});p._timelines.events.on("added",p._onTimelineAdded,p);
p._timelines.events.on("removed",p._onTimelineRemoved,p);p._redraw();p._setState(i.STATE_VISIBLE)}i.STATE_VISIBLE=1;i.STATE_HIDDEN=2;i.STATE_DESTROYED=3;i.defaults={scrollToFuture:false,highlightArchiveDays:true};
g.isVisible=function(){var k=this;return(k._state===i.STATE_VISIBLE)};g.toggle=function(k){var l=this;if(l._state===i.STATE_DESTROYED){return}if(l._state===i.STATE_HIDDEN){l.show(k)}else{if(l._state===i.STATE_VISIBLE){l.hide()
}}};g.show=function(k){var l=this;if(l._state!==i.STATE_HIDDEN){return}l.$wrapper.show();l._showOptions=k;l.updatePosition();l._setState(i.STATE_VISIBLE);l.events.fire("show")};g.hide=function(){var k=this;
if(k._state!==i.STATE_VISIBLE){return}k.$wrapper.hide();k._setState(i.STATE_HIDDEN);k.events.fire("hide")};g.updatePosition=function(){var k=this;if(k._showOptions&&k._showOptions.position){k.$wrapper.css({position:"absolute"}).position(k._showOptions.position).css("zIndex",999999999)
}else{k.$wrapper.css({position:"static"})}};g.selectRange=function(l,k){var m=this;if(m._state===i.STATE_DESTROYED){return}if(!l||!l.startTime){throw new Error("range")}m.selectDay(l.startTime,k)};g.getSelectedRange=function(){var p=this,k={startTime:0,endTime:0},n,m,l,o;
if(p._state===i.STATE_DESTROYED){throw new f.utils.StateDestroyedError(d+"#getSelectedRange")}n=p.$calendar.data("datepicker");m=[n.selectedYear,n.selectedMonth,n.selectedDay];l=j(m);if(!l.isValid()){throw new f.utils.CriticalError(d+"#getSelectedRange: Calendar returned incorrect date: "+m.join("-"))
}l=l.tz(p._timezone).startOf("day");k.startTime=o=l.valueOf();k.endTime=o+p._getLengthOfDay(o);return k};g.selectDay=function(m,k){var o=this,l,n;if(o._state===i.STATE_DESTROYED){return}if(typeof m!=="number"||isNaN(m)){throw new f.utils.ArgumentError(d+'#selectDay: Argument "startTime" is incorrect.')
}n=o.getSelectedRange();l=new Date(m);l.setHours(0,0,0,0);m=l.getTime();if(m!==n.startTime){o.$calendar.datepicker("setDate",l);n=o.getSelectedRange();if(n){o._onDaySelected(n,k)}}};g.getCurrDay=function(){var l=this,k;
k=l.getSelectedRange();return k.startTime};g.getPrevDay=function(){var l=this,k=j(l.getCurrDay()).tz(l._timezone).subtract(1,"day");return k.valueOf()};g.getNextDay=function(){var l=this,k=j(l.getCurrDay()).tz(l._timezone).add(1,"day");
return k.valueOf()};g.destroy=function(){var l=this,k;if(l._state===i.STATE_DESTROYED){return}if(l._rangeDisplayedTimer){e.clearTimeout(l._rangeDisplayedTimer);l._rangeDisplayedTimer=null}if(l._onWindowResize){c(e).unbind("resize orientationchange",l._onWindowResize);
l._onWindowResize=null}l._setState(i.STATE_DESTROYED);l.events.fire("destroying");l.events.un();l._timelines.events.un("added",l._onTimelineAdded,l);l._timelines.events.un("removed",l._onTimelineRemoved,l);
l._cancelPendingRedraw();l._timelines.forEach(function(o,n){var m=l._timelines.getIndex(n);l._removeTimeline(o,m,true)});l.$wrapper.off("click touchstart",l._clickHandler).off("clickoutside touchstartoutside",l._clickOutsideHandler).remove();
for(k in l){if(l.hasOwnProperty(k)&&k.charAt(0)==="$"){delete l[k]}}l._timelines=null};g._setState=function(k){var l=this;if(!k){throw new Error("state")}if(l._state===i.STATE_DESTROYED){return}l._state=k;
if(l._state===i.STATE_VISIBLE){l._redraw()}};g._onTimelineAdded=function(l,k){var m=this;if(m._state===i.STATE_DESTROYED){return}m._addTimeline(k.item,k.index)};g._onTimelineRemoved=function(l,k){var m=this;
if(m._state===i.STATE_DESTROYED){return}m._removeTimeline(k.item,k.index)};g._onTimelineCountsAdded=function(l,k){var m=this;if(m._state===i.STATE_DESTROYED){return}if(k.counts.length>0){m._redraw()}};
g._onTimelineCountsLoadingStarted=function(){var k=this;if(k._state===i.STATE_DESTROYED){return}k.$calendar.addClass("ui-state-processing")};g._onTimelineCountsLoadingSuccess=function(){var k=this;if(k._state===i.STATE_DESTROYED){return
}k.$calendar.removeClass("ui-state-processing")};g._onTimelineCountsLoadingError=function(){var k=this;if(k._state===i.STATE_DESTROYED){return}k.$calendar.removeClass("ui-state-processing")};g._addTimeline=function(l,k,n){if(!l){return
}var m=this;l.events.on("counts-added",m._onTimelineCountsAdded,m);l.events.on("counts-loading-started",m._onTimelineCountsLoadingStarted,m);l.events.on("counts-loading-success",m._onTimelineCountsLoadingSuccess,m);
l.events.on("counts-loading-error",m._onTimelineCountsLoadingError,m);if(!n){m._redraw(0)}};g._removeTimeline=function(l,k,n){if(!l){return}var m=this;l.events.un("counts-added",m._onTimelineCountsAdded,m);
l.events.un("counts-loading-started",m._onTimelineCountsLoadingStarted,m);l.events.un("counts-loading-success",m._onTimelineCountsLoadingSuccess,m);l.events.un("counts-loading-error",m._onTimelineCountsLoadingError,m);
if(!n){m._redraw(0)}};g._getCssClassForDay=function(m,l){var n=this,k="ivideon-timeline-calendar-date ivideon-timeline-calendar-date-"+(m);if(n._options.highlightArchiveDays){if(l>0){k+=" ivideon-timeline-calendar-date-has-records"
}else{k+=" ivideon-timeline-calendar-date-no-records"}}return k};g._updateCssClassForDay=function(m,l){var n=c(".ivideon-timeline-calendar-date-"+(m)),k=n.children("a, span");n[l>0?"removeClass":"addClass"]("ivideon-timeline-calendar-date-no-records");
n[l>0?"addClass":"removeClass"]("ivideon-timeline-calendar-date-has-records");k[l>0?"removeClass":"addClass"]("m-secondary")};g._cancelPendingRedraw=function(){var k=this;if(k._redrawTimer){e.clearTimeout(k._redrawTimer);
k._redrawTimer=null}};g._redraw=function(l){var q=this,k=q._range,n=k.startTime,p=k.endTime,o={},m;q._cancelPendingRedraw();if(typeof l==="number"){q._redrawTimer=e.setTimeout(function(){if(q._state===i.STATE_DESTROYED){return
}q._redraw()},l);return}if(q._state!==i.STATE_VISIBLE){return}q.$calendar.find(".ui-datepicker-header").removeClass("ui-widget-header ui-state-default").find(".ui-datepicker-prev").removeClass("ui-corner-all ui-widget ui-state-default").addClass("iv-btn ui-corner-left").find(".ui-icon").removeClass("ui-icon-circle-triangle-w").addClass("ui-icon-seek-prev").end().end().find(".ui-datepicker-next").removeClass("ui-corner-all ui-widget ui-state-default").addClass("iv-btn ui-corner-right").find(".ui-icon").removeClass("ui-icon-circle-triangle-e").addClass("ui-icon-seek-next").end().end().end().find(".ivideon-timeline-calendar-date").children("a").addClass("iv-btn m-secondary").end().children("span").addClass("iv-btn m-secondary m-disabled").end().end();
if(!n||!p){return}if(!q._options.highlightArchiveDays){for(m=n;m<=p;m+=f.DAY_IN_MS){q._updateCssClassForDay(m,0)}return}q._timelines.forEach(function(v){var t=v.selectCounts(n,p),u,s,r;for(r=0;r<t.length;
++r){u=t[r];s=u.startTime;if(typeof o[s]==="undefined"){o[s]=0}o[s]+=u.recordsCount}});for(m in o){if(o.hasOwnProperty(m)){q._updateCssClassForDay(m,o[m])}}q.updatePosition();q.events.fire("redraw")};g._onDaySelected=function(m,k){var l=this;
if(l._state===i.STATE_DESTROYED){return}if(!k&&m){l.events.fire("range-selected",{startTime:m.startTime,endTime:m.endTime})}};g._onMonthSelected=function(){};g._getLengthOfDay=function(k){var l=j(k).tz(this._timezone).startOf("day"),m=j(l.valueOf()).tz(this._timezone).add(1,"day");
return(m.valueOf()-l.valueOf())}}(window,window._ivideon));(function(e,f,a){"use strict";var b=f.$,j=f.require({prefix:""},"moment"),i=d,g=i.prototype,c="ivideon.views.TimelineCalendarButton",h=c;f.provide(c,i);
function d(k){var l=this;l._options=f.optClass(i.defaults,k,c,l,{$container:"container",_timelines:"timelines"});l._timezone=(l._options.timezone||f.getDetectedTimezone());l.events=new (f.require("ivideon.utils.Observable"))(l);
l.$wrapper=b("<div/>").addClass("ivideon-timeline-calendar-button-wrapper").disableSelection().appendTo(l.$container);l.$wrapper.bind("contextmenu",false);l.$prev=b('<a class="iv-btn ivideon-timeline-calendar-button-prev" />').appendTo(l.$wrapper);
l.$curr=b('<a class="iv-btn ivideon-timeline-calendar-button-curr" />').appendTo(l.$wrapper);l.$next=b('<a class="iv-btn ivideon-timeline-calendar-button-next" />').appendTo(l.$wrapper);l.$prev.attr("title",f.tr(h,"button.prev.tooltip")).button({icons:{primary:"ui-icon-seek-prev"},text:false});
l.$curr.attr("title",f.tr(h,"button.curr.tooltip")).button({icons:{primary:"ui-icon-triangle-1-n"}});l.$next.attr("title",f.tr(h,"button.next.tooltip")).button({icons:{secondary:"ui-icon-seek-next"},text:false});
l.$wrapper.buttonset();l._calendarShowOptions={clickOutsideHide:true,position:b.extend({my:"center bottom",at:"center top",of:l.$curr,offset:"0 0"},l._options.calendarPosition)};l._calendar=new (f.require("ivideon.views.TimelineCalendar"))(f.optMerge(l._options.timelineCalendarOptions,{timezone:l._timezone,timelines:l._timelines,container:l._options.calendarContainer||"body"}));
l._calendar.events.on("range-displayed",l._onCalendarRangeDisplayed=function(){l._updateFromCalendar()});l._calendar.events.on("range-selected",l._onCalendarRangeSelected=function(){l._updateFromCalendar()
});l._calendar.events.on("show",l._onCalendarShow=function(){l._updateButtonFromCalendar()});l._calendar.events.on("hide",l._onCalendarHide=function(){l._updateButtonFromCalendar()});l._calendar.hide();
l.$prev.click(function(){l._prev();return false});l.$curr.click(function(){l._toggleCalendar();return false});l.$next.click(function(){l._next();return false});l._updateFromCalendar();l._setState(i.STATE_CREATED)
}i.STATE_CREATED=1;i.STATE_DESTROYED=2;i.defaults={};g.getCalendar=function(){var k=this;return k._calendar};g.destroy=function(){var l=this,k;if(l._state===i.STATE_DESTROYED){return}l._setState(i.STATE_DESTROYED);
l.events.fire("destroying");l.events.un();if(l._onDocumentClick){b(e.document).unbind("click",l._onDocumentClick);l._onDocumentClick=null}if(l._calendar){if(l._onCalendarRangeDisplayed){l._calendar.events.un("range-displayed",l._onCalendarRangeDisplayed);
l._onCalendarRangeDisplayed=null}if(l._onCalendarRangeSelected){l._calendar.events.un("range-selected",l._onCalendarRangeSelected);l._onCalendarRangeSelected=null}if(l._onCalendarShow){l._calendar.events.un("show",l._onCalendarShow);
l._onCalendarShow=null}if(l._onCalendarHide){l._calendar.events.un("hide",l._onCalendarHide);l._onCalendarHide=null}l._calendar.destroy();l._calendar=null}l.$wrapper.remove();for(k in l){if(l.hasOwnProperty(k)&&k.charAt(0)==="$"){delete l[k]
}}};g._setState=function(k){var l=this;if(!k){throw new Error("state")}if(l._state===i.STATE_DESTROYED){return}l._state=k};g._prev=function(){var k=this;if(k._state===i.STATE_DESTROYED){return}k.events.fire("prev")
};g._next=function(){var k=this;if(k._state===i.STATE_DESTROYED){return}k.events.fire("next")};g._toggleCalendar=function(){var k=this;if(k._state===i.STATE_DESTROYED){return}k._calendar.toggle(k._calendarShowOptions)
};g._updateFromCalendar=function(){var n=this,k=f.now(),m,l;if(n._state===i.STATE_DESTROYED){return}m=n._calendar.getCurrDay();l=n._calendar.getNextDay();n.$curr.button("option","label",j(m).tz(n._timezone).format("D.MM.YYYY"));
if(l>k){n.$next.button("disable").removeClass("ui-state-hover ui-state-active")}else{n.$next.button("enable")}n._updateButtonFromCalendar()};g._updateButtonFromCalendar=function(){var k=this;if(k._calendar.isVisible()){k.$curr.addClass("m-active")
}else{k.$curr.removeClass("m-active")}}}(window,window._ivideon));(function(d,e,a){"use strict";var b=e.$,g=i,f=g.prototype,c="ivideon.views.TimelineZoomCenterButtons",h=c;e.provide(c,g);function i(j){var k=this;
k._options=e.optClass(g.defaults,j,c,k,{$container:"container"});k.events=new (e.require("ivideon.utils.Observable"))(k);k.$wrapper=b("<div/>").addClass("ivideon-timeline-zoom-center-buttons-wrapper").disableSelection().appendTo(k.$container);
k.$wrapper.bind("contextmenu",false);k.$zoomWrapper=b("<div/>").addClass("ivideon-timeline-zoom-buttons-wrapper").appendTo(k.$wrapper);k.$zoomIn=b('<a class="iv-btn ivideon-timeline-button ivideon-timeline-button-zoom-in" />').appendTo(k.$zoomWrapper);
k.$zoomOut=b('<a class="iv-btn ivideon-timeline-button ivideon-timeline-button-zoom-out" />').appendTo(k.$zoomWrapper);k.$center=b('<a class="iv-btn ivideon-timeline-button ivideon-timeline-button-center" />').appendTo(k.$wrapper);
k.$zoomIn.attr("title",e.tr(h,"button.zoom_in.tooltip")).button({icons:{secondary:"ui-icon-zoomin"},text:false});k.$zoomOut.attr("title",e.tr(h,"button.zoom_out.tooltip")).button({icons:{primary:"ui-icon-zoomout"},text:false});
k.$center.attr("title",e.tr(h,"button.center.tooltip")).button({icons:{primary:"ui-icon-arrowreturn-1-s"},text:false});k.$zoomWrapper.buttonset();k.$zoomIn.click(function(){k.events.fire("zoom-in");return false
});k.$zoomOut.click(function(){k.events.fire("zoom-out");return false});k.$center.click(function(){k.events.fire("center");return false});k._setState(g.STATE_CREATED)}g.STATE_CREATED=1;g.STATE_DESTROYED=2;
g.defaults={};f.destroy=function(){var k=this,j;if(k._state===g.STATE_DESTROYED){return}k._setState(g.STATE_DESTROYED);k.events.fire("destroying");k.events.un();k.$wrapper.remove();for(j in k){if(k.hasOwnProperty(j)&&j.charAt(0)==="$"){delete k[j]
}}};f._setState=function(j){var k=this;if(!j){throw new Error("state")}if(k._state===g.STATE_DESTROYED){return}k._state=j}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,h=a,g=h.prototype,d="ivideon.views.CameraPtzController",i=d;
f.provide(d,h);function a(j){var k=this;k._options=f.optClass(h.defaults,j,d,k,{$container:"container ?",_camera:"camera",_cameraVideoView:"cameraVideoView ?"});k.events=new (f.require("ivideon.utils.Observable"))(k);
if(!k._cameraVideoView){k.$wrapper=c("<div/>").addClass("ivideon-camera-ptz-controller").appendTo(k.$container)}else{k._controls=[]}k._createZoomControls();k._createPresetControls();k._createSpinner();
k._createArrowControls();k._createImageControls();k._camera.events.on("ptzStarted",k._ptzStartedHandler=function(){if(k._progressDisplayTimer){e.clearTimeout(k._progressDisplayTimer);k._progressDisplayTimer=null
}if(k.$progress){k.$progress.addClass("active")}if(k.$mouseController){k.$mouseController.addClass("progress")}});k._camera.events.on("ptzStopped",k._ptzStoppedHandler=function(){k._progressDisplayTimer=e.setTimeout(function(){if(k.$progress){k.$progress.removeClass("active")
}if(k.$mouseController){k.$mouseController.removeClass("progress")}if(e.Modernizr.touch){k._removeImageControlsHover()}},k._options.cameraReactionTimeInMs)});k._progressDisplayTimer=null}h.MOVE_DIRECTION={HOME:"home",UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"};
h.defaults={cameraReactionTimeInMs:1000,rzoomCoeff:0.1,features:{moveLeft:false,moveRight:false,moveUp:false,moveDown:false,moveHome:false,rzoom:false,center:false,restore:false}};g._appendControl=function(k,j){var l=this;
k.addClass("ivideon-camera-ptz-control");l._controls[l._controls.length]=k;if(l._cameraVideoView){l._cameraVideoView.injectControl(k,j||"ptz")}else{l.$wrapper.append(k)}};g._createSpinner=function(){var j=this;
j.$progress=c('<div class="ivideon-camera-ptz-controller-progress" />');j._appendControl(j.$progress,"ptz")};g._removeImageControlsHover=function(){var j=this;if(j.$mouseControllerZoomHintLeft){j.$mouseControllerZoomHintLeft.removeClass("hover")
}if(j.$mouseControllerZoomHintRight){j.$mouseControllerZoomHintRight.removeClass("hover")}if(j.$mouseControllerZoomHintUp){j.$mouseControllerZoomHintUp.removeClass("hover")}if(j.$mouseControllerZoomHintDown){j.$mouseControllerZoomHintDown.removeClass("hover")
}if(j.$mouseController){j.$mouseController.removeClass("hover-left hover-right hover-up hover-down")}};g._createImageControls=function(){var j=this;j.$mouseController=c("<div/>").addClass("ivideon-camera-ptz-controller-mouse");
if(j._options.features.center){j._zoomXYSizeCached=null;j._zoomXYSizeCacheClearTimer=null;j.$mouseController.bind("click",function(k){if(j._disabled){return}var l=f.utils.getRelativeXYSize(k.pageX,k.pageY,j.$mouseController);
j.center(l.x,l.y,l.width,l.height);return false}).mousewheel(function(k,m){if(j._disabled){return}var l=j._zoomXYSizeCached||f.utils.getRelativeXYSize(k.pageX,k.pageY,j.$mouseController);if(!j._zoomXYSizeCached){j.center(l.x,l.y,l.width,l.height);
j._zoomXYSizeCached=l;j.$mouseController.addClass("zooming")}e.clearTimeout(j._zoomXYSizeCacheClearTimer);j._zoomXYSizeCacheClearTimer=e.setTimeout(function(){j._zoomXYSizeCached=null;j.$mouseController.removeClass("zooming")
},5000);if(j._options.features.rzoom){j.rzoom(j._options.rzoomCoeff*m)}return false});j._appendControl(j.$mouseController)}else{j.$mouseController.bind((e.Modernizr.touch?"touchstart mouseleave":"mousemove mouseleave"),function(k){if(k.type==="mouseleave"){j._removeImageControlsHover();
return}if(j._disabled){return}var m=(k.originalEvent&&k.originalEvent.changedTouches?k.originalEvent.changedTouches[0]:null)||k,l=f.utils.getRelativeXYSize(m.pageX,m.pageY,j.$mouseController);if(j.$mouseControllerZoomHintLeft){if(l.x<l.width/3){j.$mouseControllerZoomHintLeft.addClass("hover");
j.$mouseController.addClass("hover-left")}else{j.$mouseControllerZoomHintLeft.removeClass("hover");j.$mouseController.removeClass("hover-left")}}if(j.$mouseControllerZoomHintRight){if(l.x>2*l.width/3){j.$mouseControllerZoomHintRight.addClass("hover");
j.$mouseController.addClass("hover-right")}else{j.$mouseControllerZoomHintRight.removeClass("hover");j.$mouseController.removeClass("hover-right")}}if(j.$mouseControllerZoomHintUp){if(l.y<l.height/3){j.$mouseControllerZoomHintUp.addClass("hover");
j.$mouseController.addClass("hover-up")}else{j.$mouseControllerZoomHintUp.removeClass("hover");j.$mouseController.removeClass("hover-up")}}if(j.$mouseControllerZoomHintDown){if(l.y>2*l.height/3){j.$mouseControllerZoomHintDown.addClass("hover");
j.$mouseController.addClass("hover-down")}else{j.$mouseControllerZoomHintDown.removeClass("hover");j.$mouseController.removeClass("hover-down")}}}).bind("click",function(k){if(j._disabled){return}var l=f.utils.getRelativeXYSize(k.pageX,k.pageY,j.$mouseController);
if(l.x<l.width/3){if(j._options.features.moveLeft){j.move(h.MOVE_DIRECTION.LEFT)}}else{if(l.x>2*l.width/3){if(j._options.features.moveRight){j.move(h.MOVE_DIRECTION.RIGHT)}}}if(l.y<l.height/3){if(j._options.features.moveUp){j.move(h.MOVE_DIRECTION.UP)
}}else{if(l.y>2*l.height/3){if(j._options.features.moveDown){j.move(h.MOVE_DIRECTION.DOWN)}}}return false}).mousewheel(function(k,l){if(j._disabled){return}if(j._options.features.rzoom){j.rzoom(j._options.rzoomCoeff*l)
}return false});if(j._options.features.moveLeft){j.$mouseControllerZoomHintLeft=c("<div/>").addClass("ivideon-camera-ptz-controller-mouse-zoom-hint-left").appendTo(j.$mouseController)}if(j._options.features.moveRight){j.$mouseControllerZoomHintRight=c("<div/>").addClass("ivideon-camera-ptz-controller-mouse-zoom-hint-right").appendTo(j.$mouseController)
}if(j._options.features.moveUp){j.$mouseControllerZoomHintUp=c("<div/>").addClass("ivideon-camera-ptz-controller-mouse-zoom-hint-up").appendTo(j.$mouseController)}if(j._options.features.moveDown){j.$mouseControllerZoomHintDown=c("<div/>").addClass("ivideon-camera-ptz-controller-mouse-zoom-hint-down").appendTo(j.$mouseController)
}j._appendControl(j.$mouseController)}};g._createZoomControls=function(){var j=this;if(j._options.features.rzoom){j.$zoomPlus=c('<a class="iv-btn ivideon-camera-ptz-controller-zoom-plus" />').attr("title",f.tr(i,"button.zoom_in.title")).html(f.tr(i,"button.zoom_in.text")).button({icons:{primary:"ui-icon-plusthick"},text:false}).bind("click",function(){j.rzoom(j._options.rzoomCoeff)
});j.$zoomMinus=c('<a class="iv-btn ivideon-camera-ptz-controller-zoom-minus" />').attr("title",f.tr(i,"button.zoom_out.title")).html(f.tr(i,"button.zoom_out.text")).button({icons:{primary:"ui-icon-minusthick"},text:false}).bind("click",function(){j.rzoom(-j._options.rzoomCoeff)
});j._appendControl(j.$zoomPlus,"topleft");j._appendControl(j.$zoomMinus,"topleft")}};g._createArrowHandler=function(j){var k=this;return function(){if(k._disabled){return}k.move(j)}};g._createArrowControls=function(){var q=this,k=[],o=c('<div class="ivideon-camera-ptz-controller-arrows" />'),m,l,j,p=function(t){var s,r;
if(q._disabled){return}for(s=0,r=k.length;s<r;++s){c(k[s]).removeClass("hover")}c(t.target).closest(".ivideon-camera-ptz-controller-rotation-arrow").addClass("hover")},n=function(r){c(r.target).closest(".ivideon-camera-ptz-controller-rotation-arrow").removeClass("hover")
};if(q._options.features.moveUp){k[k.length]=c('<div class="ivideon-camera-ptz-controller-rotation-arrow ivideon-camera-ptz-controller-rotation-up"><span class="ivideon-camera-ptz-controller-arrow-icon" /></div>').attr("title",f.tr(i,"button.move_up.title")).click(q._createArrowHandler(h.MOVE_DIRECTION.UP))
}if(q._options.features.moveDown){k[k.length]=c('<div class="ivideon-camera-ptz-controller-rotation-arrow ivideon-camera-ptz-controller-rotation-down"><span class="ivideon-camera-ptz-controller-arrow-icon" /></div>').attr("title",f.tr(i,"button.move_down.title")).click(q._createArrowHandler(h.MOVE_DIRECTION.DOWN))
}if(q._options.features.moveLeft){k[k.length]=c('<div class="ivideon-camera-ptz-controller-rotation-arrow ivideon-camera-ptz-controller-rotation-left"><span class="ivideon-camera-ptz-controller-arrow-icon" /></div>').attr("title",f.tr(i,"button.move_left.title")).click(q._createArrowHandler(h.MOVE_DIRECTION.LEFT))
}if(q._options.features.moveRight){k[k.length]=c('<div class="ivideon-camera-ptz-controller-rotation-arrow ivideon-camera-ptz-controller-rotation-right"><span class="ivideon-camera-ptz-controller-arrow-icon" /></div>').attr("title",f.tr(i,"button.move_right.title")).click(q._createArrowHandler(h.MOVE_DIRECTION.RIGHT))
}for(l=0,j=k.length;l<j;++l){m=c(k[l]).bind("mouseenter mousedown touchstart",p).bind("mouseleave mouseup touchend",n);m.appendTo(o)}q._appendControl(o,"topleft")};g._createPresetControls=function(){var k=this;
if(k._options.features.moveHome){var j=c('<a class="iv-btn ivideon-camera-ptz-controller-rotation-preset ivideon-camera-ptz-controller-rotation-home" />').attr("title",f.tr(i,"button.move_home.title")).html(f.tr(i,"button.move_home.text")).button({icons:{primary:"ui-icon-home"},text:false}).click(function(){if(k._disabled){return
}k.move(h.MOVE_DIRECTION.HOME)});k._appendControl(j,"topleft")}if(k._options.features.restore){c.each(k._options.presets||[],function(m,l){var n=c('<a class="iv-btn ivideon-camera-ptz-controller-rotation-preset ivideon-camera-ptz-controller-rotation-preset-'+(m+1)+'" />').attr("title",f.tr(i,"button.restore.title",{presetName:(m+1)})).html(f.tr(i,"button.restore.text",{presetName:(m+1)})).button({}).click(function(){if(k._disabled){return
}k.restore(l)});k._appendControl(n,"topleft")})}};g._ptz=function(j){var k=this;k._camera.ptz(j.request);k.events.fire("ptz")};g._remapRange=function(n,k,m,o,l){n=parseFloat(n);if(isNaN(n)){return NaN}var j=((n-k)/(m-k))*(l-o)+o;
if(j<o){j=o}if(j>l){j=l}return j};g.rotate=function(){throw new Error(f.tr(i,"error.rotate.not_implemented"))};g.zoom=function(){throw new Error(f.tr(i,"error.zoom.not_implemented"))};g.rzoom=function(j){var k=this;
if(k._destroyed){return}k._ptz({request:{rzoom:Math.floor(k._remapRange(j,-1,1,-9999,9999))}});k.events.fire("rzoom")};g.center=function(j,n,k,l){var m=this;if(m._destroyed){return}m._ptz({request:{center:j+","+n,imagewidth:k,imageheight:l}});
m.events.fire("center")};g.areazoom=function(){throw new Error(f.tr(i,"error.areazoom.not_implemented"))};g.move=function(k){var m=this,j,l;if(m._destroyed){return}k=String(k).toLowerCase();j=false;for(l in h.MOVE_DIRECTION){if(h.MOVE_DIRECTION[l]===k){j=true;
break}}if(!j){throw new Error(f.tr(i,"error.move.not_implemented",{direction:k}))}m._ptz({request:{move:k}});m.events.fire("move")};g.save=function(){throw new Error(f.tr(i,"error.save.not_implemented"))
};g.restore=function(k){var j=this;if(j._destroyed){return}j._ptz({request:{restore:k}});j.events.fire("restore")};g.disable=function(){var j=this;if(j._destroyed){return}j._disabled=true;c(j._controls).addClass("m-disabled").filter(".ui-button").button("disable").end().filter(".ui-slider").slider("disable").end()
};g.enable=function(){var j=this;if(j._destroyed){return}j._disabled=false;c(j._controls).removeClass("m-disabled").filter(".ui-button").button("enable").end().filter(".ui-slider").slider("enable").end()
};g.destroy=function(){var k=this,j;if(k._destroyed){return}k._destroyed=true;if(k._zoomXYSizeCacheClearTimer){e.clearTimeout(k._zoomXYSizeCacheClearTimer);k._zoomXYSizeCacheClearTimer=null}if(k._progressDisplayTimer){e.clearTimeout(k._progressDisplayTimer);
k._progressDisplayTimer=null}k.events.un();if(k._camera){if(k._ptzStartedHandler){k._camera.events.un("ptzStarted",k._ptzStartedHandler);k._ptzStartedHandler=null}if(k._ptzStoppedHandler){k._camera.events.un("ptzStopped",k._ptzStoppedHandler);
k._ptzStoppedHandler=null}k._camera=null}k._controls=null;k._options=null;if(k.$wrapper){k.$wrapper.remove()}for(j in k){if(k.hasOwnProperty(j)&&j.charAt(0)==="$"){delete k[j]}}}}(window,window._ivideon));
(function(d,e,a){"use strict";var b=e.$,g=i,f=g.prototype,c="ivideon.models.CameraPublicInfo",h=c;e.provide(c,g);function i(j){var l=this,k;l._options=e.optClass(g.defaults,j,c,l,{_camera:"camera ?",_embedOptions:"embedOptions ?"});
l._embedOptions=l._embedOptions||e.app.getConfig("embedOptions");k=l._camera;l.events=new (e.require("ivideon.utils.Observable"))(l);l._data={};l._embedCodeOptions={};l.serverId=null;l.cameraId=null;l._address=null;
l._viewing=0;l._viewed=0;l._acceptChanges(b.extend(true,{server_id:(k?k.serverId:a),server_name:(k&&k.server?k.server.name:""),camera_id:(k?k.cameraId:a),camera_name:(k?k.name:""),width:(k?k.width:a),height:(k?k.height:a),allowed:true,exists:true,hidden:false,banned:false,ban_reason:"",comments_banned:false,comments_ban_reason:"","public":true,published_at:1,online:true,views:0,total_views:0,info:{},geo:null,misc:{comments:"",description:"",link:"",link_text:"",tags:[]}},l._options.data));
l.setEmbedCodeOptions()}g.defaults={};f.getData=function(){return this._data};f.isPublic=function(){var j=this._data;return(j.exists&&j["public"]&&!j.banned)};f.getName=function(){return b.trim(this._data.camera_name||"")
};f.getDescription=function(){return b.trim(this._data.misc.description||"")};f.getShortDescription=function(k){var m=this.getDescription(),l=/\s+/,o=m.split(l),p=(k&&k.maxWords)||30,j=(k&&k.maxLength)||(20*p),n=false;
if(o.length>p){o.length=p;n=true}m=o.join(" ");if(m.length>j){m=m.substring(0,j-1);n=true}if(n){m+=""}return m};f.getCoords=function(j){var k=this._data.geo;if(!k){return}if(j==="user"){return(k.user||a)
}else{if(j==="auto"){return(k.auto||a)}}return(k.user||k.auto||a)};f.getAddress=function(){var l=this,j=b.Deferred(),k;if(l._address){return l._address}l._address=j;k=l.getCoords();if(k&&e.app.hasService("geocoderAPI")){e.app.service("geocoderAPI").reverse({coords:k}).done(function(m){j.resolve(m)
}).fail(function(m){j.reject(m)})}else{j.reject()}return j.promise()};f.getPreviewUrl=function(j){var k=this;if(typeof j!=="object"||!j.isFromIvCdn){return(e.app.getConfig("streamerAPI.rootUrl")+"preview/live?server="+k._data.server_id+"&camera="+k._data.camera_id)
}return"http://previews.iv-cdn.com/previews/"+k._data.server_id+"-"+k._data.camera_id+(j.isFacebookPreview?"-fb":"")+".jpg"};f.getEmbedCodeOptions=function(){return this._embedCodeOptions};f.setEmbedCodeOptions=function(k){var o=this,m=o._embedOptions,n=o.propagateEmbedSize((m.defaultWidths.length>0?m.defaultWidths[m.defaultWidths.length-1]:m.minWidth),"width",true),j={width:n.width,height:n.height},l;
k=b.extend({},j,k);l=o._limitEmbedSize({width:k.width,height:k.height});if(!l){if(typeof k.width!=="undefined"&&typeof k.height==="undefined"){l=o.propagateEmbedSize(k.width,"width",true)}else{if(typeof k.height!=="undefined"&&typeof k.width==="undefined"){l=o.propagateEmbedSize(k.height,"height",true)
}else{l=n}}}l.outerWidth=l.width+2;b.extend(o._embedCodeOptions,l)};f.getEmbedCode=function(o){var l=this,n=l._embedOptions,m=l.getEmbedCodeOptions(),j=l.getEmbedUrl(o),r=l.getBottomScriptUrl(o),p,q="",k;
p='<div class="iv-v" style="display:block;margin:0;padding:1px;border:0;background:#000;"><iframe class="iv-i" style="display:block;margin:0;padding:0;border:0;" src="'+e.utils.htmlencode(j)+'" width="'+m.width+'" height="'+m.height+'" frameborder="0" allowfullscreen></iframe></div>';
if(n.embedBottomBlockEnabled){q='<div class="iv-b" style="display:block;margin:0;padding:0;border:0;"><div style="float:right;text-align:right;padding:0 0 10px;line-height:10px;"><a class="iv-a" style="font:10px Verdana,sans-serif;color:inherit;opacity:.6;" href="'+e.trQuoteEnc(h,"embed_code.link.url")+'" target="_blank">'+e.tr(h,(m.width<480?"embed_code.link.text.short":"embed_code.link.text"))+'</a></div><div style="clear:both;height:0;overflow:hidden;">&nbsp;</div><script src="'+e.utils.htmlencode(r)+'"><\/script></div>'
}k='<div class="iv-embed" style="margin:0 auto;padding:0;border:0;width:'+m.outerWidth+'px;">'+p+q+"</div>";return k};f.propagateEmbedSize=function(l,k,t){var o=this,p=o._embedOptions,q=(o._data.width>0&&o._data.height>0?o._data.width/o._data.height:(640/480)),u,r,s,m,n,j={};
if(k==="height"){r="width";u=q;m=p.minHeight;n=p.minWidth}else{r="height";u=1/q;m=p.minWidth;n=p.minHeight}l=parseInt(l,10);if(isNaN(l)||l<0){s="";j[r]=""}else{if(t){if(l<m){l=m}s=Math.round(u*l);if(s<n){s=n;
l=Math.round(s/u)}j[k]=l}else{s=Math.round(u*l)}}j[r]=s;return j};f.getEmbedUrl=function(j){var m=this,k=m._embedOptions,l;l=e.lang.formatString(k.embedCameraUrl,{serverId:m._data.server_id,cameraId:m._data.camera_id,lang:e.app.getConfig("app.language")});
l=l.replace(/^https?\:\/\//,"//");return l};f.getBottomScriptUrl=function(j){var m=this,k=m._embedOptions,l;l=e.lang.formatString(k.embedBottomScriptUrl,{serverId:m._data.server_id,cameraId:m._data.camera_id,lang:e.app.getConfig("app.language")});
l=l.replace(/^https?\:\/\//,"//");return l};f.getPublicUrl=function(){var k=this,j=k._embedOptions;return e.lang.formatString(j.tvCameraUrl,{serverId:k._data.server_id,cameraId:k._data.camera_id,lang:e.app.getConfig("app.language")})
};f.getPublicHomeUrl=function(){var k=this,j=k._embedOptions;return e.lang.formatString(j.tvHomeUrl,{lang:e.app.getConfig("app.language")})};f.getCommentsEngines=function(){var j=[{value:"default",text:e.tr(h,"comments.value.default")}];
if(e.app.getConfig("app.language")==="ru"){j.push({value:"vkontakte",text:e.tr(h,"comments.value.vkontakte")});j.push({value:"facebook",text:e.tr(h,"comments.value.facebook")})}else{j.push({value:"facebook",text:e.tr(h,"comments.value.facebook")});
j.push({value:"vkontakte",text:e.tr(h,"comments.value.vkontakte")})}return j};f.validateName=function(j){return !!b.trim(j||"")};f.validateDescription=function(j){return !!b.trim(j||"")};f.validateEmbeddedLinkUrl=function(j){if(j===""||j===null){return true
}if(!/^(https?:\/\/)?[^:\/\\\s]+\.[^.\\\s]{2,}[^\\\s]*$/i.test(j)){return false}return true};f.validateEmbeddedLinkText=function(j){if(j===""||j===null){return true}return true};f.load=function(){var k=this;
var j=e.app.service("backendAPI").getCameraPublicInfo({server_id:k._data.server_id,camera_id:k._data.camera_id}).done(function(l){k._acceptChanges(l.info)});return j};f.update=function(j){var k=this;k._acceptChanges(j)
};f.getCounters=function(){var j=this;return{views:j._data.views+j._viewing,total_views:j._data.total_views+j._viewed}};f.resetLocalCounters=function(){var j=this;j._viewing=0;j._viewed=0};f.countViewsBegin=function(){var j=this;
j._viewing++;j.events.fire("changed")};f.countViewsEnd=function(){var j=this;if(j._viewing>0){j._viewing--;j._viewed++;j.events.fire("changed")}};f.saveMisc=function(k){var l=this;var j=e.app.service("backendAPI").saveCameraPublicInfo({server_id:l._data.server_id,camera_id:l._data.camera_id,misc:k}).done(function(m){l._acceptChanges(m.info)
});return j};f.saveGeo=function(k){var l=this;var j=e.app.service("backendAPI").setCameraMapLocation({server_id:l._data.server_id,camera_id:l._data.camera_id,coordinates:{latitude:k[0],longitude:k[1]}}).done(function(m){l._acceptChanges({geo:{user:[k[0],k[1]]}})
});return j};f._acceptChanges=function(j){var l=this,k=b.extend(true,{},l._data);if(typeof j.width!=="number"||j.width<=0){delete j.width}if(typeof j.height!=="number"||j.height<=0){delete j.height}b.extend(true,l._data,j);
if(!l.serverId&&!l.cameraId){l.serverId=l._data.server_id;l.cameraId=l._data.camera_id}if(!e.utils.isEqual(k,l._data)){if(!e.utils.isEqual(k.geo,l._data.geo)){l._address=null}l.events.fire("changed")}};
f._limitEmbedSize=function(k){var m=this,l=parseInt(k.width,10),j=parseInt(k.height,10);if(!isNaN(l)&&!isNaN(j)){if(l<m._options.minWidth){l=m._options.minWidth;j=Math.ceil(l*m._data.height/m._data.width)
}if(j<m._options.minHeight){j=m._options.minHeight;l=Math.ceil(j*m._data.width/m._data.height)}return{width:l,height:j}}return null}}(window,window._ivideon));(function(e,f,a){"use strict";var c=f.$,h=b,g=h.prototype,d="ivideon.views.CameraEmbedPreviewDialog",i=d;
f.provide(d,h);function b(j){var k=this;k._options=f.optClass(h.defaults,j,d,k,{_cameraPublicInfo:"cameraPublicInfo"});k.$previewDialog=null}h.defaults={};g.open=function(){var o=this,m=o._cameraPublicInfo.getData(),n,l,k,j;
if(o.$previewDialog){o.$previewDialog.dialog("close");o.$previewDialog=null}n=o._cameraPublicInfo.getEmbedCode(true);l=o._cameraPublicInfo.getEmbedCodeOptions();k=Math.round(c(e).width()*0.8);j=Math.round(c(e).height()*0.8);
o.$previewDialog=f.utils.dlg.message({title:f.tr(i,"title",{serverName:f.utils.htmlencode(m.server_name||""),cameraName:f.utils.htmlencode(m.camera_name||"")}),message:n,width:(l.width<=k?"auto":k),height:(l.height<=j?"auto":j),buttons:[],openHandler:function(r){var p=c(r),q,s;
q=parseInt(p.css("paddingLeft"),10);s=parseInt(p.css("paddingRight"),10);if(p.height()>j){p.height(j)}if(p.width()>k){p.width(k)}else{if((r.clientWidth-q-s)<l.outerWidth){p.width(l.outerWidth+c.support.scrollbarsAffectLayout)
}}},cancelHandler:function(q){var p=c(q);p.find("iframe").each(f.utils.cleanupIframe)}})};g.destroy=function(){var j=this;if(j.$previewDialog){j.$previewDialog.dialog("close");j.$previewDialog=null}}}(window,window._ivideon));
(function(e,f,a){"use strict";var c=f.$,h=b,g=h.prototype,d="ivideon.views.CameraPublishDialog",i=d;f.provide(d,h);function b(j){var l=this,k={};l._options=f.optClass(h.defaults,j,d,l,{_camera:"camera"});
l.events=new (f.require("ivideon.utils.Observable"))(l);k=[{text:f.tr(i,"button.publish"),click:function(){var m=l.$wrapper.dialog("widget").find(".ui-dialog-buttonpane .ui-button");l.$progressIndicator.show();
m.button("option","disabled",true);l._camera.setPublic(true).always(function(){if(l._state===h.STATE_DESTROYED){return}l.$progressIndicator.hide();m.button("option","disabled",false)}).done(function(){if(l._state===h.STATE_DESTROYED){return
}l.$wrapper.dialog("close");l.result.resolve()}).fail(function(n){if(l._state===h.STATE_DESTROYED){return}l.$initialMessage.hide();l.$errorMessage.empty().append("<br/>").append(c("<div/>").addClass("iv-msg-error").append(n.message)).show()
})}},{text:f.tr(i,"button.cancel"),"class":"m-secondary ui-priority-secondary",click:function(){l.$wrapper.dialog("close");l.result.reject()}}];l.$initialMessage=c("<div/>").html(f.tr(i,"message")+(l._options.tvEnabled?f.tr(i,"message.tv",{tv_home_url:f.lang.formatString(l._options.tvHomeUrl,{lang:f.app.getConfig("app.language")})}):""));
l.$errorMessage=c("<div/>").hide();l.$progressIndicator=c("<div/>").hide().addClass("b-loading-indicator");l.$wrapper=(f.require("ivideon.utils.dlg.message"))({classes:"ivideon-camera-publish-dialog",width:400,title:f.tr(i,"title"),message:c('<div class="ivideon-camera-publish-dialog-wrapper" />').append(l.$initialMessage).append(l.$errorMessage).append(l.$progressIndicator),buttons:k,autoOpen:false,cancelHandler:function(){l.destroy()
}});l._setState(h.STATE_CREATED)}h.STATE_CREATED=1;h.STATE_VISIBLE=2;h.STATE_DESTROYED=3;h.defaults={tvEnabled:false,tvHomeUrl:""};g.show=function(){var j=this;if(j._state!==h.STATE_CREATED){return}j._setState(h.STATE_VISIBLE);
j.$wrapper.dialog("open");j.events.fire("show");j.result=c.Deferred();return j.result.promise()};g.destroy=function(){var k=this,j;if(k._state===h.STATE_DESTROYED){return}k._setState(h.STATE_DESTROYED);
k.events.fire("destroying");k.events.un();f.utils.JQueryUIModalDialogOverlayFix.onModalClosed(k.$wrapper);k.$wrapper.remove();if(k.result&&k.result.state==="pending"){k.result.reject()}for(j in k){if(k.hasOwnProperty(j)&&j.charAt(0)==="$"){delete k[j]
}}};g._setState=function(j){var k=this;if(!j){throw new f.utils.ArgumentError(d+'#_setState: Argument "state" not set.')}if(k._state===h.STATE_DESTROYED){return}k._state=j}}(window,window._ivideon));(function(d,e,a){"use strict";
var b=e.$,h=g,f=h.prototype,c="ivideon.views.VideoEmbedDialog",i=c;e.provide(c,h);function g(j){var m=this,l=e.require("ivideon.views.EditableField"),k={};m._options=e.optClass(h.defaults,j,c,m,{_camera:"camera",_embedOptions:"embedOptions ?",_socialButtonsOptions:"socialButtons ?"});
m._embedOptions=m._embedOptions||e.app.getConfig("embedOptions");m._socialButtonsOptions=m._socialButtonsOptions||e.app.getConfig("socialButtons");if(!(e.app.hasService("rosterController")&&e.app.service("rosterController").closeCameraPublicAccessConfirmed)&&!m._camera.setPublic){m._options.closePublicAccessButton=false
}m.events=new (e.require("ivideon.utils.Observable"))(m);m._cameraPublicInfo=new (e.require("ivideon.models.CameraPublicInfo"))({camera:m._camera,embedOptions:m._embedOptions});k=[];if(m._options.previewButton===true){k.push({"class":"b-button-preview",text:e.tr(i,"button.preview"),click:function(){if(m._state===h.STATE_DESTROYED){return
}var p=m.getCurrentPanel(),n=(p==="tv_link"||p==="public_info"),o=(n?function(){if(m._state===h.STATE_DESTROYED){return}d.open(m._cameraPublicInfo.getPublicUrl())}:function(){if(m._state===h.STATE_DESTROYED){return
}if(!m._embedPreview){m._embedPreview=new (e.require("ivideon.views.CameraEmbedPreviewDialog"))({cameraPublicInfo:m._cameraPublicInfo})}m._embedPreview.open()});m._finishEditingPublicInfo(m.$previewButton.add(m.$closeButton),o)
}})}k.push({"class":"b-button-close m-secondary",text:e.tr(i,"button.close"),click:function(){var n=function(){if(m.$wrapper){m.$wrapper.dialog("close")}};m._finishEditingPublicInfo(m.$previewButton.add(m.$closeButton),n)
}});if(m._options.closePublicAccessButton){m.$closePublicAccess=b('<a class="iv-link m-inpage b-close-public-access-button">'+e.tr(i,"button.public_access.close")+"</a>").bind("click",function(){var n=m.$wrapper.dialog("widget").find(".ui-dialog-buttonpane .ui-button");
m.$progressIndicator.show();n.button("option","disabled",true);((e.app.hasService("rosterController")&&e.app.service("rosterController").closeCameraPublicAccessConfirmed)?e.app.service("rosterController").closeCameraPublicAccessConfirmed(m._camera):m._camera.setPublic(false)).always(function(){if(m._state===h.STATE_DESTROYED){return
}m.$progressIndicator.hide();n.button("option","disabled",false)}).done(function(){if(m._state===h.STATE_DESTROYED){return}m.$wrapper.dialog("close")}).fail(function(o){if(m._state===h.STATE_DESTROYED){return
}if(o){e.utils.dlg.error({message:o.message})}})})}m.$btnShareEmbed=b('<button name="share_type" data-panel="embed">'+e.tr(i,"tab.embed")+"</button>");m.$btnShareLink=b('<button name="share_type" data-panel="tv_link">'+e.tr(i,"tab.tv_link")+"</button>");
if(m._options.publicInfoEnabled){m.$btnPublicInfo=b('<button name="share_type" data-panel="public_info">'+e.tr(i,"tab.public_info")+"</button>")}m.$btsShareType=b('<div class="b-embed_type-buttons" />').append(m.$btnShareLink).append(m.$btnShareEmbed).append(m.$btnPublicInfo).buttonset();
if(m.$btsShareType.disableSelection){m.$btsShareType.disableSelection()}m.$btsShareType.find("button").addClass("iv-btn").click(function(){m.setCurrentPanel(b(this).attr("data-panel"))});m.$codeArea=b('<textarea class="b-code" readonly />').val(m._cameraPublicInfo.getEmbedCode());
m.$sizeSelectionButtons=b("<div/>").addClass("b-size_selection_buttons");m._appendSizeSelectionButtons(m.$sizeSelectionButtons);m.$sizeSelectionButtons.append('<div style="clear: both"></div>');m.$progressIndicator=b("<div/>").hide().addClass("b-loading-indicator");
m.$embedWrapper=b('<div class="b-panel b-embed" />').append('<div class="b-panel-title">'+e.tr(i,"embed.title")+"</div>").append(m.$codeArea).append('<div class="b-instructions">'+e.tr(i,"embed.instructions")+"</div>").append("<p><b>"+e.tr(i,"embed.video_size")+":</b></p>").append(m.$sizeSelectionButtons).append(m.$progressIndicator).css("visibility","hidden");
m._embedPreview=null;m.tvLink=m._cameraPublicInfo.getPublicUrl();m.cameraPreviewUrl=m._cameraPublicInfo.getPreviewUrl({isFromIvCdn:true});m.$linkArea=b('<textarea class="b-code" readonly />').val(m.tvLink);
m.$tvLinkWrapper=b('<div class="b-panel b-tv_link" />').append('<div class="b-panel-title">'+e.tr(i,"tv_link.title")+"</div>").append(m.$linkArea).append('<div class="b-instructions">'+e.tr(i,"tv_link.instructions")+"</div>");
m._createSocialButtons();m.$codeArea.add(m.$linkArea).bind("click",function(){this.select()});if(m._options.publicInfoEnabled){m._publicInfoGetting=null;m._publicInfoSaving=null;m._publicInfoSavingRequest=null;
m._publicInfoSavingStarted=0;m._publicInfoStoredData={};m._publicInfoModifiedData={};m._publicInfoModified=false;m._publicInfoModifiedWhileSaving=false;m._publicInfoFields={};m._publicInfoFields.link=new l({cssClassNames:"b-public_info-embedded_link-url",tooltip:e.tr(i,"public_info.embedded_link.url.tooltip"),placeholder:e.tr(i,"public_info.embedded_link.url.placeholder"),validator:b.proxy(m._cameraPublicInfo.validateEmbeddedLinkUrl,m._cameraPublicInfo),setter:function(o,n){m._publicInfoModifiedData.link=o;
if(n===true&&o!==m._publicInfoStoredData.link&&!(o===""&&m._publicInfoStoredData.link===null)){m._publicInfoModified=true;if(m._publicInfoSaving){m._publicInfoModifiedWhileSaving=true}m._savePublicInfo().always(m._publicInfoEditingFinishedCallback)
}else{if(m._publicInfoEditingFinishedCallback){m._publicInfoEditingFinishedCallback()}}}});m._publicInfoFields.link_text=new l({cssClassNames:"b-public_info-embedded_link-text",tooltip:e.tr(i,"public_info.embedded_link.text.tooltip"),placeholder:e.tr(i,"public_info.embedded_link.text.placeholder"),validator:b.proxy(m._cameraPublicInfo.validateEmbeddedLinkText,m._cameraPublicInfo),setter:function(o,n){m._publicInfoModifiedData.link_text=o;
if(n===true&&o!==m._publicInfoStoredData.link_text&&!(o===""&&m._publicInfoStoredData.link_text===null)){m._publicInfoModified=true;if(m._publicInfoSaving){m._publicInfoModifiedWhileSaving=true}m._savePublicInfo().always(m._publicInfoEditingFinishedCallback)
}else{if(m._publicInfoEditingFinishedCallback){m._publicInfoEditingFinishedCallback()}}}});if(m._embedOptions.tvInfoEnabled){m._publicInfoFields.description=new l({cssClassNames:"b-public_info-description",type:"textarea",tooltip:e.tr(i,"public_info.description.tooltip"),placeholder:e.tr(i,"public_info.description.placeholder"),validator:b.proxy(m._cameraPublicInfo.validateDescription,m._cameraPublicInfo),setter:function(o,n){m._publicInfoModifiedData.description=o;
if(n===true&&o!==m._publicInfoStoredData.description&&!(o===""&&m._publicInfoStoredData.description===null)){m._publicInfoModified=true;if(m._publicInfoSaving){m._publicInfoModifiedWhileSaving=true}m._savePublicInfo().always(m._publicInfoEditingFinishedCallback)
}else{if(m._publicInfoEditingFinishedCallback){m._publicInfoEditingFinishedCallback()}}}});m._publicInfoFields.comments=new l({context:m,cssClassNames:"b-public_info-comments",type:"select",selectItems:m._cameraPublicInfo.getCommentsEngines(),setterOnInputEnabled:true,setter:function(o,n){m._publicInfoModifiedData.comments=o;
if(n===true&&o!==m._publicInfoStoredData.comments&&!(o===""&&m._publicInfoStoredData.comments===null)){m._publicInfoModified=true;if(m._publicInfoSaving){m._publicInfoModifiedWhileSaving=true}m._savePublicInfo().always(m._publicInfoEditingFinishedCallback)
}else{if(m._publicInfoEditingFinishedCallback){m._publicInfoEditingFinishedCallback()}}}})}m.$publicInfoWrapper=b('<div class="b-panel b-public_info"><div class="b-panel-title">'+e.tr(i,"public_info.embedded_link.title")+'</div><div class="b-panel-title-hint m-embedded_link">'+e.tr(i,"public_info.embedded_link.title_hint")+'</div><div class="b-public_info-fields m-embedded_link" />'+(m._embedOptions.tvInfoEnabled?'<div class="b-panel-title">'+e.tr(i,"public_info.tv.title",{tv_home_url:m._cameraPublicInfo.getPublicHomeUrl()})+'</div><div class="b-panel-title-hint m-tv">'+e.tr(i,"public_info.tv.title_hint",{tv_home_url:m._cameraPublicInfo.getPublicHomeUrl()})+'</div><div class="b-public_info-fields m-tv" />':"")+"</div>");
m.$publicInfoWrapper.find(".b-public_info-fields.m-embedded_link").append(m._publicInfoFields.link.getElement()).append(m._publicInfoFields.link_text.getElement()).end();if(m._embedOptions.tvInfoEnabled){m.$publicInfoWrapper.find(".b-public_info-fields.m-tv").append(m._publicInfoFields.description.getElement()).append('<div class="b-public_info-comments_label">'+e.tr(i,"public_info.comments_label")+"</div>").append(m._publicInfoFields.comments.getElement()).end()
}m._setPublicInfoFieldsEnabled(false);m._getPublicInfo().done(function(){m._setPublicInfoFieldsEnabled(true)})}m.$wrapper=b('<div class="ivideon-video-embed-dialog-wrapper" />').append(m.$btsShareType).append(m.$tvLinkWrapper).append(m.$embedWrapper).append(m.$publicInfoWrapper).dialog({autoOpen:false,modal:true,width:(m._options.embedded?"100%":"auto"),resizable:false,buttons:k,position:(m._options.embedded?["middle",0]:"center"),title:e.tr(i,"dialog.title",{serverName:e.utils.htmlencode(m._camera.server?m._camera.server.name||"":""),cameraName:e.utils.htmlencode(m._camera.name||"")}),open:function(){e.utils.JQueryUIModalDialogOverlayFix.onModalOpened(b(this));
m._selectDefaultEmbedSizeButton(m.$sizeSelectionButtons);m._setPanelsSize();m.setCurrentPanel("tv_link");m.$btsShareType.buttonset("refresh");m.$embedWrapper.css("visibility","inherit");b(this).dialog("option","width","auto")
},beforeClose:function(){var o=true,n=function(){if(!o){if(m.$wrapper){m.$wrapper.dialog("close")}}};if(m._finishEditingPublicInfo(m.$previewButton.add(m.$closeButton),n)){o=false;return false}},close:function(){e.utils.JQueryUIModalDialogOverlayFix.onModalClosed(b(this));
m.destroy()},dragStop:function(){e.utils.JQueryUIModalDialogOverlayFix.onModalMoved(b(this))},resizeStop:function(){e.utils.JQueryUIModalDialogOverlayFix.onModalResized(b(this))}});m.$wrapper.dialog("widget").addClass("ivideon-video-embed-dialog"+(m._options.embedded?" m-embedded":"")).css("box-sizing","border-box");
m.$wrapper.dialog("widget").find(".ui-dialog-buttonpane .ui-button").addClass("iv-btn");if(m._options.closePublicAccessButton){m.$wrapper.dialog("widget").find(".ui-dialog-buttonpane").append(b("<div/>").addClass("ui-dialog-buttonset").css("float","left").append(m.$closePublicAccess))
}m.$previewButton=m.$wrapper.dialog("widget").find(".ui-dialog-buttonpane .b-button-preview");m.$closeButton=m.$wrapper.dialog("widget").find(".b-button-close");m.setCurrentPanel("embed",false);m.events.on("dialogSizeChanged",f._onSelectedEmbedSizeChanged,m);
m._onWindowResizeTimer=null;b(d).bind("resize orientationchange",m._onWindowResizeHandler=function(){if(m._onWindowResizeHandler){b(d).unbind("resize orientationchange",m._onWindowResizeHandler);m._onWindowResizeHandler=null
}if(m._state===h.STATE_DESTROYED){return}m._setPanelsSize();if(m._onWindowResizeTimer){d.clearTimeout(m._onWindowResizeTimer);m._onWindowResizeTimer=null}m._onWindowResizeTimer=d.setTimeout(function(){if(m._state===h.STATE_DESTROYED){return
}b(d).bind("resize orientationchange",m._onWindowResizeHandler)},200)});m._setState(h.STATE_CREATED)}h.STATE_CREATED=1;h.STATE_VISIBLE=2;h.STATE_DESTROYED=3;h.defaults={closePublicAccessButton:false,previewButton:true,publicInfoEnabled:false,embedded:false};
f.show=function(){var j=this;if(j._state!==h.STATE_CREATED){return}j._setState(h.STATE_VISIBLE);j.$wrapper.dialog("open");j.events.fire("show")};f.getCurrentPanel=function(){var j=this;if(j._state===h.STATE_DESTROYED){return
}return j.$btsShareType.find("button.m-selected").attr("data-panel")};f.setCurrentPanel=function(j,k){var l=this;if(l._state===h.STATE_DESTROYED){return}if(k!==false){l.$btsShareType.find("button.m-selected").removeClass("m-selected");
l.$btsShareType.find("button[data-panel="+j+"]").addClass("m-selected").focus()}l.$wrapper.find(".b-panel").hide();l.$wrapper.find(".b-"+j).show()};f.destroy=function(){var k=this,j;if(k._state===h.STATE_DESTROYED){return
}if(k._onWindowResizeHandler){b(d).unbind("resize orientationchange",k._onWindowResizeHandler);k._onWindowResizeHandler=null}if(k._onWindowResizeTimer){d.clearTimeout(k._onWindowResizeTimer);k._onWindowResizeTimer=null
}k._setState(h.STATE_DESTROYED);k.events.fire("destroying");k.events.un();if(k._embedPreview){k._embedPreview.destroy();k._embedPreview=null}k._publicInfoGetting=null;e.utils.JQueryUIModalDialogOverlayFix.onModalClosed(k.$wrapper);
k.$wrapper.remove();for(j in k){if(k.hasOwnProperty(j)&&j.charAt(0)==="$"){delete k[j]}}};f._createSocialButtons=function(){var m=this,l=e.app.getConfig("app.language"),k=(m._socialButtonsOptions?m._socialButtonsOptions[l]:null);
if(k){var j={container:m.$tvLinkWrapper,url:m.tvLink,buttonSize:42,preview:m.cameraPreviewUrl,title:null,buttons:k};m._socialButtons=new (e.require("ivideon.views.SocialButtons"))(j);b(d).on("resize orientationchange",function(){var o=j.buttonSize,n=m._socialButtons.$wrapper.width(),p=parseInt(m._socialButtons.$wrapper.find(".b-social-button").css("margin-right"),10);
if(n>0&&n<(k.length*(o+p))){m._socialButtons.setIconSize(24)}else{m._socialButtons.setIconSize(o)}})}};f._appendSizeSelectionButtons=function(m){var o=this,j=o._embedOptions.defaultWidths||[],k,l,n;b.each(j,function(q,r){var p=Math.ceil(o._camera.height*r/o._camera.width),s;
if(r>=o._embedOptions.minWidth&&p>=o._embedOptions.minHeight){s=o._createSizeButton(r,p,q);m.append(s)}});l=b('<input type="text" size="6" maxlength="4" />').attr("title",e.tr(i,"embed.custom_size.width")).data("dimension","width");
n=b('<input type="text" size="6" maxlength="4" />').attr("title",e.tr(i,"embed.custom_size.height")).data("dimension","height");k=b("<div/>").addClass("b-size_button m-custom_size").append('<div class="b-title">'+e.tr(i,"embed.custom_size.title")+"</div>").append(l).append(" x ").append(n).click(function(){var p=b(this);
o.events.fire("dialogSizeChanged",{$selectedButton:p,width:l.val(),height:n.val()})});b([l[0],n[0]]).bind("blur keyup input cut paste",function(q){var p=b(this),r;r=o._cameraPublicInfo.propagateEmbedSize(p.val(),p.data("dimension"),(q.type==="blur"));
if(typeof r.width!=="undefined"){l.val(r.width)}if(typeof r.height!=="undefined"){n.val(r.height)}o.events.fire("dialogSizeChanged",{$selectedButton:k,width:l.val(),height:n.val()})});if(j.length>0){l.val(j[j.length-1]).blur()
}else{l.val(o._embedOptions.minWidth).blur()}m.append(k)};f._selectDefaultEmbedSizeButton=function(m){var n=this,j,k,l;if(n._state===h.STATE_DESTROYED){return}j=m.find(".b-size_button.m-selected");if(j.is(":visible")){return
}k=m.find(".b-size_button:visible");l=k.filter(":not(.m-custom_size)");n._selectEmbedSizeButton(l.length?l.filter(":last"):k.filter(":last"))};f._createSizeButton=function(l,j,k){var m=this;return b("<div/>").addClass("b-size_button b-size_button-"+(k+1)).attr("title",String(l+"x"+j)).data("width",l).data("height",j).append('<div class="b-title">'+l+"x"+j+'</div><div class="b-sample" style="width:'+(l/5)+"px; height:"+(j/5)+'px;"></div>').click(function(){var n=b(this);
m._selectEmbedSizeButton(n)})};f._selectEmbedSizeButton=function(j){var k=this;if(k._state===h.STATE_DESTROYED){return}k.events.fire("dialogSizeChanged",{$selectedButton:j,width:j.data("width"),height:j.data("height")})
};f._onSelectedEmbedSizeChanged=function(k,j){var l=this;if(l._state===h.STATE_DESTROYED){return}if(j.$selectedButton){l.$sizeSelectionButtons.find(".b-size_button").removeClass("m-selected");j.$selectedButton.addClass("m-selected")
}l._cameraPublicInfo.setEmbedCodeOptions({width:j.width,height:j.height});l.$codeArea.val(l._cameraPublicInfo.getEmbedCode())};f._setPanelsSize=function(){var m=this,k=0,j=0,l;if(m._state===h.STATE_DESTROYED){return
}l=m.$wrapper.find(".b-panel:visible");m.$embedWrapper.show();m.$embedWrapper.css("width","100%");k=m.$embedWrapper.find(".b-size_selection_buttons").outerWidth();k+=1;m.$wrapper.find(".b-panel").hide().each(function(){var o=b(this).show(),n=o.css("height","").outerHeight();
if(n>j){j=n}o.hide()}).width(k||"auto").height(j||"auto");l.show()};f._setState=function(j){var k=this;if(!j){throw new Error("state")}if(k._state===h.STATE_DESTROYED){return}k._state=j};f._displayPublicInfo=function(){var l=this,k,j;
if(l._state===h.STATE_DESTROYED){return}for(k in l._publicInfoFields){if(l._publicInfoFields.hasOwnProperty(k)){j=l._publicInfoStoredData[k];if(typeof l._publicInfoModifiedData[k]==="undefined"||l._publicInfoModifiedData[k]===j||l._publicInfoFields[k].isValid()){if(!l._publicInfoFields[k].isEditing()&&!l._publicInfoFields[k].isFocused()){l._publicInfoFields[k].display(j)
}}}}};f._setPublicInfoFieldsEnabled=function(j){var l=this,k;if(l._state===h.STATE_DESTROYED){return}for(k in l._publicInfoFields){if(l._publicInfoFields.hasOwnProperty(k)){l._publicInfoFields[k].setEnabled(j)
}}};f._getPublicInfo=function(){var l=this,j,k=b.Deferred();if(!e.app||e.app.isEnded()){return k.reject().promise()}if(l._state===h.STATE_DESTROYED){return k.reject().promise()}if(l._publicInfoGetting){return l._publicInfoGetting.promise()
}l.$btnPublicInfo.addClass("m-progress");l._publicInfoGetting=k;j=l._cameraPublicInfo.load().done(function(){if(!e.app||e.app.isEnded()){return}if(l._state===h.STATE_DESTROYED){return}k.resolve()}).fail(function(m){if(!e.app||e.app.isEnded()){return
}if(l._state===h.STATE_DESTROYED){return}k.reject(m)});k.done(function(){var n=l._cameraPublicInfo.getData();var m;if(n.misc){for(m in l._publicInfoFields){if(l._publicInfoFields.hasOwnProperty(m)&&n.misc.hasOwnProperty(m)){l._publicInfoStoredData[m]=n.misc[m];
if(typeof l._publicInfoModifiedData[m]==="undefined"){l._publicInfoModifiedData[m]=l._publicInfoStoredData[m]}}}}}).fail(function(m){e.utils.notifyError({text:e.tr(i,"public_info.get.error")})}).always(function(){l._publicInfoGetting=null;
l._displayPublicInfo();l.$btnPublicInfo.removeClass("m-progress")});return k.promise()};f._savePublicInfo=function(){var m=this,j,l=b.Deferred(),k;if(!e.app||e.app.isEnded()){return l.reject().promise()
}if(m._state===h.STATE_DESTROYED){return l.reject().promise()}if(!m._publicInfoModified){return l.resolve().promise()}if(m._publicInfoSavingPending){return m._publicInfoSavingPending.promise()}if(m._publicInfoSaving){if(m._publicInfoModifiedWhileSaving){m._publicInfoSavingPending=l;
m._publicInfoSaving.always(function(){m._publicInfoSavingPending=null;m._savePublicInfo().done(function(n){l.resolve(n)}).fail(function(n){l.reject(n)})});return m._publicInfoSavingPending.promise()}return m._publicInfoSaving.promise()
}m.$btnPublicInfo.addClass("m-progress");m._publicInfoSavingStarted=e.now();m._publicInfoSaving=l;k=function(n,o){d.clearTimeout(m._publicInfoSavingFinishedTimer);m._publicInfoSavingFinishedTimer=d.setTimeout(function(){if(m._state===h.STATE_DESTROYED){return
}if(n){l.reject(n)}else{l.resolve(o)}},Math.max(500,m._publicInfoSavingStarted-e.now()));m._publicInfoSavingStarted=0};j=m._cameraPublicInfo.saveMisc(m._publicInfoModifiedData).done(function(n){if(!e.app||e.app.isEnded()){return
}if(m._state===h.STATE_DESTROYED){return}k(null,n.info)}).fail(function(n){if(!e.app||e.app.isEnded()){return}if(m._state===h.STATE_DESTROYED){return}k(n)});l.done(function(o){var n;if(o.misc){for(n in m._publicInfoStoredData){if(m._publicInfoStoredData.hasOwnProperty(n)&&o.misc.hasOwnProperty(n)){m._publicInfoStoredData[n]=o.misc[n]
}}}m._publicInfoModified=false;if(m._publicInfoModifiedWhileSaving){m._publicInfoModifiedWhileSaving=false;m._savePublicInfo()}}).fail(function(n){e.utils.notifyError({text:e.tr(i,"public_info.save.error")})
}).always(function(){m._publicInfoSaving=null;m._displayPublicInfo();m.$btnPublicInfo.removeClass("m-progress")});return l.promise()};f._finishEditingPublicInfo=function(k,o){var n=this,m,l,j;if(!e.app||e.app.isEnded()){return
}if(n._state===h.STATE_DESTROYED){return}m=n.getCurrentPanel();j=function(){if(n._state===h.STATE_DESTROYED){return}if(k){k.button("enable")}n._publicInfoEditingFinishedCallback=null;if(o){o();o=null}};
if(m==="public_info"){if(n._publicInfoFields){for(l in n._publicInfoFields){if(n._publicInfoFields.hasOwnProperty(l)){if(n._publicInfoFields[l].isEditing()){if(k){k.button("disable")}n._publicInfoEditingFinishedCallback=j;
n._publicInfoFields[l].finishEditing();return true}}}if(n._publicInfoModified){if(k){k.button("disable")}n._savePublicInfo().always(j);return true}}}j();return false}}(window,window._ivideon));(function(e,f,a){"use strict";
var b=f.$,h=c,g=h.prototype,d="ivideon.views.VideoAbuseDialog",i=d;f.provide(d,h);function c(j){var l=this,k={};l._options=f.optClass(h.defaults,j,d,l,{_camera:"camera"});l.events=new (f.require("ivideon.utils.Observable"))(l);
l._serviceName=f.app.getConfig("app.name");k=[];k.push({text:f.tr(i,"abuse.submit"),click:function(){if(l.$wrapper){l.$topicSelect.prop("disabled",true);l.$commentInput.prop("disabled",true);l.$emailInput.prop("disabled",true);
l.$wrapper.dialog("widget").find(".ui-button").button("disable");l._sendAbuse().done(function(){l.$wrapper.dialog("close")}).fail(function(){l.$topicSelect.prop("disabled",false);l.$commentInput.prop("disabled",false);
l.$emailInput.prop("disabled",false);l.$wrapper.dialog("widget").find(".ui-button").button("enable")})}}});k.push({"class":"ui-priority-secondary",text:f.tr(i,"abuse.cancel"),click:function(){if(l.$wrapper){l.$wrapper.dialog("close")
}}});l.$topicSelect=l._generateTopicsList();l.$commentInput=b('<textarea class="b-comment" placeholder="'+f.trQuoteEnc(i,"abuse.comment.placeholder")+'"></textarea>');l.$emailInput=b('<input class="b-email" type="email" placeholder="'+f.trQuoteEnc(i,"abuse.email.placeholder")+'" />');
l._cameraPublicInfo=new (f.require("ivideon.models.CameraPublicInfo"))({camera:l._camera,embedOptions:f.app.getConfig("embedOptions")});l.$abuseWrapper=b('<div class="b-panel"><div class="b-panel-title">'+f.tr(i,"abuse.title")+'</div><div class="b-message">'+f.tr(i,"abuse.message")+'</div><div class="b-disclaimer iv-msg-warning"><span class="icon-warning"></span>&nbsp;<span class="b-disclaimer-text">'+f.tr(i,"abuse.disclaimer",{serviceName:l._serviceName})+'</span></div><div class="b-row"><span class="b-label">'+f.tr(i,"abuse.topic")+'</span><div class="b-topic-wrapper"></div></div><div class="b-row"><span class="b-label">'+f.tr(i,"abuse.comment")+'</span><div class="b-comment-wrapper"></div></div><div class="b-row m-email"><span class="b-label">'+f.tr(i,"abuse.email")+'</span><div class="b-email-wrapper"></div></div></div>').find(".b-topic-wrapper").append(l.$topicSelect).end().find(".b-comment-wrapper").append(l.$commentInput).end().find(".b-email-wrapper").append(l.$emailInput).end();
l.$wrapper=(f.require("ivideon.utils.dlg.message"))({classes:"ivideon-video-abuse-dialog",width:"100%",position:["middle",0],title:f.tr(i,"dialog.title"),message:b('<div class="ivideon-video-abuse-dialog-wrapper" />').append(l.$abuseWrapper),buttons:k,autoOpen:false,cancelHandler:function(){l.destroy()
}});l._setState(h.STATE_CREATED)}h.TOPIC_DEFAULT="default";h.TOPIC_OTHER="other";h.defaults={cameraCommentsAvailable:false,topics:[h.TOPIC_DEFAULT,"spam","hate","violence","copyright","sexual","public_info",h.TOPIC_OTHER]};
h.STATE_CREATED=1;h.STATE_VISIBLE=2;h.STATE_DESTROYED=3;g.show=function(){var j=this;if(j._state===h.STATE_VISIBLE){return}j._setState(h.STATE_VISIBLE);j._cameraPublicInfo.load().always(function(){if(j._state===h.STATE_DESTROYED){return
}var l=j.$wrapper.find(".b-disclaimer-text"),k=j._cameraPublicInfo.getData();if(j._options.cameraCommentsAvailable&&!k.comments_banned){l.html(f.tr(i,"abuse.disclaimer.with_comments",{serviceName:j._serviceName}))
}j.$wrapper.dialog("open")})};g.destroy=function(){var j=this;if(j._state===h.STATE_DESTROYED){return}j._setState(h.STATE_DESTROYED);j.events.fire("destroying");j.events.un();j.$wrapper.remove()};g._generateTopicsList=function(){var m=this,k,l=m._options.topics,j=b('<select class="b-topic" />');
for(k=0;k<l.length;k++){j.append('<option value="'+l[k]+'">'+f.tr(i,"abuse.topic."+l[k])+"</option>")}return j};g._sendAbuse=function(){var m=this,k,l,j;if(m._state===h.STATE_DESTROYED){return b.Deferred().reject().promise()
}k=m.$topicSelect.find("option:selected").val();l=b.trim(m.$commentInput.val()||"");j=b.trim(m.$emailInput.val()||"");if((k!==h.TOPIC_DEFAULT&&k!==h.TOPIC_OTHER)||l!==""){if(m._options.controller&&m._options.controller.reportAbuse){return m._options.controller.reportAbuse({topic:k,comment:l,email:j})
}}else{if(k===h.TOPIC_OTHER){e.setTimeout(function(){if(m.$commentInput[0]){m.$commentInput[0].focus();m.$commentInput[0].select()}},0)}}return b.Deferred().reject().promise()};g._setState=function(j){var k=this;
if(!j){throw new Error("state")}if(k._state===h.STATE_DESTROYED){return}k._state=j}}(window,window._ivideon));(function(e,f,a){"use strict";var c=f.$,h=b,g=h.prototype,d="ivideon.views.CameraPublishWizard",i=d;
f.provide(d,h);function b(s){var q=this;q._options=f.optClass(h.defaults,s,d,q,{_camera:"camera",_embedOptions:"embedOptions ?",_socialButtonsOptions:"socialButtons ?"});q._embedOptions=q._embedOptions||f.app.getConfig("embedOptions");
q._socialButtonsOptions=q._socialButtonsOptions||f.app.getConfig("socialButtons");q.events=new (f.require("ivideon.utils.Observable"))(q);q._cameraPublicInfo=new (f.require("ivideon.models.CameraPublicInfo"))({camera:q._camera,embedOptions:q._embedOptions});
q._embedPreview=null;q._overlay=null;q._isOwner=q._camera.isOwnCamera();q._isFirstPublish=q._isFirstPublishViaWizard=false;var r=function(){return false};q._currentStep=-1;q._visibleStep=-1;q._steps=[{title:f.tr(i,"step.name_description"),init:function(){var u=this;
if(!q._isOwner){c("<p>"+(c.trim(q._camera.name||"")||('<span class="b-value-empty">'+f.tr(i,"name.empty.not_owner")+"</span>"))+"</p>").appendTo(c("<div/>").appendTo(u.$body));c("<p>"+(c.trim(q._cameraPublicInfo.getData().misc.description||"")||('<span class="b-value-empty">'+f.tr(i,"description.empty.not_owner")+"</span>"))+"</p>").appendTo(c("<div/>").appendTo(u.$body));
return}u._nameValid=false;u._descriptionValid=false;u._nameModified=false;u._descriptionModified=false;u._nameField=new (f.require("ivideon.views.EditableField"))({cssClassNames:"b-name-field",tooltip:(f.trSilent(i,"name.tooltip")||""),placeholder:f.tr(i,"name.placeholder"),validator:c.proxy(q._cameraPublicInfo.validateName,q._cameraPublicInfo),setterOnInputEnabled:true,setter:function(x,w,v){u._nameValid=w;
u._nameModified=(u._nameWithDefault(x)!==u._nameWithDefault(q._camera.name));q._updateBindings();if(v&&c.trim(x)!==x){u._nameField.val(c.trim(x));return}}});u._descriptionField=new (f.require("ivideon.views.EditableField"))({cssClassNames:"b-description-field",type:"textarea",tooltip:(f.trSilent(i,"description.tooltip")||""),placeholder:f.tr(i,"description.placeholder"),validator:c.proxy(q._cameraPublicInfo.validateDescription,q._cameraPublicInfo),setterOnInputEnabled:true,setter:function(x,w,v){u._descriptionValid=w;
u._descriptionModified=(u._descriptionWithDefault(x)!==u._descriptionWithDefault(q._cameraPublicInfo.getData().misc.description));q._updateBindings();if(v&&c.trim(x)!==x){u._descriptionField.val(c.trim(x));
return}}});var t=c('<div class="b-form"><div class="b-row"><label>'+f.tr(i,"name.label")+'</label><div class="b-name-field-container"></div></div><div class="b-row"><label>'+f.tr(i,"description.label")+'</label><div class="b-description-field-container"></div></div><div class="b-row b-small-note">'+f.tr(i,"name_description_info")+"</div></div>").appendTo(u.$body);
t.find(".b-name-field-container").append(u._nameField.getElement());t.find(".b-description-field-container").append(u._descriptionField.getElement());q._createStepSaveButton(u);u.reset();u._wasInvalid=(!u._nameValid||!u._descriptionValid)
},reset:function(){var t=this;if(!q._isOwner){return}t._nameField.val(t._nameWithDefault(q._camera.name));t._descriptionField.val(t._descriptionWithDefault(q._cameraPublicInfo.getData().misc.description))
},destroy:function(){var t=this;if(t._nameField){t._nameField.destroy();t._nameField=null}if(t._descriptionField){t._descriptionField.destroy();t._descriptionField=null}},_nameWithDefault:function(t){return(t||"")
},_descriptionWithDefault:function(t){return(t||"")},save:function(){var x=this;if(!q._isOwner){return}var u=c.Deferred();if(!x.isValid()){if(!x._nameValid){return u.reject(new Error(f.tr(i,"name.error.invalid"))).promise()
}if(!x._descriptionValid){return u.reject(new Error(f.tr(i,"description.error.invalid"))).promise()}}var t=x._nameWithDefault(x._nameField.val());var v=x._descriptionWithDefault(x._descriptionField.val());
var w=(t===x._nameWithDefault(q._camera.name)?c.Deferred().resolve():q._camera.setName(t)).done(function(){x._nameModified=false});var y=(v===x._descriptionWithDefault(q._cameraPublicInfo.getData().misc.description)?c.Deferred().resolve():q._savePublicInfo({description:v})).done(function(){x._descriptionModified=false
});return c.when(w,y).promise()},isModified:function(){var t=this;return(t._nameModified||t._descriptionModified)},isValid:function(){var t=this;return(t._nameValid&&t._descriptionValid)||(t._wasInvalid&&r())
}},{title:f.tr(i,"step.location"),init:function(){var t=this;t._coordsAuto=q._cameraPublicInfo.getCoords("auto");t._coords=q._cameraPublicInfo.getCoords("user");t._coordsModified=false;if(!q._isOwner&&!t._coords){c('<p><span class="b-value-empty">'+f.tr(i,"coords.empty.not_owner")+"</span></p>").appendTo(c("<div/>").appendTo(t.$body));
return}t._mapMarkerCameraStyle=f.utils.convertIntegerCSS(f.utils.extractCSS("iv-map-marker-camera",["backgroundImage","width","height","minWidth","minHeight"],t.$body));t._mapMarkerCameraImageUrl=f.utils.extractBackgroundImageUrl(t._mapMarkerCameraStyle);
if(q._isOwner){c("<p>"+f.tr(i,"coords.intro",{tv_home_url:q._cameraPublicInfo.getPublicHomeUrl()})+"</p>").appendTo(c("<div/>").appendTo(t.$body));c("<label>"+f.tr(i,"coords.label")+"</label>").appendTo(c("<div/>").appendTo(t.$body))
}t.$map=c('<div class="b-map-wrapper"></div>').appendTo(t.$body);t.$loading=c('<div class="iv-msg-info">'+f.tr(i,"loading_map")+"</div>").appendTo(t.$map);t.$error=c('<div class="iv-msg-error" style="display: none;">'+f.tr(i,"loading_map_error")+"</div>").appendTo(t.$map);
if(q._isOwner){q._createStepSaveButton(t)}t._wasInvalid=(!t._coords);f.utils.getGoogleMaps().fail(function(){t.$loading.hide();t.$error.show()})},reset:function(){var t=this;if(!q._isOwner){return}t._coords=q._cameraPublicInfo.getCoords("user");
t._coordsModified=false;if(t._map){if(t._marker){t._marker.setMap(null);t._marker=null}f.utils.getGoogleMaps().done(function(u){t._map.setCenter(t._getMapCenter(u));t._createMarker(u,u.Animation.DROP);
q._updateBindings()})}},_getMapCenter:function(t){var u=this;return(u._coords?new t.LatLng(u._coords[0],u._coords[1]):(u._coordsAuto?new t.LatLng(u._coordsAuto[0],u._coordsAuto[1]):new t.LatLng(0,0)))},_createMarker:function(t,v){var u=this;
if(t&&u._map&&u._coords&&!u._marker){u._marker=new t.Marker({position:new t.LatLng(u._coords[0],u._coords[1]),map:u._map,draggable:q._isOwner,clickable:false,icon:u._markerIcon,shadow:null,raiseOnDrag:false,animation:null});
if(q._isOwner){t.event.addListener(u._marker,"dragend",function(){var w=u._marker.getPosition();u._coords=[w.lat(),w.lng()];u._coordsModified=true;u._map.setCenter(u._getMapCenter(t));q._updateBindings()
})}}},_createMap:function(t){var u=this;if(t){if(!u._map){u.$map.empty();u._mapOptions={zoom:(u._coords?10:2),center:u._getMapCenter(t),draggable:true,scrollwheel:true,disableDefaultUI:true,mapTypeControl:true,streetViewControl:false,zoomControl:true,mapTypeId:t.MapTypeId.ROADMAP};
u._markerIcon={anchor:new t.Point(u._mapMarkerCameraStyle.minWidth,u._mapMarkerCameraStyle.minHeight),url:u._mapMarkerCameraImageUrl};u._map=new t.Map(u.$map[0],u._mapOptions);if(q._isOwner){t.event.addListener(u._map,"click",function(v){if(!u._marker){u._coords=[v.latLng.lat(),v.latLng.lng()];
u._createMarker(t,t.Animation.DROP);u._coordsModified=true;q._updateBindings()}})}}}},show:function(){var t=this;if(!q._isOwner&&!t._coords){return}f.utils.getGoogleMaps().done(function(u){t._createMap(u);
t._createMarker(u,null);q._updateBindings()})},save:function(){var w=this;if(!q._isOwner){return}var u=c.Deferred();if(!w.isValid()){if(!w._coords){return u.reject(new Error(f.tr(i,"coords.error.empty"))).promise()
}}var v=q._cameraPublicInfo.getCoords("user");var x=w._coords;var t=((v&&x[0]===v[0]&&x[1]===v[1])?c.Deferred().resolve():q._cameraPublicInfo.saveGeo(x)).done(function(){w._coordsModified=false});return t.promise()
},isModified:function(){var t=this;return(t._coordsModified)},isValid:function(){var t=this;return(!!t._coords)||(t._wasInvalid&&r())}},{title:f.tr(i,(q._isOwner?"step.link.owner":"step.link.not_owner")),init:function(){var u=this;
if(!q._isOwner){u.$linkExample=c("<div></div>").appendTo(u.$body);u._updateLinkExample();return}u._linkValid=false;u._linkTextValid=false;u._linkModified=false;u._linkTextModified=false;u._linkField=new (f.require("ivideon.views.EditableField"))({cssClassNames:"b-link-field",tooltip:(f.trSilent(i,"link.tooltip")||""),placeholder:f.tr(i,"link.placeholder"),validator:c.proxy(q._cameraPublicInfo.validateEmbeddedLinkUrl,q._cameraPublicInfo),setterOnInputEnabled:true,setter:function(x,w,v){u._linkValid=w;
u._linkModified=(u._linkWithDefault(x)!==u._linkWithDefault(q._cameraPublicInfo.getData().misc.link));u._updateLinkExample();q._updateBindings();if(v&&c.trim(x)!==x){u._linkField.val(c.trim(x));return}}});
u._linkTextField=new (f.require("ivideon.views.EditableField"))({cssClassNames:"b-link_text-field",tooltip:(f.trSilent(i,"link_text.tooltip")||""),placeholder:f.tr(i,"link_text.placeholder"),validator:c.proxy(q._cameraPublicInfo.validateEmbeddedLinkText,q._cameraPublicInfo),setterOnInputEnabled:true,setter:function(x,w,v){u._linkTextValid=w;
u._linkTextModified=(u._linkTextWithDefault(x)!==u._linkTextWithDefault(q._cameraPublicInfo.getData().misc.link_text));u._updateLinkExample();q._updateBindings();if(v&&c.trim(x)!==x){u._linkTextField.val(c.trim(x));
return}}});var t=c('<div class="b-form"><div class="b-row"><label>'+f.tr(i,"link.label")+'</label><div class="b-link-field-container"></div></div><div class="b-row"><label>'+f.tr(i,"link_text.label")+'</label><div class="b-link-text-field-container"></div></div><div class="b-row"><label>'+f.tr(i,"link_example.label")+'</label><div class="b-link-example-container"></div></div></div>').appendTo(u.$body);
u.$linkExample=c("<div/>");t.find(".b-link-field-container").append(u._linkField.getElement());t.find(".b-link-text-field-container").append(u._linkTextField.getElement());t.find(".b-link-example-container").append(u.$linkExample);
q._createStepSaveButton(u);u.reset();u._wasInvalid=(!u._linkValid||!u._linkTextValid)},reset:function(){var t=this;if(!q._isOwner){return}t._linkField.val(t._linkWithDefault(q._cameraPublicInfo.getData().misc.link));
t._linkTextField.val(t._linkTextWithDefault(q._cameraPublicInfo.getData().misc.link_text))},destroy:function(){var t=this;if(t._linkField){t._linkField.destroy();t._linkField=null}if(t._linkTextField){t._linkTextField.destroy();
t._linkTextField=null}},_linkWithDefault:function(t){return(t||"")},_linkTextWithDefault:function(t){return(t||"")},_updateLinkExample:function(){var v=this;var u=(v._linkValid?v._linkField.val():"");var t=(v._linkTextValid?v._linkTextField.val():"");
if(u){v.$linkExample.html('<a class="b-link-example m-anchor" href="'+f.utils.htmlencode(u)+'" target="_blank">'+f.utils.htmlencode(t||u)+"</a>")}else{if(t){v.$linkExample.html('<div class="b-link-example">'+f.utils.htmlencode(t)+"</div>")
}else{v.$linkExample.html('<div class="b-link-example-empty">'+f.tr(i,(q._isOwner?"link_example.empty.owner":"link_example.empty.not_owner"))+"</div>")}}},save:function(){var w=this;if(!q._isOwner){return
}var u=c.Deferred();if(!w.isValid()){if(!w._linkValid){return u.reject(new Error(f.tr(i,"link.error.invalid"))).promise()}if(!w._linkTextValid){return u.reject(new Error(f.tr(i,"link_text.error.invalid"))).promise()
}}var v=w._linkWithDefault(w._linkField.val());var x=w._linkTextWithDefault(w._linkTextField.val());if(!w._linkValid){v=a}if(!w._linkTextValid){x=a}var t=(v===w._linkWithDefault(q._cameraPublicInfo.getData().misc.link)&&x===w._linkTextWithDefault(q._cameraPublicInfo.getData().misc.link_text)?c.Deferred().resolve():q._savePublicInfo({link:v,link_text:x})).done(function(){w._linkModified=w._linkTextModified=false
});return t.promise()},isModified:function(){var t=this;return(t._linkModified||t._linkTextModified)},isValid:function(){var t=this;return(t._linkValid&&t._linkTextValid)||(t._wasInvalid&&r())}},{title:f.tr(i,"step.comments"),init:function(){var x=this;
if(!q._isOwner){var y=x._commentsWithDefault(q._cameraPublicInfo.getData().misc.comments);var v=q._cameraPublicInfo.getCommentsEngines();var w,t;for(t=v.length,w=0;w<t;++w){if(v[w].value===y){c("<p>"+v[w].text+"</p>").appendTo(c("<div/>").appendTo(x.$body));
break}}c('<div class="b-small-note">'+f.tr(i,"comments_info",{tv_home_url:q._cameraPublicInfo.getPublicHomeUrl()})+"</div>").appendTo(x.$body);return}x._commentsValid=false;x._commentsModified=false;x._commentsField=new (f.require("ivideon.views.EditableField"))({cssClassNames:"b-comments-field",type:"select",selectItems:q._cameraPublicInfo.getCommentsEngines(),setterOnInputEnabled:true,setter:function(A,z){x._commentsValid=z;
x._commentsModified=(x._commentsWithDefault(A)!==x._commentsWithDefault(q._cameraPublicInfo.getData().misc.comments));q._updateBindings()}});var u=c('<div class="b-form"><div class="b-row">'+f.tr(i,"comments.intro",{tv_home_url:q._cameraPublicInfo.getPublicHomeUrl()})+'</div><div class="b-row"><label>'+f.tr(i,"comments.label")+'</label><div class="b-comments-field-container"></div></div><div class="b-row b-small-note">'+f.tr(i,"comments_info",{tv_home_url:q._cameraPublicInfo.getPublicHomeUrl()})+"</div></div>").appendTo(x.$body);
u.find(".b-comments-field-container").append(x._commentsField.getElement());q._createStepSaveButton(x);x.reset();x._wasInvalid=(!x._commentsValid)},reset:function(){var t=this;if(!q._isOwner){return}t._commentsField.val(t._commentsWithDefault(q._cameraPublicInfo.getData().misc.comments))
},destroy:function(){var t=this;if(t._commentsField){t._commentsField.destroy();t._commentsField=null}},_commentsWithDefault:function(t){return(t||"default")},saveButtonText:function(){return(q._isFirstPublish?f.tr(i,"publish_button.text"):a)
},save:function(){var x=this;if(!q._isOwner){return}var v=c.Deferred();if(!x.isValid()){if(!x._commentsValid){return v.reject(new Error(f.tr(i,"comments.error.invalid"))).promise()}}var w=x._commentsWithDefault(x._commentsField.val());
var u=(w===x._commentsWithDefault(q._cameraPublicInfo.getData().misc.comments)?c.Deferred().resolve():q._savePublicInfo({comments:w})).done(function(){x._commentsModified=false});var t=u.then(function(){if(q._isFirstPublish){var y=(q._camera.isPublic()?c.Deferred().resolve():q._camera.setPublic(true));
return y}});return t.promise()},isModified:function(){var t=this;return(t._commentsModified)},isValid:function(){var t=this;return(t._commentsValid)||(t._wasInvalid&&r())}},{title:f.tr(i,"step.public_access"),init:function(){var t=this;
var v='<div class="iv-hr"><span class="iv-hr-text">'+f.tr(i,"separator_text")+"</span></div>";t.$publicEndpointsTable=c('<table class="b-table-with-buttons-aside b-public-endpoints-table b-form"><tbody class="b-public-endpoints-wrapper"><tr><td><div><label>'+f.tr(i,(q._isOwner?"public_link.label.owner":"public_link.label.not_owner"))+'</label></div></td><td>&nbsp;</td></tr><tr><td><div><input type="text" class="b-public-link-field" readonly /></div><div class="b-social-buttons-wrapper"></div></td><td><a class="b-public-link-button iv-btn m-inline" target="_blank">'+f.tr(i,"public_link.button")+"</a></td></tr><tr><td>"+v+"</td><td>&nbsp;</td></tr><tr><td><div><label>"+f.tr(i,(q._isOwner?"embed_code.label.owner":"embed_code.label.not_owner"))+'</label></div></td><td>&nbsp;</td></tr><tr><td><div><textarea class="b-embed-code-field" readonly /></div><div class="b-embed-code-size"><label class="b-embed-code-size-label">'+f.tr(i,"embed_size.label")+'</label><select class="b-embed-code-size-list"></select><span class="b-embed-code-size-custom"><input type="text" class="b-embed-code-size-width-field" data-dimension="width" title="'+f.trQuoteEnc(i,"embed_size.custom_width.title")+'" />&nbsp;&times;&nbsp;<input type="text" class="b-embed-code-size-height-field" data-dimension="height" title="'+f.trQuoteEnc(i,"embed_size.custom_height.title")+'" /></span></div></td><td><button type="button" class="b-embed-code-button iv-btn m-inline">'+f.tr(i,"embed_code.button")+'</button></td></tr><tr class="b-public-access-switch-separator"><td>'+v+'</td><td>&nbsp;</td></tr></tbody><tbody class="b-public-access-switch-wrapper"><tr><td><div><label class="b-public-access-switch-label"></label></div></td><td><div class="b-public-access-switch"></div></td></tr></tbody></table>').appendTo(t.$body);
t.$publicEndpointsWrapper=t.$body.find(".b-public-endpoints-wrapper");t.$publicSwitchWrapper=t.$body.find(".b-public-access-switch-wrapper");t.$publicSwitchSeparator=t.$body.find(".b-public-access-switch-separator");
t.$publicLinkField=t.$body.find(".b-public-link-field");t.$publicLinkButton=t.$body.find(".b-public-link-button");t.$publicLabel=t.$body.find(".b-public-access-switch-label");t.$socialButtonsWrapper=t.$body.find(".b-social-buttons-wrapper");
t.$embedCodeField=t.$body.find(".b-embed-code-field");t.$embedCodeButton=t.$body.find(".b-embed-code-button");t.$embedCodeSizeList=t.$body.find(".b-embed-code-size-list");t.$embedCodeSizeCustom=t.$body.find(".b-embed-code-size-custom");
t.$embedCodeSizeCustomWidth=t.$body.find(".b-embed-code-size-width-field");t.$embedCodeSizeCustomHeight=t.$body.find(".b-embed-code-size-height-field");var u=q._cameraPublicInfo.getPublicUrl();var x=f.app.getConfig("app.language");
var w=(q._socialButtonsOptions?q._socialButtonsOptions[x]:null);if(w){t._socialButtons=new (f.require("ivideon.views.SocialButtons"))({container:t.$socialButtonsWrapper,url:u,title:null,buttons:w})}t.$publicLinkField.val(u);
t.$publicLinkButton.attr("href",u||"javascript:void(0)");t._populateEmbedSizeOptions();t.$embedCodeSizeList.on("change",function(){var y=t._getSelectedSize();if(y){t._setSize(y)}else{y=t._getCustomSize();
t._setSize(y,true)}});t.$embedCodeButton.on("click",function(){if(!q._embedPreview){q._embedPreview=new (f.require("ivideon.views.CameraEmbedPreviewDialog"))({cameraPublicInfo:q._cameraPublicInfo})}q._embedPreview.open()
});q._camera.events.on("public-changed",t._onPublicChanged,t);q._camera.events.on("public-update-error",t._onPublicUpdateError,t);if(q._isOwner){t.$publicAccessSwitch=t.$body.find(".b-public-access-switch");
if(t.$publicAccessSwitch.qtip){t.$publicAccessSwitch.qtip(h.qtipConfig)}t._publicAccessSwitch=new (f.require("ivideon.views.ToggleSwitch"))({container:t.$publicAccessSwitch,value:(q._camera.isPublic()?"on":"off"),items:[{value:"on",classes:"m-on",label:f.tr(i,"public_access_switch.value.on")},{value:"off",classes:"m-off",label:f.tr(i,"public_access_switch.value.off")}]});
t._publicAccessSwitch.events.on("switched",function(A,y){var z=(y.value==="on");q._setState(h.STATE_SAVING);q._camera.setPublic(z).always(function(){q._setState(h.STATE_VISIBLE)})})}else{t._displayPublicState(false)
}t.$body.css("visibility","hidden")},destroy:function(){var t=this;q._camera.events.un("public-changed",t._onPublicChanged,t);q._camera.events.un("public-update-error",t._onPublicUpdateError,t);if(t._socialButtons){t._socialButtons.destroy();
t._socialButtons=null}if(t._publicAccessSwitch){t._publicAccessSwitch.destroy();t._publicAccessSwitch=null}},show:function(){var t=this;if(t.$publicEndpointsWrapper.is(":visible")){t._publicEndpointsWrapperHeight=t.$publicEndpointsWrapper.outerHeight()
}t._publicAccessSwitch.updateSize();t._displayPublicState(false)},hide:function(){var t=this;if(t.$publicAccessSwitch.qtip){t.$publicAccessSwitch.qtip("toggle",false)}},_onPublicChanged:function(){var t=this;
t._displayPublicState(true);if(t.$publicAccessSwitch.qtip){t.$publicAccessSwitch.qtip("toggle",false)}},_onPublicUpdateError:function(v,t){var u=this;u._displayPublicState(true);if(u.$publicAccessSwitch.qtip){if(t.error){u.$publicAccessSwitch.qtip("option","content.text",t.error.message);
u.$publicAccessSwitch.qtip("toggle",true)}else{u.$publicAccessSwitch.qtip("toggle",false)}}},_displayPublicState:function(t){var v=this;v.$body.stop();v.$publicEndpointsTable.stop();if(q._camera.isPublic()){if(v._publicAccessSwitch){v._publicAccessSwitch.select("on")
}if(!q._isOwner){v.$publicSwitchWrapper.hide();v.$publicSwitchSeparator.hide()}v.$publicLabel.html(f.tr(i,(q._isOwner?"public_access_switch.label.on.owner":"public_access_switch.label.on.not_owner")));
v.$publicEndpointsWrapper.css("visibility","inherit");v.$publicEndpointsTable[t?"animate":"css"]({top:0});v.$body[t?"animate":"css"]({marginBottom:0})}else{if(v._publicAccessSwitch){v._publicAccessSwitch.select("off")
}if(!q._isOwner){v.$publicSwitchWrapper.show();v.$publicSwitchSeparator.show()}v.$publicLabel.html(f.tr(i,(q._isOwner?"public_access_switch.label.off.owner":"public_access_switch.label.off.not_owner")));
var u=v._publicEndpointsWrapperHeight;v.$body[t?"animate":"css"]({marginBottom:-u});if(t){v.$publicEndpointsTable.animate({top:-u},function(){v.$publicEndpointsWrapper.css("visibility","hidden")})}else{v.$publicEndpointsTable.css({top:-u});
v.$publicEndpointsWrapper.css("visibility","hidden")}}v.$body.css("visibility","inherit")},_getSelectedSize:function(){var v=this,w=v.$embedCodeSizeList.find("option:selected").eq(0),u=w.attr("data-width"),t=w.attr("data-height");
if(typeof u==="undefined"||typeof t==="undefined"){return a}return{width:f.utils.parseDecimal(u,0),height:f.utils.parseDecimal(t,0)}},_getCustomSize:function(){var v=this,u=v.$embedCodeSizeCustomWidth.val(),t=v.$embedCodeSizeCustomHeight.val();
return{width:f.utils.parseDecimal(u,0),height:f.utils.parseDecimal(t,0)}},_setSize:function(t,v){var u=this,x,w;q._cameraPublicInfo.setEmbedCodeOptions(t);x=q._cameraPublicInfo.getEmbedCodeOptions();if(!v&&x.width!==u.$embedCodeSizeCustomWidth.val()){u.$embedCodeSizeCustomWidth.val(x.width)
}if(!v&&x.height!==u.$embedCodeSizeCustomHeight.val()){u.$embedCodeSizeCustomHeight.val(x.height)}if(v){w=u.$embedCodeSizeListCustom;u.$embedCodeSizeCustom.css("visibility","inherit")}else{w=u.$embedCodeSizeList.find('option[data-width="'+x.width+'"][data-height="'+x.height+'"]');
u.$embedCodeSizeCustom.css("visibility","hidden")}if(w.length&&!w.prop("selected")){w.prop("selected",true)}u.$embedCodeField.val(q._cameraPublicInfo.getEmbedCode())},_populateEmbedSizeOptions:function(){var u=this,t=q._embedOptions.defaultWidths||[],v=u.$embedCodeSizeCustomWidth,w=u.$embedCodeSizeCustomHeight;
c.each(t,function(y,z){var x=Math.ceil(q._camera.height*z/q._camera.width);if(z>=q._embedOptions.minWidth&&x>=q._embedOptions.minHeight){u.$embedCodeSizeList.append('<option data-width="'+z+'" data-height="'+x+'">'+z+"&nbsp;&times;&nbsp;"+x+"</option>")
}});u.$embedCodeSizeListCustom=c('<option data-custom="">'+f.tr(i,"embed_size.value.custom")+"</option>");u.$embedCodeSizeList.append(u.$embedCodeSizeListCustom);c([v[0],w[0]]).bind("blur keyup input cut paste",function(y){var x=c(this),z;
z=q._cameraPublicInfo.propagateEmbedSize(x.val(),x.attr("data-dimension"),(y.type==="blur"));if(typeof z.width!=="undefined"){v.val(z.width)}if(typeof z.height!=="undefined"){w.val(z.height)}u._setSize({width:v.val(),height:w.val()},true)
});if(t.length>0){u._setSize({width:t[t.length-1]})}else{u._setSize({width:q._embedOptions.minWidth})}},isSuccess:function(){return(q._isPreviousSuccess(this)&&!q._isAnyPreviousModified(this)&&q._camera.isPublic())
},isAllowed:function(){return(q._isPreviousSuccess(this)&&!q._isAnyPreviousModified(this))}}];function o(){return true}function l(){return false}function n(){var t=this;return(q._isPreviousSuccess(t)&&!q._isAnyPreviousModified(t)&&(t.isValid()||!q._isOwner))
}function j(){var t=this;return(t.isSuccess()||t.isError())}var p,k,m;for(k=q._steps.length,p=0;p<k;++p){m=q._steps[p];if(typeof m.isModified!=="function"){m.isModified=l}if(typeof m.isValid!=="function"){m.isValid=o
}if(typeof m.isSuccess!=="function"){m.isSuccess=n}if(typeof m.isError!=="function"){m.isError=l}if(typeof m.isAllowed!=="function"){m.isAllowed=j}}q._unloadId=f.app.preventUnload(q._getUnsavedChangesMessage,q);
q._setState(h.STATE_NEW)}h.STATE_NEW=1;h.STATE_CREATED=2;h.STATE_LOADING=3;h.STATE_ERROR=4;h.STATE_VISIBLE=5;h.STATE_SAVING=6;h.STATE_DESTROYED=7;h.qtipConfig={content:{text:" "},show:{event:false,effect:false},hide:{event:false,fixed:true,inactive:10000,effect:false},position:{my:"bottom center",at:"top center",adjust:{x:1,y:3},effect:false},style:{classes:"ui-tooltip-tipsy"}};
h.defaults={};g.open=function(){var j=this;if(j._state!==h.STATE_NEW){return}f.require("ivideon.utils.overlay")({stopEvents:false}).done(function(k){j._overlay=k;j._createContent(j._overlay.$content);j._overlay.$element.on("click",function(l){if(l.target===j._overlay.$content[0]||l.target===j._overlay.$element[0]){j.close();
return false}});j._onOpen()});return this};g.close=function(){var j=this;if(j._state===h.STATE_DESTROYED){return this}if(j._onBeforeClose()!==false){j._onClose()}return this};g.destroy=function(){this.close()
};g._setState=function(j){var k=this;if(!j){throw new f.utils.ArgumentError(d+'#_setState: Argument "state" not set.')}if(k._state===h.STATE_DESTROYED){return}k._state=j;switch(k._state){case h.STATE_LOADING:k.$wizard.removeClass("m-loaded m-error").addClass("m-loading");
k.$error.hide();k.$accordeon.hide();k.$progress.show();break;case h.STATE_ERROR:k.$wizard.removeClass("m-loading").addClass("m-error");k.$accordeon.hide();k.$progress.hide();k.$error.show();break;case h.STATE_VISIBLE:k.$wizard.removeClass("m-loading m-error m-saving").addClass("m-loaded");
k._setStepSaveButtonEnabled(k._steps[k._currentStep],true);k.$progress.hide();k.$error.hide();k.$accordeon.show();break;case h.STATE_SAVING:k.$wizard.addClass("m-saving");k._setStepSaveButtonEnabled(k._steps[k._currentStep],false);
k._hideStepSaveError(k._steps[k._currentStep]);break}k._updateBindings()};g._initSteps=function(){var n=this,k=n._steps,l,j,m;for(j=k.length,l=0;l<j;++l){m=k[l];if(!m._initialized){if(typeof m.init==="function"){m.init()
}m._initialized=true}}for(j=k.length,l=0;l<j&&k[l].isAllowed();++l){}if(l>=j){l=j-1}n._currentStep=l;n._visibleStep=-1};g._isAnyPreviousModified=function(l){var m=this,j=m._steps,k=j.indexOf(l);while(k>0){if(j[k-1].isModified()){return true
}--k}return false};g._isPreviousSuccess=function(l){var m=this,j=m._steps,k=j.indexOf(l);if(k>0){return j[k-1].isSuccess()}return true};g._updateBindings=function(){var n=this,k=n._steps,l,j,m;for(j=k.length,l=0;
l<j;++l){m=k[l];if(m.$step){m.$step[m.isSuccess()?"addClass":"removeClass"]("m-success");m.$step[m.isError()?"addClass":"removeClass"]("m-error");m.$step[m.isAllowed()?"addClass":"removeClass"]("m-allowed")
}if(m.$save){m.$save.html(n._getSaveButtonText(m))}if(m.$header){if(typeof m.title==="function"){m.$header.html(m.title())}}n._setStepSaveButtonEnabled(m,m.isValid());n._setStepResetButtonEnabled(m,m.isModified()&&(typeof m.reset==="function")&&!n._isFirstPublish)
}};g._moveToStep=function(o,j){var p=this,l=p._steps,n,m,k;if(p._state===h.STATE_DESTROYED){return}n=l[o];m=l[p._currentStep];if(n&&n===m){k=p.$accordeon.find('[data-step-index="'+o+'"]');if(n._initialized&&k.length){if(k.hasClass("m-collapsed")){if(p._visibleStep===p._currentStep&&typeof n.hide==="function"){n.hide()
}k.removeClass("m-collapsed");p._visibleStep=-1}else{k.addClass("m-collapsed");if(p._visibleStep!==p._currentStep&&typeof n.show==="function"){n.show()}p._visibleStep=p._currentStep}}return}if(n&&(n.isAllowed()||(j&&o===p._currentStep+1&&m&&m.isSuccess()))){p._showStep(o);
return}};g._showStep=function(m){var n=this,j=n._steps,l,k;if(n._state===h.STATE_DESTROYED){return}l=j[m];k=j[n._currentStep];n._hideStepSaveError(k);if(n._visibleStep===n._currentStep&&typeof k.hide==="function"){k.hide()
}n._visibleStep=-1;if(l){n._currentStep=m;n.$accordeon.find(".m-current").removeClass("m-current m-collapsed").addClass("m-not-current");n.$accordeon.find('[data-step-index="'+n._currentStep+'"]').removeClass("m-not-current").addClass("m-current");
n._updateBindings();if(n._visibleStep!==n._currentStep&&typeof l.show==="function"){l.show()}n._visibleStep=n._currentStep}else{n._currentStep=-1}};g._createStepsContent=function(n){var o=this,k=o._steps,l,j,m;
for(j=k.length,l=0;l<j;++l){m=k[l];m.$bullet=c('<dt class="b-accordeon-bullet" data-step-index="'+l+'">'+(l+1)+"</dt>");m.$item=c('<dd class="b-accordeon-item" data-step-index="'+l+'"><h3 class="b-accordeon-header">'+(typeof m.title==="function"?m.title():(m.title||""))+'</h3><div class="b-accordeon-body">'+(typeof m.body==="function"?m.body():(m.body||""))+"</div></dd>");
m.$header=m.$item.find(".b-accordeon-header");m.$body=m.$item.find(".b-accordeon-body");m.$step=m.$bullet.add(m.$item);n.append(m.$bullet).append(m.$item);if(l===o._currentStep){m.$step.addClass("m-current")
}else{if(l>o._currentStep){m.$step.addClass("m-not-current")}}if(m.isSuccess()){m.$step.addClass("m-success")}if(m.isAllowed()){m.$step.addClass("m-allowed")}}};g._getSaveButtonText=function(k){var l=this;
var j=(typeof k.saveButtonText==="function"?k.saveButtonText():a);j=j||(l._isFirstPublish?f.tr(i,"proceed_button.text"):f.tr(i,"save_button.text"));return j};g._createStepSaveButton=function(j){var k=this;
j.$save=c('<button type="button" class="b-button-save iv-btn">'+k._getSaveButtonText(j)+"</button>");j.$save.appendTo(j.$body);if(j.$save.qtip){j.$save.qtip(h.qtipConfig)}j.$reset=c('<button type="button" class="b-button-reset iv-btn m-secondary" style="visibility: hidden;">'+f.tr(i,"reset_button.text")+"</button>");
j.$reset.appendTo(j.$body)};g._setStepSaveButtonEnabled=function(k,j){if(k){if(k.$save){k.$save.prop("disabled",!j)[j?"removeClass":"addClass"]("m-disabled")}}};g._setStepResetButtonEnabled=function(k,j){if(k){if(k.$reset){k.$reset.prop("disabled",!j)[j?"removeClass":"addClass"]("m-disabled");
k.$reset.css("visibility",(j?"inherit":"hidden"))}}};g._showStepSaveError=function(l,k,j){var m=this;if(l){m._hideStepSaveError(l);if(k){if(l.$save&&l.$save.qtip){l.$save.qtip("option","content.text",k.message);
l.$save.qtip("toggle",true)}}}};g._hideStepSaveError=function(j){if(j){if(j.$save&&j.$save.qtip){j.$save.qtip("toggle",false)}}};g._createContent=function(j){var k=this;k.$wrapper=c('<div class="iv-camera-publish-wizard-window ui-dialog ui-widget ui-widget-content ui-corner-all"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title">'+f.tr(i,"title")+'</span><a href="javascript:void(0)" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick"></span></a></div><div class="iv-camera-publish-wizard-window-content ui-dialog-content ui-widget-content"><div class="iv-camera-publish-wizard"><div class="iv-msg-info b-progress" style="display: none;">'+f.tr(i,"loading")+'</div><div class="iv-msg-error b-error" style="display: none;"><p>'+f.tr(i,"load_error")+' <span class="b-error-message"></span></p><p><button type="button" class="b-retry-button iv-btn m-inline">'+f.tr(i,"retry_load_button.text")+'</button></p></div><dl class="b-help-actions b-accordeon" style="display: none;"></dl><div class="b-old-close-public-access-wrapper" style="display: none;"><a class="m-inpage b-old-close-public-access-button">'+f.tr(i,"old_close_public_access_button.text")+"</a></div></div></div></div>");
k.$wrapper.css("visibility","hidden");k.$wizard=k.$wrapper.find(".iv-camera-publish-wizard");k.$titlebar=k.$wrapper.find(".ui-dialog-titlebar");k.$title=k.$titlebar.find(".ui-dialog-title");k.$closeButton=k.$titlebar.find(".ui-dialog-titlebar-close");
k.$progress=k.$wizard.find(".b-progress");k.$error=k.$wizard.find(".b-error");k.$errorMessage=k.$error.find(".b-error-message");k.$errorRetryButton=k.$error.find(".b-retry-button");k.$accordeon=k.$wizard.find(".b-accordeon");
k.$closePublicAccessWrapper=k.$wizard.find(".b-old-close-public-access-wrapper");k.$closePublicAccessButton=k.$wizard.find(".b-old-close-public-access-button");k._createStepsContent(k.$accordeon);k.$accordeon.on("click",function(l){if(l.which!==1){return
}if(k._state===h.STATE_DESTROYED){return}k._hideStepSaveError(k._steps[k._currentStep])});k.$closeButton.on("click",function(l){if(l.which!==1){return}if(k._state===h.STATE_DESTROYED){return}l.preventDefault();
k.close()});k.$errorRetryButton.on("click",function(l){if(l.which!==1){return}if(k._state===h.STATE_DESTROYED){return}l.preventDefault();k._loadPublicInfo()});k.$closePublicAccessButton.on("click",function(l){if(l.which!==1){return
}if(k._state===h.STATE_DESTROYED){return}l.preventDefault();((f.app.hasService("rosterController")&&f.app.service("rosterController").closeCameraPublicAccessConfirmed)?f.app.service("rosterController").closeCameraPublicAccessConfirmed(k._camera):k._camera.setPublic(false)).fail(function(m){if(k._state===h.STATE_DESTROYED){return
}if(m){f.utils.dlg.error({message:m.message})}})});k.$accordeon.on("click",".b-accordeon-header, .b-accordeon-bullet",function(n){if(n.which!==1){return}if(k._state!==h.STATE_VISIBLE){return}n.preventDefault();
var l=c(n.target);var m=l.closest("[data-step-index]");if(m.length){var o=parseInt(m.attr("data-step-index"),10);k._moveToStep(o,false)}}).on("click",".b-button-reset",function(o){if(o.which!==1){return
}if(k._state!==h.STATE_VISIBLE){return}o.preventDefault();var l=c(o.target);var n=l.closest("[data-step-index]");if(n.length){var p=parseInt(n.attr("data-step-index"),10);var m=k._steps[p];if(m&&typeof m.reset==="function"){m.reset()
}}}).on("click",".b-button-save",function(p){if(p.which!==1){return}if(k._state!==h.STATE_VISIBLE){return}p.preventDefault();var m=c(p.target);var o=m.closest("[data-step-index]");if(o.length){var q=parseInt(o.attr("data-step-index"),10);
var n=k._steps[q];if(n&&typeof n.save==="function"){k._setState(h.STATE_SAVING);var l=n.save();if(l&&l.then){k._savingDeferred=l;e.setTimeout(function(){l.then(function(){if(k._state===h.STATE_DESTROYED){return
}k._savingDeferred=null;k._setState(h.STATE_VISIBLE);k._moveToStep(q+1,true)},function(r){if(k._state===h.STATE_DESTROYED){return}k._savingDeferred=null;k._setState(h.STATE_VISIBLE);k._showStepSaveError(n,r,m)
})},200)}else{k._setState(h.STATE_VISIBLE);if(l!==false){k._moveToStep(q+1,true)}}}else{k._moveToStep(q+1,true)}}});k.$wrapper.appendTo(j);k._setState(h.STATE_CREATED)};g._loadPublicInfo=function(){var k=this;
if(k._state!==h.STATE_CREATED&&k._state!==h.STATE_ERROR){throw new f.utils.StateError(d+"#_loadPublicInfo")}k._setState(h.STATE_LOADING);var j=k._cameraPublicInfo.load().done(function(){if(!f.app||f.app.isEnded()){return
}if(k._state===h.STATE_DESTROYED){return}k._isFirstPublish=(k._cameraPublicInfo&&k._cameraPublicInfo.getData().published_at===null);k._isFirstPublishViaWizard=!k._isFirstPublish&&(k._cameraPublicInfo&&k._cameraPublicInfo.getData().published_at<=1);
k._initSteps();k.$closePublicAccessWrapper[k._isOwner&&k._isFirstPublishViaWizard&&k._camera.isPublic()?"show":"remove"]();k._setState(h.STATE_VISIBLE);k._showStep(k._currentStep);k._camera.events.on("public-changed",k._onPublicChanged,k)
}).fail(function(l){if(!f.app||f.app.isEnded()){return}if(k._state===h.STATE_DESTROYED){return}k.$errorMessage.text(l.message);k.$closePublicAccessWrapper[k._isOwner&&k._camera.isPublic()?"show":"remove"]();
k._setState(h.STATE_ERROR)});return j};g._onPublicChanged=function(){var j=this;j._isFirstPublish=j._isFirstPublishViaWizard=false;j.$closePublicAccessWrapper.remove();j._updateBindings()};g._savePublicInfo=function(k){var l=this;
if(l._state!==h.STATE_SAVING){throw new f.utils.StateError(d+"#_savePublicInfo")}var j=l._cameraPublicInfo.saveMisc(k);return j};g._getUnsavedChangesMessage=function(){var j=this;if(j._state===h.STATE_DESTROYED){return
}if(j._isAnyPreviousModified(j._steps[j._steps.length-1])){return f.tr(i,"unsaved_changes_confirm.message")}};g._onOpen=function(){var j=this;if(j._state!==h.STATE_CREATED){return}j.$wrapper.css("visibility","inherit");
j._loadPublicInfo()};g._onBeforeClose=function(){var k=this;if(k._state===h.STATE_DESTROYED){return}var j=k._getUnsavedChangesMessage();if(j){f.utils.dlg.confirm({title:f.tr(i,"unsaved_changes_confirm.title"),message:j,yesHandler:function(){var m=k._steps,n,l,o;
for(l=m.length,n=0;n<l;++n){o=m[n];if(typeof o.reset==="function"){o.reset()}}k.close()}});return false}};g._onClose=function(){var o=this,l,m,k,n,j;if(o._state===h.STATE_DESTROYED){return}o._setState(h.STATE_DESTROYED);
o.events.fire("destroying");o.events.un();o._camera.events.un("public-changed",o._onPublicChanged,o);f.app.allowUnload(o._unloadId);if(o._embedPreview){o._embedPreview.destroy();o._embedPreview=null}l=o._steps;
if(l){for(k=l.length,m=0;m<k;++m){n=l[m];if(n._initialized){if(typeof n.destroy==="function"){n.destroy()}}}o._steps=l=n=null}if(o._overlay){o._overlay.destroy();o._overlay=null}o._savingDeferred=null;
o._camera=null;for(j in o){if(o.hasOwnProperty(j)&&j.charAt(0)==="$"){delete o[j]}}}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,k=f.require({prefix:""},"moment"),j=[].push,i=a,g=i.prototype,d="ivideon.views.CameraVideoView",h=d;
f.provide(d,i);i.CameraOfflineError=f.utils.declareErrorClass(d+".CameraOfflineError");i.AccessDeniedError=f.utils.declareErrorClass(d+".AccessDeniedError");i.PlaybackStalledError=f.utils.declareErrorClass(d+".PlaybackStalledError");
i.PlaybackInterruptedError=f.utils.declareErrorClass(d+".PlaybackInterruptedError");function a(l){var n=this;n._options=f.optClass(i.defaults,l,d,n,{$container:"container",_camera:"camera"});n._timezone=(n._camera.getTimezone()||f.getDetectedTimezone());
if(n._options.liveStreamingLimitInMs===b){n._options.liveStreamingLimitInMs=n._options.streamingLimitInMs}if(n._options.archiveStreamingLimitInMs===b){n._options.archiveStreamingLimitInMs=n._options.streamingLimitInMs
}if(c.browser.ios){n._options.fullscreenEnabled=false;n._options.normalIdleHideControls=false;n._options.fullscreenIdleHideControls=false;n._options.audioEnabled=false;n._options.liveVideoAutoRetryCount=0;
n._options.archiveVideoAutoRetryCount=0}if(c.browser.android){n._options.fullscreenEnabled=false;n._options.normalIdleHideControls=false;n._options.fullscreenIdleHideControls=false}if(!n._camera.liveEnabled){n._options.goToLiveButtonEnabled=false
}n._fullscreenMode=n._options.fullscreenMode;n._fullscreenWasAuto=false;n._isFullscreen=(n._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL_EMBEDDED);n._fullscreenButtonLangSuffix="";switch(n._fullscreenMode){case i.FULLSCREEN_MODE_AUTO:n._fullscreenWasAuto=true;
if(e.fullScreenApi&&e.fullScreenApi.supportsFullScreen){n._fullscreenMode=i.FULLSCREEN_MODE_NATIVE}else{n._fullscreenMode=i.FULLSCREEN_MODE_VIEWPORT}break;case i.FULLSCREEN_MODE_NATIVE:if(!(e.fullScreenApi&&e.fullScreenApi.supportsFullScreen)){n._options.fullscreenEnabled=false
}break;case i.FULLSCREEN_MODE_VIEWPORT:break;case i.FULLSCREEN_MODE_EXTERNAL:if(!n._options.fullscreenExternalUrl){n._options.fullscreenEnabled=false}break;case i.FULLSCREEN_MODE_EXTERNAL_EMBEDDED:try{if(!e.opener){n._options.fullscreenButtonEnabled=false
}}catch(m){}break;default:n._options.fullscreenEnabled=false}n._onFullscreenModeChanged(true);if(!n._options.fullscreenEnabled){n._options.fullscreenButtonEnabled=false}n._videoSize=n._getStandardVideoSize();
n._streamOptions={videoOptions:{quality:n._getStoredQuality(),speed:1}};n.events=new (f.require("ivideon.utils.Observable"))(n);n._requestedArchive=false;n._requestedStartTime=0;n._requestedEndTime=0;n._archiveRecord=null;
n._archiveRecordOffsetTime=0;n._archiveUpdateTimer=null;n._archiveUpdateEnabled=true;n._fragment=null;n._resetPlaybackCounters();n.$wrapper=c("<div/>").disableSelection().addClass("ivideon-camera-video-view").css("visibility","hidden").appendTo(n.$container);
n.$videoContainer=c("<div/>").addClass("ivideon-camera-video-container");n.$videoOffset=c("<div/>").addClass("ivideon-camera-video-offset");n.$controlsOffset=c("<div/>").addClass("ivideon-camera-video-controls-offset");
n.$videoStateIcon=c('<div class="ivideon-camera-video-state-icon"></div>');n._videoStateIconEvent=null;n._videoStateIconResetTimer=null;n.$fullscreenWrapper=c("<div/>").addClass("ivideon-camera-video-view m-fullscreen").hide().appendTo("body");
n.$wrapperAndFullscreenWrapper=n.$wrapper.add(n.$fullscreenWrapper);if(n._options.fullscreenButtonEnabled){n.$fullscreenButton=c('<a class="iv-btn ivideon-camera-video-fullscreen-button" />').attr("title",f.tr(h,"button.fullscreen_enter"+n._fullscreenButtonLangSuffix)).button({icons:{primary:"ui-icon-arrow-4-diag"},text:false});
n.$fullscreenButton.bind("click",function(){if(n._isFullscreen){n.exitFullscreen()}else{n.enterFullscreen()}})}n.$playpauseButton=c('<a class="iv-btn ivideon-camera-video-playpause-button" />').attr("title",f.tr(h,"button.pause")).button({icons:{primary:"ui-icon-pause"},text:false});
if(n._options.goToLiveButtonEnabled){n.$goToLiveButton=c('<a class="iv-btn ivideon-camera-video-live-button" />').disableSelection().attr("title",f.tr(h,"button.live")).button({icons:{primary:"ui-icon-play"},label:f.tr(h,"button.live"),disabled:!n._camera.liveEnabled}).click(function(){n.select(null);
if(e.Modernizr.touch){n.$goToLiveButton.button("widget").trigger("mouseleave")}})}if(n._options.audioEnabled){n._volumeSliderHideTimer=null;n.$volumeSlider=c("<div/>").addClass("ivideon-camera-video-volume-slider").bind("mouseenter",function(){n._volumeSliderShow()
}).bind("mouseleave",function(){n._volumeSliderHide()}).slider({min:0,max:100,step:1,orientation:"vertical",animation:"fast",slide:function(p,q){var o=(q.value/100);n._onVolumeSliderChange(o)}}).find(".ui-slider-handle").addClass("iv-btn").end().hide();
n.$muteButton=c('<a class="iv-btn ivideon-camera-video-mute-button" />').attr("title",f.tr(h,"button.mute")).bind("mouseenter",function(){n._volumeSliderShow()}).bind("mouseleave",function(){n._volumeSliderHide()
}).button({icons:{primary:"ui-icon-volume-on"},text:false});n.$volumeControl=c('<div class="ivideon-camera-video-volume-control" />').append(n.$volumeSlider.add(n.$muteButton))}if(n._options.timeOverlayEnabled){n.$timeOverlay=c("<div/>").hide().addClass("ivideon-camera-video-time-overlay closed");
n.$timeOverlayText=c("<span/>").addClass("ivideon-camera-video-time-overlay-text").appendTo(n.$timeOverlay);n.$timeOverlayToggleButton=c('<div class="iv-btn" />').button({icons:{primary:"ui-icon-clock"},text:false}).attr("title",f.tr(h,"time_overlay.title")).click(function(){n.$timeOverlay.toggleClass("closed");
if(n.$timeOverlay.hasClass("closed")){n.$timeOverlayToggleButton.button("option","icons",{primary:"ui-icon-clock"})}else{n.$timeOverlayToggleButton.button("option","icons",{primary:"ui-icon-arrowthick-1-e"})
}}).prependTo(n.$timeOverlay)}if(n._options.qualityControlEnabled){n._createQualityControl()}if(!(n._camera.archiveEnabled&&n._options.archiveEnabled&&n._camera.server&&n._camera.server.info&&n._camera.server.info.functions&&n._camera.server.info.functions.indexOf&&n._camera.server.info.functions.indexOf("speed_play")>=0)){n._options.speedControlEnabled=false
}if(n._options.speedControlEnabled){n._createSpeedControl()}if(n._options.embedButtonEnabled){n.$embedButton=c('<a class="iv-btn ivideon-camera-video-embed-button" />').attr("title",f.tr(h,"button.embed")).button({icons:{primary:"ui-icon-carat-2-e-w"},text:false}).bind("click",function(){n.events.fire("embed-button-clicked")
})}if(n._options.abuseButtonEnabled){n.$abuseButton=c('<a class="iv-btn ivideon-camera-video-abuse-button" />').attr("title",f.tr(h,"button.abuse")).button({icons:{primary:"ui-icon-notice"},text:false}).bind("click",function(){n.events.fire("abuse-button-clicked")
})}n.$dialogWrapper=c('<table class="ivideon-camera-video-view-dialog-wrapper"><tr><td></td></td></table>');n.$dialogWrapperInner=n.$dialogWrapper.find("td");n.$videoWrapper=c("<div/>").addClass("ivideon-camera-video-wrapper");
n.$videoWrapper.append(n.$videoOffset);n.$videoWrapper.append(n.$controlsOffset);n.$videoWrapper.append(n.$videoContainer);n.$videoWrapper.append(n.$videoStateIcon);n.$videoWrapper.append(n.$dialogWrapper);
n.$controlsContainer=n.$videoWrapper;n._controlsStacks={};n._addControlsStack("bottomleft");n._addControlsStack("bottomright");n._addControlsStack("topleft");n._addControlsStack("topright");n._addControlsStack("other");
n.$injectedControls=c([]);n.$videoWrapper.appendTo(n.$wrapper);if(n._options.audioEnabled){n.$wrapperAndFullscreenWrapper.addClass("with-audio");n.$wrapperAndFullscreenWrapper.addClass("with-volume-control");
n.injectControl(n.$volumeControl,"bottomleft")}if(n._options.speedControlEnabled){n.$wrapperAndFullscreenWrapper.addClass("with-speed-control");n.injectControl(n.$speedControl,"bottomleft")}n.injectControl(n.$playpauseButton,"bottomleft");
if(n._options.goToLiveButtonEnabled){n.$wrapperAndFullscreenWrapper.addClass("with-live-button");n.injectControl(n.$goToLiveButton,"bottomleft")}if(n._options.qualityControlEnabled){n.$wrapperAndFullscreenWrapper.addClass("with-quality-control");
n.injectControl(n.$qualityControl,"bottomright")}if(n._options.abuseButtonEnabled){n.$wrapperAndFullscreenWrapper.addClass("with-abuse-button");n.injectControl(n.$abuseButton,"bottomright")}if(n._options.embedButtonEnabled){n.$wrapperAndFullscreenWrapper.addClass("with-embed-button");
n.injectControl(n.$embedButton,"bottomright")}if(n._options.fullscreenButtonEnabled){n.$wrapperAndFullscreenWrapper.addClass("with-fullscreen");n.injectControl(n.$fullscreenButton,"bottomright")}if(n._options.timeOverlayEnabled){n.$wrapperAndFullscreenWrapper.addClass("with-time-overlay");
n.injectControl(n.$timeOverlay,"topright")}n.$bottomWrapper=c("<div/>").addClass("ivideon-camera-video-view-bottom-wrapper clearfix").appendTo(n.$wrapper);n._createTimelines();n._createNeighbors();n._createPlayer();
n._createPtz();if(n._options.fullscreenEnabled){n._addFullscreenHandlers()}n._addShortcutHandlers();n._addUserIdleTrackingHandlers();n._initPlugins();n._onWindowResizeBindUnbind(true);n._onBodyScrollBindUnbind(true);
n._setState(i.STATE_CREATED)}i.FULLSCREEN_MODE_AUTO=1;i.FULLSCREEN_MODE_VIEWPORT=2;i.FULLSCREEN_MODE_NATIVE=3;i.FULLSCREEN_MODE_EXTERNAL=4;i.FULLSCREEN_MODE_EXTERNAL_EMBEDDED=5;i.defaults={debug:false,neighborsListViewOptions:{cameraViewOptions:{previewEnabled:true}},userIdleTimeoutInMs:5*1000,normalIdleHideControls:false,fullscreenIdleHideControls:true,resizeTimeout:10,streamingLimitCheckInterval:10*1000,streamingLimitInMs:10*60*1000,liveStreamingLimitInMs:b,archiveStreamingLimitInMs:b,liveVideoAutoRetryCount:3,archiveVideoAutoRetryCount:3,archiveStreamEndThresholdInMs:2*1000,archiveContinueToLiveThresholdInMs:1*60*1000,cameraTitleFactory:function(m,l){return l.name
},fullscreenEnabled:true,fullscreenMode:i.FULLSCREEN_MODE_AUTO,fullscreenExternalUrl:null,fullscreenExternalWindowClosedCheckInterval:100,fullscreenExternalDialogDelay:1000,fullscreenButtonEnabled:true,goToLiveButtonEnabled:true,audioEnabled:true,timeOverlayEnabled:false,embedButtonEnabled:false,abuseButtonEnabled:false,qualityControlEnabled:true,speedControlEnabled:true,archiveEnabled:true,archiveExportEnabled:false,archiveShowLoadedStatus:false,archiveUpdateIntervalInMs:30*1000,allowStopLiveStream:true,allowPauseLiveStream:false,allowStopArchiveStream:true,allowPauseArchiveStream:true,playheadJumpDisplayThreshold:2*f.SECOND_IN_MS,videoSizeMultitplier:1,videoSizeFitHeight:0,pingOnError:false};
i.STATE_CREATED=1;i.STATE_IDLE=2;i.STATE_ARCHIVE_LOADING=3;i.STATE_ARCHIVE_PLAYING=4;i.STATE_ARCHIVE_LIMITED=5;i.STATE_ARCHIVE_ENDED=6;i.STATE_ARCHIVE_ERROR=7;i.STATE_LIVE_LOADING=8;i.STATE_LIVE_PLAYING=9;
i.STATE_LIVE_LIMITED=10;i.STATE_LIVE_ENDED=11;i.STATE_LIVE_ERROR=12;i.STATE_DESTROYED=13;i.ARCHIVE_EXPORT_STATE_IDLE=1;i.ARCHIVE_EXPORT_STATE_SELECTING=2;i.ARCHIVE_EXPORT_STATE_SELECTED=3;i.REASON_SELECT="select";
i.REASON_RESELECT="reselect";i.REASON_CONTINUE="continue";i.REASON_STALLED="stalled";i.REASON_CLEAR="clear";i.REASON_STOP="stopClicked";i.REASON_LIVE_LIMITED="live-limited";i.REASON_ARCHIVE_LIMITED="archive-limited";
i.REASON_STREAM_FINISHED="stream-finished";i.REASON_ENTER_FULLSCREEN="enterFullscreen";i.REASON_EXIT_FULLSCREEN="exitFullscreen";i.REASON_RESIZE_FULLSCREEN="resizeFullscreen";i.REASON_CHANGE_SPEED="changeSpeed";
i.REASON_CHANGE_QUALITY="changeQuality";i.REASON_ERROR="error";i.REASON_DESTROY="destroy";g.getCamera=function(){var l=this;l._assertNotDestroyed();return l._camera};g.isArchiveState=function(){return this._isArchiveState()
};g.getPlayheadTime=function(){var l=this;l._assertNotDestroyed();return l._playheadTime};g.getPlayer=function(){var l=this;l._assertNotDestroyed();return l._cameraPlayer};g.getNeighborsListView=function(){var l=this;
l._assertNotDestroyed();return l._neighborsList};g.getTimelineCalendar=function(){var l=this;l._assertNotDestroyed();return l._timelineCalendar};g.getVideoSize=function(){var l=this;return c.extend({},l._videoSize)
};g.getBottomPanelHeight=function(){var l=this;if(l._isDestroyedState()){return 0}return(l.$bottomWrapper?l.$bottomWrapper.outerHeight(true):0)};g.getRequiredSize=function(){var o=this,l,m,n;if(o._isDestroyedState()){return{width:0,height:0}
}l=o._getVideoOffset();m=(o._videoSize.width+(l.left+l.right));n=o.$videoWrapper.outerHeight(true)+o.getBottomPanelHeight();return{width:m,height:n}};g.init=function(){var l=this;if(l._state!==i.STATE_CREATED){throw new f.utils.StateError()
}l._setState(i.STATE_IDLE);l._updateSizeAndLayout();l._onUserActive();l.$wrapper.css("visibility","inherit");l.events.fire("initialized")};g.isInitialized=function(){var l=this;return(l._state!==i.STATE_CREATED&&!l._isDestroyedState())
};g.clear=function(){var l=this;l._assertInitialized();l._resetPlaybackCounters();l._timelineViewAutoCenterEnabled=false;l._handleClear(null,i.REASON_CLEAR)};g.select=function(l){var m=this;m._assertInitialized();
m._resetPlaybackCounters();m._handleSelect(l,i.REASON_SELECT)};g.reselect=function(){var l=this;l._assertInitialized();l._handleReselect(i.REASON_RESELECT)};g.setTimelineAutoCenterEnabled=function(l){var m=this;
m._timelineViewAutoCenterEnabled=!!l};g.updateSize=function(){var l=this;l._assertInitialized();if(l._isFullscreen){l._videoSize=l._getFullscreenVideoSize()}else{l._videoSize=l._getStandardVideoSize()}l._updateSizeAndLayout()
};g.isFullscreen=function(){var l=this;if(l._isDestroyedState()){return false}return l._isFullscreen};g.getFullscreenMode=function(){return this._fullscreenMode};g.enterFullscreen=function(){var m=this,l;
m._assertInitialized();if(m._isFullscreen||!m._options.fullscreenEnabled){return}if(m._fullscreenMode===i.FULLSCREEN_MODE_NATIVE){e.fullScreenApi.requestFullScreen(m.$wrapper[0])}else{if(m._fullscreenMode===i.FULLSCREEN_MODE_VIEWPORT){m._fullscreenChanging=true;
m._volumeSliderHide(true);m._cameraPlayer.unload(true);l=c("body");m._videoSize=m._getFullscreenVideoSize();m._bodyPrevScroll={left:l[0].scrollLeft,top:l[0].scrollTop};l[0].scrollLeft=0;l[0].scrollTop=0;
m._bodyPrevFullscreenClass=l.hasClass("ivideon-camera-video-view-fullscreen-viewport");if(!m._bodyPrevFullscreenClass){l.addClass("ivideon-camera-video-view-fullscreen-viewport")}m.$fullscreenWrapper.show().css({backgroundColor:"#000000",opacity:1});
m.$videoWrapper.appendTo(m.$fullscreenWrapper);m._isFullscreen=true;m._updateControlsAccordingToState();m._updateSizeAndLayout();m._handleReselect(i.REASON_ENTER_FULLSCREEN);m._onWindowResizeBindUnbind(true);
m._fullscreenChanging=false;m.events.fire("enterFullscreen")}else{if(m._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL){m._enterFullscreenExternal()}}}};g.exitFullscreen=function(){var m=this,l;m._assertInitialized();
if(!m._isFullscreen){return}if(m._fullscreenMode===i.FULLSCREEN_MODE_NATIVE){e.fullScreenApi.cancelFullScreen()}else{if(m._fullscreenMode===i.FULLSCREEN_MODE_VIEWPORT){m._fullscreenChanging=true;m._cameraPlayer.unload(true);
m._onWindowResizeBindUnbind(false);l=c("body");m._videoSize=m._getStandardVideoSize();if(typeof m._bodyPrevScroll==="object"){l[0].scrollLeft=m._bodyPrevScroll.left;l[0].scrollTop=m._bodyPrevScroll.top;
m._bodyPrevScroll=b}if(!m._bodyPrevFullscreenClass){l.removeClass("ivideon-camera-video-view-fullscreen-viewport");m._bodyPrevFullscreenClass=b}m.$videoWrapper.prependTo(m.$wrapper);m.$wrapperAndFullscreenWrapper.removeClass("with-fullscreen-button");
m.$fullscreenWrapper.hide();m._isFullscreen=false;m._updateControlsAccordingToState();m._updateSizeAndLayout();m._handleReselect(i.REASON_EXIT_FULLSCREEN);m._fullscreenChanging=false;m.events.fire("exitFullscreen")
}else{if(m._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL){m._exitFullscreenExternal()}else{if(m._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL_EMBEDDED){f.utils.windowClose()}}}}};g.injectControl=function(n,m){var p=this,o,l;
if(p._isDestroyedState()){return}o=c(n);if(!o.length){return}m=m||"other";l=p._controlsStacks[m];if(!l){l=p._addControlsStack(m)}o.addClass("ivideon-camera-video-control");j.apply(p.$injectedControls,c.makeArray(o));
l.$container.append(o);p._updateStackedControls()};g.handleUserActive=function(l){var m=this;if(m._isDestroyedState()){return}m._onUserActive(l)};g.handleUserIdle=function(){var l=this;if(l._isDestroyedState()){return
}l._onUserIdle()};g.setArchiveUpdateEnabled=function(l){var m=this;if(m._isDestroyedState()){return}m._archiveUpdateEnabled=!!l;if(l&&m._isArchiveAvailable()){m._startArchiveUpdate()}else{m._stopArchiveUpdate()
}};g.setEmbedButtonEnabled=function(l){var m=this;if(m._isDestroyedState()){return}if(!m._options.embedButtonEnabled){return}m.$embedButton.button(l?"enable":"disable")};g.setAbuseButtonEnabled=function(l){var m=this;
if(m._isDestroyedState()){return}if(!m._options.abuseButtonEnabled){return}m.$abuseButton.button(l?"enable":"disable")};g.destroy=function(){var m=this,l;if(m._isDestroyedState()){return}m._handleClear(null,i.REASON_DESTROY);
m._exitFullscreenExternal();m._setState(i.STATE_DESTROYED);m.events.fire("destroying");m.events.un();if(m._updateStateDisplayTimer){e.clearTimeout(m._updateStateDisplayTimer);m._updateStateDisplayTimer=null
}if(m._userIdleTimer){e.clearTimeout(m._userIdleTimer);m._userIdleTimer=null}m._stopStreamingLimitCheck();m._stopArchiveUpdate();if(m._timelineStatusUpdateTimer){e.clearTimeout(m._timelineStatusUpdateTimer);
m._timelineStatusUpdateTimer=null}if(m._timelineCalendarUpdateTimer){e.clearTimeout(m._timelineCalendarUpdateTimer);m._timelineCalendarUpdateTimer=null}if(m._removeUpdatingStatusTimer){e.clearTimeout(m._removeUpdatingStatusTimer);
m._removeUpdatingStatusTimer=null}m._volumeSliderClearHideTimer();m._onWindowResizeBindUnbind(false);m._onBodyScrollBindUnbind(false);if(m._onDocumentKeyUp){c(e.document).unbind("keyup",m._onDocumentKeyUp);
m._onDocumentKeyUp=null}if(m._onFullscreenFailed){m.$wrapper.unbind(e.fullScreenApi.fullScreenErrorEventName,m._onFullscreenFailed);m._onFullscreenFailed=null}if(m._onFullscreenChanged){m.$wrapper.add(e.document).unbind(e.fullScreenApi.fullScreenEventName,m._onFullscreenChanged);
m._onFullscreenChanged=null}if(m._cameraPtz){m._cameraPtz.destroy();m._cameraPtz=null}if(m._cameraPlayer){m._cameraPlayer.destroy();m._cameraPlayer=null}if(m._timelineView){m._timelineView.events.un("drag-started",m._handleTimelineViewRangeChangeRequestedByUser,m);
m._timelineView.events.un("item-drag-started",m._handleTimelineViewRangeChangeRequestedByUser,m);m._timelineView.events.un("scroll-left-click",m._handleTimelineViewRangeChangeRequestedByUser,m);m._timelineView.events.un("scroll-right-click",m._handleTimelineViewRangeChangeRequestedByUser,m);
m._timelineView.events.un("zoom-wheel",m._handleTimelineViewRangeChangeRequestedByUser,m);m._timelineView.events.un("range-displayed",m._onTimelineViewRangeDisplayed,m);m._timelineView.events.un("range-changed",m._onTimelineViewRangeChanged,m);
m._timelineView.events.un("click",m._onTimelineViewClick,m);m._timelineView.destroy();m._timelineView=null;m._timelinePlaybackCursor=null;m._timelineSelectionRange=null}if(m._timelineCalendar){m._timelineCalendar.events.un("range-displayed",m._onTimelineCalendarRangeDisplayed,m);
m._timelineCalendar.events.un("range-selected",m._onTimelineCalendarRangeSelected,m)}if(m._timelineCalendarButton){m._timelineCalendar=null;m._timelineCalendarButton.destroy();m._timelineCalendarButton=null
}else{if(m._timelineCalendar){m._timelineCalendar.destroy();m._timelineCalendar=null}}if(m._timelineZoomCenterButtons){m._timelineZoomCenterButtons.destroy();m._timelineZoomCenterButtons=null}if(m._cameraArchiveUpdateStartedHandler){m._camera.events.un("archiveUpdateStarted",m._cameraArchiveUpdateStartedHandler);
m._cameraArchiveUpdateStartedHandler=null}if(m._cameraArchiveUpdateStoppedHandler){m._camera.events.un("archiveUpdateStopped",m._cameraArchiveUpdateStoppedHandler);m._cameraArchiveUpdateStoppedHandler=null
}m._hideVideoStateIcon();m._camera=null;m._options=null;m.$wrapper.remove();m.$fullscreenWrapper.remove();for(l in m){if(m.hasOwnProperty(l)&&l.charAt(0)==="$"){delete m[l]}}};g._assertNotDestroyed=function(){if(this._isDestroyedState()){throw new f.utils.StateDestroyedError()
}};g._assertInitialized=function(){if(!this.isInitialized()){throw new f.utils.StateError()}};g._assertArchiveAvailable=function(){if(!this._isArchiveAvailable()){throw new f.utils.StateError()}};g._isArchiveAvailable=function(){return(this._timelines&&this._timelineView)
};g._isDestroyedState=function(){return(this._state===i.STATE_DESTROYED)};g._isLoadingState=function(){var l=this;return(l._state===i.STATE_LIVE_LOADING||l._state===i.STATE_ARCHIVE_LOADING)};g._isPlayingState=function(){var l=this;
return(l._state===i.STATE_LIVE_PLAYING||l._state===i.STATE_ARCHIVE_PLAYING)};g._isLiveState=function(){var l=this;return(l._state===i.STATE_LIVE_LOADING||l._state===i.STATE_LIVE_PLAYING||l._state===i.STATE_LIVE_LIMITED||l._state===i.STATE_LIVE_ENDED||l._state===i.STATE_LIVE_ERROR)
};g._isArchiveState=function(){var l=this;return(l._state===i.STATE_ARCHIVE_LOADING||l._state===i.STATE_ARCHIVE_PLAYING||l._state===i.STATE_ARCHIVE_LIMITED||l._state===i.STATE_ARCHIVE_ENDED||l._state===i.STATE_ARCHIVE_ERROR)
};g._logState=function(o,l,m){var n=this;if(!n._options.debug){return}f.console[o.indexOf("Error")>=0?"error":"log"](d+"#"+o+" "+(function(){var p;for(p in i){if(/^STATE_/.test(p)&&i[p]===n._state){return p
}}}()),(l===b?"":l),(m===b?"":m))};g._setState=function(l){var m=this;if(!l){throw new f.utils.ArgumentError(d+'#_setState: Argument "state" not set.')}if(m._isDestroyedState()){return}m._state=l;m._logState("_setState");
m._updateStateDisplay()};g._initPlugins=function(){};g._updateTimelineCalendar=function(){var l=this;e.clearTimeout(l._timelineCalendarUpdateTimer);l._timelineCalendarUpdateTimer=null;l._timelineCalendarUpdateLastTime=f.now();
if(l._timelineCalendar){l._skipTimelineCalendarRangeSelectedEvent=true;l._timelineCalendar.selectDay(l._timelineView.getNextRange().startTime);l._skipTimelineCalendarRangeSelectedEvent=false}};g._onTimelineViewRangeDisplayed=function(){var l=this;
l._assertNotDestroyed();l._assertArchiveAvailable();l._updateTimelineStatus();if((f.now()-l._timelineCalendarUpdateLastTime)>200){l._updateTimelineCalendar()}else{e.clearTimeout(l._timelineCalendarUpdateTimer);
l._timelineCalendarUpdateTimer=e.setTimeout(function(){l._updateTimelineCalendar()},200)}};g._onTimelineViewRangeChanged=function(m,l){var n=this;n._assertNotDestroyed();n._assertArchiveAvailable();n._updateTimelineStatus();
n._updateTimelineCalendar();n._loadTimelineRecords(l.curr)};g._onTimelineViewClick=function(o,n){var q=this,p,m,l;q._assertNotDestroyed();q._assertArchiveAvailable();p=n.time;m=q._timelineView.getRange();
if(typeof p==="number"){l=q._camera.timeline.select(p,m.endTime,true);q.events.fire("timeline-clicked",{time:p,record:l})}};g._onTimelineCalendarRangeDisplayed=function(m,l){var n=this;n._assertNotDestroyed();
n._assertArchiveAvailable();n._timelines.performLoad(l.startTime,l.endTime,f.models.Timeline.LOAD_MODE_COUNTS)};g._onTimelineCalendarRangeSelected=function(m,l){var n=this;n._assertNotDestroyed();n._assertArchiveAvailable();
if(n._skipTimelineCalendarRangeSelectedEvent){return}n._handleTimelineViewRangeChangeRequestedByUser();n._timelineView.scrollTo(l.startTime,l.endTime,b,0)};g._handleTimelineViewRangeChangeRequestedByUser=function(){var l=this;
l._assertNotDestroyed();l._assertArchiveAvailable();if(l._timelineCalendar){l._timelineCalendar.hide()}l._timelineViewAutoCenterEnabled=false};g._loadTimelineRecords=function(m){var n=this,l;n._assertNotDestroyed();
n._assertArchiveAvailable();l=n._timelines.performLoad(m.startTime,m.endTime,f.models.Timeline.LOAD_MODE_RECORDS);n._startArchiveUpdate();return l.promise()};g._loadNewTimelineRecords=function(){var o=this,l;
o._assertNotDestroyed();o._assertArchiveAvailable();var n=o._camera.timeline.selectLastRecord(),m=f.now();if(n&&o._playheadTime>=n.startTime){l=o._loadTimelineRecords({startTime:n.startTime,endTime:m})
}else{l=c.Deferred().resolve()}return l.promise()};g._startArchiveUpdate=function(){var l=this;l._stopArchiveUpdate();if(l._isArchiveAvailable()&&l._options.archiveUpdateIntervalInMs>0&&l._archiveUpdateEnabled){l._archiveUpdateTimer=e.setTimeout(function(){l._archiveUpdateTimer=null;
if(l._isDestroyedState()||!l._archiveUpdateEnabled||!l._isArchiveAvailable()){return}var m=l._timelineView.getRange();l._loadTimelineRecords(m)},l._options.archiveUpdateIntervalInMs)}};g._stopArchiveUpdate=function(){var l=this;
if(l._archiveUpdateTimer){e.clearTimeout(l._archiveUpdateTimer);l._archiveUpdateTimer=null}};g._createTimelines=function(){var s=this,r,n,o,m=1000,p,q,l;if(s._camera.timeline&&s._camera.archiveEnabled&&s._options.archiveEnabled){s._timelines=new (f.require("ivideon.models.TimelinesList"))();
s._timelines.add(s._camera.timeline);s.$timelineContainer=c("<div/>").addClass("ivideon-camera-video-view-timeline-container");s.$bottomWrapper.append(s.$timelineContainer);s.$timelineToolbar=c("<div/>").addClass("ivideon-camera-video-view-timeline-toolbar clearfix").appendTo(s.$bottomWrapper);
if(c.fn.qtip){s.$timelineContainer.qtip({content:{text:" "},show:{event:false,effect:false},hide:{event:"click",fixed:true,inactive:3000,effect:false},position:{my:"bottom center",at:"top center",adjust:{x:1,y:3},effect:false},style:{classes:"ui-tooltip-tipsy ivideon-camera-video-view-timeline-toolbar-tooltip"}})
}s.$wrapper.addClass("with-timeline");n=s._options.timelineViewOptions.levels;for(q=0,l=n.length;q<l;++q){r=n[q];if(r.groupingThreshold){s._camera.timeline.addGrouping(r.groupingThreshold)}}s._timelineView=new (f.require("ivideon.views.TimelineView"))(s._timelines,s.$timelineContainer,f.optMerge(s._options.timelineViewOptions,{timezone:s._timezone,pointersTrackerOptions:{asyncEvents:c.support.html5MediaAutoplay}}));
s._timelineStatusOverride=null;s._timelineView.events.on("range-displayed",s._onTimelineViewRangeDisplayed,s);s._timelineView.events.on("range-changed",s._onTimelineViewRangeChanged,s);s._timelineView.events.on("drag-started",s._handleTimelineViewRangeChangeRequestedByUser,s);
s._timelineView.events.on("item-drag-started",s._handleTimelineViewRangeChangeRequestedByUser,s);s._timelineView.events.on("scroll-left-click",s._handleTimelineViewRangeChangeRequestedByUser,s);s._timelineView.events.on("scroll-right-click",s._handleTimelineViewRangeChangeRequestedByUser,s);
s._timelineView.events.on("zoom-wheel",s._handleTimelineViewRangeChangeRequestedByUser,s);s._timelineView.events.on("click",s._onTimelineViewClick,s);s._timelinePlaybackCursor=new (f.require("ivideon.views.TimelineView.Playback"))({timelineView:s._timelineView});
s._timelineCalendarButton=new (f.require("ivideon.views.TimelineCalendarButton"))(f.optMerge(s._options.timelineCalendarButtonOptions,{timezone:s._timezone,timelines:s._timelines,container:s.$timelineToolbar,calendarPosition:(c.support.html5VideoClickEventsEaten||c.support.flashClickEventsEaten?{my:"center center",at:"center center",collision:"fit"}:null)}));
s._timelineCalendarButton.events.on("prev",function(){var y=s._timelineView.getRange(),z=(y.endTime-y.startTime),v=s._timelineCalendar.getPrevDay(),x=s._timelineCalendar.getCurrDay(),w=s._timelineCalendar.getNextDay(),u=(w-x),t=(z<f.DAY_IN_MS?{startTime:(y.startTime-u),endTime:(y.endTime-u)}:{startTime:v,endTime:x});
s._handleTimelineViewRangeChangeRequestedByUser();s._timelineView.scrollTo(t.startTime,t.endTime,b,0)});s._timelineCalendarButton.events.on("next",function(){var x=s._timelineView.getRange(),y=(x.endTime-x.startTime),w=s._timelineCalendar.getCurrDay(),v=s._timelineCalendar.getNextDay(),u=k(v).tz(s._timezone).add(1,"day").valueOf(),z=(u-v),t=(y<f.DAY_IN_MS?{startTime:(x.startTime+z),endTime:(x.endTime+z)}:{startTime:v,endTime:u});
s._handleTimelineViewRangeChangeRequestedByUser();s._timelineView.scrollTo(t.startTime,t.endTime,b,0)});s._timelineZoomCenterButtons=new (f.require("ivideon.views.TimelineZoomCenterButtons"))({container:s.$timelineToolbar});
s._timelineZoomCenterButtons.events.on("zoom-in",function(){s._handleTimelineViewRangeChangeRequestedByUser();s._timelineView.zoomBy(0.3)});s._timelineZoomCenterButtons.events.on("zoom-out",function(){s._handleTimelineViewRangeChangeRequestedByUser();
s._timelineView.zoomBy(-0.3)});s._timelineZoomCenterButtons.events.on("center",function(){if(s._timelinePlaybackCursor.getState()!==f.require("ivideon.views.TimelineView.Playback").STATE_IDLE){s._handleTimelineViewRangeChangeRequestedByUser();
s._timelineView.centerAt(s._timelinePlaybackCursor.getTime());s._timelineViewAutoCenterEnabled=true}});s._createArchiveExport();s._timelineCalendar=s._timelineCalendarButton.getCalendar();s._timelineCalendar.events.on("range-displayed",s._onTimelineCalendarRangeDisplayed,s);
s._timelineCalendar.events.on("range-selected",s._onTimelineCalendarRangeSelected,s);s._removeUpdatingStatusTimer=null;s._archiveUpdateStartedCounter=0;s._camera.events.on("archiveUpdateStarted",s._cameraArchiveUpdateStartedHandler=function(){if(s._isDestroyedState()){return
}if(s._removeUpdatingStatusTimer){e.clearTimeout(s._removeUpdatingStatusTimer);s._removeUpdatingStatusTimer=null}++s._archiveUpdateStartedCounter;p=f.now();if(s._camera.isArchiveLoaded()){s._timelineStatusOverride=f.tr(h,"timeline_status.updating")
}else{s._timelineStatusOverride=f.tr(h,"timeline_status.loading")}s._updateTimelineStatus(true)});s._camera.events.on("archiveUpdateStopped",s._cameraArchiveUpdateStoppedHandler=function(u,t){if(s._isDestroyedState()){return
}if(s._archiveUpdateStartedCounter>0){--s._archiveUpdateStartedCounter;if(s._archiveUpdateStartedCounter>0){return}}if(s._removeUpdatingStatusTimer){e.clearTimeout(s._removeUpdatingStatusTimer);s._removeUpdatingStatusTimer=null
}s._removeUpdatingStatusTimer=e.setTimeout(function(){if(s._isDestroyedState()){return}if(s._removeUpdatingStatusTimer){e.clearTimeout(s._removeUpdatingStatusTimer);s._removeUpdatingStatusTimer=null}if(t.result==="success"){s._timelineStatusOverride=null
}else{if(s._camera.isArchiveLoaded()){s._timelineStatusOverride=null}else{s._timelineStatusOverride=null}}s._updateTimelineStatus(true)},Math.max(0,m-(f.now()-p)))});s._updateTimelineStatus(true);o=s._timelineView.getRange();
s._loadTimelineRecords(o)}};g.showTimelineTooltip=function(l){var m=this;if(m._isDestroyedState()){return}if(m.$timelineContainer){if(!m.$timelineContainer.qtip){throw new f.utils.DependencyError("qtip")
}m.hideTimelineTooltip();if(l){m.$timelineContainer.qtip("option","content.text",l);m.$timelineContainer.qtip("toggle",true)}}};g.hideTimelineTooltip=function(){var l=this;if(l._isDestroyedState()){return
}if(l.$timelineContainer){if(!l.$timelineContainer.qtip){throw new f.utils.DependencyError("qtip")}l.$timelineContainer.qtip("toggle",false)}};g._createArchiveExport=function(){var l=this;if(l._isArchiveAvailable()&&l._options.archiveExportEnabled){l._timelineSelectionRange=new (f.require("ivideon.views.TimelineView.SelectionRange"))({timelineView:l._timelineView,minSize:2*f.MINUTE_IN_MS,maxSize:10*f.MINUTE_IN_MS});
l.$archiveExportWrapper=c("<div/>").addClass("ivideon-camera-video-archive-save-wrapper").appendTo(l.$timelineToolbar);l.$archiveExportStart=c('<a class="iv-btn ivideon-camera-video-archive-save-start-button" />').disableSelection().attr("title",f.tr(h,"button.archive_save")).button({icons:{primary:"ui-icon-disk"},text:false}).click(function(m){l.events.fire("archive-export-start-button-clicked",{originalEvent:m})
}).appendTo(l.$archiveExportWrapper);l.$archiveExportContinueWrapper=c("<div/>").addClass("ivideon-camera-video-archive-save-continue-wrapper").hide().appendTo(l.$archiveExportWrapper);l.$archiveExportDone=c('<a class="iv-btn ivideon-camera-video-archive-save-done-button" />').disableSelection().attr("title",f.tr(h,"button.archive_save_done")).button({icons:{primary:"ui-icon-check"},text:false}).click(function(m){l.events.fire("archive-export-confirm-button-clicked",{originalEvent:m})
}).appendTo(l.$archiveExportContinueWrapper);l.$archiveExportCancel=c('<a class="iv-btn ivideon-camera-video-archive-save-cancel-button" />').disableSelection().attr("title",f.tr(h,"button.archive_save_cancel")).button({icons:{primary:"ui-icon-cancel"},text:false}).click(function(m){l.events.fire("archive-export-cancel-button-clicked",{originalEvent:m})
}).appendTo(l.$archiveExportContinueWrapper);l.$archiveExportContinueWrapper.buttonset();l._archiveExportState=i.ARCHIVE_EXPORT_STATE_IDLE;l._updateArchiveExportDisplay()}};g.setArchiveExportEnabled=function(l){var m=this;
if(m._isDestroyedState()){return}if(l){if(!m._options.archiveExportEnabled){if(!m.$archiveExportWrapper){m._createArchiveExport()}m.$archiveExportWrapper.show();m._archiveExportState=i.ARCHIVE_EXPORT_STATE_IDLE;
m._updateArchiveExportDisplay()}}else{if(m.$archiveExportWrapper){m.$archiveExportWrapper.hide();m._timelineSelectionRange.disableDragging().hide()}}};g.setArchiveExportLimits=function(l,n){var m=this;
if(m._isDestroyedState()){return}if(m._timelineSelectionRange){m._timelineSelectionRange.setRangeLimits(l,n)}};g.startArchiveExport=function(){var q=this,m,l,p,n,o;if(q._isDestroyedState()){return}if(!q._options.archiveExportEnabled){return
}if(q._archiveExportState===i.ARCHIVE_EXPORT_STATE_IDLE){if(q._isArchiveState()&&q._timelinePlaybackCursor.getState()!==f.require("ivideon.views.TimelineView.Playback").STATE_IDLE){l=q._timelinePlaybackCursor.getTime()
}m=q._timelineView.getRange();if(typeof l==="number"&&l>=m.startTime&&l<=m.endTime){q._timelineSelectionRange.centerAt(l)}else{q._timelineSelectionRange.centerAt((m.startTime+m.endTime)/2)}p=q._timelineSelectionRange.getRange();
o=q._camera.timeline.select(p.startTime,b,true);if(o){if(o.startTime>p.endTime){q._timelineSelectionRange.setRange(o.startTime,o.startTime+(p.endTime-p.startTime));p=q._timelineSelectionRange.getRange()
}}else{if(q._timelineView.isEmpty()){q.showTimelineTooltip(f.tr(h,"archive_save.no_records_visible.tooltip"));return}}n=(p.endTime-p.startTime);q._timelineView.scrollTo(p.startTime-0.2*n,p.endTime+0.2*n);
q._archiveExportState=i.ARCHIVE_EXPORT_STATE_SELECTING;q._updateArchiveExportDisplay();q.showTimelineTooltip(f.tr(h,"archive_save.hint.tooltip"));q.events.fire("archive-export-started",{range:p});return true
}};g.confirmArchiveExport=function(){var p=this,o,l,n,m;if(p._isDestroyedState()){return}if(!p._options.archiveExportEnabled){return}if(p._archiveExportState===i.ARCHIVE_EXPORT_STATE_SELECTING){p.hideTimelineTooltip();
o=p._timelineSelectionRange.getRange();l=p._camera.timeline.select(o.startTime,o.endTime);if(l.length<=0){p.showTimelineTooltip(f.tr(h,"archive_save.no_records_selected.tooltip"));return}p._archiveExportState=i.ARCHIVE_EXPORT_STATE_SELECTED;
p._updateArchiveExportDisplay();if(l.length>0){n=l[0];m=l[l.length-1];o={startTime:Math.max(o.startTime,n.startTime),endTime:Math.min(o.endTime,m.endTime)}}p.events.fire("archive-export-confirmed",{range:o});
return true}};g.completeArchiveExport=function(l){var m=this;if(m._isDestroyedState()){return}if(!m._options.archiveExportEnabled){return}if(m._archiveExportState===i.ARCHIVE_EXPORT_STATE_SELECTED){m.hideTimelineTooltip();
if(l){if(l.message){m.showTimelineTooltip(l.message||"")}m._archiveExportState=i.ARCHIVE_EXPORT_STATE_SELECTING;m._updateArchiveExportDisplay()}else{m._archiveExportState=i.ARCHIVE_EXPORT_STATE_IDLE;m._updateArchiveExportDisplay()
}m.events.fire(l?"archive-export-error":"archive-export-success",(l?{error:l}:b));return true}};g.cancelArchiveExport=function(){var l=this;if(l._isDestroyedState()){return}if(!l._options.archiveExportEnabled){return
}if(l._archiveExportState===i.ARCHIVE_EXPORT_STATE_SELECTING){l._archiveExportState=i.ARCHIVE_EXPORT_STATE_IDLE;l._updateArchiveExportDisplay();l.hideTimelineTooltip();l.events.fire("archive-export-cancelled");
return true}};g._updateArchiveExportDisplay=function(){var l=this;if(l._isDestroyedState()){return}switch(l._archiveExportState){case i.ARCHIVE_EXPORT_STATE_IDLE:l._timelineSelectionRange.disableDragging().hide();
l.$archiveExportContinueWrapper.hide();l.$archiveExportStart.removeClass("ui-state-processing").button("enable").show();break;case i.ARCHIVE_EXPORT_STATE_SELECTING:l._timelineSelectionRange.enableDragging().show();
l.$archiveExportStart.removeClass("ui-state-processing").button("enable").hide();l.$archiveExportContinueWrapper.show();break;case i.ARCHIVE_EXPORT_STATE_SELECTED:l._timelineSelectionRange.disableDragging().show();
l.$archiveExportContinueWrapper.hide();l.$archiveExportStart.removeClass("ui-state-processing").button("disable").show();break}};g._createNeighbors=function(){var m=this,l=m._camera.neighbors;if(l&&l.length){f.require("ivideon.views.CamerasList");
m.$neighborsContainer=c("<div/>").addClass("ivideon-camera-neighbors-container");m.$bottomWrapper.append(m.$neighborsContainer);m.$wrapper.addClass("with-neighbors");m._neighborsList=new (f.require("ivideon.views.CamerasList"))(f.optMerge(m._options.neighborsListViewOptions,{cameras:l,container:m.$neighborsContainer}));
m.events.fire("neighbors-list-view-created")}};g._startStreamingLimitCheck=function(){var l=this;if(!l._streamingLimitCheckTimer){l._streamingLimitCheckTimer=e.setInterval(function(){if(l._isPlayingState()&&l._hasReachedStreamingLimit()){l._onVideoStreamingLimited()
}},l._options.streamingLimitCheckInterval)}};g._stopStreamingLimitCheck=function(){var l=this;if(l._streamingLimitCheckTimer){e.clearInterval(l._streamingLimitCheckTimer);l._streamingLimitCheckTimer=null
}};g._createPlayer=function(){var l=this;l._cameraPlayer=new (f.require("ivideon.views.CameraStreamPlayer"))(l.$videoContainer,l._options.cameraPlayerOptions);l._cameraPlayer.events.on("play",function(){l._updateStateDisplay();
l._showVideoStateIcon("play");l._stopStreamingLimitCheck()});l._cameraPlayer.events.on("pause",function(){l._updateStateDisplay();l._showVideoStateIcon("pause");l._startStreamingLimitCheck()});l._cameraPlayer.events.on("engine-suspended",l._updateStateDisplay,l);
l._cameraPlayer.events.on("engine-resumed",l._updateStateDisplay,l);l._cameraPlayer.events.on("stream-tick",l._onStreamTick,l);l._cameraPlayer.events.on("stream-stalled",l._onStreamStalled,l);l._cameraPlayer.events.on("stream-metadata",l._onStreamMetadata,l);
if(l._options.audioEnabled){l.$volumeSlider.slider("value",Math.round(l._cameraPlayer.options.volume*100))}else{l._cameraPlayer.setMuted(true)}};g._createPtz=function(){var m=this,l=(c.isFunction(m._options.cameraPtzOptions)?m._options.cameraPtzOptions.call(m,m._camera):m._options.cameraPtzOptions);
if(l){m._cameraPtz=new (f.require("ivideon.views.CameraPtzController"))(c.extend({},l,{camera:m._camera,cameraVideoView:m}));if(!m._camera.ptzEnabled){m._cameraPtz.disable()}}};g._getStoredQuality=function(){var o=this,n=f.utils.cookie("video-quality"),m,l;
if(o._options.qualityControlEnabled){if(typeof n!=="undefined"){n=parseInt(n,10);if(!isNaN(n)){return n}}}l=f.app.service("streamerAPI").getQualitySet();m=l[l.length-1].value;return m};g._storeQuality=function(l){f.utils.cookie("video-quality",l)
};g._createMenuControl=function(s,u){u=u||{};var q=this,p='<div class="ivideon-camera-video-menu-control '+(u.cssClassName||"")+'">',l,t,n,r,o,m;for(m=s.length,o=0;o<m;++o){t=s[o];n=(o===0?"m-first":(o===m-1?"m-last":"m-middle"));
p+='<a data-value="'+t.value+'" class="iv-btn ivideon-camera-video-menu-item '+n+" ivideon-camera-video-menu-value-"+t.value+'">';p+=t.shortText;p+="</a>"}p+="</div>";l=c(p);l.children(".ivideon-camera-video-menu-item").button({icons:{primary:"ui-icon-bullet"}});
if(!e.Modernizr.touch){l.bind("mouseenter",function(v){v.stopPropagation();q._openMenuControl(l)});l.bind("mouseleave",function(v){v.stopPropagation();q._closeMenuControl(l)})}q.$wrapperAndFullscreenWrapper.bind("click",function(){q._closeMenuControl(l)
});if(typeof u.selectedValue!=="undefined"){r=u.selectedValue;q._selectMenuControlItem(l,r)}l.on("mousemove touchmove",".ivideon-camera-video-menu-item",function(v){var x=(v.originalEvent&&v.originalEvent.changedTouches?v.originalEvent.changedTouches[0]:null),w;
v.preventDefault();v.stopPropagation();if(x&&!e.Modernizr.touch){w=f.utils.elementFromPoint(x.clientX,x.clientY);w=c(w).closest(".ivideon-camera-video-menu-item");l.children(".ivideon-camera-video-menu-item").not(w).removeClass("ui-state-hover ui-state-active");
w.addClass("ui-state-hover")}else{l.children(".ivideon-camera-video-menu-item").removeClass("ui-state-hover")}});l.on("click",".ivideon-camera-video-menu-item",function(w){var y=(w.originalEvent&&w.originalEvent.changedTouches?w.originalEvent.changedTouches[0]:w.originalEvent),x,v;
w.stopPropagation();if(y){x=f.utils.elementFromPoint(y.clientX,y.clientY);x=c(x||w.target).closest(".ivideon-camera-video-menu-item");v=x.attr("data-value")}if(!l.hasClass("m-opened")){q._openMenuControl(l);
return}if(typeof v!=="undefined"){r=v}q._selectMenuControlItem(l,r);q._closeMenuControl(l);if(u.setter){u.setter(r)}});return l};g._openMenuControl=function(l){if(!l.hasClass("m-opened")&&!l.hasClass("ui-state-disabled")){l.addClass("m-opened").removeClass("m-closed")
}};g._closeMenuControl=function(l){l.children(".ivideon-camera-video-menu-item").removeClass("ui-state-hover");if(l.hasClass("m-opened")){l.removeClass("m-opened").addClass("m-closed")}};g._selectMenuControlItem=function(l,m){l.find(".ivideon-camera-video-menu-item").not("[data-value="+m+"]").removeClass("m-selected").end().filter("[data-value="+m+"]").addClass("m-selected").end()
};g._createSpeedControl=function(){var p=this,n=[1,2,4,8,16,32,64],m=[],o,l;for(l=n.length,o=l-1;o>=0;--o){m[m.length]={value:n[o],fullText:"x"+n[o],shortText:"x"+n[o]}}p.$speedControl=p._createMenuControl(m,{cssClassName:"ivideon-camera-video-speed-control",selectedValue:p._streamOptions.videoOptions.speed,setter:function(r){var q;
r=parseInt(r,10);if(isNaN(r)){return}p._streamOptions.videoOptions.speed=r;if(p._stream){q=p._stream.getSpeed();if(r!==q){if(p._isArchiveState()){p._handleReselect(i.REASON_CHANGE_SPEED)}}}}});p.$speedControl.attr("title",f.tr(h,"button.archive_speed"))
};g._createQualityControl=function(){var m=this,l=f.app.service("streamerAPI").getQualitySet();m.$qualityControl=m._createMenuControl(l.reverse(),{cssClassName:"ivideon-camera-video-quality-control",selectedValue:m._streamOptions.videoOptions.quality,setter:function(o){var n;
o=parseInt(o,10);if(isNaN(o)){return}m._streamOptions.videoOptions.quality=o;m._storeQuality(m._streamOptions.videoOptions.quality);if(m._stream){n=m._stream.options.videoOptions.quality;if(o!==n){m._handleReselect(i.REASON_CHANGE_QUALITY)
}}}});m.$qualityControl.attr("title",f.tr(h,"button.quality"))};g._updateQualityControl=function(m){var l=this;if(l._options.qualityControlEnabled){l._selectMenuControlItem(l.$qualityControl,m)}};g._addControlsStack=function(m){var p=this,n=p._controlsStacks,l,o=("appendTo");
l={css:{},$container:c("<div/>").addClass("ivideon-camera-video-controls stack-"+m)[o](p.$controlsContainer)};n[m]=l;l.$container.bind("mouseover mousemove",function(){p._onUserActive(true);return false
});l.$container.bind("mouseout",function(){p._onUserActive();return false});return l};g._getCenteredOffset=function(o,m){var p=this,n=p._getFullscreenBoundsSize(),l;l={left:0,right:0,top:0,bottom:0};if(p._isFullscreen){l.left=l.right=((n.width-(m.width+o.left+o.right))/2);
l.top=l.bottom=((n.height-(m.height+o.top+o.bottom))/2);l.left+=n.left;l.right+=n.right;l.top+=n.top;l.bottom+=n.bottom}return l};g._getVideoOffset=function(){var m=this,l;if(m._isDestroyedState()){return{left:0,top:0,right:0,bottom:0}
}l={left:0,top:0};c.each(l,function(o,n){n=parseInt(m.$videoOffset.css(o),10);if(isNaN(n)){n=0}l[o]=n});l.right=l.left;l.bottom=l.top;return l};g._getControlsOffset=function(){var m=this,l;if(m._isDestroyedState()){return{left:0,top:0,right:0,bottom:0}
}l={left:0,top:0};c.each(l,function(o,n){n=parseInt(m.$controlsOffset.css(o),10);if(isNaN(n)){n=0}l[o]=n});l.right=l.left;l.bottom=l.top;return l};g._updateStackedControls=function(){var q=this,o=q._controlsStacks,p,n,m,l;
if(q._isDestroyedState()){return}l=q._getControlsOffset();p={topleft:{top:l.top,left:l.left},topright:{top:l.top,right:l.right},bottomleft:{bottom:l.bottom,left:l.left},bottomright:{bottom:l.bottom,right:l.right}};
for(n in o){if(o.hasOwnProperty(n)){m=o[n];if(p[n]){c.extend(m.css,p[n])}m.$container.css(m.css)}}};g._updateVideoOffset=function(l){var n=this,m;if(n._isDestroyedState()){return}l=l||n._getVideoOffset();
m=n._getCenteredOffset(l,n._videoSize);n._updateStackedControls()};g._getStandardVideoSize=function(){var p=this,m,o,l,n;if(p._isDestroyedState()){return}l=p._camera.width;n=p._camera.height;if(!l||!n){f.console.warn(d+"._getStandardVideoSize: "+p._options.cameraTitleFactory(p,p._camera)+" empty width or height: "+l+" "+n);
l=640;n=480}m=(c.isFunction(p._options.videoSizeFitHeight)?p._options.videoSizeFitHeight(p,p._camera):p._options.videoSizeFitHeight);o=(m>0?(m/n):p._options.videoSizeMultitplier);return{width:Math.floor(l*o),height:Math.floor(n*o)}
};g._getFullscreenBoundsSize=function(){var m=c(e),l=18;return{left:l/2,right:l/2,top:l/2,bottom:l/2,width:m.width()-l,height:m.height()-l}};g._getFullscreenVideoSize=function(){var q=this,n=q._getFullscreenBoundsSize(),l,p,m,o;
if(q._isDestroyedState()){return}l=q._getVideoOffset();p=n.width-(l.left+l.right);m=n.height-(l.top+l.bottom);o=f.utils.fitRectIntoFrame({width:q._camera.width,height:q._camera.height},{width:p,height:m});
return{width:Math.floor(Math.max(1,o.width)),height:Math.floor(Math.max(1,o.height))}};g._enterFullscreenExternal=function(){var l=this;l._exitFullscreenExternal(true);l._fullscreenChanging=true;l._volumeSliderHide(true);
l._handleClear(null,i.REASON_ENTER_FULLSCREEN);l._cameraPlayer.unload(true);l._fullscreenWindowName="fullscreen_"+f.now();l._fullscreenWindow=f.utils.windowOpenFullscreen(l._options.fullscreenExternalUrl,l._fullscreenWindowName);
if(l._fullscreenWindow){l._isFullscreen=true;l._fullscreenWindowClosedCheckTimer=e.setInterval(function(){if(l._isDestroyedState()){return}if(f.utils.windowIsClosed(l._fullscreenWindow)){l._exitFullscreenExternal()
}},l._options.fullscreenExternalWindowClosedCheckInterval);l._updateControlsAccordingToState();l._displayFullscreenExternalDialog();l._fullscreenChanging=false;l.events.fire("enterFullscreen")}else{l._fullscreenChanging=false
}};g._exitFullscreenExternal=function(l){var n=this,m=(n._isFullscreen!==false);n._fullscreenChanging=true;if(n._fullscreenExternalDialogTimer){e.clearTimeout(n._fullscreenExternalDialogTimer);n._fullscreenExternalDialogTimer=null
}if(n._fullscreenWindowClosedCheckTimer){e.clearInterval(n._fullscreenWindowClosedCheckTimer);n._fullscreenWindowClosedCheckTimer=null}if(n._fullscreenWindow){f.utils.windowClose(n._fullscreenWindow);n._fullscreenWindow=null
}if(m){n._isFullscreen=false;n._updateControlsAccordingToState();n._clearDialog()}n._fullscreenChanging=false;if(!l&&m){n.events.fire("exitFullscreen")}};g._updateStateDisplay=function(){var l=this;if(l._isDestroyedState()){return
}if(l._isLoadingState()||l._isPlayingState()){l._clearDialog()}else{if(l._state===i.STATE_IDLE){l._displayIdleDialog()}}l._updateStateCssClass();l._updateControlsAccordingToState();l._updatePlayhead()};
g._updateStateDisplayAsync=function(l){var m=this;if(m._isDestroyedState()){return}e.clearTimeout(m._updateStateDisplayTimer);m._updateStateDisplayTimer=e.setTimeout(function(){m._updateStateDisplayTimer=null;
m._updateStateDisplay()},l||0)};g._updateStateCssClass=function(){var l=this;if(l._isDestroyedState()){return}l.$wrapperAndFullscreenWrapper.removeClass("m-live m-archive m-loading m-timeout m-playing m-no-video m-video-error m-video-finished");
switch(l._state){case i.STATE_IDLE:l.$wrapperAndFullscreenWrapper.addClass("m-no-video");break;case i.STATE_ARCHIVE_LOADING:l.$wrapperAndFullscreenWrapper.addClass("m-archive m-loading");break;case i.STATE_ARCHIVE_PLAYING:l.$wrapperAndFullscreenWrapper.addClass("m-archive m-playing");
break;case i.STATE_ARCHIVE_LIMITED:l.$wrapperAndFullscreenWrapper.addClass("m-archive m-timeout no-video");break;case i.STATE_ARCHIVE_ENDED:l.$wrapperAndFullscreenWrapper.addClass("m-archive m-video-finished");
break;case i.STATE_ARCHIVE_ERROR:l.$wrapperAndFullscreenWrapper.addClass("m-archive m-video-error");break;case i.STATE_LIVE_LOADING:l.$wrapperAndFullscreenWrapper.addClass("m-live m-loading");break;case i.STATE_LIVE_PLAYING:l.$wrapperAndFullscreenWrapper.addClass("m-live m-playing");
break;case i.STATE_LIVE_LIMITED:l.$wrapperAndFullscreenWrapper.addClass("m-live m-timeout no-video");break;case i.STATE_LIVE_ENDED:l.$wrapperAndFullscreenWrapper.addClass("m-live m-video-finished");break;
case i.STATE_LIVE_ERROR:l.$wrapperAndFullscreenWrapper.addClass("m-live m-video-error");break}};g._showVideoStateIcon=function(m){var o=this,n=(0.1*f.SECOND_IN_MS),l=(0.3*f.SECOND_IN_MS);if(o._isDestroyedState()){return
}o._hideVideoStateIcon();o._videoStateIconEvent=m;o.$videoStateIcon.addClass("m-visible m-event-"+o._videoStateIconEvent);if(!e.Modernizr.csstransitions){o.$videoStateIcon.stop().css({opacity:1})}o._videoStateIconFadeTimer=e.setTimeout(function(){if(o._isDestroyedState()){return
}o.$videoStateIcon.addClass("m-fade");if(!e.Modernizr.csstransitions){o.$videoStateIcon.animate({opacity:0},l,"easeInQuad")}o._videoStateIconResetTimer=e.setTimeout(function(){o._hideVideoStateIcon()},l)
},n)};g._hideVideoStateIcon=function(){var l=this;if(l._isDestroyedState()){return}e.clearTimeout(l._videoStateIconFadeTimer);l._videoStateIconFadeTimer=null;e.clearTimeout(l._videoStateIconResetTimer);
l._videoStateIconResetTimer=null;if(l._videoStateIconEvent){l.$videoStateIcon.removeClass("m-visible m-fade m-event-"+l._videoStateIconEvent);l._videoStateIconEvent=null}if(!e.Modernizr.csstransitions){l.$videoStateIcon.stop().css({opacity:0})
}};g._showPlayheadJumpIcon=function(l){var m=this;if(m._isDestroyedState()){return}if(l>0){m._showVideoStateIcon("go-later")}else{if(l<0){m._showVideoStateIcon("go-earlier")}}};g._onFullscreenModeChanged=function(l){var m=this;
if(m._isDestroyedState()){return}if(m._fullscreenMode===i.FULLSCREEN_MODE_NATIVE){m._fullscreenButtonLangSuffix=".native"}if(m._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL||m._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL_EMBEDDED){m._fullscreenButtonLangSuffix=".external"
}if(m._options.fullscreenButtonEnabled&&m.$fullscreenButton){if(m._isFullscreen){m.$fullscreenButton.attr("title",f.tr(h,"button.fullscreen_exit"+m._fullscreenButtonLangSuffix))}else{m.$fullscreenButton.attr("title",f.tr(h,"button.fullscreen_enter"+m._fullscreenButtonLangSuffix))
}}if(!l){m.events.fire("fullscreenModeChanged")}};g._addFullscreenHandlers=function(){var l=this;if(l._fullscreenMode===i.FULLSCREEN_MODE_NATIVE){l.$wrapper.add(e.document).bind(e.fullScreenApi.fullScreenEventName,l._onFullscreenChanged=function(m){if(e.fullScreenApi.isFullScreen()){if(e.fullScreenApi.fullScreenElement()!==l.$wrapper[0]){return
}m.stopPropagation();l._onWindowResizeBindUnbind(false);l._fullscreenChanging=true;l._volumeSliderHide(true);l.$wrapper.addClass("m-fullscreen");l._isFullscreen=true;e.clearTimeout(l._onFullscreenChangedTimer);
l._onFullscreenChangedTimer=e.setTimeout(function(){l._videoSize=l._getFullscreenVideoSize();l._onWindowResize();if(c.browser.mozilla&&parseFloat(c.browser.version)<13){l._cameraPlayer.unload(true);l._handleReselect(i.REASON_ENTER_FULLSCREEN)
}l._fullscreenChanging=false;l._updateControlsAccordingToState();l.events.fire("enterFullscreen")},0)}else{if(l._isFullscreen){m.stopPropagation();l._onWindowResizeBindUnbind(false);l._fullscreenChanging=true;
l._volumeSliderHide(true);l.$wrapper.removeClass("m-fullscreen");l._isFullscreen=false;e.clearTimeout(l._onFullscreenChangedTimer);l._onFullscreenChangedTimer=e.setTimeout(function(){l._videoSize=l._getStandardVideoSize();
l._onWindowResize();if(c.browser.mozilla&&parseFloat(c.browser.version)<13){l._cameraPlayer.unload(true);l._handleReselect(i.REASON_EXIT_FULLSCREEN)}l._fullscreenChanging=false;l._updateControlsAccordingToState();
l.events.fire("exitFullscreen")},0)}}});l.$wrapper.bind(e.fullScreenApi.fullScreenErrorEventName,l._onFullscreenFailed=function(){if(l._onFullscreenFailed){l.$wrapper.unbind(e.fullScreenApi.fullScreenErrorEventName,l._onFullscreenFailed);
l._onFullscreenFailed=null}if(l._onFullscreenChanged){l.$wrapper.add(e.document).unbind(e.fullScreenApi.fullScreenEventName,l._onFullscreenChanged);l._onFullscreenChanged=null}if(l._fullscreenWasAuto){l._fullscreenMode=i.FULLSCREEN_MODE_VIEWPORT;
l._onFullscreenModeChanged();l.enterFullscreen()}})}};g._addShortcutHandlers=function(){var l=this;c(e.document).bind("keyup",l._onDocumentKeyUp=function(m){if(m.which===32&&l.$playpauseButton){l._onUserActive();
l.$playpauseButton.click();return false}if(m.which===27&&l._isFullscreen){l.exitFullscreen();l._onUserActive();return false}});l.$wrapperAndFullscreenWrapper.bind("dblclick keyup",function(n){var m;if(l._isFullscreen){if(n.type==="keyup"){m=(n.which===27)
}else{m=true}if(m){l.exitFullscreen();l._onUserActive();return false}}})};g._addUserIdleTrackingHandlers=function(){var l=this;if(!(l._options.userIdleTimeoutInMs>0)){return}l.$videoContainer.bind("mousemove",function(){l._onUserActive()
});l.$wrapperAndFullscreenWrapper.bind("keyup mousemove mousedown mouseup touchstart touchmove touchend",function(){l._onUserActive()})};g._onUserActive=function(l){var m=this;if(m._isDestroyedState()){return
}m.$wrapperAndFullscreenWrapper.removeClass("m-user-idle m-controls-hidden");if(m._userIdleTimer){e.clearTimeout(m._userIdleTimer);m._userIdleTimer=null}if(!(m._options.userIdleTimeoutInMs>0)){l=true}if(!l){m._userIdleTimer=e.setTimeout(function(){m._onUserIdle()
},m._options.userIdleTimeoutInMs)}m.events.fire("user-active",{persistent:l})};g._onUserIdle=function(){var l=this;if(l._isDestroyedState()){return}if(l._userIdleTimer){e.clearTimeout(l._userIdleTimer);
l._userIdleTimer=null}l.$wrapperAndFullscreenWrapper.addClass("m-user-idle"+((!l.isFullscreen()&&l._options.normalIdleHideControls)||(l.isFullscreen()&&l._options.fullscreenIdleHideControls)?" m-controls-hidden":""));
l.events.fire("user-idle")};g._updateTimelineStatus=function(n){var m=this,l;if(m._isDestroyedState()){return}l=function(){var p,o;if(m._isDestroyedState()){return}if(m._camera.isArchiveLoaded()){if(m._timelineView.isEmpty()){o="timeline_status.loaded_empty"
}else{if(m._options.archiveShowLoadedStatus){o="timeline_status.loaded"}}}else{o="timeline_status.not_loaded"}if(o&&f.lang.hasMessage(h,o)){p=f.tr(h,o)}m._timelineView.setStatus(m._timelineStatusOverride||p||"")
};if(m._timelineStatusUpdateTimer){e.clearTimeout(m._timelineStatusUpdateTimer);m._timelineStatusUpdateTimer=null}if(n){l()}else{m._timelineStatusUpdateTimer=e.setTimeout(l,0)}};g._updateTimelineSize=function(){var l=this;
if(l._isDestroyedState()){return}if(l._timelineView){if(l.$timelineContainer.hasClass("not-loaded")){l._timelineView.refresh()}}};g._calculateSizeRect=function(q){var r=this,p,n,m,l,o;if(r._isDestroyedState()){return
}q=q||{};m=r.$videoWrapper.parent().width();l=(r._camera.width/r._camera.height);o=(c.isFunction(r._options.videoSizeFitHeight)?r._options.videoSizeFitHeight(r,r._camera):r._options.videoSizeFitHeight);
if(o>0){n={width:o*l,height:o}}else{n={width:m,height:(m/l)}}if(r._isFullscreen){p=c(e);q.width=p.width();q.height=p.height()}else{q.width=Math.min(m,n.width);q.height=n.height}n=f.utils.fitRectIntoFrame(n,q);
return n};g._updateSizeAndLayout=function(){var o=this,m,n,l={};if(o._isDestroyedState()){return}n={};m=o._calculateSizeRect(n);l.width=m.width;if(o._isFullscreen&&o._fullscreenMode!==i.FULLSCREEN_MODE_EXTERNAL&&o._fullscreenMode!==i.FULLSCREEN_MODE_EXTERNAL_EMBEDDED){l.position="absolute";
l.height=m.height;l.top=(n.height-m.height)/2;l.left=l.right=0}else{l.position="";l.height="";l.top="";l.left=l.right=""}o.$videoWrapper.css(l);o._updateDialogSize(m);if(o._cameraPlayer){o._cameraPlayer.updateSize(m.width/m.height)
}if(o._timelineView){o._timelineView.redraw()}o.events.fire("resized")};g._updatePlaypauseButtonAccordingToState=function(){var l=this;if(l._isDestroyedState()){return}l.$wrapperAndFullscreenWrapper.addClass("with-playpause-button");
if(l._state===i.STATE_ARCHIVE_PLAYING&&l._options.allowPauseArchiveStream){if(l._cameraPlayer&&l._cameraPlayer.isPaused()){l.$playpauseButton.attr("title",f.tr(h,"button.play")).button("option","icons",{primary:"ui-icon-play"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l._onPlayButtonClick()
})}else{l.$playpauseButton.attr("title",f.tr(h,"button.pause")).button("option","icons",{primary:"ui-icon-pause"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l._onPauseButtonClick()
})}l.$playpauseButton.button("enable")}else{if(l._state===i.STATE_LIVE_PLAYING&&l._options.allowPauseLiveStream){if(l._cameraPlayer&&l._cameraPlayer.isPaused()){l.$playpauseButton.attr("title",f.tr(h,"button.play_live")).button("option","icons",{primary:"ui-icon-play"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l._onPlayButtonClick()
})}else{l.$playpauseButton.attr("title",f.tr(h,"button.pause_live")).button("option","icons",{primary:"ui-icon-pause"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l._onPauseButtonClick()
})}l.$playpauseButton.button("enable")}else{if((l._state===i.STATE_LIVE_PLAYING&&l._options.allowStopLiveStream)||(l._state===i.STATE_ARCHIVE_PLAYING&&l._options.allowStopArchiveStream)){l.$playpauseButton.attr("title",f.tr(h,"button.stop")).button("option","icons",{primary:"ui-icon-stop"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l.events.fire("stopClicked");
l.clear()});l.$playpauseButton.button("enable")}else{if((l._state===i.STATE_LIVE_LOADING&&l._options.allowStopLiveStream)||(l._state===i.STATE_ARCHIVE_LOADING&&l._options.allowStopArchiveStream)){l.$playpauseButton.attr("title",f.tr(h,"button.stop")).button("option","icons",{primary:"ui-icon-stop"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l.events.fire("stopClicked");
l.clear()});l.$playpauseButton.button("enable")}else{if(l._state===i.STATE_ARCHIVE_LIMITED||l._state===i.STATE_ARCHIVE_ENDED||l._state===i.STATE_ARCHIVE_ERROR){l.$playpauseButton.attr("title",f.tr(h,"button.play")).button("option","icons",{primary:"ui-icon-play"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l.select(l._playheadTime)
});l.$playpauseButton.button("enable")}else{l.$playpauseButton.attr("title",f.tr(h,(l._isArchiveState()?"button.pause":(l._options.allowPauseLiveStream?"button.pause_live":"button.stop")))).button("option","icons",{primary:(l._isArchiveState()||l._options.allowPauseLiveStream?"ui-icon-pause":"ui-icon-stop")});
l.$playpauseButton.unbind("click.ivideon-camera-video-view");l.$playpauseButton.button("disable")}}}}}if(l._isFullscreen&&l._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL){l.$playpauseButton.button("disable")
}};g._updateMuteButtonAccordingToState=function(){var l=this;if(l._isDestroyedState()){return}if(!l._options.audioEnabled){return}if(l._cameraPlayer&&l._cameraPlayer.options.muted){l.$muteButton.attr("title",f.tr(h,"button.unmute")).button("option","icons",{primary:"ui-icon-volume-off"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l._onUnmuteButtonClick()
})}else{l.$muteButton.attr("title",f.tr(h,"button.mute")).button("option","icons",{primary:"ui-icon-volume-on"}).unbind("click.ivideon-camera-video-view").bind("click.ivideon-camera-video-view",function(){l._onMuteButtonClick()
})}if(l._isFullscreen&&l._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL){l._volumeSliderHide();l.$muteButton.button("disable");l.$volumeControl.addClass("ui-state-disabled")}else{l.$muteButton.button("enable");
l.$volumeControl.removeClass("ui-state-disabled")}};g._updateControlsAccordingToState=function(){var l=this;if(l._isDestroyedState()){return}if(l._options.fullscreenButtonEnabled&&l.$fullscreenButton){if(l._isFullscreen){l.$fullscreenButton.attr("title",f.tr(h,"button.fullscreen_exit"+l._fullscreenButtonLangSuffix)).button("option","icons",{primary:"ui-icon-arrowreturnthick-1-w"})
}else{l.$fullscreenButton.attr("title",f.tr(h,"button.fullscreen_enter"+l._fullscreenButtonLangSuffix)).button("option","icons",{primary:"ui-icon-arrow-4-diag"})}l.$wrapperAndFullscreenWrapper.addClass("with-fullscreen-button")
}if(l._isLoadingState()||l._isPlayingState()){l.$videoContainer.show()}if(l._state===i.STATE_LIVE_PLAYING||l._state===i.STATE_ARCHIVE_PLAYING){l.$wrapperAndFullscreenWrapper.addClass("with-time-overlay")
}else{l.$wrapperAndFullscreenWrapper.removeClass("with-time-overlay")}l._updateMuteButtonAccordingToState();l._updatePlaypauseButtonAccordingToState();if(l._options.goToLiveButtonEnabled){if(!l._liveWasPaused&&(l._state===i.STATE_LIVE_LOADING||l._state===i.STATE_LIVE_PLAYING)){l.$goToLiveButton.addClass("m-live")
}else{l.$goToLiveButton.removeClass("m-live")}if(l._isFullscreen&&l._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL){l.$goToLiveButton.button("disable")}else{l.$goToLiveButton.button("enable")}}if(l._cameraPtz){l.$wrapperAndFullscreenWrapper.addClass("should-have-camera-controller")
}else{l.$wrapperAndFullscreenWrapper.removeClass("should-have-camera-controller")}if(l._cameraPtz){if(l._state===i.STATE_LIVE_PLAYING&&!(l._isFullscreen&&l._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL)){if(l._camera.ptzEnabled){l._cameraPtz.enable();
l.$wrapperAndFullscreenWrapper.addClass("with-camera-controller")}}else{l._cameraPtz.disable();l.$wrapperAndFullscreenWrapper.removeClass("with-camera-controller")}}if(l.$qualityControl){if(l._isFullscreen&&l._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL){l.$qualityControl.find(".ui-button").button("disable");
l.$qualityControl.addClass("ui-state-disabled")}else{l.$qualityControl.find(".ui-button").button("enable");l.$qualityControl.removeClass("ui-state-disabled")}}if(l.$speedControl){if(l._isArchiveState()){l.$speedControl.find(".ui-button").button("enable");
l.$speedControl.removeClass("ui-state-disabled")}else{l.$speedControl.find(".ui-button").button("disable");l.$speedControl.addClass("ui-state-disabled")}}l._updateVideoOffset()};g._onPlayButtonClick=function(){this._resumePlayback()
};g._onPauseButtonClick=function(){this._pausePlayback()};g._onMuteButtonClick=function(){this._muteAudio()};g._onUnmuteButtonClick=function(){this._unmuteAudio()};g._onVolumeSliderChange=function(l){this._setAudioVolume(l);
if(l>0){this._unmuteAudio()}};g._pausePlayback=function(){var n=this,m=n._cameraPlayer,l=(((n._state===i.STATE_LIVE_PLAYING&&n._options.allowPauseLiveStream)||(n._state===i.STATE_ARCHIVE_PLAYING&&n._options.allowPauseArchiveStream))&&!!m&&!m.isPaused());
if(l){if(n._state===i.STATE_LIVE_PLAYING){n._liveWasPaused=true}m.pause();n._updateStateDisplayAsync()}};g._resumePlayback=function(){var n=this,m=n._cameraPlayer,l=(n._isPlayingState()&&!!m&&m.isPaused());
if(l){m.play();n._updateStateDisplayAsync()}};g._muteAudio=function(){var n=this,m=n._cameraPlayer,l=(n.isInitialized()&&!!m);if(l){m.setMuted(true);n._updateStateDisplayAsync()}};g._unmuteAudio=function(){var n=this,m=n._cameraPlayer,l=(n.isInitialized()&&!!m);
if(l){m.setMuted(false);n._updateStateDisplayAsync()}};g._setAudioVolume=function(n){var o=this,m=o._cameraPlayer,l=(o.isInitialized()&&!!m);if(l){m.setVolume(n);o._updateStateDisplayAsync()}};g._volumeSliderClearHideTimer=function(){var l=this;
if(l._volumeSliderHideTimer){e.clearTimeout(l._volumeSliderHideTimer);l._volumeSliderHideTimer=null}};g._volumeSliderShow=function(){var l=this;if(l._isDestroyedState()){return}if(!l._options.audioEnabled){return
}if(l._isFullscreen&&l._fullscreenMode===i.FULLSCREEN_MODE_EXTERNAL){return}l._volumeSliderClearHideTimer();l.$volumeSlider.show();l.$controlsContainer.one("mouseenter",function(){l._volumeSliderHide()
})};g._volumeSliderHide=function(l){var m=this;if(m._isDestroyedState()){return}if(!m._options.audioEnabled){return}m._volumeSliderClearHideTimer();if(l){m.$volumeSlider.hide()}else{m._volumeSliderHideTimer=e.setTimeout(function(){m.$volumeSlider.hide()
},500)}};g._onWindowResizeBindUnbind=function(m){var l=this;if(l._isDestroyedState()){return}if(m){if(l._onWindowResizeTimer){e.clearTimeout(l._onWindowResizeTimer);l._onWindowResizeTimer=null}if(!l._onWindowResizeHandler){c(e).bind("resize orientationchange",l._onWindowResizeHandler=function(){if(l._onWindowResizeTimer){e.clearTimeout(l._onWindowResizeTimer);
l._onWindowResizeTimer=null}if(l._isDestroyedState()){return}l._onWindowResizeTimer=e.setTimeout(function(){if(!l._onWindowResizeHandler){return}if(l._isDestroyedState()){return}l._onWindowResize()},l._options.resizeTimeout)
})}}else{if(l._onWindowResizeHandler){c(e).unbind("resize orientationchange",l._onWindowResizeHandler);l._onWindowResizeHandler=null}if(l._onWindowResizeTimer){e.clearTimeout(l._onWindowResizeTimer);l._onWindowResizeTimer=null
}}};g._onWindowResize=function(){var l=this;if(l._isDestroyedState()){return}l._onWindowResizeBindUnbind(false);if(l._isFullscreen){l._videoSize=l._getFullscreenVideoSize();l._updateSizeAndLayout();if(l._fullscreenMode===i.FULLSCREEN_MODE_VIEWPORT){l._handleReselect(i.REASON_RESIZE_FULLSCREEN)
}}else{l._updateSizeAndLayout()}l._onWindowResizeBindUnbind(true)};g._onBodyScrollBindUnbind=function(m){var l=this;if(l._isDestroyedState()){return}if(m){if(l._onBodyScrollTimer){e.clearTimeout(l._onBodyScrollTimer);
l._onBodyScrollTimer=null}if(!l._onBodyScrollHandler){c("body").bind("resize orientationchange",l._onBodyScrollHandler=function(){if(l._onBodyScrollTimer){e.clearTimeout(l._onBodyScrollTimer);l._onBodyScrollTimer=null
}if(l._isDestroyedState()){return}l._onBodyScrollTimer=e.setTimeout(function(){if(!l._onBodyScrollHandler){return}if(l._isDestroyedState()){return}l._onBodyScroll.apply(l,arguments)},l._options.resizeTimeout)
})}}else{if(l._onBodyScrollHandler){c("body").unbind("resize orientationchange",l._onBodyScrollHandler);l._onBodyScrollHandler=null}if(l._onBodyScrollTimer){e.clearTimeout(l._onBodyScrollTimer);l._onBodyScrollTimer=null
}}};g._onBodyScroll=function(){var l=this;if(l._isDestroyedState()){return}l._onBodyScrollBindUnbind(false);l._updateSizeAndLayout();l._onBodyScrollBindUnbind(true)};g._getPlaybackSpeed=function(){var m=this,l=1;
if(m._isDestroyedState()){return l}l=m._cameraPlayer.getSpeed();if(!l){l=(m._streamOptions&&m._streamOptions.videoOptions&&m._streamOptions.videoOptions.speed)}if(!l){l=1}return l};g._getStreamTitleHtml=function(){var n=this,m,l;
if(n._isDestroyedState()){return""}m=n._stream;l=(!m?f.tr(h,"stream.empty"):(n._requestedArchive?f.tr(h,"stream.archive",{archiveRecordStartTime:n._archiveRecordStartTimeString,archiveRecordEndTime:n._archiveRecordEndTimeString,archiveRecordDuration:n._archiveRecordDurationString}):f.tr(h,"stream.live")));
return l};g._getStatusbarHtml=function(p){var n=this,r,t,m,s,l,o,q;if(n._isDestroyedState()){return""}r=n._stream;t=n._options.cameraTitleFactory(n,n._camera);m=n._getStreamTitleHtml();o=(p?String(p.message||p||""):"");
q=f.tr(h,"statusbar.idle");s=(r?n._playheadTime:b);l=(s!==b?k(s).tz(n._timezone).format("D.MM.YYYY H:mm:ss"):"");if(n._state===i.STATE_LIVE_LOADING){q=((n._videoConnectErrorCount+n._videoPlaybackErrorCount)<=1?f.tr(h,"statusbar.live_connecting",{camera:t,streamTitle:m}):f.tr(h,"statusbar.live_connecting_retry",{camera:t,streamTitle:m,retry:((n._videoConnectErrorCount+n._videoPlaybackErrorCount)-1)}))
}else{if(n._state===i.STATE_LIVE_PLAYING){q=f.tr(h,"statusbar.live_playing",{camera:t,streamTitle:m,time:l})}else{if(n._state===i.STATE_LIVE_LIMITED){q=f.tr(h,"statusbar.live_limited",{camera:t,streamTitle:m,time:l})
}else{if(n._state===i.STATE_LIVE_ERROR){q=f.tr(h,"statusbar.live_error",{camera:t,streamTitle:m,time:l,errorText:o})}else{if(n._state===i.STATE_ARCHIVE_LOADING){q=((n._videoConnectErrorCount+n._videoPlaybackErrorCount)<=1?f.tr(h,"statusbar.archive_connecting",{camera:t,streamTitle:m,time:l,archiveRecordStartTime:n._archiveRecordStartTimeString,archiveRecordEndTime:n._archiveRecordEndTimeString,archiveRecordDuration:n._archiveRecordDurationString}):f.tr(h,"statusbar.archive_connecting_retry",{camera:t,streamTitle:m,time:l,archiveRecordStartTime:n._archiveRecordStartTimeString,archiveRecordEndTime:n._archiveRecordEndTimeString,archiveRecordDuration:n._archiveRecordDurationString,retry:((n._videoConnectErrorCount+n._videoPlaybackErrorCount)-1)}))
}else{if(n._state===i.STATE_ARCHIVE_LIMITED){q=f.tr(h,"statusbar.archive_limited",{camera:t,streamTitle:m,time:l,archiveRecordStartTime:n._archiveRecordStartTimeString,archiveRecordEndTime:n._archiveRecordEndTimeString,archiveRecordDuration:n._archiveRecordDurationString})
}else{if(n._state===i.STATE_ARCHIVE_ENDED){q=f.tr(h,"statusbar.archive_ended",{camera:t,streamTitle:m,time:l,archiveRecordStartTime:n._archiveRecordStartTimeString,archiveRecordEndTime:n._archiveRecordEndTimeString,archiveRecordDuration:n._archiveRecordDurationString})
}else{if(n._state===i.STATE_ARCHIVE_PLAYING&&n._cameraPlayer&&n._cameraPlayer.isPaused()){q=f.tr(h,"statusbar.archive_paused",{camera:t,streamTitle:m,time:l,archiveRecordStartTime:n._archiveRecordStartTimeString,archiveRecordEndTime:n._archiveRecordEndTimeString,archiveRecordDuration:n._archiveRecordDurationString})
}else{if(n._state===i.STATE_ARCHIVE_PLAYING){q=f.tr(h,"statusbar.archive_playing",{camera:t,streamTitle:m,time:l,archiveRecordStartTime:n._archiveRecordStartTimeString,archiveRecordEndTime:n._archiveRecordEndTimeString,archiveRecordDuration:n._archiveRecordDurationString})
}else{if(n._state===i.STATE_ARCHIVE_ERROR){q=f.tr(h,"statusbar.archive_error",{camera:t,streamTitle:m,time:l,archiveRecordStartTime:n._archiveRecordStartTimeString,archiveRecordEndTime:n._archiveRecordEndTimeString,archiveRecordDuration:n._archiveRecordDurationString,errorText:o})
}}}}}}}}}}return q};g._getContinuousStreamingTime=function(){return(this._playFirstStartedTime>0?(f.now()-this._playFirstStartedTime):0)};g._hasReachedStreamingLimit=function(){var n=this,m=n._getContinuousStreamingTime(),l=n._continuousStreamingLimit;
return(l>0&&m>=l)};g._updatePlayhead=function(m){var r=this,o=r._isLoadingState(),q=r._isPlayingState(),p=r._isArchiveState(),n=0,l;if(r._isDestroyedState()){return}if(o){n=r._requestedStartTime}else{if(q){n=(m?m.timestamp:r._cameraPlayer.getAbsoluteTime())
}else{n=r._playheadTime}}if(!p){n=Math.min(f.now(),n)}r._playheadTime=n;r._bufferedTime=(m?m.bufferedDuration:r._cameraPlayer.getBufferedDuration());r._playedDuration=(m?m.playedDuration:r._cameraPlayer.getPlayedDuration());
l=r._getPlaybackCursorInfo();r._updatePlaybackCursor(l);if(r._isPlayingState()&&r._hasReachedStreamingLimit()){r._onVideoStreamingLimited()}};g._getPlaybackCursorInfo=function(){var r=this,o=f.require("ivideon.views.TimelineView.Playback"),u={t:b,state:o.STATE_IDLE},p,m,q,n,s,l,v;
if(r._isDestroyedState()){return u}if(!r._timelineView){return u}q=r._isLoadingState();n=r._isPlayingState();if(r._isArchiveState()){p=(r._state===i.STATE_ARCHIVE_LIMITED||r._state===i.STATE_ARCHIVE_ENDED||((q||n)&&r._cameraPlayer&&r._cameraPlayer.isPaused()));
m=((q||n)&&r._cameraPlayer&&r._cameraPlayer.isSuspended());s=(r._state===i.STATE_ARCHIVE_ERROR);v=r._playheadTime}else{if(r._isLiveState()){p=(r._state===i.STATE_LIVE_LIMITED||r._state===i.STATE_LIVE_ENDED||((q||n)&&r._cameraPlayer&&r._cameraPlayer.isPaused()));
m=((q||n)&&r._cameraPlayer&&r._cameraPlayer.isSuspended());s=(r._state===i.STATE_LIVE_ERROR);v=r._playheadTime}}if(typeof v==="number"){if(m||p){l=o.STATE_PAUSED}else{if(s){l=o.STATE_ERROR}else{if(q){l=o.STATE_LOADING
}else{l=o.STATE_PLAYING}}}}u.t=v;u.state=l;return u};g._updatePlaybackCursor=function(s){var p=this,n=f.require("ivideon.views.TimelineView.Playback"),m=p._timelinePlaybackCursor,l,t,r,u=p._options.playheadJumpDisplayThreshold;
if(p._isDestroyedState()){return}if(!p._timelinePlaybackCursor){return}if(typeof s==="undefined"){s=p._getPlaybackCursorInfo()}t=s.t;l=s.state;r=(m.getState()===n.STATE_PLAYING?t-m.getTime():0);if(typeof t==="number"&&t>0){if(p._timelineViewAutoCenterEnabled){var o=p._timelineView.getRange(),q=(o.endTime-o.startTime);
if(l===n.STATE_LOADING||l===n.STATE_PLAYING){if(t<(o.startTime+q/20)||t>(o.endTime-q/20)){p._timelineView.centerAt(t)}}}m.setTime(t,l);if(u>0&&r>(u*p._getPlaybackSpeed())){p._showPlayheadJumpIcon(r)}}else{p._hidePlaybackCursor()
}};g._hidePlaybackCursor=function(){var l=this;if(l._isDestroyedState()){return}if(!l._timelinePlaybackCursor){return}l._timelinePlaybackCursor.setState(f.require("ivideon.views.TimelineView.Playback").STATE_IDLE)
};g._onVideoAppeared=function(){var l=this;if(l._isDestroyedState()){return}l._logState("_onVideoAppeared");l._playStartedTime=f.now();l._playFirstStartedTime=l._playFirstStartedTime||l._playStartedTime;
l._playEndedTime=0;l._updateControlsAccordingToState();if(!l._isVideoAppeared){l._isVideoAppeared=true;l.events.fire("videoAppeared")}};g._onVideoDisappeared=function(m,l){var n=this;if(n._isDestroyedState()){return
}n._logState("_onVideoDisappeared");n._updatePlaybackCursor(n._getPlaybackCursorInfo());n._stopStreamingLimitCheck();n._streamPlayDeferred=null;n._streamFinishedDeferred=null;n._playEndedTime=f.now();n._playedDurationBeforeDisappear+=n._playedDuration;
n._playedDuration=0;n._stream=null;n._cameraPlayer.unload(!n._cameraPlayer.isEngineEmbedded());n._updateControlsAccordingToState();if(n._isVideoAppeared){n._isVideoAppeared=false;n.events.fire("videoDisappeared",{error:m,reason:l})
}};g._onVideoLoadingCancelled=function(l){var n=this,m=n._isArchiveState();if(n._isDestroyedState()){return}n._logState("_onVideoLoadingCancelled");n._onVideoDisappeared(null,l);if(n._isLoadingState()){n._setState(i.STATE_IDLE)
}n.events.fire(m?"archiveLoadCancelled":"liveLoadCancelled",{reason:l})};g._onVideoLoadingError=function(w,q){var t=this,v=t._isArchiveState(),x,u,s,o,n,r,l,p,y,z,m;if(t._isDestroyedState()){return}t._logState("_onVideoLoadingError",""+w,w);
x=t._getStatusbarHtml(w);u=w;while(u){if(u instanceof f.views.CameraStreamPlayer.EngineError){s=u;if((u instanceof f.views.CameraStreamPlayer.FlashRequiredError)){o=u}break}u=u.inner}m={reason:q,error:w,playerEngineError:s,flashRequiredError:o};
t._onVideoDisappeared(w,q);if(!s){++t._videoConnectErrorCount;if(t._isFurtherPlaybackAvailable()){if(t._handleReselect(i.REASON_ERROR)){z=(v?f.tr(h,"video_state_changed.archive_video_loading_error_retry",{statusbar:x}):f.tr(h,"video_state_changed.live_video_loading_error_retry",{statusbar:x}));
m.message=z;t.events.fire("livePlaybackRetry",m);if(!f.app||f.app.isEnded()){return}if(t._options.pingOnError){f.app.service("backendAPI").ping()}return}}}if(t._state===i.STATE_ARCHIVE_LOADING){t._setState(i.STATE_ARCHIVE_ERROR)
}else{if(t._state===i.STATE_LIVE_LOADING){t._setState(i.STATE_LIVE_ERROR)}}if(t._timelineCalendar){t._timelineCalendar.hide()}r=(o?"dialog.flash_required_error":(s?"dialog.player_engine_error":(v?"dialog.archive_video_loading_error":"dialog.live_video_loading_error")));
if(o){n=f.tr(h,r+".install_url")}l=f.tr(h,r+".title");p=f.tr(h,r+".text",(o?{statusbar:x,install_url:n}:{statusbar:x}));y={};z=(o?f.tr(h,"video_state_changed.flash_required_error",{version:o.flashRequiredVersionString}):(s?f.tr(h,"video_state_changed.player_engine_error"):(v?f.tr(h,"video_state_changed.archive_video_loading_error",{statusbar:x}):f.tr(h,"video_state_changed.live_video_loading_error",{statusbar:x}))));
m.message=z;t.events.fire(v?"archivePlaybackFailed":"livePlaybackFailed",m);if(!f.app||f.app.isEnded()){return}if(o){y[f.tr(h,r+".button.install")]=function(){if(t._isDestroyedState()){return}e.open(n)
}}else{if(t._options.pingOnError){f.app.service("backendAPI").ping()}y[f.tr(h,r+".button.retry")]=function(){if(t._isDestroyedState()){return}t._clearDialog();t.select(t._requestedArchive?t._playheadTime:null)
}}t._displayDialog(l,p,y,"m-error"+(o?" m-flash-required":""))};g._onStreamTick=function(m,l){var n=this;if(!f.app||f.app.isEnded()||!n._isPlayingState()){return}n._updatePlayhead(l.status)};g._onStreamStalled=function(o,n){var q=this,p=q._isArchiveState(),m,l;
if(!f.app||f.app.isEnded()||!q._isPlayingState()){return}q._updatePlayhead(n.status);q._logState("_onStreamStalled");m=new i.PlaybackStalledError();l=i.REASON_STALLED;q.events.fire(p?"archivePlaybackStalled":"livePlaybackStalled");
if(q._options.pingOnError){f.app.service("backendAPI").ping()}q._handleVideoPlaybackFinishedOrError(m,l)};g._onStreamMetadata=function(p,n){var q=this,o=n.metadata,m,l;if(!f.app||f.app.isEnded()||!q._isPlayingState()){return
}q._logState("_onStreamMetadata",JSON.stringify(n));q._updatePlayhead(n.status);m=o.fragmentPosition;l=o.fragmentDuration;if(typeof m==="number"&&typeof l==="number"){q._fragment=o;if(q._timelineView){q._loadNewTimelineRecords()
}}};g._onVideoPlaybackCancelled=function(l){var n=this,m=n._isArchiveState();if(n._isDestroyedState()){return}if(n._fullscreenChanging){return}n._logState("_onVideoPlaybackCancelled");n._onVideoDisappeared(null,l);
n._setState(i.STATE_IDLE);n.events.fire(m?"archivePlaybackCancelled":"livePlaybackCancelled",{reason:l})};g._onLiveVideoPlaybackError=function(r,o){var q=this,u,s,p,l,n,t,v,m;if(q._isDestroyedState()){return
}q._logState("_onLiveVideoPlaybackError",""+r,r);++q._videoPlaybackErrorCount;u=q._stream;s=q._getStatusbarHtml(r);q._onVideoDisappeared(r,o);m={reason:o,error:r,playerEngineError:null,flashRequiredError:null};
if(q._isFurtherPlaybackAvailable()&&q._handleReselect(o)){v=f.tr(h,"video_state_changed.live_video_ended_retry",{statusbar:s});m.message=v;q.events.fire("livePlaybackRetry",m);if(!f.app||f.app.isEnded()){return
}if(q._options.pingOnError){f.app.service("backendAPI").ping()}}else{q._setState(i.STATE_LIVE_ENDED);if(q._timelineCalendar){q._timelineCalendar.hide()}p="dialog.live_video_ended";l=f.tr(h,p+".title");
n=f.tr(h,p+".text",{statusbar:s});t={};v=f.tr(h,"video_state_changed.live_video_ended",{statusbar:s});m.message=v;q.events.fire("livePlaybackFailed",m);if(!f.app||f.app.isEnded()){return}if(q._options.pingOnError){f.app.service("backendAPI").ping()
}t[f.tr(h,p+".button.retry")]=function(){if(q._isDestroyedState()){return}q._clearDialog();q.select(q._requestedArchive?q._playheadTime:null)};q._displayDialog(l,n,t,"m-question")}};g._onVideoStreamingLimited=function(){var q=this,s=q._isArchiveState(),r,t,n,p,o,l,m,u;
if(q._isDestroyedState()){return}r=q._continuousStreamingLimit;q._logState("_onVideoStreamingLimited",q._playheadTime,r);q._onVideoDisappeared(null,(s?i.REASON_ARCHIVE_LIMITED:i.REASON_LIVE_LIMITED));if(s){q._setState(i.STATE_ARCHIVE_LIMITED);
o="dialog.archive_streaming_limited"}else{q._setState(i.STATE_LIVE_LIMITED);o="dialog.live_streaming_limited"}t=k(q._playFirstStartedTime).tz(q._timezone).format("D.MM.YYYY H:mm:ss");n=k(q._playEndedTime).tz(q._timezone).format("D.MM.YYYY H:mm:ss");
p=k(r).tz("Etc/UTC").format("H:mm:ss");l=f.tr(h,o+".title");m=f.tr(h,o+".text",{playbackStartTime:t,playbackEndTime:n,playbackLimit:p});u={};q.events.fire(s?"archivePlaybackLimited":"livePlaybackLimited");
if(!f.app||f.app.isEnded()){return}if(s){u[f.tr(h,o+".button.continue_archive")]=function(){if(q._isDestroyedState()){return}q._clearDialog();q.select(q._playheadTime)}}else{u[f.tr(h,o+".button.continue_live")]=function(){if(q._isDestroyedState()){return
}q._clearDialog();q.select(null)}}q._displayDialog(l,m,u,"m-notice")};g._onArchiveVideoPlaybackFinished=function(n){var r=this,t,s,u,o,q,p,l,m,v;if(r._isDestroyedState()){return}s=r._getContinuousStreamingTime();
r._logState("_onArchiveVideoPlaybackFinished",r._playheadTime);t=r._getStatusbarHtml(null);r._onVideoDisappeared(null,n);if(r._isFurtherPlaybackAvailable()){if(r._selectNextArchiveRecord()||r._selectLiveAfterContinuousArchive()){return
}}r._setState(i.STATE_ARCHIVE_ENDED);u=k(r._playFirstStartedTime).tz(r._timezone).format("D.MM.YYYY H:mm:ss");o=k(r._playEndedTime).tz(r._timezone).format("D.MM.YYYY H:mm:ss");q=k(s).tz("Etc/UTC").format("H:mm:ss");
p="dialog.archive_video_ended";l=f.tr(h,p+".title");m=f.tr(h,p+".text",{statusbar:t,playbackStartTime:u,playbackEndTime:o,playbackLimit:q});v={};r.events.fire("archivePlaybackEnded",{reason:n});if(!f.app||f.app.isEnded()){return
}r._displayDialog(l,m,v,"question");r._loadNewTimelineRecords()};g._onArchiveVideoPlaybackError=function(t,n){var r=this,u,s,v,o,q,p,l,m,w;if(r._isDestroyedState()){return}s=r._getContinuousStreamingTime();
r._logState("_onArchiveVideoPlaybackError",""+t,t);++r._videoPlaybackErrorCount;u=r._getStatusbarHtml(t);r._onVideoDisappeared(t,n);if(r._isFurtherPlaybackAvailable()){if(r._handleReselect(n)){return}if((r._videoConnectErrorCount===0)&&(r._selectNextArchiveRecord()||r._selectLiveAfterContinuousArchive())){return
}}r._setState(i.STATE_ARCHIVE_ERROR);v=k(r._playFirstStartedTime).tz(r._timezone).format("D.MM.YYYY H:mm:ss");o=k(r._playEndedTime).tz(r._timezone).format("D.MM.YYYY H:mm:ss");q=k(s).tz("Etc/UTC").format("H:mm:ss");
p="dialog.archive_video_error";l=f.tr(h,p+".title");m=f.tr(h,p+".text",{statusbar:u});w={};r.events.fire("archivePlaybackFailed",{reason:n,error:t});if(!f.app||f.app.isEnded()){return}if(r._options.pingOnError){f.app.service("backendAPI").ping()
}w[f.tr(h,p+".button.retry")]=function(){if(r._isDestroyedState()){return}r._clearDialog();r.select(r._requestedArchive?r._playheadTime:null)};r._displayDialog(l,m,w,"error");r._loadNewTimelineRecords()
};g._getArchiveRecordNearTime=function(n){var o=this,m=o._options.archiveStreamEndThresholdInMs*o._getPlaybackSpeed(),l;o._assertNotDestroyed();if(n<=0||!o._camera.timeline){return null}l=o._camera.timeline.select(n-m,b,true);
return l};g._getNextArchiveRecord=function(){var o=this,n=o._playheadTime,m=o._options.archiveStreamEndThresholdInMs*o._getPlaybackSpeed(),l;o._assertNotDestroyed();if(n<=0||!o._camera.timeline){return null
}l=o._camera.timeline.select(n+m,b,true);return l};g._isPlayheadNearArchiveRecordEnd=function(){var o=this,n=o._playheadTime,m=o._options.archiveStreamEndThresholdInMs*o._getPlaybackSpeed(),l=o._getArchiveRecordNearTime(n);
return(l&&((l.endTime-n)<=(m>=0?m:0)))};g._isFurtherPlaybackAvailable=function(){var n=this,m=n._isArchiveState(),l;n._assertNotDestroyed();l=n._checkAccess();if(m&&l.archive!==true){return false}if(!m&&l.live!==true){return false
}return !n._hasReachedStreamingLimit()};g._selectNextArchiveRecord=function(){var o=this,l,n,m;o._assertNotDestroyed();l=o._checkAccess();if(l.archive!==true){return false}n=o._isPlayheadNearArchiveRecordEnd();
if(n){m=o._getNextArchiveRecord();if(m){return o._handleSelect(m.startTime,i.REASON_CONTINUE)}}else{return o._handleSelect(o._playheadTime,i.REASON_CONTINUE)}return false};g._selectLiveAfterContinuousArchive=function(){var n=this,l,m;
n._assertNotDestroyed();l=n._checkAccess();if(l.live!==true){return false}m=f.now();if((m-n._playheadTime)<n._options.archiveContinueToLiveThresholdInMs){return n._handleSelect(m,i.REASON_CONTINUE)}return false
};g._checkAccess=function(){var o=this,n=(!o._camera.liveEnabled),m=(!o._camera.archiveEnabled||!o._options.archiveEnabled),l=(!o._camera.online);return{live:(n?new i.AccessDeniedError():(l?new i.CameraOfflineError():true)),archive:(m?new i.AccessDeniedError():true)}
};g._handleSelect=function(p,t){var v=this,y,r,o,q,w,u,s,x,n;v._assertNotDestroyed();if(p!==null&&(typeof p!=="number"||p<=0)){throw new f.utils.ArgumentError(d+'#_handleSelect: Argument "time" is incorrect.')
}v._logState("_handleSelect",p);n=f.now();y=true;if(p===null||p>=n){y=false;p=n}r=v._checkAccess();if(y&&r.archive!==true){o=r.archive}else{if(!y&&r.live!==true){o=r.live}}if(o){v._handleClear(null,t);
return false}q=(v._getContinuousStreamingTime()>0);v._handleClear(null,t);if((!v._requestedArchive&&y)||(v._requestedArchive&&!y)){w=true}if(v._requestedArchive&&y&&p!==v._requestedStartTime){w=true}if(w){v._videoConnectErrorCount=0;
v._videoPlaybackErrorCount=0}v._fragment=null;v._bufferedTime=0;if(y){u=v._timelineView.getRange();s=v._camera.timeline.select(p,u.endTime,true);if(s&&s.startTime>p){p=s.startTime}v._requestedArchive=true;
v._playheadTime=v._requestedStartTime=p;v._continuousStreamingLimit=v._options.archiveStreamingLimitInMs;v._requestedEndTime=p+4*f.HOUR_IN_MS;v._archiveRecordStartTimeString=k(v._requestedStartTime).tz(v._timezone).format("D.MM.YYYY H:mm:ss");
v._archiveRecordEndTimeString=k(v._requestedEndTime).tz(v._timezone).format("D.MM.YYYY H:mm:ss");v._archiveRecordDurationString=k(v._requestedEndTime-v._requestedStartTime).tz("Etc/UTC").format("H:mm:ss")
}else{v._requestedArchive=false;v._playheadTime=v._requestedStartTime=p;v._continuousStreamingLimit=v._options.liveStreamingLimitInMs;v._requestedEndTime=p+v._continuousStreamingLimit*v._getPlaybackSpeed();
v._archiveRecordStartTimeString="";v._archiveRecordEndTimeString="";v._archiveRecordDurationString=""}if(y){try{v._streamPlayDeferred=null;v._streamFinishedDeferred=null;v._stream=f.app.service("streamerAPI").createArchiveStream(v._camera,c.extend({startTime:v._requestedStartTime,endTime:v._requestedEndTime},v._streamOptions))
}catch(m){x=m;f.reportError(m)}v._setState(i.STATE_ARCHIVE_LOADING);try{if(v._stream){v._updateQualityControl(v._stream.options.videoOptions.quality);v._streamPlayDeferred=v._cameraPlayer.load(v._stream)
}}catch(l){x=l;f.reportError(l)}}else{try{v._streamPlayDeferred=null;v._streamFinishedDeferred=null;v._stream=f.app.service("streamerAPI").createLiveStream(v._camera,v._streamOptions)}catch(A){x=A;f.reportError(A)
}v._setState(i.STATE_LIVE_LOADING);try{if(v._stream){v._updateQualityControl(v._stream.options.videoOptions.quality);v._streamPlayDeferred=v._cameraPlayer.load(v._stream)}}catch(z){x=z;f.reportError(z)
}}v._updatePlayhead();if(!v._streamPlayDeferred){v._handleVideoLoadingError(x,t);return false}v._streamPlayDeferred.done(function(B){if(!v._streamPlayDeferred){return}v._streamFinishedDeferred=B;v._handleVideoLoaded();
if(q&&!v._requestedArchive&&(v._camera.archiveEnabled&&v._options.archiveEnabled)){v._showVideoStateIcon("go-to-live")}}).fail(function(B){if(!v._streamPlayDeferred){return}v._handleVideoLoadingError(B,(B?i.REASON_ERROR:t))
});return true};g._handleReselect=function(m){var n=this;n._assertNotDestroyed();n._logState("_handleReselect");if(n._isLiveState()||n._isArchiveState()){var l=n._requestedArchive;if((m!==i.REASON_STALLED&&m!==i.REASON_ERROR&&m!==i.REASON_STREAM_FINISHED)||((n._videoConnectErrorCount+n._videoPlaybackErrorCount)<(l?n._options.archiveVideoAutoRetryCount:n._options.liveVideoAutoRetryCount))){return n._handleSelect(l?n._playheadTime:null,m)
}}return false};g._handleClear=function(m,l){var n=this;n._assertNotDestroyed();n._logState("_handleClear",""+m,l,m);n._hideVideoStateIcon();if(n._isLoadingState()){n._onVideoLoadingCancelled(l)}else{if(n._isPlayingState()){n._onVideoPlaybackCancelled(l)
}}n._setState(i.STATE_IDLE)};g._resetPlaybackCounters=function(){var l=this;l._videoConnectErrorCount=0;l._videoPlaybackErrorCount=0;l._playStartedTime=0;l._playFirstStartedTime=0;l._playEndedTime=0;l._playedDuration=0;
l._playedDurationBeforeDisappear=0;l._continuousStreamingLimit=0;l._bufferedTime=0};g._handleVideoLoaded=function(){var l=this;l._logState("_handleVideoLoaded");if(l._state===i.STATE_ARCHIVE_LOADING){l._setState(i.STATE_ARCHIVE_PLAYING);
l._videoConnectErrorCount=0;if(l._timelineView){l._loadNewTimelineRecords()}}else{if(l._state===i.STATE_LIVE_LOADING){l._setState(i.STATE_LIVE_PLAYING);l._videoConnectErrorCount=0}else{return}}l._onVideoAppeared();
e.setTimeout(function(){if(!l._streamFinishedDeferred){return}l._streamFinishedDeferred.done(function(o){if(!l._streamFinishedDeferred){return}l._updatePlayhead(o.status);var n=new i.PlaybackInterruptedError(),m=i.REASON_STREAM_FINISHED;
l._handleVideoPlaybackFinishedOrError(n,m)}).fail(function(o){if(!l._streamFinishedDeferred){return}l._updatePlayhead(o.status);var n=o.error,m=(n?i.REASON_ERROR:i.REASON_CLEAR);l._handleVideoPlaybackFinishedOrError(n,m)
})},0)};g._handleVideoLoadingError=function(m,l){var n=this;if(n._isDestroyedState()){return}if(!m&&n._fullscreenChanging){return}n._logState("_handleVideoLoadingError",""+m,l,m);if(m){n._onVideoLoadingError(m,l)
}else{n._onVideoLoadingCancelled(l)}};g._handleVideoPlaybackFinishedOrError=function(m,l){var o=this,n;o._logState("_handleVideoPlaybackFinishedOrError",""+m,l,m);if(o._state===i.STATE_ARCHIVE_PLAYING){n=o._isPlayheadNearArchiveRecordEnd();
if(n){o._onArchiveVideoPlaybackFinished(l)}else{if(m){o._onArchiveVideoPlaybackError(m,l)}else{o._onVideoPlaybackCancelled(l)}}}else{if(o._state===i.STATE_LIVE_PLAYING){if(m){if(!o._handleReselect(l)){o._onLiveVideoPlaybackError(m,l)
}}else{o._onVideoPlaybackCancelled(l)}}}};g._displayIdleDialog=function(){var p=this,o,l,n,m;p._assertNotDestroyed();if(p._camera.online){l="dialog.idle.title";m="dialog.idle.text"}else{l="dialog.idle_offline.title";
m="dialog.idle_offline.text"}o=f.trSilent(h,l);n=f.trSilent(h,m);p._displayDialog(o,n,{},"m-idle")};g._displayFullscreenExternalDialog=function(){var l=this;l._assertNotDestroyed();l._fullscreenExternalDialogTimer=e.setTimeout(function(){if(l._isDestroyedState()){return
}l._fullscreenExternalDialogTimer=null;l._displayDialog(f.tr(h,"dialog.fullscreen_external.title"),f.tr(h,"dialog.fullscreen_external.text"),{},"m-fullscreen_external")},l._options.fullscreenExternalDialogDelay)
};g._clearDialog=function(){var l=this;l._assertNotDestroyed();if(l.$dialog){l.$dialog.remove();l.$dialog=null}l.$dialogWrapper.hide()};g._displayDialog=function(r,o,n,q){var s=this,p,m,l;s._assertNotDestroyed();
s._clearDialog();p=c('<div class="ivideon-camera-video-view-dialog '+(q||"")+'" />');m=c('<div class="ivideon-camera-video-view-dialog-message"><div class="ivideon-camera-video-view-dialog-header"></div><div class="ivideon-camera-video-view-dialog-content"></div></div>');
l=c('<div class="ivideon-camera-video-view-dialog-buttons" />');m.find(".ivideon-camera-video-view-dialog-header").html(r||"");m.find(".ivideon-camera-video-view-dialog-content").html(o||"");c.each(n,function(w,v){var u,t,x=c('<button type="button" class="iv-btn" />');
if(typeof v==="function"){u=w;t=v}else{u=v.text;t=v.click}if(u){x.html(u)}if(t){x.click(t)}l.append(x)});p.append(m).append(l);s.$dialogWrapperInner.append(p);s.$dialog=p;s.$dialogWrapper.show();s._updateDialogSize()
};g._updateDialogSize=function(l){var m=this;m._assertNotDestroyed();l=l||m._calculateSizeRect();m.$dialogWrapper.css("height",l.height)}}(window,window._ivideon));(function(c,h,f){"use strict";var d=h.$,e=a,b=e.prototype,g="ivideon.views.CameraVideoWindow";
h.provide(g,e);function a(i){var j=this;j._options=h.optClass(e.defaults,i,g,j,{_camera:"camera"});j.events=new (h.require("ivideon.utils.Observable"))(j);j._overlay=null;if(e._singleton){e._singleton.destroy();
e._singleton=null}e._singleton=j;j._setState(e.STATE_NEW)}e.defaults={cameraMenuEnabled:true,animatePanels:!(d.browser.msie&&d.browser.version<9),cameraWindowTitleFactory:function(i){return i.title}};e._singleton=null;
e.STATE_NEW=1;e.STATE_CREATED=2;e.STATE_VISIBLE=3;e.STATE_HIDDEN=4;e.STATE_DESTROYED=5;b.getCamera=function(){var i=this;if(i._state===e.STATE_DESTROYED){return}return i._camera};b.getCameraVideoView=function(){var i=this;
if(i._state===e.STATE_DESTROYED){return}return i._cameraVideoView};b.open=function(){var i=this;if(i._state===e.STATE_DESTROYED){return this}h.require("ivideon.utils.overlay")({stopEvents:false}).done(function(j){i._overlay=j;
i._createContent(i._overlay.$content);i._overlay.$element.on("click",function(k){if(k.target===i._overlay.$content[0]||k.target===i._overlay.$element[0]){i.close();return false}});i._overlay.$content.on("scroll",function(){i.closeMenu()
});i._onOpen()});return this};b.center=function(){var i=this;if(i._state===e.STATE_DESTROYED){return this}return this};b.close=function(){var i=this;if(i._state===e.STATE_DESTROYED){return this}if(i._onBeforeClose()!==false){i._onClose()
}return this};b.closeMenu=function(){var i=this;if(i._state===e.STATE_DESTROYED){return this}if(h.app.hasService("cameraMenuController")&&i._camera&&i.$menuButton){if(h.app.service("cameraMenuController").isOpen(i._camera,i.$menuButton[0])){h.app.service("cameraMenuController").close()
}}};b.isPanelVisible=function(i){return false};b.getPanelContainer=function(i){return d([])};b.togglePanel=function(i,j,l){var k=this;if(k._state===e.STATE_DESTROYED){return}if(d.isFunction(l)){l()}};b.updateSize=function(){var i=this;
if(i._state===e.STATE_DESTROYED){return}i.$videoWindow.add(i.$videoWindowWidget).css({height:"auto"})};b.updateTitle=function(){var i=this;if(i._state===e.STATE_DESTROYED){return}i.$title.text(i._options.cameraWindowTitleFactory(i._camera)||"")
};b.destroy=function(){this.close()};b._setState=function(i){var j=this;if(!i){throw new Error("state")}if(j._state===e.STATE_DESTROYED){return}j._state=i};b._createContent=function(i){var j=this;j.$videoWindowWidget=d('<div class="ivideon-camera-video-window ui-dialog ui-widget ui-widget-content ui-corner-all"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title"></span>'+(h.app.hasService("cameraMenuController")&&j._options.cameraMenuEnabled?'<span class="b-camera-menu"><span class="b-camera-menu-button ui-dialog-titlebar-button"></span></span>':"")+'<a href="javascript:void(0)" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick"></span></a></div><div class="ivideon-camera-video-window-content ui-dialog-content ui-widget-content"><div class="ivideon-camera-video-window-panel-player"></div></div></div>');
j.$videoWindowWidget.css("visibility","hidden");j.$videoWindow=j.$videoWindowWidget.find(".ivideon-camera-video-window-content");j.$titlebar=j.$videoWindowWidget.find(".ui-dialog-titlebar");j.$title=j.$titlebar.find(".ui-dialog-title");
j.$closeButton=j.$titlebar.find(".ui-dialog-titlebar-close");d.event.add(j.$closeButton[0],c.Modernizr.touch?"touchstart":"mousedown",function(k){k.stopPropagation()});d.event.add(j.$closeButton[0],"click",function(k){k.preventDefault();
j.close()});j.$menuButton=j.$titlebar.find(".b-camera-menu-button");if(h.app.hasService("cameraMenuController")&&j._options.cameraMenuEnabled){d.event.add(j.$menuButton[0],c.Modernizr.touch?"touchstart":"mousedown",function(k){k.stopPropagation()
});d.event.add(j.$menuButton[0],"click",function(k){k.stopPropagation();k.preventDefault();if(h.app.service("cameraMenuController").isOpen(j._camera,j.$menuButton[0])){h.app.service("cameraMenuController").close()
}else{if(j._camera.enabled){h.app.service("cameraMenuController").open(j._camera,j.$menuButton[0],i)}}})}j.$playerPanel=j.$videoWindow.find(".ivideon-camera-video-window-panel-player");j.updateTitle();
j.$videoWindowWidget.appendTo(i);j._setState(e.STATE_CREATED)};b._onOpen=function(){var i=this;if(i._state===e.STATE_DESTROYED){return}i._setState(e.STATE_VISIBLE);i._cameraVideoView=new (h.require("ivideon.views.CameraVideoView"))(d.extend({},i._options.cameraVideoViewOptions,{camera:i._camera,container:i.$playerPanel,timelineCalendarButtonOptions:{calendarContainer:i._overlay.$content}}));
i._updateSizeAndLayout();i._cameraVideoView.events.on("initialized",i._onCameraVideoViewInitialized,i);i._cameraVideoView.events.on("resized",i._onCameraVideoViewResized,i);i.events.fire("camera-video-view-created");
i._cameraVideoView.init()};b._onCameraVideoViewInitialized=function(){var i=this;if(i._state===e.STATE_DESTROYED){return}i._updateSizeAndLayout();i.$videoWindowWidget.css("visibility","inherit");i.events.fire("show");
i.events.fire("opened")};b._onCameraVideoViewResized=function(){var i=this;if(i._state===e.STATE_DESTROYED){return}i._updateSizeAndLayout()};b._onBeforeClose=function(){var i=this;if(i._state===e.STATE_DESTROYED){return
}if(i._cameraVideoView){i._cameraVideoView.destroy();i._cameraVideoView=null}i.closeMenu();i._setState(e.STATE_HIDDEN);i.events.fire("hide");i.events.fire("closed")};b._onClose=function(){var j=this,i;
if(j._state===e.STATE_DESTROYED){return}j._setState(e.STATE_DESTROYED);j.events.fire("destroying");j.events.un();if(j._overlay){j._overlay.destroy();j._overlay=null}for(i in j){if(j.hasOwnProperty(i)&&i.charAt(0)==="$"){delete j[i]
}}};b._getRequiredSizes=function(){var l=this,j=l._cameraVideoView.getRequiredSize(),i={width:0,height:0},k={width:j.width+i.width,height:j.height+i.height};return{playerRequiredSize:j,panelsRequiredSize:i,totalRequiredSize:k}
};b._updateSizeAndLayout=function(){var m=this,j,l,i,k;if(m._state===e.STATE_DESTROYED){return}j=m._getRequiredSizes(true);l=j.totalRequiredSize;i=l.width;k=l.height;m.$videoWindowWidget.css({width:i,height:k+m.$titlebar.outerHeight()});
m.$playerPanel.css({width:j.playerRequiredSize.width,height:j.playerRequiredSize.height})}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,i=a,g=i.prototype,d="ivideon.views.ServersList",j=d;
f.provide(d,i);function h(k){k.stopPropagation()}function a(k){var l=this;l._options=f.optClass(i.defaults,k,d,l,{$container:"container",_servers:"servers",_serversSelection:"serversSelection ?",_heightFitter:"heightFitter ?"});
l.events=new (f.require("ivideon.utils.Observable"))(l);l._misprintFixer=f.require("ivideon.utils.ListFilter.cyrillicFixer");l._valueHighlighter=f.require("ivideon.utils.ListFilter.valueHighlighter");l._getHighlightedHTML=f.require("ivideon.utils.ListFilter.getHighlightedHTML");
l._highlightBoundaries=(f.require("ivideon.utils.ListFilter.getHighlightBoundaries"))();l._camerasLists={};l._userInteractionEnabled=true;l._filter="";l.$wrapper=c('<div class="ivideon-servers-list '+(l._options.cssClasses||"")+'"><div class="ivideon-servers-list-items">'+(l._options.noCamerasPlaceholderEnabled===true?'<div class="ivideon-servers-list-no-cameras-placeholder">'+f.tr(j,"no_cameras")+"</div>":"")+'<div class="ivideon-servers-list-no-filter-matches-message" style="display:none;">'+f.tr(j,"no_matches")+'</div></div><div class="ivideon-servers-list-drop-targets"><div class="ivideon-servers-list-drop-target m-remove"><span class="h-text"><span class="b-text" /></span></div><div class="ivideon-servers-list-drop-target m-cancel"><span class="h-text"><span class="b-text" /></span></div></div></div>').appendTo(l.$container);
l.$serversList=l.$wrapper.find(".ivideon-servers-list-items");l.$dropTargets=l.$wrapper.find(".ivideon-servers-list-drop-targets");l.$dragCancel=l.$wrapper.find(".ivideon-servers-list-drop-target.m-cancel");
l.$dragCancelText=l.$dragCancel.find(".b-text");l.$dragRemove=l.$wrapper.find(".ivideon-servers-list-drop-target.m-remove");l.$dragRemoveText=l.$dragRemove.find(".b-text");l.$dragCancelText.html(f.tr(j,"marker.drag.cancel"));
l.$dragRemoveText.html(f.tr(j,"marker.drag.remove"));l.$noCamerasPlaceholder=l.$serversList.find(".ivideon-servers-list-no-cameras-placeholder");l.$noMatchesMessage=l.$serversList.find(".ivideon-servers-list-no-filter-matches-message");
l.$dropTargets.hide();if(l._options.scrollableViewEnabled){l._scrollable=new (f.require("ivideon.utils.ScrollableView"))(f.optMerge(l._options.scrollableViewOptions,{wrapper:l.$wrapper,onDragScrollStart:function(){l._userInteractionEnabled=false;
var m;for(m in l._camerasLists){if(l._camerasLists.hasOwnProperty(m)){l._camerasLists[m].setUserInteractionEnabled(false)}}},onDragScrollEnd:function(){l._userInteractionEnabled=true;var m;for(m in l._camerasLists){if(l._camerasLists.hasOwnProperty(m)){l._camerasLists[m].setUserInteractionEnabled(true)
}}}}))}if(l._options.serverDraggingEnabled){l._serverDraggingStyle=f.utils.convertIntegerCSS(f.utils.extractCSS("ivideon-servers-list-item-header m-drag-helper",["backgroundImage","width","height","minWidth","minHeight"],c(l._options.serverDraggingAppendTo)));
l._serverDraggingCursorAt=(l._serverDraggingStyle.minWidth&&l._serverDraggingStyle.minHeight?{left:l._serverDraggingStyle.minWidth,top:l._serverDraggingStyle.minHeight}:b)}if(l._options.serverMarkerDraggingEnabled){l._serverMarkerDraggingStyle=f.utils.convertIntegerCSS(f.utils.extractCSS("ivideon-servers-list-item-marker m-drag-helper",["backgroundImage","width","height","minWidth","minHeight"],c(l._options.serverMarkerDraggingAppendTo)));
l._serverMarkerDraggingCursorAt=(l._serverMarkerDraggingStyle.minWidth&&l._serverMarkerDraggingStyle.minHeight?{left:l._serverMarkerDraggingStyle.minWidth,top:l._serverMarkerDraggingStyle.minHeight}:b)
}l._servers.forEach(function(n,m){l._addServerView(n,m,true)});l._servers.events.on("added",l._onServerAdded,l);l._servers.events.on("removed",l._onServerRemoved,l);if(l._serversSelection){l._serversSelection.events.on("added",l._onServerSelected,l);
l._serversSelection.events.on("removed",l._onServerDeselected,l)}if(l._heightFitter){l._heightFitter.add(l.$wrapper);l._heightFitter.events.on("height-changed",l._onHeightFitterHeightChanged,l)}l.filter(l._filter);
l._setState(i.STATE_CREATED)}i.STATE_CREATED=1;i.STATE_DESTROYED=2;i.DRAG_DISTANCE=3;i.defaults={serverDraggingEnabled:false,serverDraggingAllowed:function(){return true},serverDraggingAppendTo:"body",serverDraggingContainment:"body",serverOwnerEnabled:true,serverMarkerEnabled:true,serverMarkerDraggingEnabled:false,serverMarkerDraggingAllowed:function(){return true
},serverMarkerDraggingAppendTo:"body",serverMarkerDraggingContainment:"body",camerasListEnabled:false,serverTitleFactory:function(k){return k.name},scrollableViewEnabled:true};g.getCamerasListView=function(l){var m=this,k=m._servers.findKey(l);
return m._camerasLists[k]};g.updateSize=function(k){var l=this;if(l._state===i.STATE_DESTROYED){return}if(l._scrollable){l._scrollable.refresh(k)}};g.scrollToServer=function(l){var n=this,k,m=0;if(n._state===i.STATE_DESTROYED){return
}if(n._scrollable){if(l){k=n._getServerElementById(l.id).filter(":visible");if(k.length){m=k.position().top;n._scrollable.scrollTo(0,m)}}}};g.scrollToCamera=function(l){var n=this,k,m=0;if(n._state===i.STATE_DESTROYED){return
}if(n._scrollable){if(l){if(n._options.camerasListEnabled){k=n._getServerElementById(l.serverId).filter(":visible").find('.ivideon-servers-list-item-cameras .ivideon-camera[data-serverId="'+l.serverId+'"][data-cameraId="'+l.cameraId+'"]:visible')
}else{k=n._getServerElementById(l.serverId).filter(":visible")}if(k.length){m=k.position().top;n._scrollable.scrollTo(0,m)}}}};g.getClosestVisibleServer=function(l){var o=this,n,m,k;if(o._state===i.STATE_DESTROYED){return
}m=l;while(!n&&m<o._servers.length){n=o._servers.getByIndex(m);if(n){k=o._getServerElementById(n.id);if(!k.length||k.hasClass("m-hidden")){n=b}}++m}if(!n&&o._servers.length>0&&m===o._servers.length){m=l-1;
while(!n&&m>=0){n=o._servers.getByIndex(m);if(n){k=o._getServerElementById(n.id);if(!k.length||k.hasClass("m-hidden")){n=b}}--m}}return n};g.filter=function(r){var A=this,q=false,t=false,z,o,p,k,n,B,w,y,x,l,m,u,s,v;
if(A._state===i.STATE_DESTROYED){return}r=(r||"");A._filter=r;v={filter:r,valueGetter:function(C){return(!C.owner?String(C.name||"")+A._highlightBoundaries.divider+String(C.given_by||""):String(C.name||""))
},valueHighlighter:A._valueHighlighter,highlighterBoundaries:A._highlightBoundaries,misprintFixer:A._misprintFixer,caseSensitive:false};p=A._servers.filter(v);for(B=0,w=p.length;B<w;++B){y=p[B];x=y.item;
k=A.getCamerasListView(x);n=k.filter(r);if(n.matched.length>0){y.matched=true}l=A._getServerElementById(x.id);m=l.find(".b-server-name");u=l.find(".b-server-owner");l[r?"addClass":"removeClass"]("m-filtered");
if(y.matched){s=y.highlighted.split(A._highlightBoundaries.dividerRE);m.html(A._getHighlightedHTML(s[0],A._highlightBoundaries));if(s.length>1){u.html(A._getHighlightedHTML(s[1],A._highlightBoundaries))
}l.removeClass("m-hidden").show();q=true;t=true}else{m.text(x.name||"");if(!x.owner){u.text(x.given_by||"")}l.addClass("m-hidden").hide();q=true}}z=(!!r&&!t);o=(A._options.noCamerasPlaceholderEnabled===true&&!z&&!t);
A.$noMatchesMessage.css("display",(z?"":"none"));A.$noCamerasPlaceholder.css("display",(o?"":"none"));if(q){A.updateSize()}return p};g.startServerMarkerDragging=function(p,o,n){var q=this,l,k,m;if(q._state===i.STATE_DESTROYED){return
}if(p){l=q._getServerElementById(p.id);if(l.length&&!l.hasClass("m-hidden")&&l.hasClass("m-has-marker")){k=l.find(".ivideon-servers-list-item-header");m=k.find(".b-server-marker");q._simulateDragStart(m,o,n)
}}};g.acceptServerMarkerDrag=function(o,n,m,l){var p=this,k=false;if(p._state===i.STATE_DESTROYED){return false}if(l){k=p._handleServerMarkerDrop(o,n,m)}else{p.$dragCancel[p._isOverDropTarget(p.$dragCancel,n,m)?"addClass":"removeClass"]("m-active").show();
if(o.hasMarker()){p.$dragRemove[p._isOverDropTarget(p.$dragRemove,n,m)?"addClass":"removeClass"]("m-active").show()}else{p.$dragRemove.hide()}p.$dragCancelText.html(f.tr(j,o.hasMarker()?"marker.drag.cancel":"marker.drag.cancel_add"));
p.$dropTargets.show()}return k};g.destroy=function(){var l=this,k;if(l._state===i.STATE_DESTROYED){return}l.events.fire("destroying");l.events.un();l._setState(i.STATE_DESTROYED);l._servers.events.un("added",l._onServerAdded,l);
l._servers.events.un("removed",l._onServerRemoved,l);l._servers.forEach(function(n,m){l._removeServerView(n,m,true)});if(l._serversSelection){l._serversSelection.events.un("added",l._onServerSelected,l);
l._serversSelection.events.un("removed",l._onServerDeselected,l);l._serversSelection=null}if(l._heightFitter){l._heightFitter.events.un("height-changed",l._onHeightFitterHeightChanged,l);l._heightFitter.remove(l.$wrapper);
l._heightFitter=null}if(l._scrollable){l._scrollable.destroy();l._scrollable=null}l.$wrapper.remove();l._servers=null;for(k in l){if(l.hasOwnProperty(k)&&k.charAt(0)==="$"){delete l[k]}}};g._setState=function(k){var l=this;
if(!k){throw new f.utils.ArgumentError(d+'#_setState: Argument "state" not set.')}if(l._state===i.STATE_DESTROYED){return}l._state=k};g._simulateDragStart=function(s,n,l){var q=this,m,o,k,r,p;if(q._state===i.STATE_DESTROYED){return
}m=s.offset();if(typeof n!=="number"||typeof l!=="number"){n=m.left;l=m.top}if((Math.max(Math.abs(n-m.left),Math.abs(l-m.top))<i.DRAG_DISTANCE)){m.left-=i.DRAG_DISTANCE;m.top-=i.DRAG_DISTANCE}if(e.Modernizr.touch&&(c.ui&&c.ui.mouse&&c.ui.mouse.prototype&&c.ui.mouse.prototype._touchStart)){r={pageX:m.left,pageY:m.top,screenX:m.left,screenY:m.top,clientX:m.left,clientY:m.top};
p={pageX:n,pageY:l,screenX:n,screenY:l,clientX:n,clientY:l};o=c.Event("touchstart",{target:s[0],originalEvent:{touches:[r],changedTouches:[r],targetTouches:[r]}});k=c.Event("touchmove",{target:s[0],originalEvent:{touches:[p],changedTouches:[p],targetTouches:[p]}})
}else{o=c.Event("mousedown",{target:s[0],which:1,pageX:m.left,pageY:m.top});k=c.Event("mousemove",{target:s[0],which:1,pageX:n,pageY:l})}s.trigger(o);s.trigger(k)};g._isOverDropTarget=function(l,n,m){var p=l.offset(),k=(n>=0&&p?n-p.left:-1),q=(m>=0&&p?m-p.top:-1),o=(k>=0&&q>=0&&k<l.width()&&q<l.height());
return o};g._handleServerMarkerDrop=function(n,m,l){var o=this,k=false;if(o._isOverDropTarget(o.$dragCancel,m,l)){k=true}else{if(o._isOverDropTarget(o.$dragRemove,m,l)){o.events.fire("server-marker-remove-requested",{server:n});
k=true}}o.$dropTargets.hide();return false};g._onServerAdded=function(l,k){this._addServerView(k.item,k.key)};g._onServerRemoved=function(l,k){this._removeServerView(k.item,k.key)};g._onServerSelected=function(l,k){this._displaySelection(k.item,true)
};g._onServerDeselected=function(l,k){this._displaySelection(k.item,false)};g._onHeightFitterHeightChanged=function(l,k){var m=this;if(m._state===i.STATE_DESTROYED){return}if(k.target===m.$wrapper[0]){m.updateSize()
}};g._getServerElementById=function(l){var m=this,k=m.$serversList.children('[data-serverId="'+l+'"]');return k};g._addServerView=function(o,y,q){var s=this,t,w,k,m,n,x,u,z,p,l,A,v,r;if(s._state===i.STATE_DESTROYED){return
}t=s._servers.getIndex(y);if(typeof t!=="number"){return}r=(o.need_activation===true&&s._options.serverActivationEnabled&&o.getActivationDisplayType()==="dvr");w=c('<div class="ivideon-servers-list-item'+(o.latitude!==null&&o.longitude!==null?" m-has-marker":"")+(o.online?" m-online":" m-offline")+(o.owner===true?" m-owner":" m-not-owner")+(r===true?" m-not-activated":" m-activated")+'" data-serverId="'+o.id+'"><div class="ivideon-servers-list-item-header" unselectable="on"><div class="b-server-name-wrapper"><span class="b-server-name">'+f.utils.htmlencode(String(s._options.serverTitleFactory(o)||""))+"</span>"+(s._options.serverOwnerEnabled?'<span class="b-server-owner-wrapper"'+(o.owner===true?' style="display:none"':"")+'><span class="b-server-owner-label">'+f.tr(j,"owner")+'</span><span class="b-server-owner"></span></span>':"")+(s._options.serverMarkerEnabled?'<span class="ivideon-servers-list-item-marker b-server-marker"><i>'+(o.latitude!==null&&o.longitude!==null?f.utils.htmlencode(String(s._servers.getMarkerLabel(y)||"")):"")+"</i></span>":"")+"</div></div>"+(r?'<div class="ivideon-servers-list-item-activation"></div>':"")+(s._options.camerasListEnabled?'<div class="ivideon-servers-list-item-cameras"></div>':"")+"</div>");
k=w.find(".ivideon-servers-list-item-header");m=w.find(".ivideon-servers-list-item-cameras");u=k.find(".b-server-name-wrapper");z=k.find(".b-server-name");p=k.find(".b-server-owner-wrapper");l=k.find(".b-server-owner").text(o.given_by||"");
A=k.find(".b-server-marker");v=A.find("> i");o.events.on("online-changed",s._onServerOnlineChanged,s);o.events.on("name-changed",s._onServerNameChanged,s);o.events.on("marker-update-started",s._onServerMarkerUpdateStarted,s);
o.events.on("marker-update-success",s._onServerMarkerUpdateSuccess,s);o.events.on("marker-update-error",s._onServerMarkerUpdateError,s);o.events.on("marker-remove-started",s._onServerMarkerRemoveStarted,s);
o.events.on("marker-remove-success",s._onServerMarkerRemoveSuccess,s);o.events.on("marker-remove-error",s._onServerMarkerRemoveError,s);if(r){new (f.require("ivideon.my.views.ServerActivation"))({container:w.find(".ivideon-servers-list-item-activation"),server:o});
o.events.on("activated",s._onServerActivated,s)}w.data("ivideon-servers-list",s);w.data("ivideon-servers-list-item",o);c.event.add(k[0],"selectstart",function(){return false});c.event.add(k[0],"touchstart mouseenter mousedown",function(B){if(!s._userInteractionEnabled){return
}s._hoverStartTime=f.now();s._hoverEndTime=0;f.utils.addClassFast(k[0],"m-hover");if(B.type==="touchstart"||(B.type==="mousedown"&&B.which===1)){f.utils.addClassFast(k[0],"m-down")}});c.event.add(k[0],"touchend touchcancel mouseleave mouseup",function(B){if(s._hoverStartTime){if(B.type==="touchcancel"||B.type==="mouseleave"){s._hoverStartTime=0;
s._hoverEndTime=0}else{s._hoverEndTime=f.now()}}if(B.type!=="mouseup"){f.utils.removeClassFast(k[0],"m-hover")}f.utils.removeClassFast(k[0],"m-down")});c.event.add(k[0],"touchmove",function(){if(s._hoverStartTime){s._hoverStartTime=0;
s._hoverEndTime=0;f.utils.removeClassFast(k[0],"m-hover");f.utils.removeClassFast(k[0],"m-down")}});c.event.add(k[0],"touchend click",function(C){C.preventDefault();var B=!!s._hoverStartTime;s._hoverStartTime=0;
s._hoverEndTime=0;if(!s._userInteractionEnabled){return}if(!B){return}if(A[0]&&c(C.target).closest(".b-server-marker").get(0)===A[0]){s.events.fire("server-marker-clicked",{server:o})}else{if(u[0]&&c(C.target).closest(".b-server-name-wrapper").get(0)===u[0]){s.events.fire("server-clicked",{server:o})
}}});if(s._options.serverDraggingEnabled){k.draggable({helper:function(){return c(this).clone().removeAttr("id").addClass("m-drag-helper")},appendTo:s._options.serverDraggingAppendTo,containment:s._options.serverDraggingContainment,scroll:false,distance:i.DRAG_DISTANCE,cursorAt:s._serverDraggingCursorAt,start:s._onServerOrMarkerDragStart,drag:s._onServerOrMarkerDragMove,stop:s._onServerOrMarkerDragStop});
c.event.add(k[0],e.Modernizr.touch?"touchstart":"mousedown",h)}if(s._options.serverMarkerDraggingEnabled){A.draggable({helper:function(){return c(this).clone().removeAttr("id").addClass("m-drag-helper")
},appendTo:s._options.serverMarkerDraggingAppendTo,containment:s._options.serverMarkerDraggingContainment,scroll:false,distance:i.DRAG_DISTANCE,cursorAt:s._serverMarkerDraggingCursorAt,start:s._onServerOrMarkerDragStart,drag:s._onServerOrMarkerDragMove,stop:s._onServerOrMarkerDragStop});
c.event.add(A[0],e.Modernizr.touch?"touchstart":"mousedown",h)}s.$serversList.insertAt(t,w);if(s._options.camerasListEnabled){s._camerasLists[y]=new (f.require("ivideon.views.CamerasList"))(f.optMerge(s._options.camerasListOptions,{container:m,cameras:o.cameras}));
s._camerasLists[y].events.on("columns-count-changed",function(){s.updateSize(0)});s._camerasLists[y].events.on("camera-clicked",function(C,B){s.events.fire("camera-clicked",B)})}if(!q){s.filter(s._filter)
}if(s._options.camerasListEnabled){s.events.fire("cameras-list-added",{camerasList:s._camerasLists[y]})}};g._removeServerView=function(o,m,l){var p=this,n,k;if(p._options.camerasListEnabled){n=p._camerasLists[m];
delete p._camerasLists[m];if(n){p.events.fire("cameras-list-removed",{camerasList:n});if(n){n.destroy();n=null}}}k=p._getServerElementById(o.id);o.events.un("online-changed",p._onServerOnlineChanged,p);
o.events.un("name-changed",p._onServerNameChanged,p);o.events.un("marker-update-started",p._onServerMarkerUpdateStarted,p);o.events.un("marker-update-success",p._onServerMarkerUpdateSuccess,p);o.events.un("marker-update-error",p._onServerMarkerUpdateError,p);
o.events.un("marker-remove-started",p._onServerMarkerRemoveStarted,p);o.events.un("marker-remove-success",p._onServerMarkerRemoveSuccess,p);o.events.un("marker-remove-error",p._onServerMarkerRemoveError,p);
o.events.un("activated",p._onServerActivated,p);k.draggable("destroy");k.remove();if(!l){p.filter(p._filter)}};g._onServerOrMarkerDragStart=function(k){var q=c(this),t=q.closest(".ivideon-servers-list-item"),o=t.data("ivideon-servers-list"),m=t.data("ivideon-servers-list-item"),l=q.hasClass("ivideon-servers-list-item-header"),s=q.hasClass("ivideon-servers-list-item-marker"),p,r,n=(k.originalEvent.touches?k.originalEvent.touches[0]:k.originalEvent);
if(!o||o._state===i.STATE_DESTROYED){return}if(!l&&!s){return false}if(l){if(c.isFunction(o._options.serverDraggingAllowed)){if(false===o._options.serverDraggingAllowed(m)){return false}}p="m-server-dragging";
r="server-drag"}else{if(s){if(c.isFunction(o._options.serverMarkerDraggingAllowed)){if(false===o._options.serverMarkerDraggingAllowed(m)){return false}}p="m-server-marker-dragging";r="server-marker-drag"
}}t.addClass(p);o.events.fire(r+"-started",{server:m,pageX:n.pageX,pageY:n.pageY})};g._onServerOrMarkerDragMove=function(k){var p=c(this),s=p.closest(".ivideon-servers-list-item"),o=s.data("ivideon-servers-list"),m=s.data("ivideon-servers-list-item"),l=p.hasClass("ivideon-servers-list-item-header"),r=p.hasClass("ivideon-servers-list-item-marker"),q,n=(k.originalEvent.touches?k.originalEvent.touches[0]:k.originalEvent);
if(!o||o._state===i.STATE_DESTROYED){return}if(l){q="server-drag"}else{if(r){q="server-marker-drag"}}o.events.fire(q+"-moved",{server:m,pageX:n.pageX,pageY:n.pageY});k.stopPropagation()};g._onServerOrMarkerDragStop=function(k){var q=c(this),t=q.closest(".ivideon-servers-list-item"),o=t.data("ivideon-servers-list"),m=t.data("ivideon-servers-list-item"),l=q.hasClass("ivideon-servers-list-item-header"),s=q.hasClass("ivideon-servers-list-item-marker"),p,r,n=(k.originalEvent&&k.originalEvent.touches?k.originalEvent.touches[0]:k.originalEvent);
if(!o||o._state===i.STATE_DESTROYED){return}if(l){p="m-server-dragging";r="server-drag"}else{if(s){p="m-server-marker-dragging";r="server-marker-drag"}}t.removeClass(p);o.events.fire(r+"-stopped",{server:m,pageX:(n&&n.pageX>=0?n.pageX:-1),pageY:(n&&n.pageY>=0?n.pageY:-1),cancelled:!(n&&n.pageX>=0&&n.pageY>=0)});
k.stopPropagation()};g._onServerOnlineChanged=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")}if(n._state===i.STATE_DESTROYED){return}k=n._getServerElementById(m.id);k[m.online?"addClass":"removeClass"]("m-online");
k[m.online?"removeClass":"addClass"]("m-offline")};g._onServerNameChanged=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")}if(n._state===i.STATE_DESTROYED){return}k=n._getServerElementById(m.id);
k.find(".b-server-name").text(String(n._options.serverTitleFactory(m)||""))};g._onServerMarkerUpdateStarted=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")}if(n._state===i.STATE_DESTROYED){return
}k=n._getServerElementById(m.id);k.addClass("m-updating");k.draggable("disable")};g._onServerMarkerUpdateSuccess=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")}if(n._state===i.STATE_DESTROYED){return
}k=n._getServerElementById(m.id);k.addClass("m-has-marker");k.find(".b-server-marker > i").text(String(n._servers.getMarkerLabel(n._servers.findKey(m))));k.removeClass("m-updating");k.draggable("enable")
};g._onServerMarkerUpdateError=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")}if(n._state===i.STATE_DESTROYED){return}k=n._getServerElementById(m.id);k.removeClass("m-updating");
k.draggable("enable")};g._onServerMarkerRemoveStarted=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")}if(n._state===i.STATE_DESTROYED){return}k=n._getServerElementById(m.id);
k.addClass("m-removing");k.draggable("disable")};g._onServerMarkerRemoveSuccess=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")}if(n._state===i.STATE_DESTROYED){return}k=n._getServerElementById(m.id);
k.removeClass("m-has-marker");k.find(".b-server-marker > i").text("");k.removeClass("m-removing");k.draggable("enable")};g._onServerMarkerRemoveError=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")
}if(n._state===i.STATE_DESTROYED){return}k=n._getServerElementById(m.id);k.removeClass("m-removing");k.draggable("enable")};g._onServerActivated=function(l){var n=this,m=l.target,k;if(!m){throw new Error("event.target")
}if(n._state===i.STATE_DESTROYED){return}k=n._getServerElementById(m.id);k.removeClass("m-not-activated");k.addClass("m-activated");k.find(".ivideon-servers-list-item-activation").remove();if(n._heightFitter){n._heightFitter.update()
}m.events.un("activated",n._onServerActivated,n)};g._displaySelection=function(m,l){var n=this,k;if(!m){throw new f.utils.ArgumentError('Argument "server" not set.')}if(n._state===i.STATE_DESTROYED){return
}k=n._getServerElementById(m.id);k[l?"addClass":"removeClass"]("m-selected")}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,h=i,g=h.prototype,d="ivideon.views.Camera";f.provide(d,h);
function a(){return false}function i(j){var l=this,k;l._options=f.optClass(h.defaults,j,d,l,{$container:"container",_camera:"camera",_previewImageLoader:"previewImageLoader ?"});l._previewImageLoaderCreated=false;
if(l._options.previewEnabled&&!l._previewImageLoader){l._previewImageLoader=new (f.require("ivideon.utils.ImageLoader"))(l._options.previewImageLoaderOptions);l._previewImageLoaderCreated=true}l.events=new (f.require("ivideon.utils.Observable"))(l);
l._previewSwapper=null;l._previewUrl=null;l._userInteractionEnabled=true;l._createElements();l._camera.events.on("name-changed",l._onCameraNameChanged,l);l._camera.events.on("hidden-changed",l._onCameraStatusChanged,l);
l._camera.events.on("enabled-changed",l._onCameraStatusChanged,l);l._camera.events.on("online-changed",l._onCameraStatusChanged,l);k=!l._camera.hidden;if(l._options.hideOffline){k=k&&l._camera.online}l._setState((k?h.STATE_VISIBLE:h.STATE_HIDDEN));
l._updatePreviewImage();l._displayCameraStatus();l._plugins=f.utils.plugins(l,l._options.plugins)}h.STATE_VISIBLE=1;h.STATE_HIDDEN=2;h.STATE_DESTROYED=3;h.defaults={cameraMenuEnabled:true,previewEnabled:true,previewOfflineEnabled:false,previewUnpaidEnabled:true,previewHoverUpdateInterval:10*1000,hideOffline:false};
g.getCamera=function(){var j=this;if(j._state===h.STATE_DESTROYED){return}return j._camera};g.updatePreviewImage=function(){var j=this;if(j._state===h.STATE_DESTROYED){return}if(!j._options.previewEnabled){return
}j._updatePreviewImage()};g.isVisible=function(){var j=this;return(j._state===h.STATE_VISIBLE)};g.show=function(){var j=this;if(j._state!==h.STATE_HIDDEN){return}j.$wrapper.show();j._setState(h.STATE_VISIBLE);
j.events.fire("shown")};g.hide=function(){var j=this;if(j._state!==h.STATE_VISIBLE){return}j.$wrapper.hide();j._setState(h.STATE_HIDDEN);j.events.fire("hidden")};g.displaySelection=function(j){var k=this;
if(k._state===h.STATE_DESTROYED){return}if(j){f.utils.addClassFast(k.$wrapper[0],"m-selected")}else{f.utils.removeClassFast(k.$wrapper[0],"m-selected")}};g.setUserInteractionEnabled=function(j){var k=this;
k._userInteractionEnabled=j};g.destroy=function(){var k=this,j;if(k._state===h.STATE_DESTROYED){return}k.events.fire("destroying");k.events.un();k._setState(h.STATE_DESTROYED);k._camera.events.un("name-changed",k._onCameraNameChanged,k);
k._camera.events.un("hidden-changed",k._onCameraStatusChanged,k);k._camera.events.un("enabled-changed",k._onCameraStatusChanged,k);k._camera.events.un("online-changed",k._onCameraStatusChanged,k);k.$wrapper.remove();
if(k._previewSwapper){k._previewSwapper.destroy();k._previewSwapper=null}k._previewUrl=null;if(k._previewImageLoaderCreated){k._previewImageLoader.destroy()}k._previewImageLoader=null;k._camera=null;for(j in k){if(k.hasOwnProperty(j)&&j.charAt(0)==="$"){delete k[j]
}}};g._setState=function(j){var k=this;if(!j){throw new f.utils.ArgumentError(d+'#_setState: Argument "state" not set.')}if(k._state===h.STATE_DESTROYED){return}k._state=j};g._createElements=function(){var m=this,j,k,l;
if(m._state===h.STATE_DESTROYED){return}j=((m._camera.previewUpdateIntervalInSec||0)*1000);m.$wrapper=c('<div class="ivideon-camera'+(m._options.previewEnabled?" with-preview m-error":" without-preview")+'" unselectable="on" data-serverId="'+m._camera.serverId+'" data-cameraId="'+m._camera.cameraId+'"><div class="ivideon-camera-button" title="">'+(m._options.previewEnabled?'<div class="ivideon-camera-preview iv-ratio-a"><div class="iv-ratio-b"><div class="ivideon-camera-preview-swapper"><img /><img /></div></div></div>':"")+'<span class="b-camera-name-wrapper"><span class="b-camera-name" unselectable="on" title="'+f.utils.htmlencode(String(m._camera.name||""))+'">'+f.utils.htmlencode(String(m._camera.name||""))+"</span>"+(m._options.cameraMenuEnabled&&f.app.hasService("cameraMenuController")?'<span class="b-camera-menu"><span class="b-camera-menu-button"></span></span>':"")+"</span></div></div>");
m.$nameWrapper=m.$wrapper.find(".b-camera-name-wrapper");m.$name=m.$wrapper.find(".b-camera-name");m.$button=m.$wrapper.find(".ivideon-camera-button");m.$menuButton=m.$wrapper.find(".b-camera-menu-button");
c.event.add(m.$wrapper[0],"selectstart",a);c.event.add(m.$button[0],"touchstart mouseenter mousedown",function(n){if(!m._camera.enabled||!m._userInteractionEnabled){return}m._hoverStartTime=f.now();m._hoverStartXY=f.utils.getMouseOrTouchXY(n);
m._hoverEndTime=0;f.utils.addClassFast(m.$button[0],"m-hover");if(n.type==="touchstart"||(n.type==="mousedown"&&n.which===1)){f.utils.addClassFast(m.$button[0],"m-down")}if(m._camera.liveEnabled){m._updatePreviewImage(Math.max(1000,(j>0?j:m._options.previewHoverUpdateInterval)))
}});c.event.add(m.$button[0],"touchend touchcancel mouseleave mouseup",function(n){if(m._hoverStartTime){if(n.type==="touchcancel"||n.type==="mouseleave"){m._hoverStartTime=0;m._hoverEndTime=0}else{m._hoverEndTime=f.now()
}}if(n.type!=="mouseup"){f.utils.removeClassFast(m.$button[0],"m-hover")}f.utils.removeClassFast(m.$button[0],"m-down");m._updatePreviewImage(false)});c.event.add(m.$button[0],"touchmove",function(n){if(m._hoverStartTime){var o=f.utils.getMouseOrTouchXY(n);
if(Math.abs(o.pageX-m._hoverStartXY.pageX)<10&&Math.abs(o.pageY-m._hoverStartXY.pageY)<10){return}m._hoverStartTime=0;m._hoverEndTime=0;f.utils.removeClassFast(m.$button[0],"m-hover");f.utils.removeClassFast(m.$button[0],"m-down");
m._updatePreviewImage(false)}});c.event.add(m.$button[0],"touchend click",function(o){o.preventDefault();var n=!!m._hoverStartTime;m._hoverStartTime=0;m._hoverEndTime=0;if(!m._camera.enabled||!m._userInteractionEnabled){return
}if(!n){return}m.events.fire("clicked")});if(m._options.cameraMenuEnabled&&f.app.hasService("cameraMenuController")){c.event.add(m.$menuButton[0],"touchstart mouseenter mousedown",function(n){n.stopPropagation();
m._menuHoverStartTime=f.now();m._menuHoverStartXY=f.utils.getMouseOrTouchXY(n)});c.event.add(m.$menuButton[0],"touchend touchcancel mouseleave mouseup",function(n){if(m._menuHoverStartTime){if(n.type==="touchcancel"||n.type==="mouseleave"){m._menuHoverStartTime=0
}}});c.event.add(m.$menuButton[0],"touchmove",function(n){if(m._menuHoverStartTime){var o=f.utils.getMouseOrTouchXY(n);if(Math.abs(o.pageX-m._menuHoverStartXY.pageX)<10&&Math.abs(o.pageY-m._menuHoverStartXY.pageY)<10){return
}m._menuHoverStartTime=0}});c.event.add(m.$menuButton[0],"touchend click",function(o){o.stopPropagation();o.preventDefault();var n=!!m._menuHoverStartTime;m._menuHoverStartTime=0;if(!m._camera.enabled||!m._userInteractionEnabled){return
}if(!n){return}if(f.app.hasService("cameraMenuController")){if(f.app.service("cameraMenuController").isOpen(m._camera,m.$menuButton[0])){f.app.service("cameraMenuController").close()}else{f.app.service("cameraMenuController").open(m._camera,m.$menuButton[0])
}}})}if(!e._DEBUG){c.event.add(m.$button[0],"contextmenu",a)}if(m._options.previewEnabled){l=m.$wrapper.find(".ivideon-camera-preview");m._previewSwapper=m._previewImageLoader.addSwapper(l.find("img"),f.optMerge({fadeSpeed:2000},m._options.previewSwapperOptions,{onStart:function(n){if(n.state===f.require("ivideon.utils.ImageLoader").IMAGE_STATE_EMPTY){f.utils.addClassFast(m.$wrapper[0],"m-loading")
}else{f.utils.addClassFast(m.$wrapper[0],"m-updating")}},onSuccess:function(){f.utils.removeClassFast(m.$wrapper[0],"m-loading");f.utils.removeClassFast(m.$wrapper[0],"m-updating");f.utils.removeClassFast(m.$wrapper[0],"m-error")
},onError:function(){f.utils.removeClassFast(m.$wrapper[0],"m-loading");f.utils.removeClassFast(m.$wrapper[0],"m-updating");f.utils.addClassFast(m.$wrapper[0],"m-error")}}));k=f.app.service("streamerAPI").createLiveStream(m._camera);
if(k.sources&&k.sources.jpeg&&k.sources.jpeg.url){m._previewUrl=k.sources.jpeg.url}m._updatePreviewImage()}m.$wrapper.appendTo(m.$container)};g._updatePreviewImage=function(j){var k=this;if(k._state===h.STATE_DESTROYED){return
}if(!k._options.previewEnabled){return}if(k._previewUrl){if((k._camera.online||k._options.previewOfflineEnabled)&&(k._camera.liveEnabled||k._options.previewUnpaidEnabled)){k._previewSwapper.load(k._previewUrl,j)
}}};g._displayCameraName=function(){var k=this,j=String(k._camera.name||"");k.$name.text(j).attr("title",j)};g._displayCameraStatus=function(){var k=this,j;if(k._state===h.STATE_DESTROYED){return}if(k._camera.online){f.utils.removeClassFast(k.$wrapper[0],"m-offline");
f.utils.addClassFast(k.$wrapper[0],"m-online")}else{f.utils.removeClassFast(k.$wrapper[0],"m-online");f.utils.addClassFast(k.$wrapper[0],"m-offline")}if(k._camera.enabled){f.utils.removeClassFast(k.$wrapper[0],"m-disabled")
}else{f.utils.addClassFast(k.$wrapper[0],"m-disabled")}j=!k._camera.hidden;if(k._options.hideOffline){j=j&&k._camera.online}k[j?"show":"hide"]()};g._onCameraNameChanged=function(){var j=this;if(j._state===h.STATE_DESTROYED){return
}j._displayCameraName()};g._onCameraStatusChanged=function(){var j=this;if(j._state===h.STATE_DESTROYED){return}j._displayCameraStatus();j._updatePreviewImage()}}(window,window._ivideon));(function(e,f,a){"use strict";
var b=f.$,h=c,g=h.prototype,d="ivideon.views.CamerasList",i=d;f.provide(d,h);function c(j){var k=this;k._options=f.optClass(h.defaults,j,d,k,{$container:"container",_cameras:"cameras",_camerasSelection:"camerasSelection ?",_heightFitter:"heightFitter ?",_previewImageLoader:"previewImageLoader ?"});
k._previewImageLoaderCreated=false;if(k._options.cameraViewOptions&&k._options.cameraViewOptions.previewEnabled&&!k._previewImageLoader){k._previewImageLoader=new (f.require("ivideon.utils.ImageLoader"))(k._options.previewImageLoaderOptions);
k._previewImageLoaderCreated=true}k.events=new (f.require("ivideon.utils.Observable"))(k);k._misprintFixer=f.require("ivideon.utils.ListFilter.cyrillicFixer");k._valueHighlighter=f.require("ivideon.utils.ListFilter.valueHighlighter");
k._getHighlightedHTML=f.require("ivideon.utils.ListFilter.getHighlightedHTML");k._highlightBoundaries=(f.require("ivideon.utils.ListFilter.getHighlightBoundaries"))();k._cameraViews={};k._userInteractionEnabled=true;
k.$wrapper=b('<div class="ivideon-cameras-list '+(k._options.cssClasses||"")+'">'+(k._options.scrollableViewEnabled?"<div>":"")+'<div class="ivideon-cameras-list-empty-message b-message iv-msg-info" style="display:none;">'+f.tr(i,"all_empty")+'</div><div class="ivideon-cameras-list-no-filter-matches-message b-message iv-msg-info" style="display:none;">'+f.tr(i,"no_matches")+'</div><div class="ivideon-cameras-list-offline-message b-message iv-msg-info" style="display:none;">'+f.tr(i,"all_offline")+'</div><div class="ivideon-cameras-list-items clearfix" />'+(k._options.scrollableViewEnabled?"</div>":"")+"</div>").appendTo(k.$container);
k.$camerasList=k.$wrapper.find(".ivideon-cameras-list-items");k.$emptyMessage=k.$wrapper.find(".ivideon-cameras-list-empty-message");k.$noMatchesMessage=k.$wrapper.find(".ivideon-cameras-list-no-filter-matches-message");
k.$offlineMessage=k.$wrapper.find(".ivideon-cameras-list-offline-message");if(k._options.scrollableViewEnabled){k._scrollable=new (f.require("ivideon.utils.ScrollableView"))(f.optMerge(k._options.scrollableViewOptions,{wrapper:k.$wrapper,onDragScrollStart:function(){k._userInteractionEnabled=false;
var l;for(l in k._cameraViews){if(k._cameraViews.hasOwnProperty(l)){k._cameraViews[l].setUserInteractionEnabled(false)}}},onDragScrollEnd:function(){k._userInteractionEnabled=true;var l;for(l in k._cameraViews){if(k._cameraViews.hasOwnProperty(l)){k._cameraViews[l].setUserInteractionEnabled(true)
}}}}))}k._camerasVisibleCount=0;if(k._options.columnsEnabled&&k._options.columnsCount!==null){if(b.isFunction(k._options.columnsCount)){k.setColumnsCount(k._options.columnsCount(k._camerasVisibleCount))
}else{k.setColumnsCount(k._options.columnsCount)}}k._cameras.forEach(function(m,l){k._addCameraView(m,l,true)});k._cameras.events.on("added",k._onCameraAdded,k);k._cameras.events.on("removed",k._onCameraRemoved,k);
if(k._camerasSelection){k._camerasSelection.events.on("added",k._onCameraSelected,k);k._camerasSelection.events.on("removed",k._onCameraDeselected,k)}if(k._heightFitter){k._heightFitter.add(k.$wrapper);
k._heightFitter.events.on("height-changed",k._onHeightFitterHeightChanged,k)}k._setState(h.STATE_CREATED);k._updateListStateDisplay();k.updateSize()}h.STATE_CREATED=1;h.STATE_DESTROYED=2;h.defaults={columnsEnabled:false,offlineCamerasEnabled:true,scrollableViewEnabled:true};
g.getCameras=function(){var j=this;if(j._state===h.STATE_DESTROYED){return}return j._cameras};g.updateSize=function(){var j=this;if(j._state===h.STATE_DESTROYED){return}if(j._scrollable){j._scrollable.refresh()
}};g.updateAllPreviewImages=function(){var j=this;if(j._state===h.STATE_DESTROYED){return}j._cameras.forEach(function(l,k){if(j._cameraViews[k]){j._cameraViews[k].updatePreviewImage()}})};g.setUserInteractionEnabled=function(j){var k=this;
if(k._state===h.STATE_DESTROYED){return}k._userInteractionEnabled=j;k._cameras.forEach(function(m,l){if(k._cameraViews[l]){k._cameraViews[l].setUserInteractionEnabled(j)}})};g.getColumnsCount=function(){var j=this;
if(j._state===h.STATE_DESTROYED){return}return j._columnsCount};g.setColumnsCount=function(j){var k=this;if(k._state===h.STATE_DESTROYED){return}if(!k._options.columnsEnabled){return}j=parseInt(j,10);if(isNaN(j)){return
}if(j!==k._columnsCount){if(k._columnsCount){k.$wrapper.removeClass("m-cameras-list-"+k._columnsCount+"-columns")}k._columnsCount=j;k.$wrapper.addClass("m-cameras-list-"+k._columnsCount+"-columns");k.updateSize()
}k.events.fire("columns-count-changed")};g.destroy=function(){var k=this,j;if(k._state===h.STATE_DESTROYED){return}k.events.fire("destroying");k.events.un();k._setState(h.STATE_DESTROYED);k._cameras.events.un("added",k._onCameraAdded,k);
k._cameras.events.un("removed",k._onCameraRemoved,k);k._cameras.forEach(function(m,l){k._removeCameraView(m,l,true)});if(k._camerasSelection){k._camerasSelection.events.un("added",k._onCameraSelected,k);
k._camerasSelection.events.un("removed",k._onCameraDeselected,k);k._camerasSelection=null}if(k._heightFitter){k._heightFitter.events.un("height-changed",k._onHeightFitterHeightChanged,k);k._heightFitter.remove(k.$wrapper);
k._heightFitter=null}if(k._scrollable){k._scrollable.destroy();k._scrollable=null}if(k._previewImageLoader&&k._previewImageLoaderCreated){k._previewImageLoader.destroy()}k._previewImageLoader=null;k.$wrapper.remove();
k._cameraViews=null;k._cameras=null;for(j in k){if(k.hasOwnProperty(j)&&j.charAt(0)==="$"){delete k[j]}}};g._setState=function(j){var k=this;if(!j){throw new f.utils.ArgumentError(d+'#_setState: Argument "state" not set.')
}if(k._state===h.STATE_DESTROYED){return}k._state=j};g._onCameraAdded=function(k,j){this._addCameraView(j.item,j.key)};g._onCameraRemoved=function(k,j){this._removeCameraView(j.item,j.key)};g._onCameraSelected=function(k,j){this._displaySelection(j.item,true)
};g._onCameraDeselected=function(k,j){this._displaySelection(j.item,false)};g._onCameraViewClicked=function(k){var l=this,j;if(l._state===h.STATE_DESTROYED){return}j=k.target.getCamera();l.events.fire("camera-clicked",{camera:j})
};g._onCameraViewShown=function(k){var l=this,j;if(l._state===h.STATE_DESTROYED){return}j=k.target.getCamera();l._handleCameraShown(j,false)};g._onCameraViewHidden=function(k){var l=this,j;if(l._state===h.STATE_DESTROYED){return
}j=k.target.getCamera();l._handleCameraHidden(j,false)};g._onHeightFitterHeightChanged=function(k,j){var l=this;if(l._state===h.STATE_DESTROYED){return}if(j.target===l.$wrapper[0]){l.updateSize()}};g._addCameraView=function(m,l,k){var n=this,j;
if(n._state===h.STATE_DESTROYED){return}j=n._cameras.getIndex(l);if(typeof j!=="number"){return}n._cameraViews[l]=new (f.require("ivideon.views.Camera"))(f.optMerge(n._options.cameraViewOptions,{container:n.$camerasList,camera:m,cameraTitleFactory:n._options.cameraTitleFactory,previewImageLoader:n._previewImageLoader,hideOffline:!n._options.offlineCamerasEnabled}));
if(n._cameraViews[l].isVisible()){n._handleCameraShown(m,k)}else{++n._camerasVisibleCount;n._handleCameraHidden(m,k)}n._cameraViews[l].events.on("clicked",n._onCameraViewClicked,n);n._cameraViews[l].events.on("hidden",n._onCameraViewHidden,n);
n._cameraViews[l].events.on("shown",n._onCameraViewShown,n)};g._removeCameraView=function(l,k,j){var m=this;m._handleCameraHidden(l,j);if(m._cameraViews[k]){m._cameraViews[k].destroy();delete m._cameraViews[k]
}if(!j){m.updateSize()}};g._handleCameraShown=function(k,j){var l=this;if(l._state===h.STATE_DESTROYED){return}++l._camerasVisibleCount;if(!j){l._updateListStateDisplay()}if(l._options.columnsEnabled&&b.isFunction(l._options.columnsCount)){l.setColumnsCount(l._options.columnsCount(l._camerasVisibleCount))
}if(!j){l.updateSize()}};g._handleCameraHidden=function(k,j){var l=this;if(l._state===h.STATE_DESTROYED){return}--l._camerasVisibleCount;if(!j){l._updateListStateDisplay()}if(l._options.columnsEnabled&&b.isFunction(l._options.columnsCount)){l.setColumnsCount(l._options.columnsCount(l._camerasVisibleCount))
}if(!j){l.updateSize()}};g._updateListStateDisplay=function(){var k=this,j=false;if(k._state===h.STATE_DESTROYED){return}if(!k._options.offlineCamerasEnabled){j=true;k._cameras.forEach(function(l){if(l.online){j=false;
return false}})}if(k._cameras.length>0&&j){k.$emptyMessage.css("display","none");k.$offlineMessage.css("display","")}else{k.$offlineMessage.css("display","none");if(k._camerasVisibleCount>0){k.$emptyMessage.css("display","none")
}else{k.$emptyMessage.css("display","")}}if(k._camerasVisibleCount<=0){k.$wrapper.addClass("m-empty")}else{if(k.$wrapper.hasClass("m-empty")){k.$wrapper.removeClass("m-empty")}}};g._displaySelection=function(m,k){var n=this,l,j;
if(n._state===h.STATE_DESTROYED){return}l=n._cameras.findKey(m);if(l){j=n._cameraViews[l];if(j){j.displaySelection(k)}}};g._getCameraElementById=function(k){var l=this,j=l.$camerasList.children('[data-cameraId="'+k+'"]');
return j};g.filter=function(j){var o=this,r=false,k,m,l,q,p,s,t,n;if(o._state===h.STATE_DESTROYED){return}n={filter:j,valueGetter:function(u){return String(u.name||"")},valueHighlighter:o._valueHighlighter,highlighterBoundaries:o._highlightBoundaries,misprintFixer:o._misprintFixer,caseSensitive:false};
k=o._cameras.filter(n);if(k.matched.length===0&&o._cameras.length>0){o.$noMatchesMessage.css("display","")}else{o.$noMatchesMessage.css("display","none")}for(m=0,l=k.length;m<l;++m){q=k[m];p=q.item;s=o._getCameraElementById(p.id);
t=s.find(".b-camera-name");s[j?"addClass":"removeClass"]("m-filtered");if(q.matched){t.html(o._getHighlightedHTML(q.highlighted,o._highlightBoundaries));s.removeClass("m-hidden").show();r=true}else{t.text(p.name||"");
s.addClass("m-hidden").hide();r=true}}if(r){o.updateSize()}return k}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,h=a,g=h.prototype,d="ivideon.views.ServersCamerasFilter",i=d;f.provide(d,h);
function a(j){var k=this;k._options=f.optClass(h.defaults,j,d,k,{$container:"container"});k.events=new (f.require("ivideon.utils.Observable"))(k);k.$wrapper=c("<div/>").addClass("ivideon-servers-cameras-filter").appendTo(k.$container);
k.$wrapper.on("mouseenter",function(){k.$wrapper.addClass("m-hover")}).on("mouseleave",function(){k.$wrapper.removeClass("m-hover")});k._textboxFieldValue="";k._textboxField=new (f.require("ivideon.views.EditableField"))({context:k,cssClassNames:"ivideon-servers-cameras-filter-input",tooltip:"",placeholder:f.tr(i,"placeholder"),setterOnInputEnabled:true,setter:function(m,l){k._textboxFieldValue=m;
if(l===true){k._onChange()}}});k.$textbox=k._textboxField.getElement().appendTo(k.$wrapper);k.$textbox.on("focus",function(){k.$wrapper.addClass("m-focus")}).on("blur",function(){k.$wrapper.removeClass("m-focus")
}).on("keyup",function(l){if(l.which===9||l.which===13){if(k._textboxFieldValue){k.events.fire("submitted",{filter:k._textboxFieldValue})}}});k.$button=c('<div class="ivideon-servers-cameras-filter-button"><span class="ivideon-servers-cameras-filter-button-icon icon-search"></span></div>').appendTo(k.$wrapper);
k.$buttonIcon=k.$button.find(".ivideon-servers-cameras-filter-button-icon");k.$button.on("click",c.proxy(k._onButtonClick,k))}g.val=function(j){var k=this;if(arguments.length===0){return k._textboxFieldValue
}k._textboxFieldValue=j;k._textboxField.display(j);k._handleChange()};g.focus=function(){var j=this;j.$textbox[0].focus()};g._handleChange=function(){var k=this,j=k._textboxFieldValue;if(j){k.$button.addClass("m-reset");
k.$buttonIcon.removeClass("icon-search").addClass("icon-backspace-2")}else{if(k.$button.hasClass("m-reset")){k.$button.removeClass("m-reset");k.$buttonIcon.removeClass("icon-backspace-2").addClass("icon-search")
}}k.events.fire("changed",{filter:j})};g._onChange=function(){var j=this;e.clearTimeout(j._changeTimer);j._changeTimer=e.setTimeout(function(){j._handleChange()},1)};g._onButtonClick=function(){var j=this;
if(j.$button.hasClass("m-reset")){j.focus();j.val("")}else{j._handleChange()}return false}}(window,window._ivideon));(function(e,f,b){"use strict";var c=f.$,k=f.require({prefix:""},"moment"),j=a,g=j.prototype,d="ivideon.views.CameraSavedArchiveRecordsList",i=d,h=f.require("ivideon.models.CameraArchiveRecordsSaver.Record");
f.provide(d,j);function a(l){var m=this;m._options=f.optClass(j.defaults,l,d,m,{$container:"container",_saver:"saver",_heightFitter:"heightFitter ?"});m.events=new (f.require("ivideon.utils.Observable"))(m);
m._showDeleted=false;m._listItems={};m._count=null;m.$wrapper=c('<div class="ivideon-camera-saved-archive-records-list-wrapper"><div class="ivideon-camera-saved-archive-records-list-header"><div class="ivideon-camera-saved-archive-records-list-counter"></div><div class="ivideon-camera-saved-archive-records-list-update-spinner"></div><div class="ivideon-camera-saved-archive-records-list-notice iv-msg-info"></div></div><div class="ivideon-camera-saved-archive-records-list"><div class="ivideon-camera-saved-archive-records-list-items"></div></div><div class="ivideon-camera-saved-archive-records-list-footer"></div></div>').appendTo(m.$container);
m.$header=m.$wrapper.find(".ivideon-camera-saved-archive-records-list-header");m.$list=m.$wrapper.find(".ivideon-camera-saved-archive-records-list");m.$items=m.$wrapper.find(".ivideon-camera-saved-archive-records-list-items");
m.$counter=m.$wrapper.find(".ivideon-camera-saved-archive-records-list-counter");m.$updateSpinner=m.$wrapper.find(".ivideon-camera-saved-archive-records-list-update-spinner");m.$notice=m.$wrapper.find(".ivideon-camera-saved-archive-records-list-notice");
m.$updateSpinner.html(f.tr(i,"list.updating"));if(m._options.scrollableViewEnabled){m._scrollable=new (f.require("ivideon.utils.ScrollableView"))(f.optMerge(m._options.scrollableViewOptions,{wrapper:m.$list}))
}m._saver.getList().forEach(function(n,o){m._addRecord(n,o)});m._saver.events.on("record-added",m._onRecordAdded=function(q,o){var n=o.record,p=o.key;m._addRecord(n,p)});m._saver.events.on("record-removed",m._onRecordRemoved=function(q,o){var n=o.record,p=o.key;
m._removeRecord(n,p)});m._saver.events.on("record-updated",m._onRecordUpdated=function(q,o){var n=o.record,p=o.key;m._updateRecord(n,p)});m._saver.events.on("update-list-started",m._onUpdateListStarted=function(){m._updateLoadingStatus()
});m._saver.events.on("update-list-success",m._onUpdateListSuccess=function(){m._updateCounter();m._updateLoadingStatus();if(m.$wrapper.hasClass("m-loading")){m.$wrapper.removeClass("m-loading");if(m._heightFitter){m._heightFitter.update()
}}m.$wrapper.trigger("elementresize")});m._saver.events.on("update-list-error",m._onUpdateListError=function(){m._updateLoadingStatus();if(m.$wrapper.hasClass("m-loading")){m.$wrapper.removeClass("m-loading");
if(m._heightFitter){m._heightFitter.update()}}});m._updateCounter();m._updateLoadingStatus();if(m._heightFitter){m._heightFitter.add(m.$list);m._heightFitter.events.on("height-changed",function(o,n){if(n.target===m.$list[0]){m.updateSize()
}})}m.$wrapper.trigger("elementresize");m._setState(j.STATE_CREATED)}j.STATE_CREATED=1;j.STATE_DESTROYED=2;j.defaults={scrollableViewEnabled:false};g.isEmpty=function(){var l=this;return(l._count===null||l._count<=0)
};g.updateSize=function(){var l=this;if(l._state===j.STATE_DESTROYED){return}if(l._scrollable){l._scrollable.refresh()}};g.destroy=function(){var m=this,l;if(m._state===j.STATE_DESTROYED){return}m._setState(j.STATE_DESTROYED);
m.events.fire("destroying");m.events.un();m._saver.events.un("record-added",m._onRecordAdded);m._onRecordAdded=null;m._saver.events.un("record-removed",m._onRecordRemoved);m._onRecordRemoved=null;m._saver.events.un("record-updated",m._onRecordUpdated);
m._onRecordUpdated=null;m._saver.events.un("update-list-started",m._onUpdateListStarted);m._onUpdateListStarted=null;m._saver.events.un("update-list-success",m._onUpdateListSuccess);m._onUpdateListSuccess=null;
m._saver.events.un("update-list-error",m._onUpdateListError);m._onUpdateListError=null;m._saver=null;m.$wrapper.remove();for(l in m){if(m.hasOwnProperty(l)&&l.charAt(0)==="$"){delete m[l]}}};g._setState=function(l){var m=this;
if(!l){throw new Error("state")}if(m._state===j.STATE_DESTROYED){return}m._state=l};g._addRecord=function(m,t){if(!m){return}var o=this,p=o._saver.getList().getIndex(t),q=f.app.service("roster").getCameras().getById(m.serverId,m.cameraId),r,l,u,s,n=((q?q.getTimezone():f.app.service("userAccount").timezone)||f.getDetectedTimezone());
if(o._state===j.STATE_DESTROYED){return}s=c('<div class="ivideon-camera-saved-archive-records-list-item clearfix"><div class="b-download-image"><div class="b-download-preview g-video-frame" /><div class="b-download-preview-overlay" /></div><div class="b-download-summary"><div class="b-download-name" /><div class="b-download-range" /><div class="b-download-status" /><div class="b-download-progress" /><div class="b-download-actions"><a class="b-download-action b-download-action-download iv-btn" href="javascript:void(0)" target="_blank">'+f.tr(i,"action.download")+'</a><a class="b-download-action b-download-action-delete iv-btn m-secondary" href="javascript:void(0)">'+f.tr(i,"action.delete")+"</a></div></div></div>");
o._listItems[t]=u={_el:s,_record:m,_enabled:true,_deleting:false};s.data("ivideon-camera-saved-archive-records-list-item",u);r=((q?(q.server?'<span class="b-server-name">'+q.server.name+"</span>: ":"")+'<span class="b-camera-name">'+q.name+"</span>":'<span class=camera-not-found"">'+f.tr(i,"record.camera-not-found")+"</span>"));
l=('<table><tr><td class="b-download-range__start"><div class="b-download-range__time">'+k(m.startTime).tz(n).format("H:mm:ss")+'</div><div class="b-download-range__date">'+f.tr(i,"summary.range.date",{date:k(m.startTime).tz(n).toDate()})+'</div></td><td>&mdash;</td><td class="b-download-range__end"><div class="b-download-range__time">'+k(m.endTime).tz(n).format("H:mm:ss")+'</div><div class="b-download-range__date">'+f.tr(i,"summary.range.date",{date:k(m.endTime).tz(n).toDate()})+"</div></td></tr></table>");
s.delegate(".b-download-action-delete","click",function(v){v.preventDefault();if(!u._enabled){return}o._toggleRecordEnabled(m,t,false);f.utils.dlg.confirm({title:f.tr(i,"action.delete.confirm.title",{name:r}),message:f.tr(i,"action.delete.confirm.message",{name:r}),noHandler:function(){o._toggleRecordEnabled(m,t,true)
},cancelHandler:function(){o._toggleRecordEnabled(m,t,true)},yesHandler:function(){o._toggleRecordDeleting(m,t,true);o._saver.deleteRecord(m.id).fail(function(w){if(w){f.utils.notifyError({text:w.message})
}o._toggleRecordDeleting(m,t,false);o._toggleRecordEnabled(m,t,true)})}})});s.find(".b-download-image").disableSelection();s.find(".b-download-name").html(r);s.find(".b-download-range").html(l);s.find(".b-download-actions").children().button();
s.find(".b-download-progress").progressbar();s.find(".b-download-progress").attr("title",f.tr(i,"record.requestTime",{requestTime:k(m.requestTime).tz(n).format("D.MM.YYYY H:mm:ss")}));s.find(".b-download-preview-overlay.b-download-action-download").attr("title",f.tr(i,"action.download"));
o.$items.insertAt(p,s);o._updateCounter();o._updateRecord(m,t);o.$items.trigger("elementresize")};g._toggleRecordEnabled=function(l,o,n){if(!l){return}var q=this,p,m;if(q._state===j.STATE_DESTROYED){return
}p=q._listItems[o];if(!p){return}m=p._el;if(n){p._enabled=true;m.removeClass("m-disabled")}else{p._enabled=false;m.addClass("m-disabled")}q.$items.trigger("elementresize")};g._toggleRecordDeleting=function(l,n,p){if(!l){return
}var q=this,o,m;if(q._state===j.STATE_DESTROYED){return}o=q._listItems[n];if(!o){return}m=o._el;if(p){o._deleting=true;m.addClass("m-deleting")}else{o._deleting=false;m.removeClass("m-deleting")}q._updateRecord(l,n);
q.$items.trigger("elementresize")};g._updateRecord=function(n,C){if(!n){return}var x=this,w,q,A,m,z,t,B,o,u,p,l,y,r=["queued","saving","done","server-not-available","record-not-found","interrupted","not-paid","quota-exhausted","record-deleting","record-deleted"],s,v;
if(x._state===j.STATE_DESTROYED){return}A=x._listItems[C];if(!A){return}m=A._el;z=m.find(".b-download-status");B=m.find(".b-download-preview");o=m.find(".b-download-progress");u=m.find(".b-download-action-download");
p=m.find(".b-download-action-delete");l=m.find(".b-download-action-retry");y=m.find(".b-download-action-retry-deleted");s=n.status;if(A._deleting){s=h.STATUS_RECORD_DELETING}switch(s){case h.STATUS_QUEUED:v="queued";
break;case h.STATUS_SAVING:v="saving";q=true;break;case h.STATUS_SAVING_DONE:v="done";break;case h.STATUS_SERVER_NOT_AVAILABLE:v="server-not-available";w=true;break;case h.STATUS_RECORD_NOT_FOUND:v="record-not-found";
w=true;break;case h.STATUS_SAVING_INTERRUPTED:v="interrupted";w=true;q=true;break;case h.STATUS_NOT_PAID:v="not-paid";delete n.url;w=true;break;case h.STATUS_QUOTA_EXHAUSTED:v="quota-exhausted";w=true;
break;case h.STATUS_RECORD_DELETING:v="record-deleting";break;case h.STATUS_RECORD_DELETED:v="record-deleted";break}c.each(r,function(E,D){if(v===D){m.addClass("m-"+D);z.html(f.tr(i,"status."+D,{size:n.size}))
}else{m.removeClass("m-"+D)}});if(typeof n.percent!=="number"){q=false}if(!q){o.hide()}else{o.progressbar({value:n.percent});if(n.status===h.STATUS_SAVING){o.addClass("ui-state-processing")}else{if(o.hasClass("ui-state-processing")){o.removeClass("ui-state-processing")
}}o.show()}if(n.preview&&B.children().length<=0){t=c('<img class="g-video-image" />').attr("src",n.preview);t.css({opacity:0});B.append(t);t.on("load",function(){t.animate({opacity:1},"normal")})}if(w){m.addClass("m-error")
}else{m.removeClass("m-error")}if(s===h.STATUS_RECORD_DELETING||s===h.STATUS_RECORD_DELETED){u.hide().button("disable").attr("href","javascript:void(0)");p.hide().button("disable");l.hide();if(s===h.STATUS_RECORD_DELETED){y.show();
if(x._showDeleted){m.show()}else{m.hide()}x.$items.trigger("elementresize")}else{y.hide()}}else{if(w){l.show()}else{l.hide()}if(n.url){u.attr("href",n.url).button("enable").show();p.button("enable").show()
}else{u.hide().button("disable").attr("href","javascript:void(0)");p.button("enable").show()}}};g._removeRecord=function(l,m){if(!l){return}var o=this,n;if(o._state===j.STATE_DESTROYED){return}n=o._listItems[m];
delete o._listItems[m];if(n){n._el.remove()}o._updateCounter();o.$items.trigger("elementresize")};g._updateCounter=function(){var m=this,l=0;m._saver.getList().forEach(function(n){if(n.status!==h.STATUS_RECORD_DELETED){++l
}});if(l!==m._count){if(l<=0){if(m._count>0){m.events.fire("list-empty")}m._count=l;m.$counter.html(f.tr(i,"list.empty"));m.$notice.html(f.tr(i,"notice.empty"));m.$wrapper.removeClass("m-full").addClass("m-empty");
if(m._heightFitter){m._heightFitter.update()}}else{if(m._count<=0){m.events.fire("list-full")}m._count=l;m.$counter.html(f.tr(i,"list.counter",{count:l}));m.$notice.html(f.tr(i,"notice.full"));m.$wrapper.removeClass("m-empty").addClass("m-full");
if(m._heightFitter){m._heightFitter.update()}}}};g._updateLoadingStatus=function(){var l=this;if(l._saver.isUpdating()){if(l._saver.isOnceUpdated()){l.$wrapper.addClass("m-updating")}else{l.$wrapper.addClass("m-loading")
}}else{if(l.$wrapper.hasClass("m-updating")){l.$wrapper.removeClass("m-updating")}if(l.$wrapper.hasClass("m-loading")){l.$wrapper.removeClass("m-loading")}}}}(window,window._ivideon));(function(c,h,f){"use strict";
var d=h.$,e=b,a=e.prototype,g="ivideon.views.CountSwitcher";h.provide(g,e);function b(i){var j=this;j._options=h.optClass(e.defaults,i,g,j,{$container:"container"});j.events=new (h.require("ivideon.utils.Observable"))(j);
j.$wrapper=d('<div class="ivideon-count-switcher '+(j._options.cssClassNames||"")+'"><div class="ivideon-count-switcher-label">'+(j._options.label||"")+'</div><div class="ivideon-count-switcher-switches">'+j._generateSwitchesHtml(j._options.minValue,j._options.maxValue,j._options.step)+"</div></div>").appendTo(j.$container);
j.highlightSwitch(j._options.initialValue);j.$wrapper.on("click",function(m){var k=d(m.target).closest("[data-count]",j.$wrapper),l=parseInt(k.attr("data-count"),10);if(!isNaN(l)){j.events.fire("switched",{count:l})
}})}e.defaults={cssClassNames:"",label:"",initialValue:null,minValue:1,maxValue:5,step:1,valuesInHtmlEnabled:false};a.highlightSwitch=function(i){var j=this;j.$wrapper.find("[data-count]").removeClass("m-active");
if(!isNaN(i)){j.$wrapper.find('[data-count="'+i+'"]').addClass("m-active")}};a._generateSwitchesHtml=function(m,j,n){var o=this,l,k="";for(l=m;l<=j;l+=n){k+='<span class="ivideon-count-switcher-switch m-value-'+l+'" data-count="'+l+'">'+(o._options.valuesInHtmlEnabled?l:"")+"</span>"
}return k}}(window,window._ivideon));(function(d,f,a){"use strict";var b=f.$,h=e,g=h.prototype,c="ivideon.views.Widget",i=c;f.provide(c,h);function e(j){var k=this;f.utils.assertArg(c,{options:j,"options.owner":j,"options.owner.widgetRenderContent":j,"options.owner.widgetHandleStateChange":j,"options.cssClassBase":j});
k._options=j;k.owner=j.owner;k._setState(h.STATE_NEW)}h.STATE_NEW=1;h.STATE_CREATED=2;h.STATE_IDLE=3;h.STATE_DESTROYED=4;h.MODE_DIALOG=1;h.MODE_EMBEDDED=2;g._createContent=function(k,n){var o=this,l=o._options.cssClassBase+"__content",m="",j="";
switch(n){case h.MODE_DIALOG:m=o._options.cssClassBase+"__m-dialog";break;case h.MODE_EMBEDDED:m=o._options.cssClassBase+"__m-embedded";break}if(typeof o._options.cssClasses==="string"){m+=" "+o._options.cssClasses
}if(typeof o._options.dialogCssClasses==="string"){m+=" "+o._options.dialogCssClasses}if(typeof o._options.embeddedCssClasses==="string"){m+=" "+o._options.embeddedCssClasses}if(typeof o._options.contentCssClasses==="string"){j+=" "+o._options.contentCssClasses
}o.displayMode=n;if(n===h.MODE_DIALOG){o.$wrapper=b('<div class="'+o._options.cssClassBase+" "+m+' iv-dlg ui-dialog ui-widget ui-widget-content ui-corner-all"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title">'+(o._options.dialogTitle||"")+'</span><a href="javascript:void(0)" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick"></span></a></div><div class="'+l+" "+j+' ui-dialog-content ui-widget-content"></div></div>')
}else{if(n===h.MODE_EMBEDDED){o.$wrapper=b('<div class="'+o._options.cssClassBase+" "+m+'"><div class="'+l+" "+j+'"></div></div>')}else{f.reportError(new f.utils.ArgumentError(c+"#_createContent: Unknown display mode ("+n+")."));
return}}o.$content=o.$wrapper.find("."+l);o.$titlebar=o.$wrapper.find(".ui-dialog-titlebar");o.$title=o.$titlebar.find(".ui-dialog-title");o.$closeButton=o.$titlebar.find(".ui-dialog-titlebar-close");o.$wrapper.appendTo(k);
o.$closeButton.on("click",function(p){if(p.which!==1){return}if(o._state===h.STATE_DESTROYED){return}p.preventDefault();if(!o.owner.widgetBeforeDestroy||o.owner.widgetBeforeDestroy()!==false){o.destroy()
}});o.owner.widgetRenderContent({"$container":o.$content,displayMode:n});o._setState(h.STATE_CREATED)};g.open=function(){var j=this;if(j._state!==h.STATE_NEW){throw new f.utils.StateError(c+"#open: Not in STATE_NEW.")
}f.require("ivideon.utils.overlay")({stopEvents:false}).done(function(k){j._overlay=k;j._createContent(j._overlay.$content,h.MODE_DIALOG);j._overlay.$element.on("click",function(l){if(j._state===h.STATE_DESTROYED){return
}if(l.target===j._overlay.$content[0]||l.target===j._overlay.$element[0]){if(!j.owner.widgetBeforeDestroy||j.owner.widgetBeforeDestroy()!==false){j.destroy()}return false}});j._onOpen()});return j};g.appendTo=function(j){var k=this;
if(k._state!==h.STATE_NEW){throw new f.utils.StateError(c+"#appendTo: Not in STATE_NEW.")}k._createContent(j,h.MODE_EMBEDDED);k._onOpen();return k};g.setDialogTitle=function(j){var k=this;if(k._state===h.STATE_DESTROYED){throw new f.utils.StateDestroyedError(c+"#setDialogTitle")
}k._options.dialogTitle=j;if(k.$title){k.$title.html((j||""))}return k};g.destroy=function(){var k=this,j;if(k._state===h.STATE_DESTROYED){return}k._setState(h.STATE_DESTROYED);if(k._overlay){k._overlay.destroy();
k._overlay=null}for(j in k){if(k.hasOwnProperty(j)&&j.charAt(0)==="$"){delete k[j]}}};g._setState=function(k){var l=this,j=l._state;if(!k){throw new f.utils.ArgumentError(c+'#_setState: Argument "state" not set.')
}if(l._state===h.STATE_DESTROYED){return}l._state=k;l.owner.widgetHandleStateChange({oldState:j,newState:k})};g._onOpen=function(){var j=this;if(j._state!==h.STATE_CREATED){return}j.$wrapper.css("visibility","inherit");
j._setState(h.STATE_IDLE)}}(window,window._ivideon));(function(e,f,a){"use strict";var b=f.$,h=i,g=h.prototype,c="ivideon.views.Wizard",d=[].slice;f.provide(c,h);function i(j){var k=this;k._options=f.optClass(h.defaults,j,c,k,{$container:"container",_steps:"steps","?initial":"initial",_heightFitter:"heightFitter ?"});
k.events=new (f.require("ivideon.utils.Observable"))(k);k.data={};k._currentStep=-1;k._stepsHistory=[];k._stackOfQueues=[];k.$wrapper=b('<div class="iv-wizard" />').appendTo(k.$container);k.$wrapper.on("click",function(l){var t="data-wizard-replace",o="data-wizard-push",s="data-wizard-go",r=b(l.target).closest(".iv-wizard, ["+t+"]"),p=b(l.target).closest(".iv-wizard, ["+o+"]"),n=r.attr(t),q=p.attr(o),m=f.utils.parseInt(b(l.target).closest(".iv-wizard, ["+s+"]").attr(s));
if(n&&k._steps[n]){k.updateData(r.data("wizard-data"));k.replaceState(n,r.data("wizard-state-data"));l.preventDefault()}else{if(q&&k._steps[q]){k.updateData(p.data("wizard-data"));k.pushState(q,p.data("wizard-state-data"));
l.preventDefault()}else{if(!isNaN(m)&&k._stepsHistory[m]){k.go(m);l.preventDefault()}}}});k.$wrapper.hide();k._setState(h.STATE_HIDDEN)}h.STATE_VISIBLE=1;h.STATE_HIDDEN=2;h.STATE_DESTROYED=3;h.STEP_STATE_NEW=1;
h.STEP_STATE_VISIBLE=2;h.STEP_STATE_HIDDEN=3;h.STEP_STATE_DESTROYED=4;h.defaults={scrollableViewEnabled:true};g.hide=function(){var j=this;if(j._state!==h.STATE_VISIBLE){return}j._hideStep();j.$wrapper.hide();
j._setState(h.STATE_HIDDEN)};g.show=function(){var j=this;if(j._state!==h.STATE_HIDDEN){return}j.$wrapper.show();j._setState(h.STATE_VISIBLE);if(j._currentStep<0){if(j._options.initial){j.pushState(j._options.initial,j._options.initialData)
}}else{j._showStep()}};g.go=function(j){var k=this;if(j<0||j>=k._stepsHistory.length){j=k._currentStep}if(j===k._currentStep){return}if(k._stackOfQueues.length){k._pushToQueue("_goImpl",b.makeArray(arguments));
return}k._startQueue();k._goImpl(j);k._finishQueue()};g.findBack=function(n){var m=this,l=m._stepsHistory,k,j;if(typeof n==="string"){n=[n]}k=m._currentStep;while(--k>=0&&(j=l[k])){if(b.inArray(j.id,n)>-1){return k
}}return -1};g.pushState=function(n,l){var o=this,m,j,k;if(b.isArray(n)){for(j=n.length,m=0;m<j;++m){k=(b.isArray(n[m])?n[m]:[n[m]]);o.pushState(k[0],k[1])}return}if(!o._steps[n]){throw new f.utils.ArgumentError(c+'#pushState: Argument "stepId" is incorrect.')
}if(o._stackOfQueues.length){o._pushToQueue("_pushStateImpl",b.makeArray(arguments));return}o._startQueue();o._pushStateImpl(n,l);o._finishQueue()};g.replaceState=function(o,n,l){var p=this,m,j,k;if(b.isArray(o)){if(o.length>0){k=(b.isArray(o[0])?o[0]:[o[0]]);
p.replaceState(k[0],n,k[1]);for(j=o.length,m=1;m<j;++m){k=(b.isArray(o[m])?o[m]:[o[m]]);p.pushState(k[0],k[1])}}return}if(!p._steps[o]){throw new f.utils.ArgumentError(c+'#replaceState: Argument "stepId" is incorrect.')
}if(typeof n==="undefined"){n=p._currentStep}if(n<0||n>=p._stepsHistory.length){throw new f.utils.ArgumentError(c+'#replaceState: Argument "stepIndex" is incorrect.')}if(p._stackOfQueues.length){p._pushToQueue("_replaceStateImpl",b.makeArray(arguments));
return}p._startQueue();p._replaceStateImpl(o,n,l);p._finishQueue()};g.getCurrentStepContext=function(){var k=this,j=k._currentStep;return k.getStepContext(j)};g.getCurrentStepId=function(){var l=this,k=l._currentStep,j=l.getStepContext(k);
if(j){return j.id}};g.getStepContext=function(k){var l=this,j;if(l._stepsHistory[k]){j=l._stepsHistory[k];return j}};g.getHistory=function(){return d.call(this._stepsHistory,0)};g.updateData=function(j){if(b.isPlainObject(j)){b.extend(true,this.data,j)
}};g.destroy=function(){var k=this,j;if(k._state===h.STATE_DESTROYED){return}k._setState(h.STATE_DESTROYED);k.events.fire("destroying");k.events.un();k._destroySteps(-1);k.$wrapper.remove();k._currentStep=-1;
k._stepsContext=null;for(j in k){if(k.hasOwnProperty(j)&&j.charAt(0)==="$"){delete k[j]}}};g._setState=function(j){var k=this;if(!j){throw new f.utils.ArgumentError(c+'#_setState: Argument "state" not set.')
}if(k._state===h.STATE_DESTROYED){return}k._state=j};g._goImpl=function(j){var k=this;k._hideStep();k._currentStep=j;k._showStep()};g._pushStateImpl=function(k,j){var l=this;l._destroySteps(l._currentStep);
l._pushStep(k,j)};g._replaceStateImpl=function(l,k,j){var m=this;m._destroySteps(k-1);m._pushStep(l,j)};g._pushStep=function(m,j){var n=this,l,k;if(!n._steps[m]){throw new f.utils.ArgumentError(c+'#_pushStep: Argument "stepId" is incorrect.')
}n._hideStep();l=b('<div class="iv-wizard-step iv-wizard-step__m-hidden"><div class="iv-wizard-step__header"></div><div class="iv-wizard-step__wrapper"><div class="iv-wizard-step__content"></div></div><div class="iv-wizard-step__footer"></div></div>');
k={wizard:n,id:m,step:b.extend(true,{},n._steps[m]),index:n._stepsHistory.length,$container:l,$header:l.find(".iv-wizard-step__header"),$footer:l.find(".iv-wizard-step__footer"),$wrapper:l.find(".iv-wizard-step__wrapper"),$content:l.find(".iv-wizard-step__content"),data:b.extend({},j),_state:h.STEP_STATE_NEW};
n._stepsHistory.push(k);n._currentStep=k.index;n._showStep();return k};g._destroySteps=function(l){var m=this,j,k;while(m._stepsHistory.length-1>l&&(k=m._stepsHistory.pop())){j=(k._state===h.STEP_STATE_NEW);
if(k._state!==h.STEP_STATE_DESTROYED){if(!j){m.events.fire("before-step-destroy",k);if(b.isFunction(k.step.destroy)){k.step.destroy(k)}if(m._heightFitter&&k.scrollableHandler){m._heightFitter.events.un("height-changed",k.scrollableHandler);
k.scrollableHandler=null}if(k.scrollable){k.scrollable.destroy();k.scrollable=null}k.$container.remove()}k.index=-1;k._state=h.STEP_STATE_DESTROYED;if(!j){m.events.fire("after-step-destroy",k)}}}};g._hideStep=function(){var l=this,k=l._currentStep,j;
if(k>=0&&l._stepsHistory[k]){j=l._stepsHistory[k];if(j._state===h.STEP_STATE_VISIBLE){l._startQueue();l.events.fire("before-step-hide",j);if(b.isFunction(j.step.hide)){j.step.hide(j)}j.$container.addClass("iv-wizard-step__m-hidden").removeClass("iv-wizard-step__m-visible");
if(l._heightFitter){l._heightFitter.update(j.$wrapper)}j._state=h.STEP_STATE_HIDDEN;l.events.fire("after-step-hide",j);l._finishQueue()}}};g._showStep=function(){var l=this,k=l._currentStep,j;if(l._state!==h.STATE_VISIBLE){return
}if(k>=0&&l._stepsHistory[k]){j=l._stepsHistory[k];if(j._state===h.STEP_STATE_NEW){l._startQueue();l.events.fire("before-step-init",j);j.$container.appendTo(l.$wrapper);if(b.isFunction(j.step.init)){j.step.init(j)
}if(l._options.scrollableViewEnabled){j.scrollable=new (f.require("ivideon.utils.ScrollableView"))(f.optMerge(l._options.scrollableViewOptions,{wrapper:j.$wrapper}));if(l._heightFitter){l._heightFitter.add(j.$wrapper);
l._heightFitter.events.on("height-changed",j.scrollableHandler=function(n,m){if(m.target===j.$wrapper[0]){j.scrollable.refresh()}})}}j._state=h.STEP_STATE_HIDDEN;l.events.fire("after-step-init",j);if(l._finishQueue()){return
}}if(j._state===h.STEP_STATE_HIDDEN){l._startQueue();l.events.fire("before-step-show",j);j.$container.addClass("iv-wizard-step__m-visible").removeClass("iv-wizard-step__m-hidden");if(b.isFunction(j.step.show)){j.step.show(j)
}if(l._heightFitter){l._heightFitter.update(j.$wrapper)}j._state=h.STEP_STATE_VISIBLE;l.events.fire("after-step-show",j);if(l._finishQueue()){return}}}};g._startQueue=function(){this._stackOfQueues.push([])
};g._pushToQueue=function(k,j){this._stackOfQueues[this._stackOfQueues.length-1].push([k,j])};g._finishQueue=function(){var m=this,j,l,k;if(m._stackOfQueues.length>0){j=m._stackOfQueues[m._stackOfQueues.length-1];
if(j.length>0){k=true;while((l=j.shift())){m[l[0]].apply(m,l[1])}}m._stackOfQueues.pop()}if(k){m._stackOfQueues.splice(0,m._stackOfQueues.length);return true}}}(window,window._ivideon));(function(g,i,b){"use strict";
var e=i.$,c="ivideon.views.CameraStreamPlayer",d=i.require(c),l=i.require(c+".IEngine"),k=a,h=(i.require("ivideon.utils.subclass"))(k,l),f=c+".FlowplayerEngine",j=c;i.provide(f,k);d.engines.flowplayer=k;
k.FlowplayerError=i.utils.declareErrorClass(i.utils.CriticalError,f+".FlowplayerError");function a(n,m){var o=this;m=i.optMerge(k.defaults,m);o._isDestroyed=false;o._flowplayerFactory=(g.$f||g.flowplayer);
o._flowplayer=null;o._p=n;o._o=m;o._componentsReady=e.Deferred();o._cacheTtl={getTime:1000,isPlaying:5000,isPaused:5000};o._cacheExpires={};o._cache={};o._cacheExtrapolateRate={};o._cacheStalled={};o._bufferFullLastTime=0;
o._bufferFullEmptyTracker=0;o._firstNonzeroTime=0;o._lastNonzeroTime=0;o.events=new (i.require("ivideon.utils.Observable"))(o)}k.defaults={debug:false,folder:"/flowplayer/",bufferingLengthInMs:0,bufferingWaitTimeInMs:0,bufferingRetryTimeInMs:1000,bufferingRetryCount:3,durationTrackerIntervalInMs:100};
k._gettersDefaults={isLoaded:false,getTime:0,getStatus:null,isPlaying:false,isPaused:false};h.canEmbed=function(){var m=this;if(m._isDestroyed){return false}return(!!g.flashembed&&!!m._flowplayerFactory)
};h.isEmbedded=function(){var o=this,n=o._p;if(o._isDestroyed){return false}try{if(o._flowplayer&&n.$playerContainer&&n.$playerContainer.children().length){return o._call("isLoaded")}}catch(m){}return false
};h.embed=function(){var n=this,m=n._p;if(n._isDestroyed){return}n._pauseRequested=false;n._loadComponents().done(function(){if(n._isDestroyed){return}var p,u=[10,0],r=u.join("."),s,o,t;if(n._o&&n._o.debug){i.console.log(f+"#embed: engine._loadComponents().done")
}if(!n.canEmbed()){p=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);n.events.fire("embed-error",p);return}try{n._unembedInternal();t=m.$playerContainer.get(0);s={src:n._o.folder+"/flowplayer-3.2.5.swf",version:u,wmode:"opaque",cachebusting:e.browser.msie,onFail:function(){var v;
if(g.flashembed.isSupported(u)){v=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f)}else{v=new d.FlashRequiredError(i.tr(j,"player.error.flash_required",{version:r}),r)}n.events.fire("embed-error",v);
return""}};o={showErrors:false,onLoad:n._onFlowplayerLoad,onError:n._onFlowplayerError,onPlaylistReplace:n._onFlowplayerPlaylistReplace,play:null,plugins:{controls:null},canvas:{background:"transparent none no-repeat 0 0",backgroundGradient:"none",border:"0px none"}};
n._flowplayer=n._flowplayerFactory(t,s,o);t=null;s=null;o=null;if(n._flowplayer){n._flowplayer._ivideon_engine=n;if(e.support.flashLoadsAfterClick){n.events.fire("engine-suspended")}}else{p=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);
i.reportError(p,{func:f+"#embed",part:"flowplayer_empty"});n._unembedInternal(true,p);return}}catch(q){t=null;s=null;o=null;p=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);
p.inner=q;i.reportError(p,{func:f+"#embed",part:"flowplayer_exception"});n._unembedInternal(true,p);return}}).fail(function(p){if(n._isDestroyed){return}var o=new d.EngineNotAvailableError(i.tr(j,"player.flowplayer.error.components_not_loaded"),f);
o.inner=p;i.reportError(o,{func:f+"#embed",part:"components_fail"});n._unembedInternal(true,o);return})};h.load=function(r){var o=this,n,m,p,q;if(o._isDestroyed){return}if(o._o&&o._o.debug){i.console.log(f+"#load begin")
}o._unloadInternal();if(!r||!r.sources||!r.sources.flv||!r.sources.flv.url){m=new d.StreamNotAvailableError(i.tr(j,"stream.error.source_not_available"));if(o._o&&o._o.debug){i.console.log(f+"#load: stream error",m)
}o.events.fire("load-error",m);return}if(!o.isEmbedded()){if(o._o&&o._o.debug){i.console.log(f+"#load: not embedded")}m=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);i.reportError(m,{func:f+"#load",part:"not_embedded"});
o._unembedInternal(true,m);return}o._stream=r;n=i.utils.nocacheURL(r.sources.flv.url);if(o._o&&o._o.debug){i.console.log(f+"#load: url == "+n)}o._cacheTtl.getTime=(1000/r.getSpeed());q=r.getDuration();
p={url:n,metaData:false,bufferLength:(o._o.bufferingLengthInMs/1000),duration:(q<=0?0:null),autoBuffering:true,autoPlay:false,scaling:"scale",image:false,linkUrl:""};o._loadPlayAsyncTimer=g.setTimeout(function(){if(o._isDestroyed){return
}o._loadPlayAsyncTimer=null;try{o._call("play",p)}catch(s){if(o._o&&o._o.debug){i.console.log(f+"#load: play_exception",s)}m=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);
m.inner=s;i.reportError(m,{func:f+"#load",part:"play_exception"});o._unloadInternal(true,m);return}},0);if(o._o&&o._o.debug){i.console.log(f+"#load end")}};h.unload=function(){var m=this;if(m._isDestroyed){return
}if(m._o&&m._o.debug){i.console.log(f+"#unload begin")}m._unloadInternal(true);if(m._o&&m._o.debug){i.console.log(f+"#unload end")}};h.unembed=function(){var m=this;if(m._isDestroyed){return}if(m._o&&m._o.debug){i.console.log(f+"#unembed begin")
}m._unembedInternal(true);if(m._o&&m._o.debug){i.console.log(f+"#unembed end")}};h.destroy=function(){var m=this;if(m._isDestroyed){return}m._isDestroyed=true;m.events.un();m._unembedInternal();delete m._p;
delete m._o};h.play=function(){var m=this;m._pauseRequested=false;m._cacheExpires.isPaused=0;m._cacheExpires.isPlaying=0;if(m._flowplayer){m._call("resume")}};h.pause=function(){var m=this;m._pauseRequested=true;
m._cacheExpires.isPaused=0;m._cacheExpires.isPlaying=0;if(m._flowplayer){m._call("pause")}};h.isPaused=function(){var m=this;if(m._flowplayer){return m._call("isPaused")}return false};h.isPlaying=function(){var m=this;
if(m._flowplayer){return m._call("isPlaying")}return false};h.getTime=function(){var m=this,n=0;if(m._flowplayer){n=(m._call("getTime")*i.SECOND_IN_MS);if(n>0){m._lastNonzeroTime=n}else{if(m._lastNonzeroTime>0){n=m._lastNonzeroTime
}}if(m._firstNonzeroTime===0){m._firstNonzeroTime=n}if(m._firstNonzeroTime>0&&n>0){n-=m._firstNonzeroTime}if(n<0){n=0}}return n};h.updateSize=function(){};h.setVolume=function(n){var m=this;if(m._flowplayer){n=Math.max(0,n);
n=Math.min(n,1);m._call("setVolume",Math.round(n*100))}};h.setMuted=function(n){var m=this;if(m._flowplayer){if(n){m._call("mute")}else{m._call("unmute")}}};h._call=function(){var s=this,p,r,t,o,m,n;if(s._isDestroyed){return
}p=e.makeArray(arguments);r=p.shift();t=s._flowplayer;o=i.now();if(typeof s._cacheExpires[r]==="number"&&o<s._cacheExpires[r]){n=s._cache[r];if(typeof s._cacheExtrapolateRate[r]==="number"&&!s._cacheStalled[r]){m=(o-(s._cacheExpires[r]-s._cacheTtl[r]));
n+=s._cacheExtrapolateRate[r]*m}return n}if(t&&t[r]&&t[r].apply){try{n=t[r].apply(t,p)}catch(q){if(s._o&&s._o.debug){i.console.error(f+"#_call: "+q,q)}}}if((typeof n==="undefined"||n===t)&&k._gettersDefaults.hasOwnProperty(r)){n=k._gettersDefaults[r]
}if(typeof s._cacheTtl[r]==="number"){if(typeof s._cacheExtrapolateRate[r]==="number"){s._cacheStalled[r]=(Math.abs(n-s._cache[r])<0.001)}s._cache[r]=n;s._cacheExpires[r]=o+s._cacheTtl[r]}return n};h._loadComponents=function(){var m=this;
if(m._isDestroyed){return}if(!m.canEmbed()){m._componentsReady.reject()}else{m._componentsReady.resolve()}return m._componentsReady.promise()};h._reportLoadSuccess=function(m){var n=this;if(n._isDestroyed){return
}if(!n._loadSuccessReported){n._loadSuccessReported=true;n._firstNonzeroTime=0;n._lastNonzeroTime=0;n.events.fire("load-success");if(m){n._startDurationTracker()}}};h._unloadInternal=function(o,n){var p=this,q=p._embedSuccessReported,m=p._loadSuccessReported,r=p._lastNonzeroTime;
if(p._isUnloading){return}if(p._o&&p._o.debug){i.console.log(f+"#_unloadInternal("+(o||false)+") begin")}p._isUnloading=true;g.clearTimeout(p._loadPlayAsyncTimer);p._loadPlayAsyncTimer=null;g.clearTimeout(p._onPauseAsyncTimer);
p._onPauseAsyncTimer=null;g.clearTimeout(p._onResumeAsyncTimer);p._onResumeAsyncTimer=null;g.clearTimeout(p._onStopAsyncTimer);p._onStopAsyncTimer=null;g.clearTimeout(p._onLoadAsyncTimer);p._onLoadAsyncTimer=null;
g.clearTimeout(p._onErrorAsyncTimer);p._onErrorAsyncTimer=null;g.clearTimeout(p._onBufferEventsThrottlingTimer);p._onBufferEventsThrottlingTimer=null;p._stopDurationTracker();p._stopBufferingWait();p._cacheExpires={};
if(p._flowplayer){p._call("close")}p._pauseRequested=false;p._firstNonzeroTime=0;p._lastNonzeroTime=0;p._loadSuccessReported=false;p._stream=null;p._isUnloading=false;if(o){if(m){if(p._o&&p._o.debug){i.console.log(f+"#_unloadInternal fire stream-finished")
}p.events.fire("stream-finished",{time:r,error:n})}else{if(q){if(p._o&&p._o.debug){i.console.log(f+"#_unembedInternal fire load-error",n)}p.events.fire("load-error",n)}else{if(p._o&&p._o.debug){i.console.log(f+"#_unloadInternal fire embed-error")
}p.events.fire("embed-error",n)}}}if(p._o&&p._o.debug){i.console.log(f+"#_unloadInternal end")}};h._unembedInternal=function(o,n){var q=this,p=q._p,r=q._embedSuccessReported,m=q._loadSuccessReported,s=q._lastNonzeroTime;
if(q._isUnembedding){return}if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal("+(o||false)+") begin")}q._isUnembedding=true;q._unloadInternal();q._embedSuccessReported=false;if(q._flowplayer){q._flowplayer._ivideon_engine=null;
q._flowplayer.destroy();q._flowplayer=null;p._cleanupBrowserPlugins()}p.$playerContainer.empty();q._isUnembedding=false;if(o){if(m){if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal fire stream-finished",n)
}q.events.fire("stream-finished",{time:s,error:n})}else{if(r){if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal fire load-error",n)}q.events.fire("load-error",n)}else{if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal fire embed-error",n)
}q.events.fire("embed-error",n)}}}if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal end")}};h._startBufferingWait=function(){var m=this,n=function(){var p,o;if(m._isDestroyed){return}if(m._o&&m._o.debug){i.console.log(f+"#_startBufferingWait bufferingCheck")
}if(m._bufferingWaitFinishTimer){return}g.clearTimeout(m._bufferingWaitTimer);m._bufferingWaitTimer=null;if(m.getTime()>0){m._bufferingWaitTimer=g.setTimeout(function(){m._handleBufferingWaitComplete()
},m._o.bufferingWaitTimeInMs)}else{if(m._bufferingCheckCount<m._o.bufferingRetryCount){if(m._o&&m._o.debug){i.console.log(f+"#_startBufferingWait bufferingCheck retry")}++m._bufferingCheckCount;m._bufferingWaitTimer=g.setTimeout(n,m._o.bufferingRetryTimeInMs)
}else{if(m._o&&m._o.debug){i.console.log(f+"#_startBufferingWait bufferingCheck failed, call _unloadInternal")}p=i.tr(j,"player.flowplayer.error.stream_not_available");o=new d.StreamNotAvailableError(p);
m._unloadInternal(true,o)}}};if(m._isDestroyed){return}if(m._o&&m._o.debug){i.console.log(f+"#_startBufferingWait begin")}if(typeof m._o.bufferingWaitTimeInMs!=="number"||m._o.bufferingWaitTimeInMs<0){m._handleBufferingWaitComplete()
}else{m._stopBufferingWait();m._bufferingWaitTimer=g.setTimeout(n,m._o.bufferingRetryTimeInMs)}if(m._o&&m._o.debug){i.console.log(f+"#_startBufferingWait end")}};h._handleBufferingWaitComplete=function(){var m=this;
if(m._isDestroyed){return}if(m._o&&m._o.debug){i.console.log(f+"#_handleBufferingWaitComplete begin")}m._stopBufferingWait();if(m._pauseRequested){if(m._loadSuccessReported){m._call("pause")}}m._bufferingWaitFinishTimer=g.setTimeout(function(){if(m._isDestroyed){return
}if(m._pauseRequested){if(m._o&&m._o.debug){i.console.log(f+"#_handleBufferingWaitComplete pause")}m._call("pause");m._reportLoadSuccess(false)}else{if(m._o&&m._o.debug){i.console.log(f+"#_handleBufferingWaitComplete resume")
}m._call("resume");m._reportLoadSuccess(true)}},0);if(m._o&&m._o.debug){i.console.log(f+"#_handleBufferingWaitComplete end")}};h._stopBufferingWait=function(){var m=this;if(m._isDestroyed){return}if(m._o&&m._o.debug){i.console.log(f+"#_stopBufferingWait begin")
}m._bufferingCheckCount=0;g.clearTimeout(m._onBufferEventsThrottlingTimer);m._onBufferEventsThrottlingTimer=null;g.clearTimeout(m._bufferingWaitTimer);m._bufferingWaitTimer=null;g.clearTimeout(m._bufferingWaitFinishTimer);
m._bufferingWaitFinishTimer=null;if(m._o&&m._o.debug){i.console.log(f+"#_stopBufferingWait end")}};h._startDurationTracker=function(){var p=this,o=p._p,r,q,m,n;if(p._isDestroyed||!o||!o.isStreamLoaded()){return
}r=p._stream;if(!r){return}q=r.getDuration();if(q>0&&!o.options.archiveStreamHasDuration){m=Math.max(0,q-500);n=function(){var s;if(p._isDestroyed){n=null;p._stopDurationTracker();return}p._cacheExpires.getTime=0;
s=p.getTime();if(s>=m){n=null;p._stopDurationTracker();if(p._o&&p._o.debug){i.console.log(f+"#_durationTrackerTimer reached end "+s+" "+m+", call _unloadInternal(true)")}p._unloadInternal(true)}else{p._durationTrackerTimer=g.setTimeout(n,Math.min(m,p._o.durationTrackerIntervalInMs))
}};n()}};h._stopDurationTracker=function(){var m=this;if(m._durationTrackerTimer){g.clearInterval(m._durationTrackerTimer);m._durationTrackerTimer=null}};h._onFlowplayerLoad=function(o){var n=this._ivideon_engine,m;
if(!n||n._isDestroyed||n._isUnloading){return}m=n._p;o=String(o||"");if(n._o&&n._o.debug){i.console.log(f+"#_onFlowplayerLoad(",o,")")}if(o!=="player"){return}n._flowplayer.setVolume(Math.round(m.options.volume*100));
g.clearTimeout(n._onLoadAsyncTimer);n._onLoadAsyncTimer=g.setTimeout(function(){if(n._isDestroyed){return}n._embedSuccessReported=true;if(e.support.flashLoadsAfterClick){n.events.fire("engine-resumed")
}n.events.fire("embed-success")},0)};h._onFlowplayerError=function(o,m){var n=this._ivideon_engine;if(!n||n._isDestroyed||n._isUnloading){return}o=parseInt(o||0,10);m=String(m||"");if(n._o&&n._o.debug){i.console.log(f+"#_onFlowplayerError(",o,m,")")
}g.clearTimeout(n._onLoadAsyncTimer);g.clearTimeout(n._onErrorAsyncTimer);n._onErrorAsyncTimer=g.setTimeout(function(){if(n._isDestroyed){return}var p;switch(o){case 100:m=i.tr(j,"player.flowplayer.error.plugin_init_failed");
break;case 200:m=i.tr(j,"player.flowplayer.error.stream_not_found");p=new d.StreamNotAvailableError(m);break;case 201:m=i.tr(j,"player.flowplayer.error.stream_not_available");p=new d.StreamNotAvailableError(m);
break;case 202:m=i.tr(j,"player.flowplayer.error.provider_not_available");break;case 300:m=i.tr(j,"player.flowplayer.error.init_failed");break;case 301:m=i.tr(j,"player.flowplayer.error.plugin_load_failed");
break;case 302:m=i.tr(j,"player.flowplayer.error.external_interface_error");break;case 303:m=i.tr(j,"player.flowplayer.error.resource_load_failed");break;default:m=i.tr(j,"player.flowplayer.error.unknown",{errorCode:o,errorMessage:m})
}if(!p){p=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);p.inner=new k.FlowplayerError(m);p.inner.code=o}if(o===100||o===300||o===301||o===302||o===303){if(n._o&&n._o.debug){i.console.log(f+"#_onFlowplayerError: call _unembedInternal")
}n._unembedInternal(true,p)}else{if(n._o&&n._o.debug){i.console.log(f+"#_onFlowplayerError: call _unloadInternal")}n._unloadInternal(true,p)}},0)};h._onFlowplayerPlaylistReplace=function(){var s=this._ivideon_engine,p,n,o,u,v,r,m,q,t;
if(!s||s._isDestroyed||s._isUnloading){return}n=s._flowplayer.getPlaylist();if(!n){return}p=["Start","Finish","BeforePause","Pause","Resume","Stop","BufferEmpty","BufferFull","MetaData"];for(m=n.length,r=0;
r<m;++r){o=n[r];for(t=p.length,q=0;q<t;++q){u=o["on"+p[q]];v=s["_onFlowplayerClip"+p[q]];if(u&&v){u.call(o,v)}}}};h._onFlowplayerClipStart=function(){var m=this._ivideon_engine;if(!m||m._isDestroyed||m._isUnloading){return
}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipStart")}m._bufferFullLastTime=0;m._bufferFullEmptyTracker=0;if(m._loadSuccessReported){m._onFlowplayerClipResume.call(this)}else{m._reportLoadSuccess(true)
}};h._onFlowplayerClipFinish=function(){var m=this._ivideon_engine;if(!m||m._isDestroyed||m._isUnloading){return}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipFinish")}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipFinish: call _unloadInternal(true)")
}m._unloadInternal(true)};h._onFlowplayerClipBeforePause=function(){var n=this._ivideon_engine,m,o;if(!n||n._isDestroyed){return false}m=n._p;if(n._loadSuccessReported){if(!m||!m.isStreamLoaded()){return false
}o=n._stream;if(!o){return false}}};h._onFlowplayerClipPause=function(){var m=this._ivideon_engine;if(!m||m._isDestroyed||m._isUnloading){return}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipPause")
}m._stopDurationTracker();m._cacheExpires.isPaused=0;m._cacheExpires.isPlaying=0;m._cacheExpires.getTime=0;if(m._loadSuccessReported){m._onPauseAsyncTimer=g.setTimeout(function(){if(m._isDestroyed){return
}m._onPauseAsyncTimer=null;m.events.fire("stream-paused")},0)}};h._onFlowplayerClipResume=function(){var m=this._ivideon_engine;if(!m||m._isDestroyed||m._isUnloading){return}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipResume")
}m._startDurationTracker();m._cacheExpires.isPaused=0;m._cacheExpires.isPlaying=0;if(m._loadSuccessReported){m._onResumeAsyncTimer=g.setTimeout(function(){m._onResumeAsyncTimer=null;if(m._isDestroyed){return
}m.events.fire("stream-resumed")},0)}};h._onFlowplayerClipStop=function(){var m=this._ivideon_engine;if(!m||m._isDestroyed||m._isUnloading){return}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipStop")
}if(m._loadSuccessReported){m._cacheExpires.isPaused=0;m._cacheExpires.isPlaying=0;m._cacheExpires.getTime=0;m._onStopAsyncTimer=g.setTimeout(function(){m._onStopAsyncTimer=null;if(m._isDestroyed){return
}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipStop: call _unloadInternal(true)")}m._unloadInternal(true)},0)}};h._onFlowplayerClipBufferEmpty=function(){var m=this._ivideon_engine;if(!m||m._isDestroyed||m._isUnloading){return
}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipBufferEmpty")}if(m._bufferFullLastTime){if(((new Date()).getTime()-m._bufferFullLastTime)<100){m._bufferFullEmptyTracker++}else{m._bufferFullEmptyTracker=0
}m._bufferFullLastTime=0;if(m._bufferFullEmptyTracker>20){if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipBufferEmpty: call _unloadInternal")}m._unloadInternal(true);return}}g.clearTimeout(m._onBufferEventsThrottlingTimer);
m._onBufferEventsThrottlingTimer=null;m._startBufferingWait()};h._onFlowplayerClipBufferFull=function(){var m=this._ivideon_engine;if(!m||m._isDestroyed||m._isUnloading){return}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipBufferFull")
}m._bufferFullLastTime=(new Date()).getTime();g.clearTimeout(m._onBufferEventsThrottlingTimer);m._onBufferEventsThrottlingTimer=null;m._onBufferEventsThrottlingTimer=g.setTimeout(function(){m._onBufferEventsThrottlingTimer=null;
if(m._isDestroyed){return}m._handleBufferingWaitComplete()},100)};h._onFlowplayerClipMetaData=function(n){var m=this._ivideon_engine;if(!m||m._isDestroyed||m._isUnloading){return}if(m._o&&m._o.debug){i.console.log(f+"#_onFlowplayerClipMetaData: ",n.metaData)
}m.events.fire("stream-metadata",n.metaData)}}(window,window._ivideon));(function(g,i,b){"use strict";var e=i.$,c="ivideon.views.CameraStreamPlayer",d=i.require(c),k=a,l=i.require(c+".IEngine"),h=i.utils.subclass(k,l),f=c+".IosEngine",j="ivideon.views.CameraStreamPlayer";
i.provide(f,k);d.engines.ios=k;k.MediaError=i.utils.declareErrorClass(i.utils.CriticalError,f+".MediaError");function a(n,m){var o=this;m=i.optMerge(k.defaults,m);o._isDestroyed=false;o._p=n;o._o=m;o._stream=null;
o.events=new (i.require("ivideon.utils.Observable"))(o);o._lastNonzeroTime=0;o._onPageshowHandler=function(){if(o._isDestroyed){return}e(g).one("pagehide",o._onPagehideHandler);o.events.enable();if(o._loadSuccessReported){o.events.fire("stream-finished",{time:o._lastNonzeroTime})
}o.events.fire("embed-error")};o._onPagehideHandler=function(){if(o._isDestroyed){return}e(g).one("pageshow",o._onPageshowHandler);o.events.disable()};e(g).one("pagehide",o._onPagehideHandler);o._onVideoErrorEnabled=false;
o._onVideoDisappearedEnabled=false;o._onVideoReadyToPlayEnabled=false;o._onVideoGestureEnabled=false}k.defaults={debug:false,suspendTimeout:7000,suspendCheckInterval:500};h.canEmbed=function(){var m=this;
if(m._isDestroyed){return false}return((e.browser.ios||e.browser.android)&&!e.browser.operaMini)};h.isEmbedded=function(){var m=this;if(m._mediaElement&&m.$videoElement&&m.$videoElement.parent().is(":visible")){return true
}return false};h.embed=function(){var p=this,o=p._p,m;if(p._isDestroyed){return}if(p._o&&p._o.debug){i.console.log(f+"#embed begin")}p._unembedInternal();if(!p.canEmbed()){m=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);
p.events.fire("embed-error",m);return}try{p.$videoElement=e("<video/>").attr("width","100%").attr("height","100%").attr("controls",false).hide();if(e.browser.android){p.$videoElement.attr("poster","");
p.$videoElement.attr("preload","true")}p._mediaElement=p.$videoElement.get(0);p.$videoElement.on("ended",function(){if(p._isDestroyed||p._isUnloading||!p._stream||p._stream.isLive()){return}if(p._o&&p._o.debug){i.console.log(f+"#(ended)")
}p.events.fire("stream-finished",{time:p._lastNonzeroTime})});p.$videoElement.on("play",function(q){if(p._isDestroyed||p._isUnloading){return}if(p._o&&p._o.debug){i.console.log(f+"#(play): ",q)}p._notifyResumed();
p.events.fire("stream-resumed")});p.$videoElement.on("pause",function(s){if(p._isDestroyed||p._isUnloading){return}if(p._o&&p._o.debug){i.console.log(f+"#(pause): ",s)}var t=(p._stream?p._stream.getDuration():0),r=Math.max(0,t-500),q=p._lastNonzeroTime;
if(p._o&&p._o.debug){i.console.log(f+"#(pause): pause currentTime == "+q+", durationCuepoint == "+r)}if(t>0&&q>=r){p._onVideoDisappeared(s);return}p.events.fire("stream-paused");if(!p._pauseRequested){p.events.fire("engine-suspended")
}});p.$videoElement.on("suspend",function(q){if(p._isDestroyed||p._isUnloading){return}if(p._o&&p._o.debug){i.console.log(f+"#(suspend)",q)}p._setSuspendedCheck()});p.$videoElement.on("loadedmetadata playing",e.proxy(p._onVideoAppeared,p));
p.$videoElement.on("error",e.proxy(p._onVideoError,p));p.$videoElement.on("abort emptied",e.proxy(p._onVideoDisappeared,p));p.$videoElement.on("canplay load",e.proxy(p._onVideoReadyToPlay,p));p._gestureFullscreenScaleInitial=0;
if(!p._overlayGestureStartHandler){o.getOverlayElement().on("gesturestart",p._overlayGestureStartHandler=function(q){if(p._isDestroyed){return}if(!p._onVideoGestureEnabled){return}p._gestureFullscreenScaleInitial=q.originalEvent.scale
})}if(!p._overlayGestureEndHandler){o.getOverlayElement().on("gestureend",p._overlayGestureEndHandler=function(q){if(p._isDestroyed){return}if(!p._onVideoGestureEnabled){return}if(p._gestureFullscreenScaleInitial<q.originalEvent.scale){if(p._mediaElement.readyState>=p._mediaElement.HAVE_METADATA){p._mediaElement.webkitEnterFullscreen()
}}p._gestureFullscreenScaleInitial=0})}if(!p._overlayTapHandler){o.getOverlayElement().on("touchend",p._overlayTapHandler=function(){if(p._o&&p._o.debug){i.console.log(f+"#(touchend)")}p._onVideoReadyToPlayEnabled=true;
p._onVideoReadyToPlay.apply(p,arguments)})}o.$playerContainer.prepend(p.$videoElement);p._embedSuccessReported=true;p.events.fire("embed-success")}catch(n){m=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);
m.inner=n;i.reportError(m,{func:f+"#embed",part:"html5video_exception"});p._unembedInternal(true,m)}if(p._o&&p._o.debug){i.console.log(f+"#embed end")}};h.load=function(q){var p=this,n,m;if(p._isDestroyed){return
}if(p._o&&p._o.debug){i.console.log(f+"#load begin")}p._unloadInternal();if(!q||!q.sources||!q.sources.hls||!q.sources.hls.url){m=new d.StreamNotAvailableError(i.tr(j,"stream.error.source_not_available"));
p.events.fire("load-error",m);return}if(!p.isEmbedded()){m=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);i.reportError(m,{func:f+"#load",part:"not_embedded"});p._unembedInternal(true,m);
return}p._stream=q;n=i.utils.nocacheURL(q.sources.hls.url);i.console.log(f+"#load: url == "+n);try{p.$videoElement.show();p.$videoElement.width();p.events.disable();if(p._o&&p._o.debug){i.console.log(f+"#load: before src assigned")
}p._mediaElement.src=n;p._mediaElement.removeAttribute("controls");p.events.enable();if(p._o&&p._o.debug){i.console.log(f+"#load: before play()")}if(e.browser.android){p._mediaElement.load()}p._mediaElement.play();
if(p._o&&p._o.debug){i.console.log(f+"#load: after play()")}if(p._mediaElement.readyState<p._mediaElement.HAVE_FUTURE_DATA){p._onVideoReadyToPlayEnabled=true;g.setTimeout(function(){if(p._onVideoReadyToPlayEnabled){p._onVideoErrorEnabled=true;
p._onVideoDisappearedEnabled=true}},0)}else{p._onVideoErrorEnabled=true;p._onVideoDisappearedEnabled=true}}catch(o){m=new d.EngineNotAvailableError(i.tr(j,"player.error.engine_not_available"),f);m.inner=o;
i.reportError(m,{func:f+"#load",part:"play_exception"});p._unloadInternal(true,m);return}if(p._o&&p._o.debug){i.console.log(f+"#load end")}};h.unload=function(){var m=this;if(m._isDestroyed){return}m._unloadInternal(true)
};h.unembed=function(){var m=this;if(m._isDestroyed){return}m._unembedInternal(true)};h.destroy=function(){var m=this;if(m._isDestroyed){return}m._isDestroyed=true;m.events.un();m._unembedInternal(true);
if(m._onPageshowHandler&&m._onPagehideHandler){e(g).off("pageshow",m._onPageshowHandler).off("pagehide",m._onPagehideHandler);m._onPageshowHandler=null;m._onPagehideHandler=null}delete m._p;delete m._o
};h.play=function(){var m=this;m._pauseRequested=false;if(m._mediaElement){m._mediaElement.play()}};h.pause=function(){var m=this;m._pauseRequested=true;if(m._mediaElement){m._mediaElement.pause()}};h.isPaused=function(){var m=this;
if(m._mediaElement){return(!!m._pauseRequested||m._mediaElement.paused)}return false};h.isPlaying=function(){var m=this;if(m._mediaElement){return(!m._mediaElement.paused&&!m._mediaElement.ended)}return false
};h.getTime=function(){var m=this,n=0;if(m._mediaElement){n=(m._mediaElement.currentTime*i.SECOND_IN_MS);if(n>0){m._lastNonzeroTime=n}else{if(m._lastNonzeroTime>0){n=m._lastNonzeroTime}}}return n};h.updateSize=function(){};
h.setVolume=function(m){};h.setMuted=function(m){};h._call=function(){var q=this,n=e.makeArray(arguments),p=n.shift(),r=q._mediaElement,m;if(r&&r[p]&&r[p].apply){try{m=r[p].apply(r,n)}catch(o){if(q._o&&q._o.debug){i.console.error(f+"#_call: "+o,o)
}}}return m};h._reportLoadSuccess=function(){var m=this;if(m._isDestroyed){return}if(!m._loadSuccessReported){m._loadSuccessReported=true;m._lastNonzeroTime=0;m.events.fire("load-success")}};h._unloadInternal=function(o,n){var q=this,p=q._p,r=q._embedSuccessReported,m=q._loadSuccessReported,s=q._lastNonzeroTime;
if(q._isUnloading){return}if(q._o&&q._o.debug){i.console.log(f+"#_unloadInternal("+(o||false)+") begin")}q._isUnloading=true;q._clearSuspendedCheck();q._lastNonzeroTime=0;q._loadSuccessReported=false;q._pauseRequested=false;
q._onVideoErrorEnabled=false;q._onVideoDisappearedEnabled=false;q._onVideoReadyToPlayEnabled=false;q._onVideoGestureEnabled=false;q._stream=null;if(q.$videoElement){q.$videoElement.hide()}if(q._mediaElement){q._mediaElement.src="about:blank";
q._mediaElement.load()}q._isUnloading=false;if(o){if(m){if(q._o&&q._o.debug){i.console.log(f+"#_unloadInternal fire stream-finished")}q.events.fire("stream-finished",{time:s,error:n})}else{if(r){if(q._o&&q._o.debug){i.console.log(f+"#_unloadInternal fire load-error",n)
}q.events.fire("load-error",n)}else{if(q._o&&q._o.debug){i.console.log(f+"#_unloadInternal fire embed-error")}q.events.fire("embed-error",n)}}}if(q._o&&q._o.debug){i.console.log(f+"#_unloadInternal end")
}};h._unembedInternal=function(o,n){var q=this,p=q._p,r=q._embedSuccessReported,m=q._loadSuccessReported,s=q._lastNonzeroTime;if(q._isUnembedding){return}if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal("+(o||false)+") begin")
}q._isUnembedding=true;q._unloadInternal();q._embedSuccessReported=false;q._pagehidden=false;q._pageshowReloadDone=false;if(q._mediaElement){q._mediaElement=null}if(q.$videoElement){q.$videoElement.remove();
q.$videoElement=null}p.$playerContainer.empty();if(q._overlayGestureStartHandler){p.getOverlayElement().off("gesturestart",q._overlayGestureStartHandler);q._overlayGestureStartHandler=null}if(q._overlayGestureEndHandler){p.getOverlayElement().off("gestureend",q._overlayGestureEndHandler);
q._overlayGestureEndHandler=null}if(q._overlayTapHandler){p.getOverlayElement().off("touchend",q._overlayTapHandler);q._overlayTapHandler=null}q._isUnembedding=false;if(o){if(m){if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal fire stream-finished")
}q.events.fire("stream-finished",{time:s,error:n})}else{if(r){if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal fire load-error",n)}q.events.fire("load-error",n)}else{if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal fire embed-error")
}q.events.fire("embed-error",n)}}}if(q._o&&q._o.debug){i.console.log(f+"#_unembedInternal end")}};h._fakeClick=function(o){var n=g.document,m=(n.createEvent?n.createEvent("MouseEvents"):b);if(m&&m.initMouseEvent&&o&&o.dispatchEvent){m.initMouseEvent("click",true,true,g,0,0,0,0,0,false,false,false,false,0,null);
o.dispatchEvent(m)}};h._onVideoReadyToPlay=function(){var n=this,m=n._p;if(n._isDestroyed||!n._mediaElement||n._isUnloading){return}if(!n._onVideoReadyToPlayEnabled){return}if(n._o&&n._o.debug){i.console.log(f+"#_onVideoReadyToPlay: before play() "+n._mediaElement.networkState+" "+n._mediaElement.readyState)
}n._mediaElement.play();if(n._o&&n._o.debug){i.console.log(f+"#_onVideoReadyToPlay: after play() "+n._mediaElement.networkState+" "+n._mediaElement.readyState)}n._fakeClick(n._mediaElement);n._notifyResumed();
n._setSuspendedCheck()};h._onVideoAppeared=function(o){var n=this,m=n._p;if(n._isDestroyed||n._isUnloading){return}if(n._o&&n._o.debug){i.console.log(f+"#_onVideoAppeared: event.type == "+o.type)}n._notifyResumed();
n._reportLoadSuccess();n._onVideoGestureEnabled=true};h._onVideoDisappeared=function(o){var n=this,m=n._p;if(n._isDestroyed||n._isUnloading){return}if(!n._onVideoDisappearedEnabled){return}if(n._o&&n._o.debug){i.console.log(f+"#_onVideoDisappeared: event.type == "+o.type)
}if(n._loadSuccessReported){if(n._o&&n._o.debug){i.console.log(f+"#_onVideoDisappeared: stream-finished { time: "+n._lastNonzeroTime+" }")}n.events.fire("stream-finished",{time:n._lastNonzeroTime})}else{if(n._o&&n._o.debug){i.console.log(f+"#_onVideoDisappeared: load-error (empty error)")
}n.events.fire("load-error")}};h._onVideoError=function(s){var r=this,o=r._p,m,n,q,t,p;if(r._isDestroyed||r._isUnloading){return}if(s.type==="error"){n=new d.StreamNotAvailableError(i.tr(j,"player.ios.error.stream_not_available"));
q=(r._mediaElement?r._mediaElement.error:null);if(q){m=r._mediaElement;for(p in q){if(p.indexOf("MEDIA_ERR_")===0&&q.code===q[p]){n.inner=t=new k.MediaError(p);t.inner=q;t.code=q.code;break}}if(t){t.mediaElement={};
e.each(["src","currentSrc","currentTime","startTime","duration","networkState","readyState","ended"],function(v,u){t.mediaElement[u]=m[u];if(u==="networkState"||u==="readyState"){for(var w in m){if(w.indexOf(u==="networkState"?"NETWORK_":"HAVE_")===0&&t.mediaElement[u]===m[w]){t.mediaElement[u+"String"]=w
}}}})}}}if(!r._onVideoErrorEnabled){return}if(r._o&&r._o.debug){i.console.log(f+": error",s)}r._notifyResumed();if(r._loadSuccessReported){r.events.fire("stream-finished",{time:r._lastNonzeroTime,error:n})
}else{r.events.fire("load-error",n)}};h._setSuspendedCheck=function(){var p=this,q,m,o=0,n;if(p._isDestroyed){return}q=p._o.suspendTimeout;m=p._o.suspendCheckInterval;n=function(){if(!p._mediaElement){return
}if(++o>(q/m)){if(p._mediaElement.networkState===p._mediaElement.NETWORK_IDLE&&p._mediaElement.readyState===p._mediaElement.HAVE_NOTHING){p.events.fire("engine-suspended")}}else{p._suspendedCheckTimer=g.setTimeout(n,m)
}};n()};h._clearSuspendedCheck=function(){var m=this;if(m._suspendedCheckTimer){g.clearTimeout(m._suspendedCheckTimer);m._suspendedCheckTimer=null}};h._notifyResumed=function(){var m=this;m._clearSuspendedCheck();
if(m._isDestroyed){return}m.events.fire("engine-resumed")}}(window,window._ivideon));(function(c,h,f){"use strict";var d=h.$,e=a,b=e.prototype,g="ivideon.models.BackendAPI.Session";h.provide(g,e);e.SessionEndedError=h.utils.declareErrorClass(g+".SessionEndedError",["code"]);
function a(){var n=this,m=n._jsonAPI.errorFilters,l,j,k=function(o,i){if(!i||!i.success){if(o.method!=="ping"){n.ping()}}};for(j=m.length,l=0;l<j;++l){if(m[l]===h.utils.JsonAPI.successFalseFilter){m.splice(l,0,k);
break}}return d.extend(n,b)}b.ping=function(){var j=this,i=j._pingDeferred;if(i){return i.promise()}i=j._pingDeferred=d.Deferred();if(!h.app||h.app.isEnded()){return i.promise()}h.console.log(g+".ping: started");
j._jsonAPI.request("ping",null,{type:"get"}).done(function(k){j._pingDeferred=null;h.console.log(g+".ping: done; success == "+k.success,k);if(!h.app||h.app.isEnded()){return}i.resolve()}).fail(function(k){var l=k.code;
j._pingDeferred=null;h.console.error(g+".ping: fail; error == ",k);if(!h.app||h.app.isEnded()){return}if(l===10002||l===10017){i.reject();j.events.fire("session-ended",{error:new e.SessionEndedError(k.message||"",l)})
}else{i.reject();j.events.fire("session-check-error",{error:k})}});return i.promise()}}(window,window._ivideon));(function(b,h,f){"use strict";var c=h.$,e=d,a=e.prototype,g="ivideon.models.BackendAPI.Streamer";
h.provide(g,e);function d(){return c.extend(this,a)}a.getArchiveRecords=function(k,j,i){if(typeof j!=="number"||isNaN(j)){throw new h.utils.ArgumentError(g+'#getArchiveRecords: Argument "startTime" is incorrect.')
}if(typeof i!=="number"||isNaN(i)){throw new h.utils.ArgumentError(g+'#getArchiveRecords: Argument "endTime" is incorrect.')}var l=this;return l._jsonAPI.request("getArchiveRecords",{u:k.serverId,c:k.cameraId,ast:j,aet:i},{type:"get",timeout:33*1000})
};a.getArchiveRecordsCounts=function(k,j,i){if(typeof j!=="number"||isNaN(j)){throw new h.utils.ArgumentError(g+'#getArchiveRecords: Argument "startTime" is incorrect.')}if(typeof i!=="number"||isNaN(i)){throw new h.utils.ArgumentError(g+'#getArchiveRecords: Argument "endTime" is incorrect.')
}var l=this;return l._jsonAPI.request("getArchiveRecordsCounts",{u:k.serverId,c:k.cameraId,ast:j,aet:i},{type:"get",timeout:33*1000})};a.ptz=function(i,j){var k=this;return k._jsonAPI.request("ptz",c.extend({u:i.serverId,c:i.cameraId},j),{type:"get"})
}}(window,window._ivideon));(function(b,h,f){"use strict";var c=h.$,e=d,a=e.prototype,g="ivideon.models.BackendAPI.PublicCameras";h.provide(g,e);function d(){return c.extend(this,a)}a.getCameraPublicInfo=function(i){var j=this;
return j._jsonAPI.request("getCameraPublicInfo",i)};a.saveCameraPublicInfo=function(i){var l=this,k=c.extend({},i.misc),j;for(j in k){if(k.hasOwnProperty(j)){if(k[j]===null){delete k[j]}}}return l._jsonAPI.request("saveCameraPublicInfo",{server_id:i.server_id,camera_id:i.camera_id,misc:JSON.stringify(k)},{type:"post"})
};a.setCameraMapLocation=function(i){var l=this,j={server_id:i.server_id,camera_id:i.camera_id},k=i.coordinates;if(k&&k.latitude&&k.longitude){j.latitude=k.latitude;j.longitude=k.longitude}return l._jsonAPI.request("setCameraGeo",j,{type:"post"})
};a.getPublicCameras=function(i){var j=this;return j._jsonAPI.request("getPublicCameras",i)};a.getPublicCamerasByGeoBox=function(i){var j=this;return j._jsonAPI.request("getPublicCamerasByGeoBox",i)}}(window,window._ivideon));
(function(c,h,f){"use strict";var d=h.$,e=b,a=e.prototype,g="ivideon.models.BackendAPI.Abuse";h.provide(g,e);function b(){return d.extend(this,a)}a.checkAbuse=function(i){var j=this;return j._jsonAPI.request("cameraAbuseCheck",{serverId:i.camera.serverId,cameraId:i.camera.cameraId},{type:"get"})
};a.reportAbuse=function(i){var j=this;return j._jsonAPI.request("cameraAbuse",{serverId:i.camera.serverId,cameraId:i.camera.cameraId,topic:i.topic,comment:i.comment,email:i.email},{type:"post"})}}(window,window._ivideon));
(function(a,e,c){"use strict";var b=e.$,d=e.ns("ivideon.config");d.buildCameraTitle=function(f){if(!f){return""}var g=f.server,h="";if(g&&g.name){h+=g.name+": "}h+=f.name;return h};d.init=function(){d.rosterPreviewImageLoaderOptions=b.extend({trackerOptions:{timeout:10000}},d.rosterPreviewImageLoaderOptions);
var f=d.app.assetsStaticUrl.replace(/^\/\//,a.location.protocol+"//")+"/common/libs";d.cameraVideoViewOptions=b.extend({debug:!!a._DEBUG,cameraPlayerOptions:{debug:!!a._DEBUG,engine:"flowplayer",flowplayerEngine:{folder:f+"/flowplayer"},mediaelementEngine:{folder:f+"/mediaelement2.1.3"}},cameraPtzOptions:function(m){if(!m||!m.features||!m.features.ptz){return c
}return{rzoomCoeff:m.rzoomCoeff,presets:m.ptzPresets,features:{moveLeft:!!m.features.ptz.pan,moveRight:!!m.features.ptz.pan,moveUp:!!m.features.ptz.tilt,moveDown:!!m.features.ptz.tilt,moveHome:false,rzoom:!!m.features.ptz.rzoom,center:false,restore:false}}
},cameraTitleFactory:function(n,m){return d.buildCameraTitle(m)},timelineViewOptions:{levels:[{rangeSize:15*e.MINUTE_IN_MS,ticksCount:5,groupingThreshold:e.SECOND_IN_MS},{rangeSize:e.HOUR_IN_MS,ticksCount:5,groupingThreshold:e.SECOND_IN_MS},{rangeSize:4*e.HOUR_IN_MS,ticksCount:4,groupingThreshold:5*e.MINUTE_IN_MS},{rangeSize:24*e.HOUR_IN_MS,ticksCount:6,groupingThreshold:5*e.MINUTE_IN_MS}],groupingEnabled:false,recordColorsByTypeEnabled:false},timelineCalendarButtonOptions:{timelineCalendarOptions:{}},videoSizeFitHeight:function(){return 480
},embedButtonEnabled:true,archiveExportEnabled:true,allowStopLiveStream:true,allowPauseLiveStream:false,allowStopArchiveStream:true,allowPauseArchiveStream:true,pingOnError:true},d.cameraVideoViewOptions);
d.cameraVideoWindowOptions=b.extend({cameraWindowTitleFactory:function(m){return d.buildCameraTitle(m)},cameraVideoViewOptions:d.cameraVideoViewOptions},d.cameraVideoWindowOptions);d.embedOptions=b.extend(true,{embedCameraUrl:"",embedBottomScriptUrl:"",embedBottomBlockEnabled:false,tvHomeUrl:"",tvCameraUrl:"",tvEmbedCameraUrl:"",tvInfoEnabled:false,minWidth:250,minHeight:188,defaultWidths:[320,480,640]},d.embedOptions);
var j=e.require({throwError:false},"ivideon.models.Server"),h=e.require({throwError:false},"ivideon.models.Camera"),g=e.require({throwError:false},"ivideon.models.Server.Roster"),k=e.require({throwError:false},"ivideon.models.Server.Activation"),l=e.require({throwError:false},"ivideon.models.Camera.Roster"),i=e.require({throwError:false},"ivideon.models.Camera.PublicAccess");
if(j&&g){g.apply(j.prototype)}if(j&&k){k.apply(j.prototype)}if(h&&l){l.apply(h.prototype)}if(h&&i){i.apply(h.prototype)}e.app.events.on("config-initialized",function(){var m=e.app.getConfig();if(m.serverTime){e.syncTime(m.serverTime)
}e.app.registerServices({session:{factory:function(p){return b.extend(true,{},p)},config:m.session},router:{"class":"ivideon.utils.Router",config:m.router},streamerAPI:{"class":"ivideon.models.StreamerAPI",config:m.streamerAPI},backendAPI:{"class":"ivideon.models.BackendAPI",mixins:["ivideon.models.BackendAPI.Streamer",e.require({throwError:false},"ivideon.models.BackendAPI.Session"),e.require({throwError:false},"ivideon.models.BackendAPI.Roster"),e.require({throwError:false},"ivideon.models.BackendAPI.UserAccount"),e.require({throwError:false},"ivideon.models.BackendAPI.PublicCameras"),e.require({throwError:false},"ivideon.models.BackendAPI.Activation"),e.require({throwError:false},"ivideon.models.BackendAPI.CameraArchiveRecordsSaver"),e.require({throwError:false},"ivideon.models.BackendAPI.MacAddressPersonalization"),e.require({throwError:false},"ivideon.models.BackendAPI.TariffPlan"),e.require({throwError:false},"ivideon.models.BackendAPI.TariffPackage"),e.require({throwError:false},"ivideon.CameraPlanManagerBackendAPI"),e.require({throwError:false},"ivideon.BillingBackendAPI"),e.require({throwError:false},"ivideon.models.BackendAPI.NotificationSchedule"),e.require({throwError:false},"ivideon.models.BackendAPI.Invitations"),e.require({throwError:false},"ivideon.models.BackendAPI.Sensors"),e.require({throwError:false},"ivideon.models.BackendAPI.ServerPlugins"),e.require({throwError:false},"ivideon.models.BackendAPI.Abuse")],config:m.backendAPI}});
var o=e.require({throwError:false},"ivideon.utils.LockerService");if(o){e.app.registerService("locker",{"class":o})}var n=e.require({throwError:false},"ivideon.models.GeocoderAPI");if(n){e.app.registerService("geocoderAPI",{"class":n,config:m.geocoderAPI})
}})}}(window,window._ivideon));(function(e,f,a){"use strict";var b=f.$,h=d,g=h.prototype,c="ivideon.controllers.EmbeddedVideo",i=c,j=f.require({throwError:false,prefix:""},"Visibility");f.provide(c,h);
function d(k){var n=this,m;n.options=f.optClass(h.defaults,k,c,n,{$wrapper:"wrapper",_camera:"camera ?"});n._url=e.location.href;n._parentUrl="";try{if(e.parent!==e){n._parentUrl=e.document.referrer;f.console.log(c+": Embedded into ",n._parentUrl)
}}catch(l){}n._error=null;n._abuseButtonAllowed=false;n.$video=n.$wrapper.find(".b-embed-video");n.$splash=n.$wrapper.find(".b-embed-splash");n.$splashContent=n.$wrapper.find(".b-embed-splash-content");
n.$previewWrapper=n.$wrapper.find(".b-embed-preview-wrapper");n.$statusbarWrapper=n.$wrapper.find(".b-embed-statusbar-wrapper");n.$statusbar=n.$wrapper.find(".b-embed-statusbar");n.$play=n.$splash.find(".b-embed-btn-play");
if(n._camera){m=f.app.service("streamerAPI").createLiveStream(n._camera);if(m&&m.sources&&m.sources.jpeg){n._previewImageUrl=m.sources.jpeg.url}n._previewImageLoader=new (f.require("ivideon.utils.ImageLoader"))(n.options.previewImageLoaderOptions);
n.$previewBuffers=b("<img/><img/>").appendTo(n.$previewWrapper);n._previewSwapper=n._previewImageLoader.addSwapper(n.$previewBuffers);n.$play.on("touchstart click",b.proxy(g._onPlayButtonClick,n))}else{n.$play.remove()
}if(n.$statusbar.hasClass("m-error")||!n._camera){n._error=new Error(n.$statusbar.text()||f.tr(i,"error.embed_no_connection"))}if(n.options.embeddedLogoEnabled){n._addEmbeddedLogo(n.options.embeddedLogoOptions)
}if(n.options.embeddedLinkEnabled){n._addEmbeddedLink(n.options.embeddedLinkOptions)}if(n.options.collapsibleBannerEnabled){n._addCollapsibleBanner(n.options.collapsibleBannerOptions)}else{if(n.options.freeBannerEnabled){n._addFreeBanner(n.options.freeBannerOptions)
}}n._cameraCommentsAvailable=((e.parent!==e)&&((e.document.referrer||"").indexOf(f.app.getConfig("embedOptions.tvBaseUrl")+"/")===0));n._onWindowResize();b(e).bind("resize orientationchange",n._onWindowResizeHandler=function(){n._onWindowResize.apply(n,arguments)
});f.app.events.on("ending",function(){var o;if(n._previewSwapper){o=n._previewSwapper;n._previewSwapper=null;o.destroy()}if(n._previewImageLoader){o=n._previewImageLoader;n._previewImageLoader=null;o.destroy()
}if(n.cameraVideoView){o=n.cameraVideoView;n.cameraVideoView=null;o.destroy()}if(n._onWindowResizeHandler){b(e).unbind("resize orientationchange",n._onWindowResizeHandler);n._onWindowResizeHandler=null
}n.$video.remove();n.$splash.remove();n._fireExternalEvent({event:"iv-embed-unloaded"})});n._renderError();n._fireExternalEvent({event:"iv-embed-loaded"});if(n._camera&&n.options.autoplay===true&&b.support.html5MediaAutoplay){n.showVideo();
n.updatePreview()}else{n.showSplash(n._camera?new Error(n.$statusbar.text()):a)}if(j&&j.isSupported()){j.change(function(){if(!j.hidden()&&n._state===h.STATE_SPLASH){n.updatePreview()}})}}h.STATE_SPLASH=1;
h.STATE_VIDEO=2;h.defaults={autoplay:false,previewImageLoaderOptions:{trackerOptions:{timeout:10000},swapperOptions:{fadeSpeed:"fast"}},embeddedLogoEnabled:false,embeddedLinkEnabled:false,collapsibleBannerEnabled:false,freeBannerEnabled:false};
g.updatePreview=function(){var k=this;if(k._previewImageUrl&&k._previewSwapper){k._previewSwapper.load(k._previewImageUrl)}};g.showSplash=function(){var k=this;if(k._state===h.STATE_SPLASH){return}k._state=h.STATE_SPLASH;
if(k.cameraVideoView){k.cameraVideoView.getPlayer().unload(true);k.cameraVideoView.clear();if(k.options.cameraVideoViewOptions&&k.options.cameraVideoViewOptions.fullscreenMode!==f.require("ivideon.views.CameraVideoView").FULLSCREEN_MODE_EXTERNAL_EMBEDDED){k.cameraVideoView.exitFullscreen()
}}k.$video.addClass("m-hidden");k.$wrapper.removeClass("m-video").addClass("m-splash");k.updatePreview();if(j&&j.isSupported()){j.stop(k._updatePreviewTimer);k._updatePreviewTimer=j.every(20000,120000,function(){k.updatePreview()
})}k._fireExternalEvent({event:"iv-embed-splash"})};g.showVideo=function(l){var m=this;if(!m._camera){m.showSplash();return}if(m._state===h.STATE_VIDEO){return}m._state=h.STATE_VIDEO;m.$wrapper.removeClass("m-splash").addClass("m-video");
m.$video.removeClass("m-hidden");if(j&&j.isSupported()){j.stop(m._updatePreviewTimer)}if(!m.cameraVideoView){var k=f.require("ivideon.views.CameraVideoView");m.cameraVideoView=new k(f.optMerge(f.app.getConfig("cameraVideoViewOptions"),{camera:m._camera,container:m.$video,normalIdleHideControls:true,fullscreenIdleHideControls:true,videoSizeFitHeight:0,fullscreenEnabled:false,embedButtonEnabled:true,abuseButtonEnabled:true,allowPauseLiveStream:false,allowStopLiveStream:true,goToLiveButtonEnabled:false,pingOnError:false},m.options.cameraVideoViewOptions));
m.cameraVideoView.events.on("videoAppeared",function(){m._error=null;m._renderError();m.showVideo(true);m._fireExternalEvent({event:"iv-embed-video-appeared"})});m.cameraVideoView.events.on("videoDisappeared",function(o,n){m._fireExternalEvent({event:"iv-embed-video-disappeared"})
});m.cameraVideoView.events.on("livePlaybackFailed",function(p,n){var o=f.tr(i,"error.embed_no_connection");if(!n.playerEngineError){m._camera.online=false;m._error=new Error(o);m._renderError();m.showSplash()
}});m.cameraVideoView.events.on("liveLoadCancelled",function(o,n){if(n.reason===k.REASON_CLEAR||n.reason===k.REASON_DESTROY){m.showSplash()}});m.cameraVideoView.events.on("livePlaybackCancelled",function(o,n){if(n.reason===k.REASON_CLEAR||n.reason===k.REASON_DESTROY){m.showSplash()
}});m.cameraVideoView.events.on("enterFullscreen",function(){if(m.cameraVideoView&&m.cameraVideoView.getFullscreenMode()===k.FULLSCREEN_MODE_EXTERNAL){m.cameraVideoView.setAbuseButtonEnabled(false)}});
m.cameraVideoView.events.on("exitFullscreen",function(){if(m.cameraVideoView&&m.cameraVideoView.getFullscreenMode()===k.FULLSCREEN_MODE_EXTERNAL){m.cameraVideoView.setAbuseButtonEnabled(m._abuseButtonAllowed)
}m.showSplash()});m.cameraVideoView.events.on("embed-button-clicked",function(){if(!m.cameraVideoView){return}m.cameraVideoView.setEmbedButtonEnabled(false);var n=new (f.require("ivideon.views.VideoEmbedDialog"))({camera:m.cameraVideoView.getCamera(),closePublicAccessButton:false,previewButton:false,embedded:true});
n.events.on("destroying",function(){m.cameraVideoView.setEmbedButtonEnabled(true)});n.show()});m.cameraVideoView.events.on("abuse-button-clicked",function(){if(!m.cameraVideoView){return}m.cameraVideoView.setAbuseButtonEnabled(false);
var n=new (f.require("ivideon.views.VideoAbuseDialog"))(b.extend({},{controller:m,camera:m.cameraVideoView.getCamera(),cameraVideoView:m.cameraVideoView,cameraCommentsAvailable:m._cameraCommentsAvailable}));
n.events.on("destroying",function(){m.cameraVideoView.setAbuseButtonEnabled(m._abuseButtonAllowed)});n.show()});if(b.browser.ios){m.cameraVideoView.getPlayer().events.on("pause",m._onVideoPlaybackStop,m)
}if(b.browser.android){m.cameraVideoView.getPlayer().getOverlayElement().hide()}m.cameraVideoView.setAbuseButtonEnabled(m._abuseButtonAllowed);m.cameraVideoView.init()}m._fitWindow();m._fireExternalEvent({event:"iv-embed-video"});
if(!l){m.cameraVideoView.select(null)}m._checkAbuse()};g._onVideoPlaybackStop=function(){var k=this;if(k._state!==h.STATE_VIDEO){return}k.showSplash()};g._onPlayButtonClick=function(){var k=this;if(k._state!==h.STATE_SPLASH){return
}if(!k._camera.online){k._camera.online=true}k.showVideo()};g._renderError=function(){var l=this,k=l._error;if(k){l.$splash.addClass("m-error");if(k.message){l.$statusbar.addClass("m-error").text(k.message);
l.$statusbarWrapper.show()}else{l.$statusbar.empty().removeClass("m-error");l.$statusbarWrapper.hide()}}else{l.$statusbar.empty().removeClass("m-error");l.$statusbarWrapper.hide();l.$splash.removeClass("m-error")
}};g._fitWindow=function(){var n=this,m,l,k;if(!n._camera){return}m=b(e);k={width:n._camera.width,height:n._camera.height};l={width:m.width(),height:m.height()};k=f.utils.fitRectIntoFrame(k,l);n.$wrapper.css("width",k.width);
n.$wrapper.add(n.$previewBuffers).css({width:k.width,height:k.height});n.$wrapper.css({top:(l.height-k.height)/2});if(n.cameraVideoView){n.cameraVideoView.updateSize()}};g._onWindowResize=function(){var k=this;
e.clearTimeout(k._onWindowResizeThrottleTimer);k._onWindowResizeThrottleTimer=e.setTimeout(function(){k._fitWindow()},0)};g._addEmbeddedLogo=function(l){var m=this,k;if(!l){return}k=(l.url?b('<a class="ivideon-embedded-logo" target="_blank"></a>').attr("href",l.url):b('<span class="ivideon-embedded-logo"></span>')).html((l.imageUrl?'<img class="ivideon-embedded-logo-image" src="'+f.utils.htmlencode(l.imageUrl)+'" />':'<span class="ivideon-embedded-logo-text">'+f.utils.htmlencode(l.text||l.url||"")+"</span>")+'<span class="ivideon-embedded-powered-by-logo"></span>').attr("title",l.tooltip||"");
m.$embeddedLogo=b('<div class="ivideon-embedded-logo-wrapper '+(l.cssClassNames||"")+'" />').append(k);m.$wrapper.append(m.$embeddedLogo)};g._addEmbeddedLink=function(l){var m=this,k;if(!l){return}k=(l.url?b('<a target="_blank" class="ivideon-embedded-link m-anchor" />').attr("href",l.url).on("click",function(){m.showSplash()
}):b('<span class="ivideon-embedded-link" />')).text(l.text||l.url||"").attr("title",l.tooltip||"");m.$embeddedLink=b('<div class="ivideon-embedded-link-wrapper '+(l.cssClassNames||"")+'" />').append(k);
m.$wrapper.append(m.$embeddedLink)};g._addCollapsibleBanner=function(m){var o=this,l,n,k;if(!m){return}l=b('<div class="ivideon-collapsible-banner ivideon-collapsible-banner__m-closed"><a class="ivideon-collapsible-banner__contents" href="'+m.url+'" target="_blank"><div class="ivideon-collapsible-banner__image"><img src="'+m.imageUrl+'" /></div><div class="ivideon-collapsible-banner__text">'+(m.html||"")+'</div></a><div class="ivideon-collapsible-banner__actions"><div class="ivideon-collapsible-banner__expand"></div><div class="ivideon-collapsible-banner__close"></div></div></div></div>');
l.on("click",".ivideon-collapsible-banner__image, .ivideon-collapsible-banner__contents",function(){e.clearTimeout(k);k=e.setTimeout(function(){l.addClass("ivideon-collapsible-banner__m-collapsed")},2000);
o.showSplash()}).on("mouseenter touchstart touchmove",function(){e.clearTimeout(k);l.removeClass("ivideon-collapsible-banner__m-collapsed")}).on("mouseleave touchend touchstartoutside",function(){e.clearTimeout(k);
k=e.setTimeout(function(){l.addClass("ivideon-collapsible-banner__m-collapsed")},2000)}).on("click",".ivideon-collapsible-banner__expand",function(){e.clearTimeout(k);l.removeClass("ivideon-collapsible-banner__m-collapsed")
}).on("click",".ivideon-collapsible-banner__close",function(){e.clearTimeout(n);e.clearTimeout(k);l.addClass("ivideon-collapsible-banner__m-closed")});k=e.setTimeout(function(){l.addClass("ivideon-collapsible-banner__m-collapsed")
},15000);n=e.setTimeout(function(){l.removeClass("ivideon-collapsible-banner__m-closed")},1000);o.$collapsibleBanner=b('<div class="ivideon-collapsible-banner-wrapper '+(m.cssClassNames||"")+'" />').append(l);
o.$wrapper.append(o.$collapsibleBanner)};g._addFreeBanner=function(l){var m=this,k;if(!l){return}k=(l.url?b('<a class="ivideon-free-banner m-anchor" target="_blank"></a>').attr("href",l.url).on("click",function(){m.showSplash()
}):b('<span class="ivideon-free-banner"></span>')).html(l.imageUrl?'<img class="ivideon-free-banner-image" src="'+f.utils.htmlencode(l.imageUrl)+'" />':f.utils.htmlencode(l.text||"")).attr("title",l.tooltip||"");
m.$freeBanner=b('<div class="ivideon-free-banner-wrapper '+(l.cssClassNames||"")+'" />').append(k);m.$wrapper.append(m.$freeBanner)};g._checkAbuse=function(){var l=this,k=b.Deferred();f.app.service("backendAPI").checkAbuse({camera:l._camera}).done(function(m){l._abuseButtonAllowed=!!m.allowed;
if(l.cameraVideoView){l.cameraVideoView.setAbuseButtonEnabled(l._abuseButtonAllowed)}k.resolve(m)}).fail(function(m){if(l.cameraVideoView){l.cameraVideoView.setAbuseButtonEnabled(l._abuseButtonAllowed)
}k.reject(m)});return k.promise()};g.reportAbuse=function(l){var m=this,k=b.Deferred();if(m._abuseRequestDeferred){return m._abuseRequestDeferred}m._abuseRequestDeferred=k;m._abuseButtonAllowed=false;if(m.cameraVideoView){m.cameraVideoView.setAbuseButtonEnabled(m._abuseButtonAllowed)
}f.app.service("backendAPI").reportAbuse({camera:m._camera,topic:l.topic,comment:l.comment,email:l.email}).done(function(n){f.utils.notify({text:f.tr(i,"abuse.success.text")});k.resolve(n)}).fail(function(n){f.utils.notifyError({text:f.tr(i,"abuse.error.text")+(n?" "+n.message:"")});
k.reject(n)}).always(function(){m._abuseRequestDeferred=null;m._checkAbuse()});return k.promise()};g._fireExternalEvent=function(k){var l=this;k=b.extend(true,{url:l._url,error:l._error},k);f.app.postMessage("parent",k)
}}(window,window._ivideon));