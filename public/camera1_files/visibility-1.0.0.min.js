!function(e){"use strict";var i=function(i){return i!=e},n=window.Visibility={onVisible:function(e){if(!n.isSupported()||!n.hidden())return e(),n.isSupported();var i=n.change(function(){n.hidden()||(n.unbind(i),e())});return i},change:function(e){if(!n.isSupported())return!1;n._lastCallback+=1;var i=n._lastCallback;return n._callbacks[i]=e,n._setListener(),i},unbind:function(e){delete n._callbacks[e]},afterPrerendering:function(e){if(!n.isSupported()||"prerender"!=n.state())return e(),n.isSupported();var i=n.change(function(t,r){"prerender"!=r&&(n.unbind(i),e())});return i},hidden:function(){return n._prop("hidden",!1)},state:function(){return n._prop("visibilityState","visible")},isSupported:function(){return i(n._prefix())},_doc:window.document,_chechedPrefix:null,_listening:!1,_lastCallback:-1,_callbacks:{},_hiddenBefore:!1,_init:function(){n._hiddenBefore=n.hidden()},_prefix:function(){return null!==n._chechedPrefix?n._chechedPrefix:i(n._doc.visibilityState)?n._chechedPrefix="":i(n._doc.webkitVisibilityState)?n._chechedPrefix="webkit":void 0},_name:function(e){var i=n._prefix();return""==i?e:i+e.substr(0,1).toUpperCase()+e.substr(1)},_prop:function(e,i){return n.isSupported()?n._doc[n._name(e)]:i},_onChange:function(e){var i=n.state();for(var t in n._callbacks)n._callbacks[t].call(n._doc,e,i);n._hiddenBefore=n.hidden()},_setListener:function(){if(!n._listening){var e=n._prefix()+"visibilitychange",i=function(){n._onChange.apply(Visibility,arguments)};n._doc.addEventListener?n._doc.addEventListener(e,i,!1):n._doc.attachEvent(e,i),n._listening=!0,n._hiddenBefore=n.hidden()}}};n._init();var t={every:function(e,t,r){n._initTimers(),i(r)||(r=t,t=null),n._lastTimer+=1;var a=n._lastTimer;return n._timers[a]={interval:e,hiddenInterval:t,callback:r},n._runTimer(a,!1),n.isSupported()&&n._setListener(),a},stop:function(e){var t=n._timers[e];return i(t)?(n._stopTimer(e),delete n._timers[e],t):!1},_lastTimer:-1,_timers:{},_timersInitialized:!1,_initTimers:function(){n._timersInitialized||(n._timersInitialized=!0,n.change(function(){n._timersStopRun()}))},_setInterval:function(e,i){return setInterval(e,i)},_runTimer:function(e,i){var t,r=n._timers[e];if(n.hidden()){if(null===r.hiddenInterval)return;t=r.hiddenInterval}else t=r.interval;i&&r.callback.call(window),r.id=n._setInterval(r.callback,t)},_stopTimer:function(e){var i=n._timers[e];clearInterval(i.id),delete i.id},_timersStopRun:function(){var e=n.hidden(),i=n._hiddenBefore;if(e&&!i||!e&&i)for(var t in n._timers)n._stopTimer(t),n._runTimer(t,!e)}};for(var r in t)Visibility[r]=t[r]}();