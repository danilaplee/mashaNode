(function(F,q,k){"use strict";var x=q.$,z=F.CrashKit,p={}.toString,I="ivideon.utils.reports",K=q.provide(I),B=false,j=false,D={},h=[],w=10,o=null,s=I,J=/^\[?ivideon\./,c={"dlg.error.title":"An error occurred","dlg.error.reported":"Error report has been sent to the Support team. <br />We will do our best to fix it as soon as possible!","dlg.error.cause":"The error may be caused by an incorrect or conflicting behavior of browser extensions and add-ons. If the error disappears after some extension has been disabled, please report the extension name to us!","dlg.error.refresh.button":"Refresh the page","dlg.error.refresh.confirmation":"Refresh the page automatically?","dlg.error.not_reported":"We could not send the report automatically. Please, copy the following and send it to the <strong>Support team</strong>:","dlg.error.report.button":"Create e-mail for Support team","dlg.error.report.paste_here":"Copy the report and paste it here below the line.\n-----------------------------------------\n\n\n"},g=function(N,Q){var O,P=[];
O=N;while(O){if(P.indexOf(O)>=0){Q(O,true);return}P[P.length]=O;if(false===Q(O)){return}O=O.inner}},H=function(T,P){if(!T){return}var O,V,S,W,R,N,Q,X,U={}.hasOwnProperty;S={name:T.name||"",message:T.message||""};
if(P){S.recursion=P}if(p.call(T.stack)==="[object Array]"){O=T}else{O=(z&&z.computeStackTrace?z.computeStackTrace(T,0):null);if(O&&O.mode!=="callers"){S.stack=O.stack}else{S.stack=null}}for(W in T){if(U.call(T,W)){if(typeof S[W]==="undefined"&&W!=="inner"&&W!=="error"&&typeof T[W]!=="function"){S[W]=q.toJSONValue(T[W])
}}}if(O!==T){for(W in O){if(U.call(O,W)){if(W!=="stack"&&W!=="inner"&&W!=="error"&&typeof T[W]!=="function"){S[W]=O[W]}}}}if(!S.type){delete S.type}V=S.stack;for(N=(V?V.length:0),R=0;R<N;++R){if(!V[R].context||!V[R].context.length){delete V[R].context;
continue}for(X=(V[R].context?V[R].context.length:0),Q=0;Q<X;++Q){if(V[R].context[Q]){V[R].context[Q]=x.trim(V[R].context[Q])}}}S.stack=V||[];return S},C=(x("html").attr("data-crashkit")||""),E=false,M=false,v=function(O){try{return(F.location?F.location.href:null)
}catch(N){q.console.error(O+N.message,N)}return null},f=function(Q,R,P){var O=I+" _collectProps ";try{x.each(P,function(U,T){try{R[T]=Q[T]}catch(S){q.console.error(O+S.message,S)}})}catch(N){q.console.error(O+N.message,N)
}},d=function(O){var P=I+" _generateReport ",R,U=null,Q=new Date(),N,S={},V;try{S.$=(x&&x.fn?x.fn.jquery:null);N=(F.jQuery&&F.jQuery.fn?F.jQuery.fn.jquery:null);if(S.$!==N){S.jQuery=N}}catch(T){q.console.error(P+T.message,T)
}R={refs:C,date:Q.toString(),dateTimezoneOffset:Q.getTimezoneOffset(),defaultTimezone:(q&&q.getDefaultTimezone?q.getDefaultTimezone():null),detectedTimezone:(q&&q.getDetectedTimezone?q.getDetectedTimezone():null),timestamp:Q.getTime(),timestampSynced:(q&&q.now?q.now():null),url:null,referrer:null,iframe:null,popup:null,navigator:{},screen:{},window:{},documentElement:{},documentMode:null,plugins:{},libs:S,config:{app:{},session:{}},serversideInitial:D.serversideInitial};
x.extend(R,q.toJSONValue(O));R.url=v(P);if(h&&h.length){R.timestampInit=o;R.actions=q.toJSONValue(h)}try{R.referrer=F.document.referrer}catch(T){q.console.error(P+T.message,T)}try{R.iframe=(F.parent&&F.parent!==F)
}catch(T){q.console.error(P+T.message,T)}try{R.popup=(F.opener&&F.opener!==F)}catch(T){q.console.error(P+T.message,T)}f(F.navigator,R.navigator,["cookieEnabled","language","userLanguage","onLine","platform","userAgent"]);
f(F.screen,R.screen,["width","height","availWidth","availHeight"]);f(F,R.window,["innerWidth","innerHeight"]);f(F.document.documentElement,R.documentElement,["clientWidth","clientHeight"]);try{if(F.document.documentMode>0){R.documentMode=F.document.documentMode
}}catch(T){q.console.error(P+T.message,T)}try{if(F.flashembed&&F.flashembed.getVersion){R.plugins.flash={version:F.flashembed.getVersion()}}}catch(T){q.console.error(P+T.message,T)}try{V=(q&&q.app&&q.app.getConfig?q.app.getConfig():null);
R.config.app=(V&&V.app?q.toJSONValue(V.app):null);R.config.session=(V&&V.session?q.toJSONValue(V.session):null)}catch(T){q.console.error(P+T.message,T)}try{U=JSON.stringify(R)}catch(T){q.console.error(P+T.message,T)
}return{report:R,reportString:U}},y=function(P,O){var N=x.Deferred();if(!P||!P.report||!P.reportString||!O){return x.Deferred().reject(P,null).promise()}x.ajax({type:"post",url:O,timeout:3000,cache:false,data:{report:P.reportString},dataType:"json",success:function(Q){if(Q.success){N.resolve(P,Q)
}else{N.reject(P,Q)}},error:function(){N.reject(P,null)}});return N.promise()},t=function(N){return(N&&N.replace(/#.*$/,"")===(""+(v(I+" _isErrorOnCurrentPage ")||"")).replace(/#.*$/,""))},r=function(N){var O=D.crashkitScriptsRegexp;
if(!O){O=/(?:\/assets\/[0-9]+\/)|(?:\/assets\/static\/)/}else{if(typeof O==="string"){O=new RegExp(O)}}return(N&&O&&O.test?O.test(N):false)},b=function(N){return(N&&/^(?:(?:http:\/\/www)|(?:https:\/\/ssl))\.google-analytics\.com\/ga\.js$/.test(N))
},a=function(N){return(N&&N.indexOf("http://s7.addthis.com/")===0)},u=function(W,P){if(!W){return false}if(M){return false}var T=false,V=W,S=(V.message||""),N=(V.stack&&V.stack[0]?V.stack[0].url:null),Q=(F.document?F.document.documentElement:null),U,R,O;
if(V.stack&&V.stack.length===1&&!N){return false}if(b(N)){return false}if(t(N)&&Q&&V.stack&&V.stack[0]&&V.stack[0].line>(Q.innerHTML||"").split("\n").length){return false}U=["argv is not defined"," has no method 'getDetectedLanguage'","Can't find variable: isInjected"," resource://",' "chrome://',"EBOpenPopHtml is not defined","can't load XRegExp twice in the same frame","Error connecting to extension","Attempting to use a disconnected port object","top.GLOBALS","originalCreateNotification","canvas.contentDocument","MyApp_RemoveAllHighlights","http://tt.epicplay.com","Can't find variable: ZiteReader","jigsaw is not defined","ComboSearch is not defined","http://loading.retry.widdit.com/","atomicFindClose","fb_xd_fragment","Script error."];
for(O=U.length,R=0;R<O;R++){if(S.indexOf(U[R])>-1){return false}}if(r(N)){return true}if(t(N)&&V.stack&&V.stack[0]&&V.stack[0].line>1){}if(t(N)&&V.stack&&V.stack[0]&&V.stack[0].line===1&&x.browser.chrome&&S==="Unexpected token :"){return false
}g(V,function(ad,ac){if(ac){return false}var aa,X,Z,ab=(ad.name||""),Y=(ad.message||"");if(J.test(ab)||J.test(Y)){T=true;return false}for(X=(ad.stack?ad.stack.length:0),aa=0;aa<X;++aa){if(ad.stack[aa]){Z=(ad.stack[aa].url||"");
if(Z==="http://serviceama-a.akamaihd.net/js/intext.js"){T=false;return false}if(r(Z)){T=true;return false}if((Z&&Z.indexOf("http://")!==0&&Z.indexOf("https://")!==0)){T=false;return false}}}});return T
},n=function(P,N,S){if(!P){return false}if(!S){return false}var O=(q&&q.utils&&q.utils.CriticalError),R=(q&&q.utils&&q.utils.NonCriticalError),Q=true;if(R&&(N instanceof R)){Q=false;return Q}g(N,function(Y,X){if(X){return false
}var W=(Y.name||""),V=(Y.message||""),U=(Y.stack&&Y.stack[0]?Y.stack[0].url:null),T=r(U);if(O&&(Y instanceof O)){Q=true;return false}if(R&&(Y instanceof R)){Q=false;return false}if(Y.inner){return}if(W==="TypeError"||W==="RangeError"||V.indexOf("TypeError:")===0||V.indexOf("RangeError:")===0){Q=true;
return false}if(V.indexOf("[ivideon.DependencyError]")===0){Q=true;return false}if(b(U)){Q=false;return false}if(a(U)){Q=false;return false}if(V==="Error loading script"){if(T){Q=true;return false}Q=false;
return false}if(V.indexOf("SetReturnValue")>=0){Q=false;return false}if(t(U)&&Y.stack&&Y.stack[0]&&Y.stack[0].line<=1){Q=false;return false}if((V.indexOf("uncaught exception: ")>=0||V.indexOf("(NS_ERROR")>=0)){Q=false;
return false}if(V.indexOf("fp_")>0&&(V.indexOf("NULL")>0||V.indexOf("null")>0)){Q=false;return false}if(!T){Q=false;return false}});return Q},m=function(V,Z,U){if(!V){return}if(E){return}var O,ad="",W="",S="",T=[],R=null,Q=(D.crashkitEmail||""),aa=(D.crashkitEmailSubject||""),P="",ae=(q?q.lang:null),N=(q&&q.tr&&ae&&ae.hasMessage&&ae.hasMessage(s,"dlg.error.title")?q.tr:function(ah,ag,aj){var af=c[ag],ai;
if(typeof af!=="string"){return ag}for(ai in aj){if(typeof aj[ai]!=="function"){af=af.replace(new RegExp("\\{"+ai+"\\}","g"),String(aj[ai]))}}return af}),X=!!(q&&q.utils&&q.utils.notifyError),ac=!X&&!!(q&&q.utils&&q.utils.dlg&&q.utils.dlg.error&&ae&&ae.getMessages("ivideon.utils")),ab;
if(V.critical){R=function(){F.location.reload();return false}}else{return}if(Z){ab=N(s,"dlg.error.reported");W+=(ab?"<p>"+ab+"</p>":"");ab=N(s,"dlg.error.cause");W+=(ab?"<p>"+ab+"</p>":"")}else{ab=N(s,"dlg.error.not_reported");
W+=(ab?"<p>"+ab+"</p>":"");W+='<textarea style="display:block;width:95%;height:7em;max-height:30em;margin:0.5em auto 0.5em 0;resize:vertical;" readonly="readonly" onclick="this.select();">';O=F.document.createElement("SPAN");
O.innerText=(U.reportString||"");W+=O.innerHtml;W+="</textarea>";ab=N(s,"dlg.error.cause");W+=(ab?"<p>"+ab+"</p>":"")}if(!Z&&Q){P=("mailto:"+Q+"?subject="+encodeURIComponent(aa+" "+U.report.refs)+"&body="+encodeURIComponent(N(s,"dlg.error.report.paste_here")))
}ad=N(s,"dlg.error.title");S="";if(P){S+='<a class="iv-btn" onclick="'+('window.open("'+P.replace(/(["'\\])/g,"\\$1")+'");return false;').replace('"',"&quot;")+'">'+N(s,"dlg.error.report.button")+"</a>"
}if(R){S+='<button type="button" class="iv-btn" onclick="window.location.reload();return false;">'+N(s,"dlg.error.refresh.button")+"</button>"}if(X){E=q.utils.notifyError({title:ad,text:W+(S?"<p>"+S+"</p>":""),expires:false}).done(function(af){if(V.critical){af.widget().find(".iv-notify-close").remove()
}})}else{if(ac){if(P){T.push({text:N(s,"dlg.error.report.button"),click:function(){F.open(P);return false}})}if(R){T.push({text:N(s,"dlg.error.refresh.button"),click:R})}E=q.utils.dlg.error({title:ad,message:W,classes:"m-critical-error",buttons:T,cancelHandler:R})
}else{try{if(!E&&F.document.body){F.document.body.innerHTML+='<div style="position:absolute;left:0;top:0;right:0;bottom:0;z-index:10000002;padding:20px;margin:0 auto;background:#fff;"><h1>'+ad+"</h1><div>"+W+"</div><div>"+S+"</div></div>";
E=true}}catch(Y){}}}},L=function(){if(q.app){q.app.end()}return true},e=function(O,N){var P;var Q=N.reportRequired;delete N.reportRequired;delete N.reported;P=d({error:N});q.console.error(I+".reportError: "+P.reportString,P.report);
if(P.report.error.message&&P.report.error.stack&&P.report.error.stack[0]&&P.report.error.stack[0].url&&P.report.error.stack[0].line){q.console.error("\n"+P.report.error.message+"\n"+P.report.error.stack[0].url+":"+P.report.error.stack[0].line+"\nstack: ",P.report.error.stack,"\n")
}if(P&&Q){O.reported=true;y(P,D.crashkitReportUrl).done(function(R){if(m){m(N,true,R)}}).fail(function(R){O.reported=false;if(m){m(N,false,R)}})}};K.init=function(O){var N;if(o===null){o=+(new Date())}try{if(!z||!z.report||!z.report.subscribe){throw new Error("[ivideon.DependencyError] CrashKit (ivideon_utils_reports_init)")
}z.report.subscribe(function(Q){K.reportError(Q)});x.extend(D,O)}catch(P){N=P}if(N){K.reportError(N)}};K.logAction=function(Q,T){var P=h,O=(P.length-(w-1)),N=(P[0]&&P[0].r?P[0].r+O:O),S={t:(+(new Date())-(o===null?0:o)),a:Q};
if(O>0){P.splice(0,O);P[0].r=N}if(T){S.d=T}if(q.app&&q.app.getState()!==q.utils.Application.STATE_RUNNING){S.s=q.app.getState()}try{S.h=F.location.hash;if(!S.h){delete S.h}}catch(R){q.console.error(I+".logAction "+R.message,R)
}P[P.length]=S;return true};K.processError=function i(P,N){var O={},Q;g(P,function(S,R){if(Q){Q.inner=H(S,R);Q=Q.inner}else{O=Q=H(S,R)}});O.reported=false;if(P){O.reportRequired=u(O,P);O.critical=n(O,P,O.reportRequired)
}else{O.reportRequired=false;O.critical=false}if(N&&typeof N.context==="string"){N.context=N.context.replace(/\n\s+/g,"\n")}O.context=N;return O};K.makeReport=d;K.makeErrorReport=function A(O,N){return d({error:K.processError(O,N)})
};K.reportError=function l(Q,N){var O,U;if(q.app&&q.app.isEnded()){return}if(!Q){return}if(Q.reported){q.console.error(I+".reportError: error was already reported: ",Q);return}if(B){q.console.error(I+".reportError: error reported during other report: ",Q);
return}B=true;try{O=K.processError(Q,N);if(!j){j=true;try{if(q.app&&q.app.events){q.app.events.fire("error",O)}}catch(P){U=H(P)}j=false}e(Q,O)}catch(S){Q.reported=false;try{U=H(S)}catch(T){B=false;return L()
}}try{if(U){e(U,U)}if(U||O.critical){B=false;return L()}}catch(R){B=false;return L()}B=false;return false};K.reportFeedback=function G(R,Q,O){var P,N;if(typeof R!=="string"){throw new q.utils.ArgumentError(I+'.reportFeedback: Argument "message" must be string.')
}if(q.app&&q.app.isEnded()){return x.Deferred().reject(null,null).promise()}if(O&&O.gatrack&&q.trackEvent){q.trackEvent(O.gatrack)}P=d({feedback:{message:R,type:Q}});N=y(P,D.feedbackReportUrl);N.done(function(S){if(q&&q.utils&&q.utils.notify){if(!O||O.notify!==false){q.utils.notify({text:q.tr(s,"feedback.success",S.report)})
}}}).fail(function(S){if(q&&q.utils&&q.utils.notify){if(!O||O.notify!==false){q.utils.notifyError({text:q.tr(s,"feedback.error",S.report)})}}});return N.promise()};K.trackEvent=function(S,U,P,T,R){if(typeof S==="object"){R=S.noninteraction;
T=S.value;P=S.label;U=S.action;S=S.category}if(!S){throw new q.utils.ArgumentError(I+'.trackEvent: Argument "category" not set.')}if(!U){throw new q.utils.ArgumentError(I+'.trackEvent: Argument "action" not set.')
}try{if(!F.ga){throw new Error("window.ga missing.")}F.ga("send",{hitType:"event",eventCategory:String(S),eventAction:String(U),eventLabel:String(P||""),eventValue:parseFloat(T||0),nonInteraction:(R!==false)});
return true}catch(Q){var O=new q.utils.NonCriticalError(I+".trackEvent: "+Q.message);O.inner=Q;var N={func:I+".trackEvent"};if(q.reportError){q.reportError(O,N)}else{if(q.console&&q.console.error){q.console.error(O,N)
}}}return false};x.each(["logAction","trackEvent","processError","reportError","reportFeedback","makeReport","makeErrorReport"],function(N,O){q[O]=K[O]})}(window,window._ivideon));