/** @license MIT License (c) copyright 2011-2013 original author or authors */
var when=function(e){function t(e,t,n,i){return r(e).then(t,n,i)}function n(e,t){this.then=e;this.inspect=t}function r(e){return o(function(t){t(e)})}function i(e){return t(e,f)}function s(){function i
(i,s,o){e.resolve=e.resolver.resolve=function(e){if(n)return r(e);n=!0;i(e);return t};e.reject=e.resolver.reject=function(e){if(n)return r(f(e));n=!0;s(e);return t};e.notify=e.resolver.notify=function(
e){o(e);return e}}var e,t,n;e={promise:D,resolve:D,reject:D,notify:D,resolver:{resolve:D,reject:D,notify:D}};e.promise=t=o(i);return e}function o(e){function s(e,n,i){return o(function(s,o,u){r?r.push(
function(t){t.then(e,n,i).then(s,o,u)}):P(function(){t.then(e,n,i).then(s,o,u)})})}function a(){return t?t.inspect():x()}function h(e){if(!r)return;t=u(e);c(r,t);r=D}function p(e){h(f(e))}function d(e)
{r&&c(r,l(e))}var t,r=[];try{e(h,p,d)}catch(i){p(i)}return new n(s,a)}function u(e){return e instanceof n?e:e===Object(e)&&"then"in e?o(function(t,n,r){P(function(){try{var i=e.then;typeof i=="function"?
C(i,e,t,n,r):t(a(e))}catch(s){n(s)}})}):a(e)}function a(e){var t=new n(function(n){try{return typeof n=="function"?u(n(e)):t}catch(r){return f(r)}},function(){return E(e)});return t}function f(e){var t=new 
n(function(n,r){try{return typeof r=="function"?u(r(e)):t}catch(i){return f(i)}},function(){return S(e)});return t}function l(e){var t=new n(function(n,r,i){try{return typeof i=="function"?l(i(e)):t}catch(
s){return l(s)}});return t}function c(e,t){P(function(){var n,r=0;while(n=e[r++])n(t)})}function h(e){return e&&typeof e.then=="function"}function p(e,n,r,i,s){return t(e,function(e){function u(r,i,s){
function d(e){c(e)}function v(e){l(e)}var o,u,a,f,l,c,h,p;h=e.length>>>0;o=Math.max(0,Math.min(n,h));a=[];u=h-o+1;f=[];if(!o)r(a);else{c=function(e){f.push(e);if(!--u){l=c=j;i(f)}};l=function(e){a.push
(e);if(!--o){l=c=j;r(a)}};for(p=0;p<h;++p)p in e&&t(e[p],v,d,s)}}return o(u).then(r,i,s)})}function d(e,t,n,r){function i(e){return t?t(e[0]):e[0]}return p(e,1,i,n,r)}function v(e,t,n,r){return b(e,j).
then(t,n,r)}function m(){return b(arguments,j)}function g(e){return b(e,E,S)}function y(e,t){return b(e,t)}function b(e,n,r){return t(e,function(e){function i(i,s,o){var u,a,f,l,c;f=a=e.length>>>0;u=[]
;if(!f){i(u);return}l=function(e,a){t(e,n,r).then(function(e){u[a]=e;--f||i(u)},s,o)};for(c=0;c<a;c++)c in e?l(e[c],c):--f}return o(i)})}function w(e,n){var r=C(N,arguments,1);return t(e,function(e){var i
;i=e.length;r[0]=function(e,r,s){return t(e,function(e){return t(r,function(t){return n(e,t,s,i)})})};return T.apply(e,r)})}function E(e){return{state:"fulfilled",value:e}}function S(e){return{state:"rejected"
,reason:e}}function x(){return{state:"pending"}}function P(e){L.push(e)===1&&H()}function H(){k(B)}function B(){var e,t=0;while(e=L[t++])e();L=[]}function j(e){return e}t.defer=s;t.resolve=r;t.reject=i
;t.join=m;t.all=v;t.map=y;t.reduce=w;t.settle=g;t.any=d;t.some=p;t.isPromise=h;t.promise=o;n.prototype={otherwise:function(e){return this.then(D,e)},ensure:function(e){function t(){return r(e())}return this
.then(t,t).yield(this)},yield:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return v(t,function(t){return e.apply(D,t)})})},always:function(e,t){return this
.then(e,e,t)}};var T,N,C,k,L,A,O,M,_,D;L=[];A=e.setTimeout;k=typeof setImmediate=="function"?setImmediate.bind(e):typeof process=="object"&&process.nextTick?process.nextTick:typeof vertx=="object"?vertx
.runOnLoop:function(e){A(e,0)};O=Function.prototype;M=O.call;C=O.bind?M.bind(M):function(e,t){return e.apply(t,N.call(arguments,2))};_=[];N=_.slice;T=_.reduce||function(e){var t,n,r,i,s;s=0;t=Object(this
);i=t.length>>>0;n=arguments;if(n.length<=1)for(;;){if(s in t){r=t[s++];break}if(++s>=i)throw new TypeError}else r=n[1];for(;s<i;++s)s in t&&(r=e(r,t[s],s,t));return r};return t}(this);
